(function($){$(function(){blog.init()});var blog={_category:"",init:function(){this.blogDrafArticle.init();this.blogReaderForwardNumber.init();this.blogTagsList.init();this.blogThumbnail.init();this.blogFullPublish.init();this.blogManager.init();this.blogEditorManager.init();this.blogCategoryManager.init();this.blogVcode.init()},blogCategoryManager:{init:function(){this.categoryManager()},categoryManager:function(){var modifymark=false;var originalcategoryname="";function updateCategory(id,txt){var name=$("#name_"+id).text();if(name==txt){return}else{var perm=$("#hide_"+id+":checked").length;$.ajax({url:"/a/blog/home/category/update.htm?_input_encode=UTF-8&_output_encode=UTF-8",data:{id:id,name:$.trim(name),desc:"",perm:perm},type:"POST",success:function(result){var json=$.parseJSON(result);if(json.status){setTimeout(function(){$.sentenceNotice({type:"notice",delay:1000,icon:"success",content:json.msg})},200);modifymark=true}else{setTimeout(function(){$.sentenceNotice({type:"notice",delay:1000,icon:"error",content:json.msg})},200)}}})}}var $dialogCategoryManager={};$("#managecategory").live("click",function(){$.ajax({url:"/a/blog/home/category/list.htm?_input_encode=UTF-8&_output_encode=UTF-8",data:"",type:"POST",success:function(result){var json=$.parseJSON(result);var $content="";$.each(json.categoryList,function(i,n){if(n.perm==0){$content+='<li id="item_'+n.id+'" class="rs"><span class="col-1"><span id="editname_'+n.id+"_"+n.name+'"  title="'+n.name+'" class="sort-name-default"><strong id="name_'+n.id+'">'+n.name+'</strong><a href="javascript:;" class="edit">编辑</a></span>	</span><span class="col-3"><span class="create-date">'+n.createOn+'</span></span><span class="col-4"><span class="tool"><input class="hidecategory" id="hide_'+n.id+'" type="checkbox">隐藏　　<a  id="categoryid_'+n.id+'" class="deleteThisCategory" href="javascript:;">删除</a></span></span></li>'}else{$content+='<li id="item_'+n.id+'" class="rs"><span class="col-1"><span id="editname_'+n.id+"_"+n.name+'"  title="'+n.name+'" class="sort-name-default"><strong id="name_'+n.id+'">'+n.name+'</strong><a href="javascript:;" class="edit">编辑</a></span>	</span><span class="col-3"><span class="create-date">'+n.createOn+'</span></span><span class="col-4"><span class="tool"><input class="hidecategory" id="hide_'+n.id+'" type="checkbox" checked="checked">隐藏　　<a  id="categoryid_'+n.id+'" class="deleteThisCategory" href="javascript:;">删除</a></span></span></li>'}});$dialogCategoryManager=$.dialog({className:"",labAccept:"保存",labCancel:"取消",title:"管理分类",content:'<div class="dialog-blog-set"><ul><li class="title"><span class="col-1">分类名</span><span class="col-3">创建日期</span><span class="col-4">分类隐藏</span></li></ul><ul style="height:180px;" class="items-list">'+$content+'</ul><ul><li class="rs"><span class="sort-name-add"><input  id="addcategoryname"  type="text" value="填写分类名" class="sort-name-input"><a id="addcategory" class="btn1" href="javascript:;">新增分类</a></span></li></ul></div>',fixed:true,modal:true,scrollIntoView:true,onBeforeAccept:function(){},onClose:function(){if(modifymark){var url=window.location.href;var ihome="http://i.sohu.com/blog/home/entry/list.htm";if(url==ihome){window.location.href=ihome}else{window.location.href=url}}}});$(".sort-name-default").live("mouseenter",function(){$(this).addClass("sort-name-default-hover")}).live("mouseleave",function(){$(this).removeClass("sort-name-default-hover")})}});$("#addcategoryname").live("click",function(){var handler=this;if($(handler).val()=="填写分类名"){$(handler).val("").css({color:"#000000"})}}).live("focusout",function(){var handler=this;if($(handler).val()==""||$(handler).val()=="填写分类名"){$(handler).val("填写分类名").css({color:"#999999"})}});$(".edit").live("click",function(){var temp=$(this).parent().attr("id").split("_");var type=temp[0];var id=temp[1];var name=temp[2];if(type=="editname"){$(this).parent().removeClass("sort-name-default-hover").addClass("sort-name-default-edit").html('<input id="editnameinput_'+id+'" type="text" value="'+name+'" class="sort-name-input"/>');$("#editnameinput_"+id).focus().bind("focusout",function(){var editname=$("#editnameinput_"+id).val().replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;");originalcategoryname=editname;if(/^\s*$/.test(originalcategoryname)){setTimeout(function(){$.sentenceNotice({type:"notice",delay:1000,icon:"error",content:"分类名称不能为空!"})},200);$("#editnameinput_"+id).val(name).focus();return false}else{if(originalcategoryname!=name){$(this).parent().attr({id:"editname_"+id+"_"+editname,title:editname}).removeClass("sort-name-default-edit").html('<strong id="name_'+id+'">'+editname+'</strong><a href="javascript:;" class="edit">编辑</a>');updateCategory(id,name)}else{if(originalcategoryname==name){$(this).parent().attr({id:"editname_"+id+"_"+editname,title:editname}).removeClass("sort-name-default-edit").html('<strong id="name_'+id+'">'+editname+'</strong><a href="javascript:;" class="edit">编辑</a>')}}}})}})});$(".hidecategory").live("click",function(){updateCategory(this.id.substr(5))});$(".deleteThisCategory").live("click",function(){var id=this.id.substr(11);$.confirm({title:false,icon:"icon-question",content:"确认删除吗？此操作不可逆！",labConfirm:"确认",labCancel:"取消",onConfirm:function($dialog){$.ajax({url:"/a/blog/home/category/delete.htm?_input_encode=UTF-8&_output_encode=UTF-8",data:{id:id},type:"POST",success:function(result){var json=$.parseJSON(result);if(json.status){$("#item_"+id).slideUp(500);setTimeout(function(){$("#item_"+id).remove();$dialogCategoryManager.adjust();modifymark=true;return false},700)}else{$.sentenceNotice({type:"notice",delay:2000,icon:"error",content:json.msg});return false}}})},onCancel:function($dialog){}})});$("#addcategory").live("click",function(){var name=$("#addcategoryname").val();var safename=$("#addcategoryname").val().replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;");if(name=="填写分类名"||$.trim(name)==""){$.sentenceNotice({type:"notice",delay:1000,icon:"error",content:"请填写分类名"});$("#addcategoryname").val("").focus()}else{if(name.replace(/[^\x00-\xff]/g,"aa").length>32){$.sentenceNotice({type:"notice",delay:1000,icon:"error",content:"分类名称超过32个字符"});$("#addcategoryname").focus()}else{var handler=this;$.ajax({url:"/a/blog/home/category/add.htm?_input_encode=UTF-8&_output_encode=UTF-8",data:{name:$.trim(name),desc:"",perm:"0"},type:"POST",success:function(result){var json=$.parseJSON(result);if(json.status){var id=json.categoryId;var time=json.createOn;var $newCategory='<li id="item_'+id+'" class="rs" style="display: none;"><span class="col-1"><span id="editname_'+id+"_"+safename+'"  class="sort-name-default"><strong title="'+$.trim(safename)+'" id="name_'+id+'">'+$.trim(safename)+'</strong><a href="javascript:;" class="edit">编辑</a></span>	</span><span class="col-3"><span class="create-date">'+time+'</span></span><span class="col-4"><span class="tool"><input class="hidecategory" id="hide_'+id+'" type="checkbox">隐藏　　<a id="categoryid_'+id+'" class="deleteThisCategory" href="javascript:;">删除</a></span></span></li>';var items_list=$(handler).closest("div.dialog-blog-set").find("ul.items-list").prepend($newCategory)[0];items_list.scrollTop=0;$("#item_"+id).slideDown();$("#addcategoryname").val("");if($(".items-list").height()<180){$(".items-list").height("180");$dialogCategoryManager.adjust()}else{$(".items-list").height("180")}if($("#categoryselect").length>0){$("#categoryselect").append('<option value="'+id+'">'+$.trim(name)+"</option>");$("#categoryselect").val(id);blog._category=id}}else{$.sentenceNotice({type:"notice",delay:1000,icon:"error",content:json.msg});return false}}})}}})}},blogFullPublish:{init:function(){if($("#updatetextareablog").length>0){$("#savedraftarticle").data("ArticleID",$("#articleid").val());var ibe=new $.BlogEditor({textarea:"#updatetextareablog",mode:"full",comment:false,footer:true,height:429,corner:{width:20,height:20,left:17,top:17,right:17,bottom:17}});blog.initPreviewHtml();ibe.find(".be-footer").html('<span class="blog-editor-spread"></span>');$(".blog-editor-spread").live("click",function(){ibe.setHeight(600);ibe.find(".be-footer").find(".blog-editor-spread").addClass("blog-editor-shrink").removeClass("blog-editor-spread");$("#savedraftarticle").data("BlogeditorSize","Full")});$(".blog-editor-shrink").live("click",function(){ibe.setHeight(300);$(".blog-editor-shrink").addClass("blog-editor-spread").removeClass("blog-editor-shrink");$("#savedraftarticle").data("BlogeditorSize","Simple")});$("#requesttag").live("click",function(){var str=ibe.htmlText();if(str.length<=0){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"请先填写日志内容，系统才能根据内容来提取标签。<br/>或者您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}})}else{if(str.length<100){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"您的日志内容过少，系统很难有效提取标签。<br/>请增加到100字以上。<br/>或者您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}})}else{_requestTag()}}});function _requestTag(){var url="/a/blog/home/tag/get.htm?_input_encode=UTF-8&_output_encode=UTF-8";if($("#blogtag").length>0){if($("#blogtag").val()=="请填写标题"){var text="  "+ibe.htmlText()}else{var text=$("#blogtag").val()+" "+$("#blogtag").val()+" "+ibe.htmlText()}}else{if($("#titleblog").length>0){if($("#titleblog").val()=="请填写标题"){var text="  "+ibe.htmlText()}else{var text=$("#titleblog").val()+" "+$("#titleblog").val()+" "+ibe.htmlText()}}}var options={requestUrl:url,method:"post",parameters:text};setTimeout(function(){_ajaxRequestTag(options)},500)}function _ajaxRequestTag(temp){var parameters=temp.parameters;var url=temp.requestUrl;$.ajax({url:url,type:"POST",data:{text:parameters,"var":"hello"},success:function(result){var tags=result.substr(5);if(result.length==7){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"很遗憾，系统没有提取出有效的标签。<br/>或许您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}});$("#blogtag").focus()}else{if(tags.length>0){$("#blogtag").val(tags).css({color:"#000000"})}}}})}var categoryid=$("#articlecategoryid").val();$("#categoryId").live("change",function(){categoryid=$("#categoryId option:selected").val()});function updatePublishArticle(){$("#updatepublisharticle").die("click",updatePublishArticle);var title=$.trim($("#titleblog").val());if($.trim(title).length==0||title=="请填写标题"){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"标题不能为空，请输入博客标题。",onClose:function($dialog){}});$("#titleblog").val("").focus();return}var content=ibe.htmlText();var tag=($("#blogtag").val()=="请输入标签")?"":$("#blogtag").val();var articleid=$("#articleid").val();var vcode=$("#vcode").val()||"";var vcodeEn=$("#vcodeEn").val()||"";var updateURL="/a/blog/home/entry/update.htm?_input_encode=UTF-8&_output_encode=UTF-8";var quicksaveArticleID=$("#savedraftarticle").data("ArticleID")||"";$.ajax({url:updateURL,type:"POST",data:{id:quicksaveArticleID,title:title,content:content,keywords:tag,categoryId:categoryid,oper:"art_ok",vcode:vcode,vcodeEn:vcodeEn},success:function(result){var json=$.parseJSON(result);if(!json.status){$.inform({icon:"icon-success",delay:1000,easyClose:true,content:"博客发布成功！即将跳转到博客浏览页面。"});setTimeout(function(){window.location.href=json.data},500)}else{$.inform({icon:"icon-error",delay:1500,easyClose:true,content:json.statusText})}}})}$("#updatepublisharticle").live("click",updatePublishArticle);function saveDraftArticle(){var title=$("#titleblog").val();if($.trim(title).length==0||title=="请填写标题"){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"标题不能为空，请输入博客标题。",onClose:function($dialog){}});$("#titleblog").focus();return}var content=ibe.htmlText();var tag=($("#blogtag").val()=="请输入标签")?"":$("#blogtag").val();var category=blog._category;var comment="0";$("#savedraftarticle").die("click");var vcode=$("#vcode").val()||"";var vcodeEn=$("#vcodeEn").val()||"";var updateURL="/a/blog/home/entry/update.htm?_input_encode=UTF-8&_output_encode=UTF-8";var quicksaveArticleID=$("#savedraftarticle").data("ArticleID");$.ajax({url:updateURL,type:"POST",data:{id:quicksaveArticleID,title:title,content:content,keywords:tag,categoryId:category,oper:"art_draft",allowComment:comment,vcode:vcode,vcodeEn:vcodeEn},success:function(result){var json=$.parseJSON(result);var BlogeditorSize=$("#savedraftarticle").data("BlogeditorSize");var Top=(BlogeditorSize!="Full")?"474px":"744px";var isEdit=$("#articleid").length;if(isEdit>0){Top=(BlogeditorSize!="Full")?"574px":"744px"}if(!json.status){var date=new Date();var hours=date.getHours();var minutes=date.getMinutes();var nowHours=(hours.length==1)?("0"+hours):hours;var nowMinutes=(minutes.length==1)?("0"+minutes):minutes;var time=nowHours+":"+nowMinutes;if($("#QuickSaveTips").length==0){$("#QuickSaveTips").data("State","Idle");var HtmlString='<span id="QuickSaveTips" style="display:none; text-align:center; height:22px;line-height:22px;border-radius: 5px 5px 5px 5px;background-color:#70b907;border:1px solid #e8e8e8;padding: 0 10px; color:#fff; position:absolute;width:200px;top:210px;padding:0 10px; margin:0 0 0 -100px; left:50%; " ></span>';$("body").append(HtmlString)}if($("#QuickSaveTips").data("State")!="Busy"){$("#QuickSaveTips").data("State","Busy");$("#QuickSaveTips").css({top:Top}).text("已成功为您保存到草稿箱").fadeIn(1000).delay(3000).fadeOut(1000);setTimeout(function(){$("#QuickSaveTips").data("State","Idle")},3000)}$("#savedraftarticle").data("ArticleID",json.data).live("click",saveDraftArticle)}else{if($("#QuickSaveTips").length==0){var HtmlString='<span id="QuickSaveTips" style="display:none; text-align:center; height:22px;line-height:22px;border-radius: 5px 5px 5px 5px;background-color:#70b907;border:1px solid #e8e8e8;padding: 0 10px; color:#fff; position:absolute;width:200px;top:210px;padding:0 10px; margin:0 0 0 -100px; left:50%; " ></span>';$("body").append(HtmlString)}if($("#QuickSaveTips").data("State")!="Busy"){$("#QuickSaveTips").data("State","Busy");$("#QuickSaveTips").css({top:Top}).text(json.statusText).fadeIn(1000).delay(3000).fadeOut(1000);setTimeout(function(){$("#QuickSaveTips").data("State","Idle")},3000)}$("#savedraftarticle").live("click",saveDraftArticle)}}})}$("#savedraftarticle").live("click",saveDraftArticle)}}},blogManager:{init:function(){this.publishArticle();this.deleteArticle()},publishArticle:function(){if($(".articlepublish").length>0){$(".articlepublish").live("click",function(){var id=(this.id).substr(8);$.ajax({url:"/a/blog/home/entry/publish.htm?_input_encode=UTF-8&_output_encode=UTF-8",type:"POST",data:{id:id},success:function(result){var json=$.parseJSON(result);if(json.status==0){$.inform({icon:"icon-success",delay:2500,easyClose:true,content:"博客发布成功！即将跳转到博客浏览页面。",onClose:function($dialog){}});setTimeout(function(){if(json.status==0){window.location.href=json.data}},2000);return false}else{if(json.status==1){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:json.statusText,onClose:function($dialog){}})}}}})})}},deleteArticle:function(){if($(".articledelete").length==0){return}$(".articledelete").live("click",function(){var id=(this.id).substr(8);$.confirm({title:false,defaultBtn:"cancel",content:"是否删除此博文？删除后不可恢复。",onConfirm:function(){$.ajax({url:"/a/blog/home/entry/delete.htm?_input_encode=UTF-8&_output_encode=UTF-8",type:"POST",data:{id:id},success:function(result){var json=$.parseJSON(result);if(json.status==0){$.inform({icon:"icon-success",delay:2000,easyClose:true,content:"删除成功。",onClose:function($dialog){}});if($("#id_"+id).length>0){var articlenum=parseInt($("#articlenum").text(),10)-1;var articlecountnum=parseInt($("#articlecountnum").text(),10)-1;$("#articlenum").text(articlenum);$("#articlecountnum").text(articlecountnum);$("#id_"+id).slideUp(500)}else{window.location.href=json.data}return false}else{$.inform({icon:"icon-error",delay:2000,easyClose:true,content:"删除失败。",onClose:function($dialog){}});return false}},error:function(){$.inform({icon:"icon-error",delay:2000,easyClose:true,content:"网络异常,请重试",onClose:function($dialog){}});return false}})},onCancel:function(event){return false}})})}},blogDrafArticle:{init:function(){this.initArticleDraf();this.setDraftKeywords()},initArticleDraf:function(){var that=this;if($("#publisharticlelink").length!=0){var id=$("#articleid").val();$("#categoryId").bind("change",function(){categoryid=$("#categoryId option:selected").val()});$("#publisharticle").bind("click",function(){that.publishArticleDraft(id)});$("#publisharticlelink").bind("click",function(){that.publishArticleDraft(id)})}if($("#articledeletelink").length!=0){var id=$("#articleid").val();$("#articledeletelink").bind("click",function(){$.confirm({title:false,icon:"icon-question",content:"确认删除吗？此操作不可逆！",labConfirm:"确认",labCancel:"取消",onConfirm:function($dialog){that.deleteArticleDraft(id)},onCancel:function($dialog){}})})}},deleteArticleDraft:function(id){$.ajax({url:"/a/blog/home/entry/delete.htm?_input_encode=UTF-8&_output_encode=UTF-8",type:"POST",data:{id:id},success:function(result){var json=$.parseJSON(result);if(!json.status){$.inform({icon:"icon-success",delay:2000,easyClose:true,content:json.statusText,onClose:function($dialog){}});setTimeout(function(){if(json.status==0){window.location.href=json.data}},2000)}else{$.inform({icon:"icon-error",delay:2000,easyClose:true,content:json.statusText,onClose:function($dialog){}});setTimeout(function(){window.location.href="http://i.sohu.com/blog/home/entry/list.htm"},2000)}}})},publishArticleDraft:function(id){$.ajax({url:"/a/blog/home/entry/publish.htm?_input_encode=UTF-8&_output_encode=UTF-8",type:"POST",data:{id:id},success:function(result){var json=$.parseJSON(result);if(json.status==0){$.inform({icon:"icon-success",delay:2500,easyClose:true,content:"博客发布成功！即将跳转到博客浏览页面。",onClose:function($dialog){}});setTimeout(function(){if(json.status==0){window.location.href=json.data}},2500);return false}else{$.inform({icon:"icon-error",delay:2000,easyClose:true,content:json.statusText,onClose:function($dialog){}});return false}}})},setDraftKeywords:function(){if($("#keywords").length>0){if($("#keywords").val().length==0){$("#keywords").val("请输入标签").css({color:"#999999"})}$("#keywords").live("click",function(){var handler=this;if($(handler).val()=="请输入标签"){$(handler).val("").css({color:"#666666"})}}).focusout(function(){var handler=this;var txt=$(handler).val();if($.trim(txt)=="请输入标签"||/^\s*$/.test(txt)==true){$(handler).val("请输入标签").css({color:"#999999"})}});$("#title").live("click",function(){var handler=this;if($(handler).val()=="请填写标题"){$(handler).val("").css({color:"#666666"})}else{$(handler).css({color:"#666666"})}}).focusout(function(){var handler=this;var txt=$(handler).val();if($.trim(txt)=="请填写标题"||/^\s*$/.test(txt)==true){$(handler).val("请填写标题").css({color:"#999999"})}})}}},blogReaderForwardNumber:{init:function(){var that=this;if($(".readernum").length>0){that.readerNumber()}if($(".forwardnum").length>0){that.forwardNumber()}},forwardNumber:function(){var ids=[];$(".forwardnum").each(function(i){var id=(this.id).substr(8);ids.push("blog_"+id+"_0_"+$space_config._xpt)});var ts=(new Date).getTime();$.ajax({url:"/a/app/mblog/getCounts.htm",type:"POST",data:"ids="+ids.join(","),dataType:"json",success:function(data){$.each(data,function(i,n){if(n.spreadcount==0){$("#forward_"+i).html("转发")}else{$("#forward_"+i).html("转发("+n.spreadcount+")")}if(n.commentcount==0){$("#comment_"+i).html("评论")}else{$("#comment_"+i).html("评论("+n.commentcount+")")}})}})},readerNumber:function(){var ids=[];$(".readernum").each(function(i){var id=(this.id).substr(7);ids.push(id)});var ts=(new Date).getTime();var vn="Blog.ercs_"+ts;var url=window.location.href;if(url.match("index.htm")||url.match("/blog/home/entry/list.htm")||url.match("/blog/show/entry/list.htm")){$.ajax({url:"http://ana.blog.sohu.com/blogcount",data:{l:ids.join(","),vn:ts},type:"GET",timeout:2000,dataType:"script",jsonp:vn,success:function(data){var info=eval(vn)||{};$.each(info,function(i,n){setTimeout(function(){$("#reader_"+i).html("阅读("+n+")")},0)})}})}else{$.ajax({url:"http://ana.blog.sohu.com/blogcount",data:{e:ids.join(","),vn:ts},type:"GET",timeout:2000,dataType:"script",jsonp:vn,success:function(data){var info=eval(vn)||{};$.each(info,function(i,n){setTimeout(function(){$("#reader_"+i).html("阅读("+n+")")},0)})}})}}},blogTagsList:{init:function(){this.getBlogTag()},getBlogTag:function(){if($("#suc_blog_tags").length>0){var id=$("#suc_blog_tags p").attr("id").substr(5);if(id.length==0){return}var taglink=$("#hidetaglink").val();var url="http://ptag.blog.sohu.com/btags/"+id+"/all/";$.getScript(url,function(data,status){if(status==="success"){var islong=false;var html="";var hidehtml='<a id="show_all_suc_tags" href="javascript:;" > 展开全部标签 </a><span style="display:none;"  id="suc_blog_tags_hide">';$.each(BlogPtags.tags_abc,function(i,n){if(i<50){html+='<a href="'+taglink+n.encode+'" title="'+n.count+'篇" >'+n.tag+"</a>"}else{islong=true;hidehtml+='<a href="'+taglink+n.encode+'" title="'+n.count+'篇" >'+n.tag+"</a>"}});hidehtml+='<a id="hide_all_suc_tags" href="javascript:;" > 收起标签 </a></span>';if(islong){$("#tags_"+id).html(html+hidehtml);$("#show_all_suc_tags").bind("click",function(){$("#suc_blog_tags_hide").slideDown(300);$("#show_all_suc_tags").hide()});$("#hide_all_suc_tags").bind("click",function(){$("#suc_blog_tags_hide").slideUp(300);$("#show_all_suc_tags").show()})}else{$("#tags_"+id).html(html)}}})}}},blogThumbnail:{init:function(){this.setBlogThumbnail()},setBlogThumbnail:function(){if($(".blogthumbnail").length>0){$(".blogthumbnail").each(function(i){if($(this).width()>$(this).height()){if($(this).width()>180){$(this).css({display:"block",width:"180px"})}else{$(this).css({display:"block"})}}else{if($(this).height()>180){$(this).css({display:"block",height:"180px"})}else{$(this).css({display:"block"})}}})}}},blogEditorManager:{beInstance:null,init:function(){this.writeBlog();this.closeEditBlog()},closeEditBlog:function(){$("#closeblog").live("click",function(){$("#blogeditorbox").slideUp(0);$("#blogguidtips").slideDown(0)})},writeBlog:function(){var that=this;if($("#blogeditorbox").length>0){that.showBlogEditor()}$("#writeblog").live("click",function(){if($("#blogeditorbox").css("display")=="none"){$("#blogguidtips").slideUp(0);$("#blogeditorbox").slideDown(0,function(){if($.browser.mozilla){that.beInstance.reDrawSwfupload()}that.beInstance.setHeight(330)})}else{$("#blogguidtips").slideUp(0);$("#blogeditorbox").slideDown(0)}});setTimeout(function(){var url=window.location.href;if(url.match("from=show")){$("#writeblog").trigger("click")}},1000)},showBlogEditor:function(){var that=this;that.beInstance=new $.BlogEditor({textarea:"#textareablog",mode:"simple",comment:false,height:300,width:760,footer:true,corner:{width:20,height:20,left:17,top:17,right:17,bottom:17}});blog.initPreviewHtml();that.beInstance.find(".be-footer").html('<span class="blog-editor-spread"></span>');$(".blog-editor-spread").live("click",function(){that.beInstance.setHeight(600);that.beInstance.find(".be-footer").find(".blog-editor-spread").addClass("blog-editor-shrink").removeClass("blog-editor-spread");$("#savedraftarticle").data("BlogeditorSize","Full")});$(".blog-editor-shrink").live("click",function(){that.beInstance.setHeight(300);$(".blog-editor-shrink").addClass("blog-editor-spread").removeClass("blog-editor-shrink");$("#savedraftarticle").data("BlogeditorSize","Simple")});$("#titleblog").val("请填写标题").css({color:"#999999",width:"740px"});$("#titleblog").live("focusin",function(){var txt=$(this).val();if($.trim(txt).length==0||txt=="请填写标题"){$(this).val("").css({color:"#000000"})}else{$(this).css({color:"#000000"})}}).live("focusout",function(){var txt=$(this).val();if($.trim(txt).length==0||txt=="请填写标题"){$(this).val("请填写标题").css({color:"#999999"})}else{$(this).css({color:"#000000"})}});var _categorylist='<option selected="selected" value="-1">全部分类</option>';$.ajax({url:"/a/blog/home/category/list.htm?_input_encode=UTF-8&_output_encode=UTF-8",data:"",type:"POST",success:function(result){var json=$.parseJSON(result);if(json.status){$.each(json.categoryList,function(i,n){_categorylist+='<option value="'+n.id+'">'+n.name+"</option>"});$("#categoryselect").html(_categorylist)}else{}}});$("#blogtag").live("click",function(){var handler=this;if($(handler).val()=="请输入标签"){$(handler).val("").css({color:"#333333"})}}).focusout(function(){var handler=this;var txt=$(handler).val();if($.trim(txt)=="请输入标签"||$.trim(txt)==""){$(handler).val("请输入标签").css({color:"#999999"})}});$("#requesttag").live("click",function(){var str=that.beInstance.htmlText();if(str.length<=0){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"请先填写日志内容，系统才能根据内容来提取标签。<br/>或者您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}})}else{if(str.length<100){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"您的日志内容过少，系统很难有效提取标签。<br/>请增加到100字以上。<br/>或者您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}})}else{_requestTag()}}});function _requestTag(){var url="/a/blog/home/tag/get.htm?_input_encode=UTF-8&_output_encode=UTF-8";if($("#titleblog").length>0){if($("#titleblog").val()=="请填写标题"){var text="  "+that.beInstance.htmlText()}else{var text=$("#titleblog").val()+" "+$("#titleblog").val()+" "+that.beInstance.htmlText()}}else{if($("#title").length>0){if($("#title").val()=="请填写标题"){var text="  "+that.beInstance.htmlText()}else{var text=$("#title").val()+" "+$("#title").val()+" "+that.beInstance.htmlText()}}}var options={requestUrl:url,method:"post",parameters:text};setTimeout(function(){_ajaxRequestTag(options)},500)}function _ajaxRequestTag(temp){var parameters=temp.parameters;var url=temp.requestUrl;$.ajax({url:url,type:"POST",data:{text:parameters,"var":"hello"},success:function(result){var tags=result.substr(5);if(result.length==7){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"很遗憾，系统没有提取出有效的标签。<br/>或许您可以自己为日志添加一些标签，例如“情感 日记”。",onClose:function($dialog){}});$("#blogtag").focus()}else{if(tags.length>0){$("#blogtag").val(tags).css({color:"#000000"})}}}})}$("#categoryselect").live("change",function(){blog._category=$("#categoryselect option:selected").val()});$("#publisharticle").live("click",publishArticleAction);function publishArticleAction(){var title=$("#titleblog").val();if($.trim(title).length==0||title=="请填写标题"){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"标题不能为空，请输入博客标题。",onClose:function($dialog){}});$("#titleblog").focus();return}var content=that.beInstance.htmlText();if(content.length>100000){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"文章长度不能超过100000字符。",onClose:function($dialog){}});return}var tag=($("#blogtag").val()=="请输入标签")?"":$("#blogtag").val();category=blog._category;var comment="0";$("#publisharticle").die("click");var vcode=$("#vcode").val()||"";var vcodeEn=$("#vcodeEn").val()||"";var saveURL="/a/blog/home/entry/save.htm?_input_encode=UTF-8&_output_encode=UTF-8";var updateURL="/a/blog/home/entry/update.htm?_input_encode=UTF-8&_output_encode=UTF-8&deliver=show";var quicksaveArticleID=$("#savedraftarticle").data("ArticleID");var sendURL=(quicksaveArticleID==undefined)?saveURL:updateURL;$("#vcodeimg").trigger("click");$.ajax({url:sendURL,type:"POST",data:{id:quicksaveArticleID,title:title,content:content,keywords:tag,categoryId:category,oper:"art_ok",allowComment:comment,vcode:vcode,vcodeEn:vcodeEn},success:function(result){var json=$.parseJSON(result);if(!json.status){var targetURL="http://i.sohu.com"+json.data;$.inform({icon:"icon-success",delay:1000,easyClose:true,content:json.statusText});setTimeout(function(){window.location.href=targetURL},1000)}else{$.inform({icon:"icon-error",delay:1000,easyClose:true,content:json.statusText});$("#publisharticle").live("click",publishArticleAction)}},error:function(){$.inform({icon:"icon-error",delay:2000,easyClose:true,content:"服务器错误,请稍后再试..."})}})}$("#submitcontribute").live("click",contributeArticle);function contributeArticle(){var DeliverID=$("#deliverid").val();var Items=$("input[name='types']:checked");var itemsLength=Items.length;var types=[];if(itemsLength==0){}else{if(itemsLength<3){$.each(Items,function(i,n){types.push($(n).val())});$.post("/a/blog/home/entry/post.htm",{entryid:DeliverID,types:types.toString()},function(){});$.inform({icon:"icon-success",delay:2000,easyClose:true,content:"投稿成功..."});setTimeout(function(){window.location.href="http://i.sohu.com/blog/home/entry/index.htm"},1000)}else{}}}$("#savedraftarticle").live("click",saveDraftArticle);function saveDraftArticle(){var title=$("#titleblog").val();if($.trim(title).length==0||title=="请填写标题"){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"标题不能为空，请输入博客标题。",onClose:function($dialog){}});$("#titleblog").focus();return}var content=that.beInstance.htmlText();if(content.length>100000){$.inform({icon:"icon-error",delay:2500,easyClose:true,content:"文章长度不能超过100000字符。",onClose:function($dialog){}});return}var tag=($("#blogtag").val()=="请输入标签")?"":$("#blogtag").val();var category=blog._category;var comment="0";$("#savedraftarticle").die("click");var vcode=$("#vcode").val()||"";var vcodeEn=$("#vcodeEn").val()||"";var saveURL="/a/blog/home/entry/save.htm?_input_encode=UTF-8&_output_encode=UTF-8";var updateURL="/a/blog/home/entry/update.htm?_input_encode=UTF-8&_output_encode=UTF-8";var quicksaveArticleID=$("#savedraftarticle").data("ArticleID");var sendURL=(quicksaveArticleID==undefined)?saveURL:updateURL;$.ajax({url:sendURL,type:"POST",data:{id:quicksaveArticleID,title:title,content:content,keywords:tag,categoryId:category,oper:"art_draft",allowComment:comment,vcode:vcode,vcodeEn:vcodeEn},success:function(result){var json=$.parseJSON(result);var BlogeditorSize=$("#savedraftarticle").data("BlogeditorSize");var Top=(BlogeditorSize!="Full")?"474px":"744px";var isEdit=$("#articleid").length;if(isEdit>0){Top=(BlogeditorSize!="Full")?"574px":"744px"}if(!json.status){var date=new Date();var hours=date.getHours();var minutes=date.getMinutes();var nowHours=(hours.length==1)?("0"+hours):hours;var nowMinutes=(minutes.length==1)?("0"+minutes):minutes;var time=nowHours+":"+nowMinutes;if($("#QuickSaveTips").length==0){$("#QuickSaveTips").data("State","Idle");var HtmlString='<span id="QuickSaveTips" style="display:none; text-align:center; height:22px;line-height:22px;border-radius: 5px 5px 5px 5px;background-color:#70b907;border:1px solid #e8e8e8;padding: 0 10px; color:#fff; position:absolute;width:200px;top:474px;padding:0 10px; margin:0 0 0 -50px; left:50%; " ></span>';$("body").append(HtmlString)}if($("#QuickSaveTips").data("State")!="Busy"){$("#QuickSaveTips").data("State","Busy");$("#QuickSaveTips").css({top:Top}).text("已成功为您保存到草稿箱").fadeIn(1000).delay(3000).fadeOut(1000);setTimeout(function(){$("#QuickSaveTips").data("State","Idle")},3000)}$("#savedraftarticle").data("ArticleID",json.data).live("click",saveDraftArticle)}else{if($("#QuickSaveTips").length==0){var HtmlString='<span id="QuickSaveTips" style="display:none; text-align:center; height:22px;line-height:22px;border-radius: 5px 5px 5px 5px;background-color:#70b907;border:1px solid #e8e8e8;padding: 0 10px; color:#fff; position:absolute;width:200px;top:474px;padding:0 10px; margin:0 0 0 -50px; left:50%; " ></span>';$("body").append(HtmlString)}if($("#QuickSaveTips").data("State")!="Busy"){$("#QuickSaveTips").data("State","Busy");$("#QuickSaveTips").css({top:Top}).text(json.statusText).fadeIn(1000).delay(3000).fadeOut(1000);setTimeout(function(){$("#QuickSaveTips").data("State","Idle")},3000)}$("#savedraftarticle").live("click",saveDraftArticle)}}})}}},blogVcode:{init:function(){var self=this;if($("#vcode").length>0){self.changeText();self.changeVcodeImg()}else{return}},changeText:function(){$("#vcode").focus(function(){var txt=$(this).val();if(txt=="输入验证码"){$(this).val("")}else{if(/^\s*$/.test(txt)){$(this).val("输入验证码")}}}).focusout(function(){var txt=$(this).val();if(/^\s*$/.test(txt)){$(this).val("输入验证码")}})},changeVcodeImg:function(){if($("#vcodeimg").length>0){$("#vcodeimg").click(function(){var url="/a/blog/home/vcode/get.htm";$.ajax({url:url,type:"POST",success:function(data){$("#vcodeEn").val(data);$("#vcodeimg").attr("src","/a/blog/home/vcode/rand?vcode="+data)}})})}}},initPreviewHtml:function(){var space_config_URL=$space_config._url;var previewURL=(space_config_URL=="i.sohu.com")?("http://i.sohu.com/p/"+$space_config._xpt+"/blog/preview.htm"):("http://"+space_config_URL+"/blog/preview.htm");if($("#ArticlePreviewForm").length==0){var HtmlString=[];HtmlString.push('<div style="display:none;height:0px; line-height:0px; overflow:hidden;"><form id="ArticlePreviewForm" method="post" target="_blank" action="'+previewURL+'">');HtmlString.push('<input id="formTitle"    name="entrytitle"   type="text" value="" />');HtmlString.push('<textarea  id="formContent"  name="entrycontent" ></textarea>');HtmlString.push('<input id="formKeywords" name="keywords"     type="text" value="" />');HtmlString.push('<input id="formCategory" name="categoryId"   type="text" value="" />');HtmlString.push("</form></div>");$("#requesttag").after(HtmlString.join(""))}}}})(jQuery);$(function(){var c,j=false,m=false,g=$(".qt-remark-tit h3").first();if(!g.length){return}var k=g.offset().top,b=$space_config._xpt,h=$("#header .set-face"),e=h.attr("href"),l="http://i.sohu.com/blog/home/entry/index.htm";if(typeof isblanked=="undefined"||!isblanked){return}var o='<div class="bf-body"><div class="img"><a target="_blank" href="'+e+'"></a></div><div class="txt"><p class="tt">嗨，我是 <a href="" target="_blank">.</a></p><p class="con">如果想第一时间阅读我的最新博文，那就快来跟随我吧！</p><div class="bf-btn"><a href="javascript://" class="btn-enter btn-enter-hover"></a></div></div></div>';function n(p){var r="",q;if(p==1){r="跟随成功";i(1)}else{if(p==-2){r="已跟随过"}}q='<p class="success">'+r+'！你可以在个人中心里看到我的各种新鲜事了。</p><div class="bf-btn"><a target="_blank" class="btn-geren" href="'+l+'"></a><a class="close" href="javascript://">我知道了</a></div>';return q}function i(p){var q="/a/blog/home/follow.htm?callback=?";$.getJSON(q,{status:p})}function f(){i(2)}function d(){i(3)}function a(){i(0);c=$.dialog({className:"pp-dialog",content:'<h2>一亿人当中你遇见了我...</h2><div class="poping-blog-follow"></div>',contentWidth:400,contentHeight:180}).delegate(".btn-enter","click",function(){i(7);var q=c.find(".dialog-button-close");q.unbind("click",f);q.click(d);require("core::util[beLogin]",function(r){var s={options:{regRedirectUrl:location.href}};if(r.beLogin(s)){return}if(mysohu.is_mine()){$("#tweet_editor_box")[0].style.visibility="hidden";c.close();return}$.get("/a/app/friend/friend/add.do",{xpt:b,from_type:"blog_person_show"},function(t){var u=t.code;var w=n(u);c.find(".txt").html(w);if(u==1||u==-2){if(u==-2){i(6)}var v=$("#tweet_editor_box .btn-attention-wraper");if(t.data.friendType==1){v.html('<span class="btn-attention-each-other"><em>互相跟随</em><a href="javascript:void(0);">取消</a></span>')}else{v.html('<span class="btn-attention-already"><em>已跟随</em><a href="javascript:void(0);">取消</a></span>')}}},"json")})}).delegate("div.img a, p.tt a","click",function(){i(5)}).delegate("a.close, a.btn-geren","click",function(){c.close();if($(this).hasClass("close")){i(3)}else{if($(this).hasClass("btn-geren")){i(4)}}});c.find(".dialog-button-close").click(f);c.find(".poping-blog-follow").html(o);c.find(".img a").html($("#header .img").html());var p=h.attr("title");if(p.length>12){p=p.substring(0,12)+"..."}c.find(".tt a").html(p).attr("href",e)}$(window).scroll(function(){if(c||j){return}var q=$(window).height();var p=$(document).scrollTop();if(k-p+125<q){if(mysohu.is_login()){if(!mysohu.is_mine()){$.getJSON("/a/app/friend/get/friend/relation.do",{xpts:_xpt},function(r){if(!r.data.friendList.length){a()}});j=true}}else{a()}}})});
require("core::util","core::util::jQuery","plugins::hijacker","#document",function(c,e,f){f.hijackthis(".hijackthis");var b=e(".show-comment");if(b.length){var d=location.hash.match(/(?:#comment(?:\.(\d+))?)?$/)[1];if(d){window.location.hash="#comment"}var a=e.find(".feed-set a");f.hijack({actionTarget:b[b.length-1],action:"comment.show",onSuccess:mysohu.appId==="blog"&&function(h){for(var g=a.length,j=0;j<g;j++){var i=a[j].getAttribute("action");if(i=="junction"){i=a[j].getAttribute("jTarget")}if(!i){continue}if(/forward/.test(i)){c.refreshCount(a[j],h.spreadcount)}else{if(/comment|discuss/.test(i)){c.refreshCount(a[j],h.commentcount)}}}}});if(mysohu.appId==="blog"){e(".forwardnum")[0].as=a}}e('a[action="mblog.refer"]').click(function(h){h.preventDefault();var g=h.target.getAttribute("data-nick");require("app::widgets::atTA",function(i){i({nick:g})})})});
