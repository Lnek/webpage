require("core::util::jQuery","core::util[ajax,cookie,beLogin,channel]","app::widgets::template","plugins::swfupload",function(c,b,a,e){var d={saved:$space_config._themeExtra?{id:$space_config._theme||"default",custom:Boolean($space_config._themeExtra.custom),url:$space_config._themeExtra.url,repeat:$space_config._themeExtra.repeat||"no-repeat",position:$space_config._themeExtra.position||"left"}:{id:$space_config._theme||"default"},current:function(){return this.themes[this.weared.id]},getTheme:function(f){return this.themes[f]},shown:false,init:function(h){var g=this.themes={};this.groups=h;for(var i in h){var j=h[i];var f=[],m=0;for(var l in j){f.push(g[l]=j[l]={id:l,n:m++,title:j[l],group:j})}j.themes=f;j.width=f.length*160;j.title=i;if(!this.customGroup){j.isCustom=true;this.customGroup=j}}},show:function(f){if(f===this.shown){return this}this.shown=f;this.$dom||this.render();c(".skin-dummy").css("display",f?"block":"none");var g=b.wndTop();window.scrollTo(0,f?g+175:g>175?g-175:0);document.body.style.backgroundPosition=this.weared.custom?this.weared.position+(f?" 205px":"  30px"):"";if(f){this.$dom.show();c("#skin_sprite").hide();this.$dom.animate({opacity:1,marginTop:0},300,"swing",function(){b.ie&&(this.style.filter="")})}else{this.$dom.animate({opacity:0,marginTop:-80},500,"swing",function(){c("#skin_sprite").show();this.style.display="none"})}return this},render:function(){var g=[];for(var h in this.groups){g.push(this.groups[h])}var f=this.$dom=c(a.theme(g));f.appendTo(document.body);f.$prev=f.find("a.prev");f.$next=f.find("a.next");f.icons=f.find(".icons")[0];f.click(this.mmClick);this.render=null},isModified:function(){var g=["id","custom","url","position","repeat"];for(var f in this.saved){if(this.saved[f]!=this.weared[f]){return true}}return false},mmClick:function(h){var n=d,i=h.target,g=null,l=n.$dom[0];while(!(g=i.getAttribute("action"))){if(i===l){return}i=i.parentNode}var j=true;switch(g){case"save":n.show(false);if(n.isModified()){n.save()}break;case"cancel":n.show(false);if(n.isModified()){n.wear()}break;case"show-group":var k=i.getAttribute("title"),m=n.groups[k],i=n.current();if(m!=n.currentGroup){n.drawGroup(m);if(i.group==m){n.setCurrent(i.id).scrollTo(m.isCustom?0:b.range(0,m.themes.length-1,i.n,6)[0])}else{n.scrollTo(0)}}break;case"wear-skin":var f=i.getAttribute("theme");n.setCurrent(f);n.wear({custom:false,id:f});break;case"next":n.scrollTo(Math.min(n.scroll+6,n.currentGroup.themes.length-6),true);break;case"prev":n.scrollTo(Math.max(n.scroll-6,0),true);break;case"reset-bg":n.wear({custom:i.children[0].checked});j=false;break;case"custom-color":var f=i.getAttribute("data-color");if(f!=n.weared.id){n.$dom.find(".color-list .active").removeClass("active");i.className="active";n.wear({id:f})}break}j&&h.preventDefault()},focus:function(g){if(g.custom){this.drawGroup(this.customGroup).scrollTo(0)}else{var f=this.themes[g.id];this.drawGroup(f.group).setCurrent(g.id).scrollTo(b.range(0,f.group.themes.length-1,f.n,6)[0])}},drawGroup:function(i){if(i==this.currentGroup){if(i.isCustom){this.toggleBg(Boolean(this.weared.url),this.weared)}return this}this.$dom.find(".groups span.focused").removeClass("focused");this.$dom.find('.groups span[title="'+i.title+'"]').addClass("focused");if(i.isCustom){var h=this.weared.url,f=h&&h.lastIndexOf(".");h=h?"url("+h.substr(0,f)+"_s"+h.substr(f)+")":"none";this.$dom.find(".icons").html(a.theme_custom({weared:this.weared,bg_sm:h,colors:i.themes}));if(this.current().group!==i){this.wear({id:i.themes[0].id})}this.$dom.find(".color-list a")[this.current().n].className="active";var g=this;require("core::ui::Select",function(j){g.selPos=new j(g.$dom.find("#i_select_Position"),{left:"左对齐",center:"居中",right:"右对齐"},g.weared.position).bind(j.CHANGE,function(k,l){g.wear({position:l})});g.selRep=new j(g.$dom.find("#i_select_Repeat"),{"no-repeat":"不平铺","repeat-x":"横向平铺","repeat-y":"纵向平铺",repeat:"平铺"},g.weared.repeat).bind(j.CHANGE,function(l,k){g.wear({repeat:k})})});this.initUpload()}else{if(this.swfu){this.swfu.destroy();this.selPos.destroy();this.selRep.destroy();this.swfu=this.selPos=this.selRep=undefined}this.$dom.find(".icons").html(a.theme_list(i))}this.currentGroup=i;return this},setCurrent:function(h){var f=this.$dom.find(".icons .skin.current"),g=this.$dom.find('.icons .skin[theme="'+h+'"]');if(f[0]!=g[0]){f.removeClass("current");g.addClass("current")}return this},scrollTo:function(f,h){var g=this.currentGroup.themes.length;if(!h){this.$dom.$prev.css("display",f===0?"none":"");this.$dom.$next.css("display",f>=g-6?"none":"");this.scroll=f;this.$dom.icons.scrollLeft=f*160}else{this.$dom.$prev[f===0?"hide":"show"]();this.$dom.$next[f>=g-6?"hide":"show"]();b.fx({src:this.scroll*160,dst:f*160,self:this.$dom.icons,speed:b.ie?"fastest":"fast",type:"log",steps:32,round:true,callback:function(i){this.scrollLeft=i}});this.scroll=f}return this},wear:function(l){l||(l=this.saved);for(var f in l){this.weared[f]=l[f]}var h=this.weared.custom;c(document.body).css({backgroundRepeat:h?this.weared.repeat:"",backgroundPosition:this.shown?(h?this.weared.position||"left":"center")+" 205px":"",backgroundImage:h?this.weared.url?"url('"+this.weared.url+"')":"none":""});var j="/themes/"+this.weared.id+"/style.css";var i=document.getElementById("theme_style");if(i){var g=load.repos.s3.getURL([j]);(i.href!=g)&&(i.href=g)}else{loadResource({id:"theme_style"},j)}document.body.className=this.weared.id},error:function(f){require("core::ui::dialog::error",function(g){g(f||"让服务器再飞一会儿，请稍后再试。",1800)})},save:function(g){g||(g=this.weared);for(var f in g){this.saved[f]=g[f]}b.ajax.getJSON("/a/setting/theme/set?"+b.toQueryString({custom:this.saved.custom,theme:this.saved.id,position:{left:1,center:2,right:3}[this.saved.position]||1,repeat:{"no-repeat":1,"repeat-x":2,"repeat-y":3,repeat:4}[this.saved.repeat]||1,url:this.saved.url}),function(h){if(h.code!=0){d.error("保存主题失败")}else{b.channel.broadcast("theme","wear",g)}})},initUpload:function(){var f=this;require("plugins::swfupload",function(j){f.swfu&&f.swfu.destroy();f.swfu=new j({upload_url:"http://upload.pp.sohu.com/suc/backgroundUpload.do",file_size_limit:"3 MB",file_types:"*.jpg;*.jpeg;*.gif;*.png",file_types_description:"图片文件",file_upload_limit:"0",file_queue_error_handler:function(k,m,l){switch(m){case j.QUEUE_ERROR.ZERO_BYTE_FILE:f.error("图片文件太小，请检查图片属性。");break;case j.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:f.error("图片过大，请选择小于3MB的图片。");break;case j.QUEUE_ERROR.INVALID_FILETYPE:f.error("该文件不是支持的格式，请检查。");break;default:f.error();break}},file_dialog_complete_handler:function(k,l){if(l>0){i=true;h()}},upload_start_handler:function(){d.showUploading(true)},upload_progress_handler:function(l,k,m){d.showUploading(k/m)},upload_error_handler:function(k,m,l){d.error();d.showUploading(false)},upload_success_handler:function(l,k){d.showUploading(false);d.setUploaded(JSON.parse(k))},button_placeholder_id:"theme_bg-upload",button_image_url:"http://js6.pp.sohu.com.cn/i/default/my/img/nil.gif",button_width:120,button_height:90,button_window_mode:j.WINDOW_MODE.TRANSPARENT,button_cursor:j.CURSOR.HAND,button_action:j.BUTTON_ACTION.SELECT_FILE,flash_url:"http://i.sohu.com/asset/swfupload.swf",debug:false})});var g,i;b.ajax.getJSON("/api/gettoken.jsp?ot=json",function(j){if(j.status==0){g=j.data[0].enToken;h()}else{f.error()}});function h(){if(g&&i){f.swfu.setPostParams({token:g,watermark:""});f.swfu.startUpload()}}},showUploading:function(f){if(f===true){this.toggleBg(false);this.$dom.find(".bg_setting").addClass("uploading")}else{if(f===false){this.$dom.find(".bg_setting").removeClass("uploading")}else{if(typeof f=="number"&&f<1){f=f*5<<0;this.$dom.find(".progress").css("backgroundPosition",f*12-60+"px -126px")}}}},setUploaded:function(f){if(f.code!=0){this.error();return}d.wear({custom:true,url:f.data.image[0]});d.toggleBg(true,d.weared)},toggleBg:function(g,h){if(g){this.$dom.find(".bg_setting").removeClass("no-bg");var g=h.url,f=g&&g.lastIndexOf(".");g=g?"url("+g.substr(0,f)+"_s"+g.substr(f)+")":"none";this.$dom.find(".icons .bg-upload").css("background",g+" center center");this.selPos&&this.selPos.setValue(h.position);this.selRep&&this.selRep.setValue(h.repeat);this.$dom.find(".color-list .active").removeClass("active");if(/^color\d+$/.test(h.id)){this.$dom.find('.color-list a[data-color="'+h.id+'"]').addClass("active")}this.$dom.find("input")[0].checked=h.custom}else{this.$dom.find(".bg_setting").addClass("no-bg");this.$dom.find(".icons .bg-upload").css("background","")}}};d.weared=b.probe(d.saved);b.channel.listenOther("theme","wear",function(f){if(b.cookie.isMine()){d.wear(f.data)}});define("app::widgets::theme",d)});require("core::util::jQuery","core::util[fx,cookie]","app::widgets::theme","core::ui::dialog::confirm","#document",function(g,c,h,b,a){var e=g('<div id="skin_sprite"></div>');a.body.appendChild(e[0]);e.bind("mouseover",f).bind("mouseout",f).click(function(){d(h.weared)});if(!c.cookie.isMine()){if(c.ie===6){e.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://s3.suc.itc.cn/themes/d/sprite4.png')")}else{e.css("backgroundPosition","0 -64px")}}define("plugins::hijacker::theme.wear",function(j){var i=j.actionTarget;var k={id:i.getAttribute("data-themeid"),custom:i.getAttribute("data-custom")=="true"};if(k.custom){k.position=i.getAttribute("data-position");k.repeat=i.getAttribute("data-repeat");k.url=i.getAttribute("data-url")}h.wear(k);d(k)});a.body.insertBefore(g('<div class="skin-dummy"></div>')[0],a.body.firstChild);function d(j){if(c.beLogin()){return}if(c.cookie.isMine()){h.show(true).focus(j)}else{var i=j.custom||/^color/.test(j.id)?_sucNick+"”的自定义主题("+h.getTheme(j.id).title+"色)":h.themes[j.id].title+"”";b({content:"使用“"+i+"作为您的主题吗？",onConfirm:function(){h.save(j)},onCancel:function(){if(h.isModified()){h.wear(h.saved)}}})}}function f(i){var j=(i.type==="mouseover");e[0].title=c.cookie.isMine()?"更换主题":h.weared.custom||/^color/.test(h.weared.id)?"使用"+_sucNick+"的自定义主题("+h.current().title+"色)":"使用主题“"+h.current().title+"”";c.fx({steps:3,src:j?0:3,dst:j?3:0,callback:c.ie===6?(function(k){c.cookie.isMine()||(k+=4);e.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://s3.suc.itc.cn/themes/d/sprite"+k+".png')")}):(function(k){e.css("backgroundPosition",(k*-56)+"px "+(c.cookie.isMine()?"0":"-64px"))})})}});require("app::widgets::theme",function(a){a.init({"自定义模板":{color01:"浅灰",color02:"淡蓝",color03:"浅绿",color04:"紫",color05:"粉红",color06:"黑"},"经典版":{"default":"经典版",t01001:"粉红爱情",t01002:"秋风摆柳",t01003:"蓝色韵律",t01004:"绿色生命",t01005:"飘飞思绪",t01006:"绯色花飘"},"艺术版":{t02001:"金色梦幻",t02002:"抽象艺术",t02003:"蓝天彩虹",t02004:"怀旧纪念",t02005:"现代水彩",t02006:"情侣金鱼",t09001:"霓虹闪烁"},"场景版":{t03008:" 禅之海",t03007:"阿凡达",t03001:"云中城堡",t03002:"海洋畅想",t03004:"沙滩漫步",t03005:"七彩热气球",t03006:"夏日律动",t03003:"午后咖啡",t03009:"气壮山河",t03010:"丰收盛宴",t03011:"原野之花",t03012:"蓝海银帆"},"水墨版":{t04001:"南山寒钓",t04002:"江上渔家",t04003:"阡陌山村"},"节日版":{t05001:"中秋月圆",t05002:"欢乐万圣",t05003:"圣诞花絮"},"可爱版":{t06001:"飞天小猪",t06002:"蓝天小兔",t06003:"沙滩海星",t06004:"两小无猜",t06005:"圣诞雪人",t06006:"夏日雪糕",t06007:"七彩世界",t06008:"飞翔的信",t06009:"卡通世界",t06010:"动物聚会"},"心情版":{t07001:"秋之境",t07002:"梦境之花",t07003:"艳阳风铃",t07004:"草莓餐桌",t07005:"时尚女郎",t07006:"趴窗狗狗",t07007:"雨中女孩",t07008:"悠长回忆",t07009:"孤独话亭"},"桌面版":{t08001:"魔兽猎影",t08002:"冰封武士",t09002:"暗影星际"}})});
require("core::util::jQuery","core::util::fx","#document",function(f,d){var g=f('<a id="back_top" href="javascript:;" title="返回页面顶部"></a>');var j=f(window);var e=false;var k,b;var i=false;g.data("backTop",c);function c(){e=true;g.fadeOut();d({src:j.scrollTop(),dst:0,type:"log",fixFrame:false,steps:12,speed:"fast",round:true,callback:function(l){window.scrollTo(0,l)},complete:function(){e=false}})}function h(){if(e){return}var l=j.scrollTop();if(i&&l<b/1.67){g.fadeOut();i=false}else{if(!i&&l>=b/1.67){g.fadeIn();i=true}}}function a(){k=j.width();b=j.height();var l=Math.floor(k/2-530);g.css("right",l>0?l+"px":0);h()}g.init=function(){document.body.appendChild(g[0]);g.click(c);j.bind("resize",a);j.bind("scroll",h);g.focus(function(){this.blur()});a()};g.init()});
