(function(d){var b=function(){try{return window._xpt||(window.$space_config&&window.$space_config._xpt)||Base64.encode(/focus\.cn$/ig.test(PassportSC.cookie.userid)?(PassportSC.cookie.uid+"@focus.cn"):PassportSC.cookie.userid)}catch(g){return null}};var f={proInfo:"profile_widget_info",checkProVal:function(){try{if(window[this.proInfo]){alert(this.proInfo+"这个变量已经被占用了，请重新命名");return false}return true}catch(g){return false}},getUrl:function(){try{var g=b(),j=this.proInfo,h="http://profile.blog.sohu.com/service/profile.htm?xp="+g+"&vn="+j+"&_a="+ +new Date();return h}catch(i){return""}},setProInfo:function(g){this.proInfo=g},init:function(){var h=arguments;if(!d.isFunction(h[0])){return}if(h[1]&&typeof h[1]==="string"){this.setProInfo(h[1])}if(!this.checkProVal()){return false}var i=this.getUrl(),g=this;d.getScript(i,function(){try{h[0]()}catch(j){}})}};var a={init:function(){var i=arguments[0];if(!d.isFunction(i)){return}var h="http://api.ums.sohu.com/sur/summary.json",g="__medal_info_"+parseInt(Math.random()*100000);d.ajax({url:h+"?xpt="+b()+"&callback=?",dataType:"jsonp",scriptCharset:"utf-8",success:function(j){i(j)}})}};var e={init:function(){var i=arguments[0];if(!i||typeof i!=="object"){return}var h="/a/app/friend/friend/count.do";d.ajax({url:h,cache:false,data:{xpt:b()},dataType:"json",success:function(k){try{i.callback(k);g(k.data.isAtted,i.nologin,i.islogin)}catch(j){}}});function g(m,l,o){try{var k=function(){try{return PassportSC.cookie}catch(q){return false}};function j(){try{return PassportSC?true:false}catch(q){return false}}function p(){if(PassportSC.cookie){o(m)}else{l()}}d.waitUntil({condition:j,work:p})}catch(n){}}}};var c={avInfo:"__avatar_info_"+parseInt(Math.random()*10000),init:function(){var i=b(),j="http://i.sohu.com/api/accountinfo.do?xp="+i+"&vn="+this.avInfo,h=arguments,g=this;if(!d.isFunction(h[0])){return}d.getScript(j,function(){var k=window[g.avInfo][i];h[0](k)})}};if(d.iProfile){return}d.iProfile={_pinf:f.proInfo,_ainf:c.avInfo,_xpt:b,getProfile:function(){var g=arguments;try{f.init(g[0],g[1])}catch(h){}},getMedal:function(){try{a.init(arguments[0])}catch(g){}},getFriends:function(){try{e.init(arguments[0])}catch(g){}},getAvatar:function(){var g=arguments;try{c.init(g[0],g[1])}catch(h){}}}})(jQuery);
(function(a){a(function(){var l=a("div.sidebar > div.user-app-more"),h=a("div.main-nav-wrapper ul.main-nav");if(l.length){var p=a("ul.apps-list",l),k=a("div.actions > span.more-btn",l),g=a("div.actions > span.less-btn",l);var c={is_expand:a.cookie("person_sidebar_is_expand"),put_expand:function(r){a.cookie("person_sidebar_is_expand",r,{expires:365,path:"/",domain:"i.sohu.com"})},expand:function(r){p.slideDown();k.hide();g.show();c.put_expand(true)},collapse:function(r){p.slideUp();g.hide();k.show();c.put_expand(false)},init:function(){l.addClass("more-expand")}};k.bind("click.sidebar",c.expand);g.bind("click.sidebar",c.collapse);var f={mblog:0,blog:1,album:2,video:3,scomment:4},m={guestbook:0,wenda:1,baby:2,task:5};if(c.is_expand&&c.is_expand.toLowerCase()==="true"){c.init()}if($space_config&&$space_config._currentApp){var q=$space_config._currentApp,o=a("div.sidebar > div.user-app-list"),i=a("div.sidebar > div.user-app-more");if(q in f){var n=f[q];if(typeof n!=="undefined"){a("ul > li",o).eq(n).addClass("nonce")}}else{if(q in m){var n=m[q];if(typeof n!=="undefined"){a("ul > li",i).eq(n).addClass("nonce")}}}}}if(h.length){var j=a("li.more-btn",h);var b={is_expand:a.cookie("person_nav_is_expand"),put_expand:function(r){a.cookie("person_nav_is_expand",r,{path:"/",domain:"i.sohu.com"})},expand:function(r){j.trigger("mouseout").removeClass("more-left").addClass("more-right").find("> a").text("");j.siblings("li.main-nav-extend").show();b.put_expand(true)},collapse:function(r){j.removeClass("more-right").addClass("more-left").find("> a").text("更多");j.siblings("li.main-nav-extend").hide();b.put_expand(false)},init:function(){b.expand()}},e={index:0,mblog:1,blog:2,album:3,video:4,scomment:5,baby:6,wenda:7};j.click(function(){if(j.hasClass("more-right")){b.collapse()}else{b.expand()}});if(b.is_expand&&b.is_expand.toLowerCase()==="true"){b.init()}if($space_config&&$space_config._currentApp){var q=$space_config._currentApp,d=e[q];if(typeof d!=="undefined"){a("li",h).eq(d).addClass("active")}}}})})(jQuery);
jQuery.effects||(function(h,e){h.effects={};h.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(n,m){h.fx.step[m]=function(o){if(!o.colorInit){o.start=l(o.elem,m);o.end=j(o.end);o.colorInit=true}o.elem.style[m]="rgb("+Math.max(Math.min(parseInt((o.pos*(o.end[0]-o.start[0]))+o.start[0],10),255),0)+","+Math.max(Math.min(parseInt((o.pos*(o.end[1]-o.start[1]))+o.start[1],10),255),0)+","+Math.max(Math.min(parseInt((o.pos*(o.end[2]-o.start[2]))+o.start[2],10),255),0)+")"}});function j(n){var m;if(n&&n.constructor==Array&&n.length==3){return n}if(m=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n)){return[parseInt(m[1],10),parseInt(m[2],10),parseInt(m[3],10)]}if(m=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n)){return[parseFloat(m[1])*2.55,parseFloat(m[2])*2.55,parseFloat(m[3])*2.55]}if(m=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n)){return[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]}if(m=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n)){return[parseInt(m[1]+m[1],16),parseInt(m[2]+m[2],16),parseInt(m[3]+m[3],16)]}if(m=/rgba\(0, 0, 0, 0\)/.exec(n)){return a.transparent}return a[h.trim(n).toLowerCase()]}function l(o,m){var n;do{n=h.curCSS(o,m);if(n!=""&&n!="transparent"||h.nodeName(o,"body")){break}m="backgroundColor"}while(o=o.parentNode);return j(n)}var a={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var f=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function g(){var p=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,q={},n,o;if(p&&p.length&&p[0]&&p[p[0]]){var m=p.length;while(m--){n=p[m];if(typeof p[n]=="string"){o=n.replace(/\-(\w)/g,function(r,s){return s.toUpperCase()});q[o]=p[n]}}}else{for(n in p){if(typeof p[n]==="string"){q[n]=p[n]}}}return q}function b(n){var m,o;for(m in n){o=n[m];if(o==null||h.isFunction(o)||m in c||(/scrollbar/).test(m)||(!(/color/i).test(m)&&isNaN(parseFloat(o)))){delete n[m]}}return n}function i(m,o){var p={_:0},n;for(n in o){if(m[n]!=o[n]){p[n]=o[n]}}return p}h.effects.animateClass=function(m,n,p,o){if(h.isFunction(p)){o=p;p=null}return this.queue("fx",function(){var u=h(this),r=u.attr("style")||" ",w=b(g.call(this)),t,s=u.attr("className");h.each(f,function(x,y){if(m[y]){u[y+"Class"](m[y])}});t=b(g.call(this));u.attr("className",s);u.animate(i(w,t),n,p,function(){h.each(f,function(x,y){if(m[y]){u[y+"Class"](m[y])}});if(typeof u.attr("style")=="object"){u.attr("style").cssText="";u.attr("style").cssText=r}else{u.attr("style",r)}if(o){o.apply(this,arguments)}});var q=h.queue(this),v=q.splice(q.length-1,1)[0];q.splice(1,0,v);h.dequeue(this)})};h.fn.extend({_addClass:h.fn.addClass,addClass:function(n,m,p,o){return m?h.effects.animateClass.apply(this,[{add:n},m,p,o]):this._addClass(n)},_removeClass:h.fn.removeClass,removeClass:function(n,m,p,o){return m?h.effects.animateClass.apply(this,[{remove:n},m,p,o]):this._removeClass(n)},_toggleClass:h.fn.toggleClass,toggleClass:function(o,n,m,q,p){if(typeof n=="boolean"||n===e){if(!m){return this._toggleClass(o,n)}else{return h.effects.animateClass.apply(this,[(n?{add:o}:{remove:o}),m,q,p])}}else{return h.effects.animateClass.apply(this,[{toggle:o},n,m,q])}},switchClass:function(m,o,n,q,p){return h.effects.animateClass.apply(this,[{add:o,remove:m},n,q,p])}});h.extend(h.effects,{version:"1.8.11",save:function(n,o){for(var m=0;m<o.length;m++){if(o[m]!==null){n.data("ec.storage."+o[m],n[0].style[o[m]])}}},restore:function(n,o){for(var m=0;m<o.length;m++){if(o[m]!==null){n.css(o[m],n.data("ec.storage."+o[m]))}}},setMode:function(m,n){if(n=="toggle"){n=m.is(":hidden")?"show":"hide"}return n},getBaseline:function(n,o){var p,m;switch(n[0]){case"top":p=0;break;case"middle":p=0.5;break;case"bottom":p=1;break;default:p=n[0]/o.height}switch(n[1]){case"left":m=0;break;case"center":m=0.5;break;case"right":m=1;break;default:m=n[1]/o.width}return{x:m,y:p}},createWrapper:function(m){if(m.parent().is(".ui-effects-wrapper")){return m.parent()}var n={width:m.outerWidth(true),height:m.outerHeight(true),"float":m.css("float")},o=h("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0});m.wrap(o);o=m.parent();if(m.css("position")=="static"){o.css({position:"relative"});m.css({position:"relative"})}else{h.extend(n,{position:m.css("position"),zIndex:m.css("z-index")});h.each(["top","left","bottom","right"],function(p,q){n[q]=m.css(q);if(isNaN(parseInt(n[q],10))){n[q]="auto"}});m.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return o.css(n).show()},removeWrapper:function(m){if(m.parent().is(".ui-effects-wrapper")){return m.parent().replaceWith(m)}return m},setTransition:function(n,p,m,o){o=o||{};h.each(p,function(r,q){unit=n.cssUnit(q);if(unit[0]>0){o[q]=unit[0]*m+unit[1]}});return o}});function d(n,m,o,p){if(typeof n=="object"){p=m;o=null;m=n;n=m.effect}if(h.isFunction(m)){p=m;o=null;m={}}if(typeof m=="number"||h.fx.speeds[m]){p=o;o=m;m={}}if(h.isFunction(o)){p=o;o=null}m=m||{};o=o||m.duration;o=h.fx.off?0:typeof o=="number"?o:o in h.fx.speeds?h.fx.speeds[o]:h.fx.speeds._default;p=p||m.complete;return[n,m,o,p]}function k(m){if(!m||typeof m==="number"||h.fx.speeds[m]){return true}if(typeof m==="string"&&!h.effects[m]){return true}return false}h.fn.extend({effect:function(p,o,r,t){var n=d.apply(this,arguments),q={options:n[1],duration:n[2],callback:n[3]},s=q.options.mode,m=h.effects[p];if(h.fx.off||!m){if(s){return this[s](q.duration,q.callback)}else{return this.each(function(){if(q.callback){q.callback.call(this)}})}}return m.call(this,q)},_show:h.fn.show,show:function(n){if(k(n)){return this._show.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="show";return this.effect.apply(this,m)}},_hide:h.fn.hide,hide:function(n){if(k(n)){return this._hide.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="hide";return this.effect.apply(this,m)}},__toggle:h.fn.toggle,toggle:function(n){if(k(n)||typeof n==="boolean"||h.isFunction(n)){return this.__toggle.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="toggle";return this.effect.apply(this,m)}},cssUnit:function(m){var n=this.css(m),o=[];h.each(["em","px","%","pt"],function(p,q){if(n.indexOf(q)>0){o=[parseFloat(n),q]}});return o}});h.easing.jswing=h.easing.swing;h.extend(h.easing,{def:"easeOutQuad",swing:function(n,o,m,q,p){return h.easing[h.easing.def](n,o,m,q,p)},easeInQuad:function(n,o,m,q,p){return q*(o/=p)*o+m},easeOutQuad:function(n,o,m,q,p){return -q*(o/=p)*(o-2)+m},easeInOutQuad:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o+m}return -q/2*((--o)*(o-2)-1)+m},easeInCubic:function(n,o,m,q,p){return q*(o/=p)*o*o+m},easeOutCubic:function(n,o,m,q,p){return q*((o=o/p-1)*o*o+1)+m},easeInOutCubic:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o+m}return q/2*((o-=2)*o*o+2)+m},easeInQuart:function(n,o,m,q,p){return q*(o/=p)*o*o*o+m},easeOutQuart:function(n,o,m,q,p){return -q*((o=o/p-1)*o*o*o-1)+m},easeInOutQuart:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o*o+m}return -q/2*((o-=2)*o*o*o-2)+m},easeInQuint:function(n,o,m,q,p){return q*(o/=p)*o*o*o*o+m},easeOutQuint:function(n,o,m,q,p){return q*((o=o/p-1)*o*o*o*o+1)+m},easeInOutQuint:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o*o*o+m}return q/2*((o-=2)*o*o*o*o+2)+m},easeInSine:function(n,o,m,q,p){return -q*Math.cos(o/p*(Math.PI/2))+q+m},easeOutSine:function(n,o,m,q,p){return q*Math.sin(o/p*(Math.PI/2))+m},easeInOutSine:function(n,o,m,q,p){return -q/2*(Math.cos(Math.PI*o/p)-1)+m},easeInExpo:function(n,o,m,q,p){return(o==0)?m:q*Math.pow(2,10*(o/p-1))+m},easeOutExpo:function(n,o,m,q,p){return(o==p)?m+q:q*(-Math.pow(2,-10*o/p)+1)+m},easeInOutExpo:function(n,o,m,q,p){if(o==0){return m}if(o==p){return m+q}if((o/=p/2)<1){return q/2*Math.pow(2,10*(o-1))+m}return q/2*(-Math.pow(2,-10*--o)+2)+m},easeInCirc:function(n,o,m,q,p){return -q*(Math.sqrt(1-(o/=p)*o)-1)+m},easeOutCirc:function(n,o,m,q,p){return q*Math.sqrt(1-(o=o/p-1)*o)+m},easeInOutCirc:function(n,o,m,q,p){if((o/=p/2)<1){return -q/2*(Math.sqrt(1-o*o)-1)+m}return q/2*(Math.sqrt(1-(o-=2)*o)+1)+m},easeInElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v)==1){return m+w}if(!u){u=v*0.3}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}return -(o*Math.pow(2,10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u))+m},easeOutElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v)==1){return m+w}if(!u){u=v*0.3}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}return o*Math.pow(2,-10*q)*Math.sin((q*v-r)*(2*Math.PI)/u)+w+m},easeInOutElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v/2)==2){return m+w}if(!u){u=v*(0.3*1.5)}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}if(q<1){return -0.5*(o*Math.pow(2,10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u))+m}return o*Math.pow(2,-10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u)*0.5+w+m},easeInBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}return r*(o/=q)*o*((p+1)*o-p)+m},easeOutBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}return r*((o=o/q-1)*o*((p+1)*o+p)+1)+m},easeInOutBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}if((o/=q/2)<1){return r/2*(o*o*(((p*=(1.525))+1)*o-p))+m}return r/2*((o-=2)*o*(((p*=(1.525))+1)*o+p)+2)+m},easeInBounce:function(n,o,m,q,p){return q-h.easing.easeOutBounce(n,p-o,0,q,p)+m},easeOutBounce:function(n,o,m,q,p){if((o/=p)<(1/2.75)){return q*(7.5625*o*o)+m}else{if(o<(2/2.75)){return q*(7.5625*(o-=(1.5/2.75))*o+0.75)+m}else{if(o<(2.5/2.75)){return q*(7.5625*(o-=(2.25/2.75))*o+0.9375)+m}else{return q*(7.5625*(o-=(2.625/2.75))*o+0.984375)+m}}}},easeInOutBounce:function(n,o,m,q,p){if(o<p/2){return h.easing.easeInBounce(n,o*2,0,q,p)*0.5+m}return h.easing.easeOutBounce(n,o*2-p,0,q,p)*0.5+q*0.5+m}})})(jQuery);
(function(a,b){a.effects.slide=function(c){return this.queue(function(){var f=a(this),e=["position","top","bottom","left","right"];var j=a.effects.setMode(f,c.options.mode||"show");var i=c.options.direction||"left";a.effects.save(f,e);f.show();a.effects.createWrapper(f).css({overflow:"hidden"});var g=(i=="up"||i=="down")?"top":"left";var d=(i=="up"||i=="left")?"pos":"neg";var k=c.options.distance||(g=="top"?f.outerHeight({margin:true}):f.outerWidth({margin:true}));if(j=="show"){f.css(g,d=="pos"?(isNaN(k)?"-"+k:-k):k)}var h={};h[g]=(j=="show"?(d=="pos"?"+=":"-="):(d=="pos"?"-=":"+="))+k;f.animate(h,{queue:false,duration:c.duration,easing:c.options.easing,complete:function(){if(j=="hide"){f.hide()}a.effects.restore(f,e);a.effects.removeWrapper(f);if(c.callback){c.callback.apply(this,arguments)}f.dequeue()}})})}})(jQuery);
(function(h,s){if(h.iCard){return}var g=window;var A=h.browser.msie&&parseFloat(h.browser.version)<7;var m=20;var w="请输入新分组名称";var i=/[^\x00-\xff]/g,v=/[^\x00-\xff]/;function j(B){return B.replace(i,"lv").length}function x(B){return v.test(B)}function a(H,B,G,F){G=G||"";F=F||G.length;B-=F;if(j(H)<=B){return H}var E=H.split(""),I=0,C=[];for(var D=0;D<E.length;D+=1){if(I<B){C[C.length]=E[D]}if(x(E[D])){I+=2}else{I+=1}}return C.join("")+G}function c(C){var B=[255,200,200];C.style.backgroundColor="rgb("+B[0]+","+B[1]+","+B[2]+")";var D=setInterval(function(){B[1]+=10;B[2]+=10;if(B[1]>255){clearInterval(D)}C.style.backgroundColor="rgb("+B[0]+","+B[1]+","+B[2]+")"},100)}function q(D,G){var F=this;var C=D.relatedTarget;var B=F.get(0);try{while(C&&C!==B){C=C.parentNode}if(C!==B){G()}}catch(E){}}function o(){if(!h.cookie("ppinf")){h.ppDialog({appId:"1019",regRedirectUrl:location.href,title:"想要查看更多精彩内容，马上登录吧！",onLogin:function(B){location.reload()}});return false}return true}var l=null;var u=false;var t=function(B){var C={onAccept:null,onCancel:null};this.opts=h.extend(C,B);this.init()};t.prototype={init:function(){var B=this;this.$container=h('<div class="card-win-wrapper" style="z-index:520"></div>');var C=['<div class="card-win-con">确定不再跟随？</div>','<div class="card-win-btn">','<a href="#" class="accept">确定</a>','<a href="#" class="cancel">取消</a>',"</div>"].join("");this.$container.html(C).appendTo("body");this.$container.find("a.accept").bind("click",function(D){D.preventDefault();if(h.isFunction(B.opts.onAccept)&&B.opts.onAccept.call(B)===false){return false}B.close()});this.$container.find("a.cancel").bind("click",function(D){D.preventDefault();if(h.isFunction(B.opts.onCancel)&&B.opts.onCancel.call(B)===false){return false}B.close()})},dlg:function(){return this.$container},close:function(){this.$container.hide()},destroy:function(){this.$container.find("a.accept,a.cancel").unbind("click");this.$container.remove()}};var z=0;var y=[];function r(D,C){var F=h(D).eq(0);if(F.data("iCardInstance")){F.data("iCardInstance").destroy()}F.data("iCardInstance",C);for(var E=0,B=y.length;E<B;E+=1){if(y[E][0]===F[0]){break}}if(E>=B){y[y.length]=F}}function e(B){var C=h(B).eq(0);if(C.data("iCardInstance")){C.data("iCardInstance").destroy()}}function k(D){for(var C=0,B=y.length;C<B;C+=1){if(y[C].data("iCardInstance")&&y[C].data("iCardInstance")!==D){y[C].data("iCardInstance").hide()}}}function p(){for(var C=0,B=y.length;C<B;C+=1){if(y[C].data("iCardInstance")){y[C].data("iCardInstance").clearCache()}}}function n(){for(var D=0,B=y.length;D<B;D+=1){var C=y[D].data("iCardInstance");if(C&&C.isVisible()){return C}}return null}var b=function(B){var C={params:{},type:"isohu",bindElement:"",autoBindEvent:true,getcard:"/a/usercard/getcard.do",getnickcard:"/a/usercard/getnickcard.do?_input_encode=UTF-8",follow:"/a/app/friend/friend/add.do",unFollow:"/a/app/friend/friend/delete.do",getgroups:"/a/app/friend/group/getgroups.do",createGroup:"/a/app/friend/group/add.do?_input_encode=UTF-8",mapping:"/a/app/friend/update/group/mapping.do",getDesc:"/a/app/friend/get/friend/desc.do",setDesc:"/a/app/friend/friend/update.do?_input_encode=UTF-8",maxHeight:170,ajaxDelay:300,fromType:"usercard",side:"auto",showInviteCheckbox:true,onCreateGroup:null,onSetGroup:null,onCancelSetGroup:null,onFollow:null,onUnfollow:null,onSetDesc:null};this.options=h.extend(C,B||{});if(this.options.bindElement!=""&&!h(this.options.bindElement).length){return}if(z==0){h("body").bind("click.icard",function(E){var D=n();if(D&&!h(E.target).closest(".card-box,.card-box-dialog").length){D.hide()}})}this.instanceId="iCardInstance"+(++z);this.cache={};this.xhr=null;this.ajaxTimeoutId=null;this.timeoutID=null;this.init();this.bindEvent()};b.prototype={init:function(){var B=this;var C='<div class="jt-right"></div><div class="jt-top"></div><div class="jt-bottom"></div>';C+='<div class="card-con">';C+="</div>";this.container=h('<div class="card-box" id="'+this.instanceId+'"></div>');this.container.css({position:"absolute",zIndex:"510"}).html(C).appendTo("body");this.container.hide();this.$fixmask=h("<div></div>").css({position:"absolute",opacity:0,backgroundColor:"#ffffff"}).appendTo(this.container);this.container.bind("mouseenter."+this.instanceId,function(){if(B.timeoutID){clearTimeout(B.timeoutID)}}).bind("mouseleave."+this.instanceId,function(){if(!l){B.hide(0)}}).bind("click."+this.instanceId,function(G){var D=h(G.target),F=B.container.data("xpt"),E=B.container.data("friendid"),H=B.container.data("groupids");if(D.closest(".card-unfollow").length){G.preventDefault();B.unfollow(G)}else{if(D.closest(".card-follow").length){G.preventDefault();B.follow()}else{if(D.closest(".card-setgroup").length){G.preventDefault();B.setGroup()}else{if(D.closest(".card-remark").length){G.preventDefault();B.setDesc()}else{if(D.closest(".card-at").length){G.preventDefault();B.atTA()}else{if(D.closest(".card-msg").length){G.preventDefault();B.message()}else{if(D.closest(".card-invite").length){G.preventDefault();B.inviteFollow()}else{if(D.closest(".card-whisper").length){G.preventDefault();B.whisper()}}}}}}}}});if(A){this.iframe=h('<iframe frameborder="0" tabindex="-1" src="about:blank" style="position:absolute;z-index:'+this.container.css("z-index")+';display:block;cursor:default;opacity:0;filter:alpha(opacity=0);"></iframe>').insertBefore(this.container).hide()}if(this.options.bindElement!=""){e(this.options.bindElement);r(this.options.bindElement,this)}else{e("body");r("body",this)}},bindEvent:function(){var B=this,C;if(this.options.bindElement!=""){C=h(this.options.bindElement).eq(0)}else{C=h("body")}if(this.options.autoBindEvent){C.delegate("[data-card]","mouseenter."+this.instanceId,function(D){B.show(h(this),{})}).delegate("[data-card]","mouseleave."+this.instanceId,function(D){B.hide(1000)})}},position:function(K){var N,M,L=this.options.side,E=h(g),J=E.width(),F=E.scrollTop(),P=30,I=K.offset(),H=this.container.width(),C=this.container.height(),D=this.container.find(".jt-right"),B=this.container.find(".jt-top"),O=this.container.find(".jt-bottom"),G=this.getParam(K.attr("data-card-action")),Q=C>this.options.maxHeight?C:this.options.maxHeight;if(this.container.outerWidth()+I.left>J){L="left"}if(L=="left"){D.show();B.hide();O.hide();N=I.left-H-D.width();M=I.top-D.position().top+K.height()/2-D.height()/2;this.$fixmask.css({top:0,right:-10,left:"auto",bottom:"auto",width:12,height:C})}else{if(I.top-Q-F-P-2>=0){N=I.left;M=I.top-C-O.height()+2;D.hide();B.hide();O.show();this.$fixmask.css({left:0,right:"auto",top:"auto",width:H,height:12});if(A){this.$fixmask.css({top:this.container.outerHeight()-8})}else{this.$fixmask.css({bottom:-10})}}else{N=I.left;M=I.top+K.height()+B.height()-2;D.hide();B.show();O.hide();this.$fixmask.css({top:-10,left:0,right:"auto",bottom:"auto",width:H,height:12})}}this.container.css({top:M,left:N});if(this.iframe){this.iframe.css({top:this.container.css("top"),left:this.container.css("left"),width:this.container.outerWidth(),height:this.container.outerHeight()}).show()}},show:function(G,C){if(this.timeoutID){clearTimeout(this.timeoutID)}if(this.ajaxTimeoutId){clearTimeout(this.ajaxTimeoutId)}if(this.xhr){this.xhr.abort();this.xhr=null}var K=this,I=G.attr("data-card"),F=G.attr("data-card-action"),J=G.attr("data-card-type")||this.options.type;if(!G.data("data-card-instanceId")){G.data("data-card-instanceId",this.instanceId)}if(J!="isohu"||I=="false"||I==false||u||(G.data("data-card-instanceId")!=this.instanceId)){return}k(this);var D,H;var E=this.getParam(F),B=this.getCacheData(F);if(this.options.ajaxDelay>0){this.ajaxTimeoutId=setTimeout(function(){if(B){K.setHTML(B)}else{K.loadCard(G,C)}K.container.data("paramStr",F);K.container.show();K.position(G);K.destroyUnfollowDialog()},this.options.ajaxDelay)}else{if(B){this.setHTML(B)}else{this.loadCard(G,C)}this.container.data("paramStr",F);this.container.show();this.position(G);this.destroyUnfollowDialog()}},hide:function(C){var B=this;if(!this.isVisible()){if(this.ajaxTimeoutId){clearTimeout(this.ajaxTimeoutId)}if(this.xhr){this.xhr.abort();this.xhr=null}return}if(C>0){this.timeoutID=setTimeout(function(){B.container.hide();if(B.iframe){B.iframe.hide()}B.destroyUnfollowDialog()},C)}else{this.container.hide();if(this.iframe){this.iframe.hide()}this.destroyUnfollowDialog()}},destroyUnfollowDialog:function(){if(l){l.destroy();l=null;u=false}},loading:function(){this.setHTML('<div class="data-load"><div class="data-load-icon"></div>正在加载，请稍候...</div>')},loadCard:function(E,G){var B=this,F=E.attr("data-card-action"),C,D;var H=h.extend(this.getParam(F),this.options.params);if(H.xpt){C=this.options.getcard}else{if(H.nick){C=this.options.getnickcard}else{this.setHTML('<div class="data-error">抱歉，该用户无法访问</div>');return}}H._=(new Date()).getTime();this.loading();this.xhr=h.getJSON(C,H,function(I){if(I.code==0&&B.xhr){B.setCacheData(F,I.data);B.setHTML(I.data)}else{B.setHTML('<div class="data-load">'+I.msg+"</div>")}B.position(E);B.xhr=null})},getParam:function(H){if(!H){return{}}var E=H.split("&");var G={},B,D,F;for(var C=0;C<E.length;C+=1){B=E[C].indexOf("=");D=E[C].substring(0,B);F=E[C].substring(B+1);G[D]=F}return G},setCacheData:function(B,C){return this.cache[B]=C},getCacheData:function(B){if(this.cache[B]){return this.cache[B]}return null},setHTML:function(C){var B;if(h.isPlainObject(C)){B=C.view.replace(/(\r?\n)|\t/g,"");this.container.data("friendid",C.friendid||"");this.container.data("xpt",C.xpt||"");this.container.data("groupids",C.groupids||"");this.container.data("nick",C.nick||"")}else{B=C}this.container.find(".card-con").html(B)},follow:function(){var D=this,E=this.container.data("paramStr"),C=this.container.data("xpt"),B=this.container.data("friendid"),F=this.container.data("groupids");if(!o()){return}h.get(this.options.follow,{xpt:C,from_type:this.options.fromType},function(G){if(G.code==1||G.code==-2){if(G.data.friendType==1){D.container.find("span.card-button-attention,span.card-button-attention-add").replaceWith('<span class="card-button-attention-each-other"><em>互相跟随</em><a class="card-unfollow" href="#">取消</a></span>')}else{D.container.find("span.card-button-attention,span.card-button-attention-add").replaceWith('<span class="card-button-attention-already"><em>已跟随</em><a class="card-unfollow" href="#">取消</a></span>')}p();D.setCacheData(E,null);D.container.data("friendid",G.data.friendId);D.container.data("groupids","");D.followMode();D.setGroup("跟随成功","跳过",D.options.showInviteCheckbox?G.data.friendType:1);if(h.isFunction(D.options.onFollow)){D.options.onFollow({xpt:C,friendid:B,friendType:G.data.friendType})}}else{h.alert(G.msg)}},"json")},unfollow:function(B){var M=this,I=this.container.data("paramStr"),C=this.container.data("xpt"),E=this.container.data("friendid"),D=this.container.data("groupids");if(!o()||u||(l&&l.dlg().is(":visible"))){return}this.destroyUnfollowDialog();var F=h(B.target).parent();var J=F.offset();var G=new t({onAccept:function(){h.get(M.options.unFollow,{xpt:C},function(N){if(N.code==1){if(N.data.friendType==1){M.container.find("span.card-button-attention-already,span.card-button-attention-each-other").replaceWith('<span class="card-button-attention-add"><a class="card-follow" href="#">跟随</a></span>')}else{M.container.find("span.card-button-attention-already,span.card-button-attention-each-other").replaceWith('<span class="card-button-attention"><a class="card-follow" href="#">跟随</a></span>')}p();M.setCacheData(I,null);M.unFollowMode();if(h.isFunction(M.options.onUnfollow)){M.options.onUnfollow({xpt:C,friendid:E,groupids:D,friendType:N.data.friendType})}}else{h.alert(N.msg)}},"json");M.destroyUnfollowDialog();return false},onCancel:function(){u=true;this.dlg().hide("slide",{direction:"down"},function(){M.destroyUnfollowDialog()});return false}});var H=J.top-G.dlg().outerHeight()-2;var L=J.left+(F.outerWidth()-G.dlg().outerWidth())/2;var K=h(g).width();if(H<0){H=0}if((L+G.dlg().outerWidth())>K){L=K-G.dlg().outerWidth()-10}u=true;l=G;G.dlg().css({top:H,left:L}).show("slide",{direction:"down"},function(){u=false})},followMode:function(){this.container.find(".card-remark").parent().show();this.container.find(".card-setgroup").show()},unFollowMode:function(){this.container.find(".card-remark").parent().hide();this.container.find(".card-setgroup").hide()},setGroup:function(H,G,E){var I=this,F=this.container.data("paramStr"),B=this.container.data("xpt"),D=this.container.data("friendid"),C=this.container.data("groupids"),J=(E==0?true:false);h.getJSON(this.options.getgroups,function(K){if(K.code==1){I.showGroupWin(K.data.groups,H,G,J)}})},isInGroup:function(E,B){if(B==""){return false}B+="";var C=B.split(",");for(var D=0;D<C.length;D+=1){if(C[D]==E){return true}}return false},checkGroupName:function(E){var D={pass:true,text:""};if(E==""||E==w){D.pass=false;D.text="请输入新分组名称";return D}if(j(E)>16){D.pass=false;D.text="请不要超过16个字符";return D}for(var C=0,B=this.groupsData.length;C<B;C+=1){if(this.groupsData[C].groupName==E||E=="未分组"){D.pass=false;D.text="此分组名已存在";return D}}return D},compareArray:function(D,C){if(D.length!=C.length){return false}function B(F,E){return parseInt(F,10)-parseInt(E,10)}D=D.sort(B);C=C.sort(B);if(D.join(",")==C.join(",")){return true}return false},showGroupWin:function(R,S,T,D){var J=this,F=this.container.data("paramStr"),B=this.container.data("xpt"),C=this.container.data("friendid"),G=this.container.data("groupids")||"",P=this.container.data("nick");this.groupsData=R;var E=h('<div class="card-win-clew" style="width:348px;"></div>');var I=['<div class="boxD">','<h2>为"'+P.replace(/&amp;/g,"&")+'"选择分组：</h2>','<ul class="clearfix"></ul>','<h3><a class="card-createGroup" href="#"><span class="card-icon-add"></span>创建分组</a></h3>','<p style="display:none" class="card-createGroupBox clearfix"><input type="text" class="text-input"><input type="button" class="card-button-found-disabled" value="创建"><span class="cancel-found"><a href="#">取消</a></span><span class="input-clew">你最多可以输入16个字符</span></p>',D?'<div class="card-invite-follow-bg"><input class="card-invite" type="checkbox" checked="checked" /><span>是否邀请TA与你互相跟随？</span></div>':"","</div>"];E.html(I.join(""));var H=E.find("ul"),N,O;for(N=0,O=R.length;N<O;N+=1){H.append('<li><label><input type="checkbox" value="'+R[N].groupId+'"'+(this.isInGroup(R[N].groupId,G)?' checked="checked"':"")+" />"+R[N].groupName+"</label></li>")}var Q=h.dialog({className:"jquery-btn-boxA",btns:["accept","cancel"],labAccept:"保存",labCancel:T||"取消",title:S||"设置分组",content:E,fixed:true,modal:true,scrollIntoView:true,onBeforeAccept:function(){var V,U=[];H.find(":checkbox:checked").each(function(){U.push(this.value)});if(G==""){V=[]}else{V=G.split(",")}if(!J.compareArray(V,U)){h.post(J.options.mapping,{friendId:C,groupIds:U.join(",")},function(W){if(W.code==0){J.okAlert();if(h.isFunction(J.options.onSetGroup)){J.options.onSetGroup({xpt:B,friendid:C,groupids:U.join(","),noGroupCount:W.data.noGroupCount})}}else{J.errorAlert()}},"json");p();J.setCacheData(F,null)}else{if(h.isFunction(J.options.onCancelSetGroup)){J.options.onCancelSetGroup({xpt:B})}}if(E.find("input.card-invite:checked").length){d.show({xpt:B,nick:P,fromType:"add_follow"})}},onCancel:function(){if(h.isFunction(J.options.onCancelSetGroup)){J.options.onCancelSetGroup({xpt:B})}}});if(O>=m){E.find(".card-createGroup").parent().hide()}var L=E.find(".card-createGroupBox :button");var M=E.find(".card-createGroupBox :text");var K=E.find(".input-clew");E.delegate("li","mouseenter",function(){h(this).addClass("now")}).delegate("li","mouseleave",function(){h(this).removeClass("now")}).click(function(V){var U=h(V.target);if(U.closest(".card-createGroup").length){V.preventDefault();E.find(".card-createGroup").parent().hide();E.find(".card-createGroupBox").show();M.val("").focus();Q.adjust()}else{if(U.closest(".cancel-found").length){V.preventDefault();E.find(".card-createGroup").parent().show();E.find(".card-createGroupBox").hide();Q.adjust()}}});M.bind(h.browser.msie?"propertychange":"input",function(){if(this.value.length>0){L.removeClass().addClass("card-button-found")}else{L.removeClass().addClass("card-button-found-disabled")}});L.click(function(){if(L.hasClass("card-button-found-disabled")){return}var V=h.trim(M.val());M.val(V);var U=J.checkGroupName(V);if(U.pass){h.post(J.options.createGroup,{gname:V},function(W){if(W.code==1){J.groupsData[J.groupsData.length]={groupId:W.data.gid,groupName:W.data.gname};H.append('<li><label><input type="checkbox" value="'+W.data.gid+'" checked="checked" />'+W.data.gname+"</label></li>");E.find(".card-createGroup").parent().show();E.find(".card-createGroupBox").hide();if(J.groupsData.length>=m){E.find(".card-createGroup").parent().hide()}Q.adjust();if(h.isFunction(J.options.onCreateGroup)){J.options.onCreateGroup({gid:W.data.gid,gname:W.data.gname})}}else{h.alert(W.msg)}},"json");K.removeClass("input-error").addClass("input-clew").html("你最多可以输入16个字符")}else{M.focus();K.removeClass().addClass("input-error").html(U.text)}}).hover(function(){if(!L.hasClass("card-button-found-disabled")){L.removeClass().addClass("card-button-found-hover")}},function(){if(!L.hasClass("card-button-found-disabled")){L.removeClass().addClass("card-button-found")}}).mousedown(function(){if(!L.hasClass("card-button-found-disabled")){L.removeClass().addClass("card-button-found-down")}}).mouseup(function(){if(!L.hasClass("card-button-found-disabled")){L.removeClass().addClass("card-button-found-hover")}})},okAlert:function(B){h.inform({icon:"icon-success",delay:1000,easyClose:true,content:B||"设置成功"})},errorAlert:function(B){h.inform({icon:"icon-error",delay:1000,easyClose:true,content:B||"设置失败"})},setDesc:function(){var D=this,E=this.container.data("paramStr"),C=this.container.data("xpt"),B=this.container.data("friendid"),F=this.container.data("groupids");h.getJSON(this.options.getDesc,{friendid:B},function(G){if(G.code==0){D.showDescWin(G.data.desc.replace(/&amp;/g,"&"))}})},showDescWin:function(I){var J=this,H=this.container.data("paramStr"),D=this.container.data("xpt"),F=this.container.data("friendid"),E=this.container.data("groupids"),B=this.container.data("nick");var C=h('<div class="card-win-clew" style="width:315px;"></div>');C.html('<div class="boxC"><p>请输入备注名字，方便认出TA是谁</p><p class="clearfix"><input type="text" class="text-input" value="'+I+'"><br><span class="input-error" style="display:none">请不要超过16个字符</span></p>');var G=h.dialog({className:"jquery-btn-boxA",btns:["accept","cancel"],labAccept:"确定",labCancel:"取消",title:"设置备注名",content:C,fixed:true,modal:true,scrollIntoView:true,onBeforeAccept:function(){var K=C.find(":text");var L=h.trim(K.val());K.val(L);if(j(L)>16){C.find(".input-error").html("请不要超过16个字符").show();G.adjust();return false}else{if(L!=I){h.post(J.options.setDesc,{friendid:F,desc:L},function(M){if(M.code==1){p();J.setCacheData(H,null);if(h.isFunction(J.options.onSetDesc)){J.options.onSetDesc({xpt:D,friendid:F,desc:M.data.desc})}}else{h.alert(M.msg)}},"json")}}}});C.find(":text").focus().select()},atTA:function(){var C=this,B=this.container.data("nick");require("app::widgets::atTA",function(D){D({nick:B})})},message:function(){if(!s.tweet){return}var D=this,C=this.container.data("xpt"),B=this.container.data("nick");s.tweet.message_dialog({receiverPassport:C,nick:B})},inviteFollow:function(){var D=this,C=this.container.data("xpt"),B=this.container.data("nick");d.show({xpt:C,nick:B,fromType:"user_card"})},whisper:function(){var D=this,C=this.container.data("xpt"),B=this.container.data("nick");require("app::whisper",function(E){E({nick:B})})},isVisible:function(){return this.container.is(":visible")},clearCache:function(){this.cache={}},destroy:function(){var B=this,C;if(this.options.bindElement!=""){C=h(this.options.bindElement).eq(0)}else{C=h("body")}if(this.options.autoBindEvent){C.unbind("."+this.instanceId).undelegate("."+this.instanceId)}C.removeData("iCardInstance");h("body").unbind("."+this.instanceId);this.container.unbind("."+this.instanceId);this.container.remove()}};var f={getgroups:"/a/app/friend/group/getgroups.do",createGroup:"/a/app/friend/group/add.do?_input_encode=UTF-8",mapping:"/a/app/friend/update/group/mapping.do",groupsData:null,isInGroup:b.prototype.isInGroup,compareArray:b.prototype.compareArray,checkGroupName:b.prototype.checkGroupName,errorAlert:b.prototype.errorAlert,okAlert:b.prototype.okAlert,show:function(F,I){F=F||{};var E=this,D=F.friendid,B=F.nick,H=F.friendType,C=F.xpt,G=(H==0?true:false);this.callback=I;h.getJSON(this.getgroups,function(J){if(J.code==1){E.showGroupWin(J.data.groups,D,C,B,G)}})},showGroupWin:function(I,E,D,B,P){var O=this;this.groupsData=I;var C=h('<div class="card-win-clew" style="width:348px;"></div>');var J=['<div class="boxD">','<h2>为"'+B.replace(/&amp;/g,"&")+'"选择分组：</h2>','<ul class="clearfix"></ul>','<h3><a class="card-createGroup" href="#"><span class="card-icon-add"></span>创建分组</a></h3>','<p style="display:none" class="card-createGroupBox clearfix"><input type="text" class="text-input"><input type="button" class="card-button-found-disabled" value="创建"><span class="cancel-found"><a href="#">取消</a></span><span class="input-clew">你最多可以输入16个字符</span></p>',P?'<div class="card-invite-follow-bg"><input class="card-invite" type="checkbox" checked="checked" /><span>是否邀请TA与你互相跟随？</span></div>':"","</div>"];C.html(J.join(""));var H=C.find("ul"),G,K;for(G=0,K=I.length;G<K;G+=1){H.append('<li><label><input type="checkbox" value="'+I[G].groupId+'" />'+I[G].groupName+"</label></li>")}var F=h.dialog({className:"jquery-btn-boxA",btns:["accept","cancel"],labAccept:"保存",labCancel:"跳过",title:"跟随成功",content:C,fixed:true,modal:true,scrollIntoView:true,onBeforeAccept:function(){var Q=[];H.find(":checkbox:checked").each(function(){Q.push(this.value)});h.post(O.mapping,{friendId:E,groupIds:Q.join(",")},function(R){if(R.code==0){O.okAlert()}else{O.errorAlert()}},"json");h.isFunction(O.callback)&&O.callback();if(C.find("input.card-invite:checked").length){d.show({xpt:D,nick:B,fromType:"add_follow"})}},onCancel:function(){h.isFunction(O.callback)&&O.callback()}});if(K>=m){C.find(".card-createGroup").parent().hide()}var M=C.find(".card-createGroupBox :button");var L=C.find(".card-createGroupBox :text");var N=C.find(".input-clew");C.delegate("li","mouseenter",function(){h(this).addClass("now")}).delegate("li","mouseleave",function(){h(this).removeClass("now")}).click(function(R){var Q=h(R.target);if(Q.closest(".card-createGroup").length){R.preventDefault();C.find(".card-createGroup").parent().hide();C.find(".card-createGroupBox").show();L.val("").focus();F.adjust()}else{if(Q.closest(".cancel-found").length){R.preventDefault();C.find(".card-createGroup").parent().show();C.find(".card-createGroupBox").hide();F.adjust()}}});L.bind(h.browser.msie?"propertychange":"input",function(){if(this.value.length>0){M.removeClass().addClass("card-button-found")}else{M.removeClass().addClass("card-button-found-disabled")}});M.click(function(){if(M.hasClass("card-button-found-disabled")){return}var R=h.trim(L.val());L.val(R);var Q=O.checkGroupName(R);if(Q.pass){h.post(O.createGroup,{gname:R},function(S){if(S.code==1){O.groupsData[O.groupsData.length]={groupId:S.data.gid,groupName:S.data.gname};H.append('<li><label><input type="checkbox" value="'+S.data.gid+'" checked="checked" />'+S.data.gname+"</label></li>");C.find(".card-createGroup").parent().show();C.find(".card-createGroupBox").hide();if(O.groupsData.length>=m){C.find(".card-createGroup").parent().hide()}F.adjust()}else{h.alert(S.msg)}},"json");N.removeClass("input-error").addClass("input-clew").html("你最多可以输入16个字符")}else{L.focus();N.removeClass().addClass("input-error").html(Q.text)}}).hover(function(){if(!M.hasClass("card-button-found-disabled")){M.removeClass().addClass("card-button-found-hover")}},function(){if(!M.hasClass("card-button-found-disabled")){M.removeClass().addClass("card-button-found")}}).mousedown(function(){if(!M.hasClass("card-button-found-disabled")){M.removeClass().addClass("card-button-found-down")}}).mouseup(function(){if(!M.hasClass("card-button-found-disabled")){M.removeClass().addClass("card-button-found-hover")}})}};var d={show:function(D,E){D=D||{};E=h.isFunction(E)?E:function(){};var C=this,B=D.xpt;if(!B){return}if(D.noCheck){this.showDialog(D,E);return}h.getJSON("/a/app/friend/quest/send/check.do",{xpt:B},function(F){if(F.code==0){if(F.data.isAllowFollow){D.autoFollow=true}C.showDialog(D,E)}else{h.inform({icon:"icon-error",delay:1000,easyClose:true,content:F.msg})}})},showDialog:function(K,F){K=K||{};F=h.isFunction(F)?F:function(){};var M=this,G=200,U="Hi，我已跟随你啦，求互相跟随！",H="Hi，很希望认识你，求互相跟随！",C=U,B=K.xpt,R=K.fromType||"",S=K.nick||"TA",D=K.autoFollow||false;if(D){C=H}var E=h('<div class="card-invite-follow-wrapper"></div>');var J=['<div class="title">对TA说点什么：</div>','<div class="textarea-wrapper">','<textarea class="invite-textarea">'+C+"</textarea>","</div>",'<div class="card-invite-follow-bottom">','<div class="btn">','<span class="txt red error-text">请输入内容</span>','<span class="txt inputed-counter"><em class="inputed-length">0</em>&nbsp;/&nbsp;'+G+"</span>",'<span class="ui-btn"><span>发送</span></span>',"</div>","</div>"];E.html(J.join(""));var T=h.dialog({className:"",title:"邀请"+S+"与我互相跟随",content:E,fixed:true,modal:true,scrollIntoView:true});var Q=E.find("textarea"),N=E.find("span.error-text"),I=E.find("span.inputed-counter"),P=E.find("em.inputed-length"),O=E.find("span.ui-btn");N.hide();Q.css("color","#999").bind(h.browser.msie?"propertychange":"input",function(W){var V=this.value.length;if(V>G){P.addClass("red")}else{P.removeClass("red")}P.html(V)}).bind("focus",function(){Q.css("color","#000").removeClass("invite-textarea-err");N.hide();I.show()});var L=false;O.bind("click",function(W){var X=h.trim(Q.val());if(X==""){Q.addClass("invite-textarea-err");N.show();I.hide()}else{if(X.length>G){Q.addClass("invite-textarea-err")}else{if(L){return}L=true;Q.attr("disabled",true);O.html("<span>发送中</span>");var V=function(){h.post("/a/app/friend/quest/send/request.do?_input_encode=UTF-8",{xpt:B,sweetWords:X,from_type:R},function(Y){if(Y.code==0){h.inform({icon:"icon-success",delay:1000,easyClose:true,content:"邀请发送成功"});T.close();F()}else{h.inform({icon:"icon-error",delay:1000,easyClose:true,content:Y.msg});L=false;Q.attr("disabled",false);O.html("<span>发送</span>")}},"json")};if(E.find("div.selector input:checkbox:checked").length){h.getJSON("/a/app/friend/friend/add.do",{xpt:B},function(Y){if(Y.code==1||Y.code==-2){V()}})}else{V()}}}})}};b.destroyInstance=e;b.SetGroupsDialog=f;b.InviteFollowDialog=d;h.iCard=s.iCard=b;h(function(){h("[data-card-handle]").each(function(){var C=h(this),D=b.prototype.getParam(C.attr("data-card-handle")||"");var B=new b({bindElement:C,params:D})})})})(jQuery,mysohu);
(function(c){var e="http://stat.i.sohu.com/guest/frag/recents.do?callback=?";function b(){return window._xpt||(window.$space_config?$space_config._xpt:"")}function a(f){if(!f.next().length){f.find("ul").addClass("noborder")}}var d={card:null,xhr:null,init:function(){var f=this;this.$this=c("#rtbarGuestBox");if(!this.$this.length){return}this.getPage();if(c.iCard){this.card=new c.iCard({bindElement:"#rtbarGuestBox",side:"left"})}},getPage:function(){var g=this,f=b();c.getJSON(e,{xpt:f},function(h){if(h.code==0){g.build(h.data);g.inited=true}})},build:function(k){var g=this,j=[],h,f=k.list.length>8?8:k.list.length;j.push("<h3>");if(k.more){j.push('<a class="change" href="http://i.sohu.com/app/friend/!!/a/guest/web/recentlist.do">更多&gt;&gt;</a>')}j.push("最近访客</h3>");j.push('<ul class="rtbar-com">');for(h=0;h<f;h+=1){j.push("<li>");j.push(this.getLiHTML(k.list[h]));j.push("</li>")}if(f==0){if(k.more){j.push('<span class="visitors-txt">还没有人访问过你，先去拜访一下别人吧，他们也会回访你的！</span>')}else{j.push('<span class="visitors-txt">还没有人访问过TA</span>')}}j.push("</ul>");this.$this.html(j.join(""));a(this.$this)},getLiHTML:function(f){return'<a href="'+f.blog+'" target="_blank" title="'+f.nick+'"><img src="'+f.photo+'" width="40" height="40" data-card-action="xpt='+f.xpt+'&type=simple&pageid=51" data-card-type="isohu" data-card="true" /></a>'}};c(function(){d.init()})})(jQuery);
(function(d){var f="/a/app/friend/person/attentions/frag.do";function b(){return window._xpt||(window.$space_config?$space_config._xpt:"")}function c(){return window.$space_config?$space_config._url:""}function a(g){if(!g.next().length){g.find("ul").addClass("noborder")}}var e={card:null,xhr:null,init:function(){var g=this;this.$this=d("#rtbarFollowBox");if(!this.$this.length){return}this.getPage();if(d.iCard){this.card=new d.iCard({bindElement:"#rtbarFollowBox",side:"left"})}},getPage:function(){var h=this,g=b();d.getJSON(f,{xpt:g},function(i){if(i.code==0){h.build(i.data);h.inited=true}})},build:function(l){var h=this,k=[],j,g=l.list.length>8?8:l.list.length;k.push("<h3>");k.push('<a class="change" href="'+c()+'app/friend/">更多&gt;&gt;</a>');if(l.more){k.push("我跟随的人")}else{k.push("TA跟随的人")}k.push("</h3>");k.push('<ul class="rtbar-com">');for(j=0;j<g;j+=1){k.push("<li>");k.push(this.getLiHTML(l.list[j]));k.push("</li>")}if(g==0){if(l.more){k.push('<span class="visitors-txt">你还没有跟随任何人</span>')}else{k.push('<span class="visitors-txt">TA还没有跟随任何人</span>')}}k.push("</ul>");this.$this.html(k.join(""));a(this.$this)},getLiHTML:function(g){return'<a href="'+g.blog+'" target="_blank" title=""><img src="'+g.photo+'" width="40" height="40" data-card-action="xpt='+g.xpt+'&type=simple&pageid=81" data-card-type="isohu" data-card="true" /></a>'}};d(function(){e.init()})})(jQuery);
(function(a){var b={sets:{namespace:".tweet",edit_box:"#tweet_editor_box",leavemsg_wrapper:".main-leavemsg-place",publish_wrapper:".publish-wrapper",textarea_box:".main-leavemsg",vcode:"input.securitycode-text",vcode_img:"img.securitycode-img",vcode_link:"a.securitycode-switch",publish_btn:".leavemsg-btn",line_height:20,default_text:"对他说点什么",is_working:false,publish_url:"/a/guestbook/addMessage.htm?_input_encode=UTF-8",vcode_url:"/a/guestbook/vcode.htm",vcode_image_url:"/a/guestbook/rand.htm",default_height:18,line_height:18,min_height:72,max_height:180,link_to:$space_config._url+"guestbook/index.htm"},params:{receiverPassport:"",vcode:""},timer:null,init:function(e){a.extend(b.sets,e||{});b.params.receiverPassport=($space_config&&$space_config._xpt)?$space_config._xpt:"";var f=a(b.sets.edit_box),d=a(b.sets.textarea_box,f),c=a(b.sets.publish_btn,f);a("body").bind("focusin"+b.sets.namespace,b.leavemsg_handler).bind("click"+b.sets.namespace,b.leavemsg_handler);if(d.val()==""){d.val(b.sets.default_text)}d.bind("keyup"+b.sets.namespace,b.height_adjust);c.bind("mouseenter"+b.sets.namespace,function(){a(this).addClass("leavemsg-btn-hover")}).bind("mouseleave"+b.sets.namespace,function(){a(this).removeClass("leavemsg-btn-hover")})},height_adjust:function(f){f=f||"expand";var g=a(b.sets.edit_box),d=a(b.sets.textarea_box,g),i=null;if(!a("#leavemsg_textarea_duplicate").length){a("body").append('<div id="leavemsg_textarea_duplicate" style="display: none;"></div>')}i=a("#leavemsg_textarea_duplicate");var c=d.val();c=c.replace(/\&/g,"&amp;");c=c.replace(/\</g,"&lt;");c=c.replace(/\>/g,"&gt;");c=c.replace(/\n/g,"<br/> ");c=c.replace(/\s/g,"<i> </i>");i.html(c);var e=i.height();e=(e<b.sets.max_height)?e:b.sets.max_height;d.height((e>b.sets.min_height)?e:b.sets.min_height);if(f==="collapse"){d.height(b.sets.default_height)}},string_length:function(c){return c.replace(/[^\x00-\xff]/g,"**").length},string_sub:function(e,g){var f=/[^\x00-\xff]/g;if(b.string_length(e)<=g){return e}var c=Math.floor(g/2);for(var d=c;d<e.length;d++){if(b.string_length(e.substr(0,d))>=g){return e.substr(0,d)}}return e},login:function(){if(!a.cookie("ppinf")){a.ppDialog({appId:"1019",regRedirectUrl:location.href,title:"想要查看更多精彩内容，马上登录吧！",onLogin:function(c){location.reload()}});return false}return true},get_vcode:function(c){a.getJSON(b.sets.vcode_url+"?t="+ +new Date,function(d){if(typeof d!="undefined"){b.params.vcode=d.vcode;c[0].src="/a/guestbook/rand.htm?vcode="+d.vcode}},"json");return b.params.vcode},publish:function(d){if(!b.login()){return}var c=a(d.target);$edit_box=a(b.sets.edit_box),$publish_wrapper=a(b.sets.publish_wrapper,$edit_box),$textarea_box=a(b.sets.textarea_box,$publish_wrapper),$usercode=a(b.sets.vcode,$publish_wrapper);b.is_working=true;b.set_status.call($publish_wrapper,"disabled");var e=a.extend(b.params,{content:$textarea_box.val(),usercode:$usercode.val()});if(a.trim(e.content)==""||a.trim(e.content)==b.sets.default_text){b.set_status.call($publish_wrapper,"error");a.inform({icon:"icon-error",delay:1500,easyClose:true,content:"内容不能为空。",onClose:function(){$textarea_box.focus();b.is_working=false}})}else{if(b.string_length(a.trim(e.content))>400){b.set_status.call($publish_wrapper,"error");a.inform({icon:"icon-error",delay:1500,easyClose:true,content:"内容不能超过200个字。",onClose:function(){$textarea_box.focus();b.is_working=false}})}else{if(a.trim(e.usercode)==""||a.trim(e.usercode)==""){$usercode.addClass("securitycode-text-active");a.inform({icon:"icon-error",delay:1500,easyClose:true,content:"验证码不能为空。",onClose:function(){$usercode.focus();b.is_working=false}})}else{a.post(b.sets.publish_url,e,function(f){if(f&&parseInt(f.status)===1){a.inform({icon:"icon-success",delay:1000,easyClose:true,content:f.statusText,onClose:function(){b.set_status.call($publish_wrapper,"normal");$textarea_box.val("");b.is_working=false;document.location.href=b.sets.link_to}})}else{a.inform({icon:"icon-error",delay:1000,easyClose:true,content:f.statusText,onClose:function(){$textarea_box.focus();b.is_working=false}})}},"json")}}}},set_status:function(c){var d=this;if(d.length){d.removeClass("leavemsg-active leavemsg-disabled leavemsg-error");switch(c){case"active":d.addClass("leavemsg-active");break;case"disabled":d.addClass("leavemsg-disabled");break;case"error":d.addClass("leavemsg-error");break;default:break}}},leavemsg_handler:function(c){var e=a(c.target);var g=a(b.sets.edit_box),j=a(b.sets.leavemsg_wrapper,g),h=a(b.sets.publish_wrapper,g),f=a(b.sets.textarea_box,h),d=a(b.sets.publish_btn,g),k=a(b.sets.vcode,h),i=a(b.sets.vcode_img,h);if(e.closest(b.sets.publish_wrapper).length||e.closest(b.sets.publish_btn).length){if(!h.hasClass("leavemsg-active")){if(f.val()==""||f.val()==b.sets.default_text){f.val("")}if(b.params.vcode==""){b.get_vcode(i)}b.set_status.call(h,"active");b.height_adjust("expand")}}else{if(h.hasClass("leavemsg-active")){if(f.val()==""){f.val(b.sets.default_text)}b.height_adjust("collapse");b.set_status.call(h,"normal")}}if(e.closest(b.sets.vcode).length){k.addClass("securitycode-text-active")}else{k.removeClass("securitycode-text-active")}if(c.type=="click"){if(e.closest(b.sets.publish_btn).length){b.publish.call(c.target,c)}else{if(e.closest(b.sets.vcode_img).length||e.closest(b.sets.vcode_link).length){b.get_vcode(i)}}}},textarea_blur:function(c){}};a(function(){b.init()})})(jQuery);
require("core::util::jQuery","core::ui::ppDialog","app::emote",function(d,a,b){if(!!mysohu.msgbox){return}var c={sets:{namespace:".msgbox",is_working:false,on_close:null,manage:".message-manage",wrapper:".message-remark",reply_btn:".btn-remark-reply",reply_reply_btn:".btn-reply-reply",manage_reply_btn:".btn-remark-reply-my",manage_reply_reply_btn:".btn-reply-reply-my",message_destroy_btn:".btn-remark-destroy",reply_destroy_btn:".btn-reply-destroy",message_post_url:"/a/guestbook/addMessage.htm?_input_encode=UTF-8",reply_url:"/a/guestbook/addReply.htm?_input_encode=UTF-8",manage_reply_url:"/a/guestbook/addReply.htm?_input_encode=UTF-8",message_destroy_url:"/a/guestbook/deleteMessage.htm",reply_destroy_url:"/a/guestbook/deleteReply.htm",messages_destroy_url:"/a/guestbook/deleteBatchMessages.htm",vcode_url:"/a/guestbook/vcode.htm",vcode_image_url:"/a/guestbook/rand.htm",reply_textarea:".reply-textarea",editor_panel:"#remark_message_panel",editor_wrapper:".message-editor",max_words:400,helper:null},params:{receiverPassport:"",vcode:""},templates:{no_login:['<div class="remark-message no-login-panel">',' 	<div class="rk-message-con">','    	<div class="rk-message-name">留言：</div>','        <div class="rk-message-body">','        	<div class="post-area">','              <div class="textarea-wrapper">','                  <span class="rk-noenter-words">此功能暂时只允许登录用户发表留言，<a class="quick-login" href="javascript:void(0);">立即登录</a>',"                  </span>","              </div>","            </div>","        </div>","        </div>","   </div>"].join(""),message_editor:['<div class="remark-message message-editor">',' 	<div class="rk-message-con">','    	<div class="rk-message-name">留言：</div>','       <div class="rk-message-body">','        <form method="post" action="#" name="addMessage">','        	<div class="post-area">','              <div class="textarea-wrapper">','                  <textarea class="message-textarea" name="content" cols="60" rows="4"></textarea>',"              </div>","            </div>",'            <div class="rk-message-emotion">','            	<div class="emotion-body clearfix"></div>',"            </div>","        </form></div>","    </div>",'    <div class="rk-message-con">','    <div class="rk-message-name">验证码：</div>','    <div class="rk-message-body">','        	<span class="btn-rk-message"><input type="submit" value="发表" class="ui-btn-w60 message-post-btn" /></span>','        	<input type="text" class="securitycode-text" name="usercode" maxlength="10" /><img class="securitycode-img" src="http://s3.suc.itc.cn/d/nil.gif" /><span class="remind-rk-message">看不清，<a class="securitycode-switch" href="javascript:void(0);">换一张</a></span>',"        </div>","    </div>"," </div>"].join(""),reply_dialog:['<div class="remark-message-wrapper remark-message-dialog">','  	 <div class="remark-message">','     	<div class="rk-message-con">','            <div class="rk-message-body">','            	<div class="post-area">','                  <div class="textarea-wrapper">','                      <textarea rows="1" cols="60" class="reply-textarea" name="replytextarea"></textarea>',"                  </div>","                </div>",'                <div class="rk-message-emotion">','                	<div class="emotion-body clearfix"></div>',"                </div>","            </div>","        </div>",'        <div class="rk-message-con">','            <div class="rk-message-body">','            	<input type="text" name="securitycode" class="securitycode-text" value="请输入验证码" maxlength="10" ><img class="securitycode-img" src="http://s3.suc.itc.cn/d/nil.gif"><span class="remind-rk-message">请输入图片中的文字，<a class="securitycode-switch" href="javascript:void(0);">看不清验证码？</a></span>',"            </div>","        </div>","     </div>","  </div>"].join(""),manage_reply_dialog:['<div class="remark-message-wrapper remark-message-dialog">','  	 <div class="remark-message">','     	<div class="rk-message-con">','            <div class="rk-message-body">','            	<div class="post-area">','                  <div class="textarea-wrapper">','                      <textarea rows="1" cols="60" class="reply-textarea" name="replytextarea"></textarea>',"                  </div>","                </div>",'                <div class="rk-message-emotion">','                	<div class="emotion-body clearfix"></div>',"                </div>","            </div>","        </div>","     </div>","  </div>"].join("")},init:function(o){d.extend(c.sets,o||{});var j=d(c.sets.manage),g=d(c.sets.wrapper),i=d(c.sets.editor_panel),h=d(c.sets.editor_wrapper);c.params.receiverPassport=($space_config&&$space_config._xpt)?$space_config._xpt:"";if(j.length){if(mysohu.is_login()){j.unbind("click"+c.sets.namespace).bind("click"+c.sets.namespace,function(q){var p=d(q.target);if(p.closest("a.remark-select-all").length||p.closest("input.remark-destroy-all").length){c.select_all()}else{if(p.closest("a.remark-destroy-selected").length){c.destroy_selected()}}})}}if(g.length){if(mysohu.is_login()){g.unbind("click"+c.sets.namespace).bind("click"+c.sets.namespace,function(q){var p=d(q.target);if(p.closest(c.sets.reply_btn).length){var t=p.closest(c.sets.reply_btn),u=t.closest(".remark-reply-box");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:null});c.reply_dialog()}if(p.closest(c.sets.manage_reply_btn).length){var t=p.closest(c.sets.manage_reply_btn),u=t.closest(".remark-reply-box");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:null});c.manage_reply_dialog()}else{if(p.closest(c.sets.message_destroy_btn).length){var s=p.closest(c.sets.message_destroy_btn),u=s.closest(".remark-reply-box");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:null});c.message_destroy(p)}else{if(p.closest(c.sets.reply_reply_btn).length){var t=p.closest(c.sets.reply_reply_btn),u=t.closest("li");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:u.attr("data-replyid")});c.reply_dialog()}else{if(p.closest(c.sets.manage_reply_reply_btn).length){var t=p.closest(c.sets.manage_reply_reply_btn),u=t.closest("li");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:u.attr("data-replyid")});c.manage_reply_dialog()}else{if(p.closest(c.sets.reply_destroy_btn).length){var r=p.closest(c.sets.reply_destroy_btn),u=r.closest("li");d.extend(c.params,{messageId:u.attr("data-messageid"),replyId:u.attr("data-replyid")});c.reply_destroy(p)}}}}}})}else{g.bind("click"+c.sets.namespace,function(q){var p=d(q.target);if(p.closest(c.sets.reply_btn).length){mysohu.login()}else{if(p.closest(c.sets.message_destroy_btn).length){mysohu.login()}else{if(p.closest(c.sets.reply_reply_btn).length){mysohu.login()}else{if(p.closest(c.sets.reply_destroy_btn).length){mysohu.login()}}}}})}}if(i.length){var k="";if(mysohu.is_login()){k=c.templates.message_editor;i.html(k);var n=d("textarea.message-textarea",i),e=n.closest(".post-area"),m=d("input.securitycode-text",i),l=d("img.securitycode-img",i),f=d(".rk-message-emotion > .emotion-body",i);f.html(c.get_emote());c.get_vcode(l);i.bind("click"+c.sets.namespace,function(r){var p=d(r.target);if(p.closest(".message-textarea").length){c.set_status.call(e,"active")}else{if(p.closest(".message-post-btn").length){var q=p.closest(".message-post-btn"),s=d.extend(c.params,{content:n.val(),usercode:m.val()});if(d.trim(s.content)==""){c.set_status.call(e,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能为空。",onClose:function(){n.focus()}})}else{if(c.string_length(d.trim(s.content))>c.sets.max_words){c.set_status.call(e,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能超过200个字。",onClose:function(){n.focus()}})}else{if(d.trim(s.usercode)==""){d.inform({icon:"icon-error",delay:1500,easyClose:true,content:"验证码不能为空。",onClose:function(){m.focus()}})}else{d.post(c.sets.message_post_url,s,function(t){if(t&&parseInt(t.status)===1){d.inform({icon:"icon-success",delay:3000,easyClose:true,content:t.statusText,onClose:function(){n.val("");document.location.href=$space_config._url+"guestbook/index.htm"}})}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:t.statusText,onClose:function(){n.focus()}})}},"json")}}}}else{if(p.closest("img.securitycode-img").length||p.closest("a.securitycode-switch").length){c.get_vcode(l)}else{if(p.closest("div.emotion-body > a")){c.put_emote(n,p.closest("div.emotion-body > a"))}}}}});n.bind("focus"+c.sets.namespace,function(p){c.set_status.call(e,"active")}).bind("blur"+c.sets.namespace,function(p){c.set_status.call(e,"normal")});m.bind("focus"+c.sets.namespace,function(p){d(this).addClass("securitycode-text-active")}).bind("blur"+c.sets.namespace,function(p){d(this).removeClass("securitycode-text-active")})}else{k=c.templates.no_login;i.html(k);i.bind("click"+c.sets.namespace,function(q){var p=d(q.target);if(p.closest(".quick-login").length){var r=p.closest(".quick-login");mysohu.login()}})}}},select_all:function(){var f=d(c.sets.manage),e=d("input.remark-destroy-all",f);$checkbox_items=d("div.message-remark input.remark-destroy-item",f),is_checked=false;if(e[0].checked){is_checked=true}else{is_checked=false}$checkbox_items.each(function(g){this.checked=is_checked})},destroy_selected:function(){var f=d(c.sets.manage),h=d("div.message-remark input.remark-destroy-item",f),e=[],g={messageIdStr:""};h.filter(":checked").each(function(j){e.push(d(this).attr("value"))});if(e.length){d.confirm({title:false,defaultBtn:"cancel",content:"是否要删除选中的留言？删除后不可恢复。",onConfirm:function(i){g.messageIdStr=e.join(";");d.getJSON(c.sets.messages_destroy_url,g,function(j){if(j&&parseInt(j.status)===1){location.reload()}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:j.statusText||"",onClose:function(){}})}})},onCancel:function(i){return false}})}else{d.inform({icon:"icon-notice",delay:3000,easyClose:true,content:"您还没有选中任何留言，请选取后再删除！",onClose:function(){}})}},reply_dialog:function(i){if(!mysohu.login()){return}var g=d.dialog({title:"留言 - 回复",btns:["accept","cancel"],defaultBtn:"accept",labAccept:"回复",contentBtnHelp:true,className:"remark-reply-dialog",icon:"icon-notice",content:c.templates.reply_dialog,onLoad:c.on_dialog_load,onBeforeAccept:c.on_dialog_reply,onClose:c.sets.on_close}),j=d(c.sets.reply_textarea,g),e=j.closest(".post-area"),f=d("input.securitycode-text",g),h=d("img.securitycode-img",g);g.adjust().bind("click"+c.sets.namespace,function(l){var k=d(l.target);if(k.closest("img.securitycode-img").length||k.closest("a.securitycode-switch").length){c.get_vcode(h)}else{if(k.closest("div.emotion-body > a")){c.put_emote(j,k.closest("div.emotion-body > a"))}}});j.bind("click"+c.sets.namespace,function(k){c.set_status.call(e,"active")}).bind("focus"+c.sets.namespace,function(k){c.set_status.call(e,"active")}).bind("blur"+c.sets.namespace,function(k){c.set_status.call(e,"normal")}).focus();f.bind("focus"+c.sets.namespace,function(k){d(this).addClass("securitycode-text-active");if(d.trim(d(this).val())=="请输入验证码"){d(this).val("")}}).bind("blur"+c.sets.namespace,function(k){d(this).removeClass("securitycode-text-active")})},manage_reply_dialog:function(h){if(!mysohu.login()){return}var f=d.dialog({title:"留言 - 回复",btns:["accept","cancel"],defaultBtn:"accept",labAccept:"回复",contentBtnHelp:true,className:"remark-reply-dialog",icon:"icon-notice",content:c.templates.manage_reply_dialog,onBeforeAccept:c.on_manage_dialog_reply,onClose:c.sets.on_close}),i=d(c.sets.reply_textarea,f),e=i.closest(".post-area"),g=d(".rk-message-emotion > .emotion-body",f);g.html(c.get_emote());f.adjust().bind("click"+c.sets.namespace,function(k){var j=d(k.target);if(j.closest("div.emotion-body > a")){c.put_emote(i,j.closest("div.emotion-body > a"))}});i.bind("click"+c.sets.namespace,function(j){c.set_status.call(e,"active")}).bind("focus"+c.sets.namespace,function(j){c.set_status.call(e,"active")}).bind("blur"+c.sets.namespace,function(j){c.set_status.call(e,"normal")}).focus()},message_destroy:function(e){var f={messageId:c.params.messageId,xpt:c.params.receiverPassport};d.confirm({title:false,defaultBtn:"cancel",content:"确认要删除留言？",onConfirm:function(g){d.getJSON(c.sets.message_destroy_url,f,function(h){if(h&&parseInt(h.status)===1){location.reload()}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:h.statusText||"",onClose:function(){}})}})},onCancel:function(g){return false}})},reply_destroy:function(){var e={messageId:c.params.messageId,replyId:c.params.replyId,xpt:c.params.receiverPassport};d.confirm({title:false,defaultBtn:"cancel",content:"确认要删除回复？",onConfirm:function(f){d.getJSON(c.sets.reply_destroy_url,e,function(g){if(g&&parseInt(g.status)===1){location.reload()}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:g.statusText||"",onClose:function(){}})}})},onCancel:function(f){return false}})},on_dialog_load:function(){var e=this,f=d(".rk-message-emotion > .emotion-body",e),g=d("img.securitycode-img",e);f.html(c.get_emote());c.get_vcode(g)},get_emote:function(h){var i=b.Data.base.emotes,e=[];for(var f in i){e.push('<a data_ubb="',f,'" data_path="base" href="javascript:;">',i[f],"</a>")}var g=e.join("");if(typeof h!=="undefined"&&!!h.length){h.html(g)}return g},put_emote:function(g,e){var h=g[0];if(e.attr("data_ubb")!=null&&e.attr("data_ubb")!=""){var j="["+e.attr("data_ubb")+"]";h.focus();if(document.selection){var i=document.selection.createRange();document.selection.empty();i.text=j}else{if(h.selectionStart&&typeof h.selectionStart==="number"){var l=startPos=h.selectionStart,f=h.selectionEnd,k=h.scrollTop;h.value=h.value.substring(0,startPos)+j+h.value.substring(f,h.value.length);l+=j.length;h.selectionStart=h.selectionEnd=l}else{h.value+=j}}}},get_vcode:function(e){d.getJSON(c.sets.vcode_url+"?t="+ +new Date,function(f){if(typeof f!="undefined"){c.params.vcode=f.vcode;e[0].src="/a/guestbook/rand.htm?vcode="+f.vcode}});return c.params.vcode},string_length:function(e){return e.replace(/[^\x00-\xff]/g,"**").length},string_sub:function(g,j){var h=/[^\x00-\xff]/g;if(tweet.string_length(g)<=j){return g}var e=Math.floor(j/2);for(var f=e;f<g.length;f++){if(tweet.string_length(g.substr(0,f))>=j){return g.substr(0,f)}}return g},on_dialog_reply:function(){var g=this,i=d(c.sets.reply_textarea,g),f=i.closest(".post-area"),e=d(".securitycode-text",g),h=d.extend(c.params,{content:i.val(),usercode:e.val()});if(d.trim(h.content)==""){c.set_status.call(f,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能为空。",onClose:function(){i.focus()}})}else{if(c.string_length(d.trim(h.content))>c.sets.max_words){c.set_status.call(f,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能超过200个字。",onClose:function(){i.focus()}})}else{if(d.trim(h.usercode)==""||d.trim(h.usercode)=="请输入验证码"){e.addClass("securitycode-text-active");d.inform({icon:"icon-error",delay:1500,easyClose:true,content:"验证码不能为空。",onClose:function(){e.focus()}})}else{d.post(c.sets.reply_url,h,function(j){if(j&&parseInt(j.status)===1){d.inform({icon:"icon-success",delay:3000,easyClose:true,content:j.statusText,onClose:function(){i.val("");location.reload()}});return true}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:j.statusText,onClose:function(){i.focus()}})}},"json")}}}return false},on_manage_dialog_reply:function(){var f=this,h=d(c.sets.reply_textarea,f),e=h.closest(".post-area"),g=d.extend(c.params,{content:h.val()});if(d.trim(g.content)==""){c.set_status.call(e,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能为空。",onClose:function(){h.focus()}})}else{if(c.string_length(d.trim(g.content))>c.sets.max_words){c.set_status.call(e,"error");d.inform({icon:"icon-error",delay:3000,easyClose:true,content:"内容不能超过200个字。",onClose:function(){h.focus()}})}else{d.post(c.sets.manage_reply_url,g,function(i){if(i&&parseInt(i.status)===1){d.inform({icon:"icon-success",delay:3000,easyClose:true,content:i.statusText,onClose:function(){location.reload()}});return true}else{d.inform({icon:"icon-error",delay:3000,easyClose:true,content:i.statusText,onClose:function(){h.focus()}})}},"json")}}return false},set_status:function(e){var f=this;if(f.length){f.removeClass("post-area-active post-area-disabled post-area-error");switch(e){case"active":f.addClass("post-area-active");break;case"disabled":f.addClass("post-area-disabled");break;case"error":f.addClass("post-area-error");break;default:break}}}};mysohu.msgbox=c;d(function(){mysohu.msgbox.init()})});
require("core::util::jQuery","core::stringUtil",function(b,a){b(function(){var c={tblog:b(".ms_num_tblog"),comment:b(".ms_num_comment"),mail:b(".ms_num_mail"),follow:b("#ms_num_follow"),follower:b("#ms_num_follower"),feeds:b("#ms_num_feeds"),visits:b("#person_visits_num"),profile:b("#info_person_profile")};if(c.comment.length||c.tblog.length){b.getJSON("/a/app/discuss/newcount.htm?"+ +new Date,function(d){if(c.comment.length){var f=parseInt(d.newcommentcount);if(f>0&&f<100&&$space_config._currentApp!="discuss"){c.comment.text(f).closest("li").addClass("current")}else{if(f>=100&&$space_config._currentApp!="discuss"){c.comment.text("99+").closest("li").addClass("current")}else{c.comment.text("0").closest("li.current").removeClass("current")}}}if(c.tblog.length){var e=parseInt(d.newreferedcount);if(e>0&&e<100&&$space_config._currentApp!="refer"){c.tblog.text(e).closest("li").addClass("current")}else{if(e>=100&&$space_config._currentApp!="refer"){c.tblog.text("99+").closest("li").addClass("current")}else{c.tblog.text("0").closest("li.current").removeClass("current")}}}})}if(c.mail.length){b.getJSON("http://register.mail.sohu.com/servlet/getUnreadMailCountServlet?callback=?",function(e){var d=parseInt(e);if(d>0&&d<100){c.mail.text(d).closest("li").addClass("current")}else{if(d>=100){c.mail.text("99+").closest("li").addClass("current")}else{c.mail.text("0").closest("li.current").removeClass("current")}}})}if(c.feeds.length){b.getJSON("/a/newsfeed/newsnum?"+ +new Date,{pp:$space_config._xpt},function(e){if(parseInt(e.status)==0){var d=parseInt(e.newsnum);if(d>0){c.feeds.text(d)}else{c.feeds.text("0")}}})}if(c.visits.length){b.getJSON("http://stat.i.sohu.com/guest/count/count.do?callback=?",{xpt:$space_config._xpt,type:0},function(e){if(b.isPlainObject(e)){var d=parseInt(e.count);if(d>0){c.visits.text(d)}else{c.visits.text("0")}}})}if(c.profile.length){b.getJSON("/a/profile/simpleprofile.json",{xpt:$space_config._xpt},function(e){if(parseInt(e.code)==0){var f={auth:e.data.auth||false,authInfo:e.data.authInfo||"",school:e.data.school||"",day:e.data.birthdayDay||"",month:e.data.birthdayMonth||"",year:e.data.birthdayYear||"",sex:(function(g){if(g==0){return"男"}else{if(g==1){return"女"}else{return""}}})(e.data.sex),company:e.data.workcompany||"",province:e.data.provinceName||"",city:e.data.cityName||"",county:e.data.countyName||""},d=[];if(!f.auth){if(f.sex!=""){d.push(f.sex+" ")}if(f.month!=""&&f.day!=""){d.push("生于");if(f.year!=""){d.push(f.year+"年")}d.push(f.month+"月"+f.day+"日 ")}if(f.province!=""||f.city!=""||f.county!=""){d.push("住在 "+f.province+" "+f.city+" "+f.county+" ")}d.push("<br />");if(f.company!=""){d.push("在"+a.gbSubstr(f.company,15)+"工作 ")}if(f.school!=""){d.push("曾就读于"+f.school+" ")}}else{d.push(f.authInfo+"<br />")}c.profile.html(d.join(""))}})}b("body").append('<div id="float_yjfk"><a href="http://feedback.q.sohu.com/" target="_blank"><span>意见反馈</span></a></div>')})});(function(d){function e(k){try{d("#medal_level").html(k.data.level);d("#medal_score").html(k.data.score);var j=k.data.medal,l=d("#medal_images"),i=[],g=l.closest("li.rtbar-medal").find("span > a").attr("href");d.each(j,function(m,n){if(m>2){return}i.push('<i class="icon-medal-x16"><a href="'+g+'"><img alt="" src="'+n.img+'" /></a></i>')});if(j.length){if(j.length>3){i.push('&nbsp;<a href="'+g+'">&gt;&gt;</a>')}l.html(i.join(""))}}catch(h){}}function a(){if(!d.cookie("ppinf")){d.ppDialog({appId:"1019",regRedirectUrl:location.href,title:"想要查看更多精彩内容，马上登录吧！",onLogin:function(g){location.reload()}});return false}return true}var c={init:function(h){var g=this;this.$box=d("#tweet_editor_box .btn-attention-wraper");if(!this.$box.length){return}if(h==-1){this.$box.html('<span class="btn-attention" style="display:none"><a href="javascript:void(0);">跟随</a></span>')}else{if(h==0||h==3){this.$box.html('<span class="btn-attention-already" style="display:none"><em>已跟随</em><a href="javascript:void(0);">取消</a></span>');this.insertInviteBtn()}else{if(h==2){this.$box.html('<span class="btn-attention-each-other" style="display:none"><em>互相跟随</em><a href="javascript:void(0);">取消</a></span>')}}}this.$box.children().fadeIn("slow");this.$box.click(function(j){var i=d(j.target);if(i.closest(".btn-attention-already a,.btn-attention-each-other a").length){j.preventDefault();g.unfollow()}else{if(i.closest(".btn-attention a,.btn-attention-add a").length){j.preventDefault();g.follow()}}});d("#tweet_editor_box a.whisper-link").bind("click",function(i){i.preventDefault();g.whisper()})},follow:function(){var i=this,h=$space_config._xpt,g=window._sucNick||"";if(!a()){return}d.get("/a/app/friend/friend/add.do",{xpt:h,from_type:"blog_person_show"},function(j){if(j.code==1||j.code==-2){if(j.data.friendType==1){i.$box.html('<span class="btn-attention-each-other"><em>互相跟随</em><a href="javascript:void(0);">取消</a></span>');i.removeInviteBtn()}else{i.$box.html('<span class="btn-attention-already"><em>已跟随</em><a href="javascript:void(0);">取消</a></span>');i.insertInviteBtn()}if(d.iCard&&d.iCard.SetGroupsDialog){d.iCard.SetGroupsDialog.show({friendid:j.data.friendId,nick:g,friendType:j.data.friendType,xpt:h})}}else{d.alert(j.msg)}},"json")},unfollow:function(){var h=this,g=$space_config._xpt;if(!a()){return}d.post("/a/app/friend/friend/delete.do",{xpt:g},function(i){if(i.code==1){if(i.data.friendType==1){h.$box.html('<span class="btn-attention"><a href="javascript:void(0);">跟随</a></span>')}else{h.$box.html('<span class="btn-attention"><a href="javascript:void(0);">跟随</a></span>')}h.removeInviteBtn()}else{d.alert(i.msg)}},"json")},insertInviteBtn:function(){var g=this,h=d('<a href="javascript:void(0);" class="invite-follow-link">求跟随</a>');d("#tweet_editor_box div.view-leavemsg").prepend(h);h.bind("click",function(){g.invite()})},removeInviteBtn:function(){d("#tweet_editor_box a.invite-follow-link").remove()},invite:function(){var i=this,h=$space_config._xpt,g=window._sucNick||"TA";if(d.iCard.InviteFollowDialog){d.iCard.InviteFollowDialog.show({xpt:h,nick:g,fromType:"person_show"})}},whisper:function(){var i=this,h=$space_config._xpt,g=window._sucNick||"";if(g){require("app::whisper",function(j){j({nick:g})})}}};var b={callback:function(g){d("#ms_num_follow").html(g.data.friendCount);d("#ms_num_follower").html(g.data.fansCount);c.init(g.data.isAtted)},nologin:function(){},islogin:function(g){}};function f(j,h){var k=j,i=parseInt(k.html());if(typeof h=="undefined"||(i==0&&h<0)){return i}var g=i+parseInt(h);k.html(g);return g}d.iProfile.setAttNum=function(){var g=arguments[0];return f(d("#att_num"),g)};d.iProfile.setFansNum=function(){var g=arguments[0];return f(d("#fans_num"),g)};d(document).ready(function(){d.iProfile.getMedal(function(g){e(g)});d.iProfile.getFriends(b)})})(jQuery);
