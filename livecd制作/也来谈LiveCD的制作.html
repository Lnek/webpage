<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>也来谈LiveCD的制作 - 系统安装 -  中国Linux公社论坛  </title>
<meta name="keywords" content="" />
<meta content="Discuz!,News, news, New, new, Technology, technology, Headlines, headlines, Nuke, nuke, PHP-Nuke, phpnuke, php-nuke, Geek, geek, Geeks, geeks, Hacker, hacker, Hackers, hackers, Linux, linux, Windows, windows, Software, software, Download, download, Downloads, downloads, Free, FREE, free, Community, community, MP3, mp3, Forum, forum, Forums, forums, Bulletin, bulletin, Board, board, Boards, boards, PHP, php, Survey, survey, Kernel, kernel, Comment, comment, Comments, comments,npcomet,Portal, portal, ODP, odp, Open, open, Open Source, OpenSource, Opensource, opensource, open source, Free Software, FreeSoftware, Freesoftware, free software, GNU, gnu, GPL, gpl, License, license, Unix, UNIX, *nix, unix, MySQL, mysql, SQL, sql, Database, DataBase, Blogs, blogs, Blog, blog, database, Mandrake, mandrake, Red Hat, RedHat, red hat, Slackware, slackware, SUSE, SuSE, suse, Debian, debian, Gnome, GNOME, gnome, Kde, KDE, kde, Enlightenment, enlightenment, Interactive, interactive, Programming, programming, Extreme, extreme, Game, game, Games, games, Web Site, web site, Weblog, WebLog, weblog, Guru, GURU, guru, Oracle, oracle, db2, DB2, odbc, ODBC, plugin, plugins, Plugin, Plugins," name="keywords">
<meta name="description" content=" 中国Linux公社论坛 经过几天的研究,写了几页豆腐,如今也来这里酸一酸,因为贴图不太方便,所以只在这里摘录前面一截,感兴趣的朋友可以下载附件中的pdf文档观看,谢谢.

另外,在这里下P ... - Discuz! Board" />
<meta name="MSSmartTagsPreventParsing" content="True" />
<meta http-equiv="MSThemeCompatible" content="Yes" />
<link rel="archives" title="中国Linux公社论坛" href="http://forum.linuxfans.org/archiver/" />
	<link rel="stylesheet" type="text/css" href="forumdata/cache/style_7_viewthread.css" />
	<link rel="stylesheet" type="text/css" href="forumdata/cache/style_7_common.css" />
<script type="text/javascript">
	var discuz_uid = 0;var IMGDIR = 'images/summeryiya';var attackevasive = '0';var gid = 0;var STYLEID = '7';
	gid = parseInt('76');var fid = parseInt('2');var tid = parseInt('97099');
</script>
<script src="include/javascript/common.js" type="text/javascript"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4754209-3']);
  _gaq.push(['_setDomainName', '.linuxfans.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body onkeydown="if(event.keyCode==27) return false;">
	<div id="append_parent"></div><div id="ajaxwaitid"></div>
    <div class="wrap">
		<div id="header">
<!-- 			<h2><a href="index.php" title="中国Linux公社论坛"><img src="images/summeryiya/logo.png" alt="中国Linux公社论坛" border="0" /></a></h2>
			<div id="ad_headerbanner"></div> -->
	<table width='100%' border='0' cellpadding='0' cellspacing='0' bgcolor='#FFFFFF' >
		<tr>
          <td width='185' rowspan='2' valign='top' class='toppannel' ><a href="http://www.linuxfans.org"><img src='images/summeryiya/logo.png' width='185' height='95'></a></td>
          <td width="5%" height="95" align="right" valign="middle" background="images/summeryiya/panel.png" class="mainnote"></td>
          <td width="18%" height="95" align="center" valign="center" background="images/summeryiya/panel.png"><a href="http://www.linuxfans.org" ><img src="images/summeryiya/home.jpg" width="70" height="70" border="0" alt=""></a></td>
          <td width="18%" height="95" align="center" valign="center" background="images/summeryiya/panel.png"><a href="/index.php" ><img src="images/summeryiya/forum.jpg" width="70" height="70" border="0" alt=""></a></td>
          <td width="18%" height="95" align="center" valign="center" background="images/summeryiya/panel.png"><a href="http://www.linuxfans.org/cms/m.php?name=software" ><img src="images/summeryiya/download.jpg" width="70" height="70" border="0" alt=""></a></td>
          <td width="18%" height="95" align="center" valign="center" background="images/summeryiya/panel.png"><a href="http://www.linuxfans.org/cms/?action-link" ><img src="images/summeryiya/links.jpg" width="70" height="70" border="0" alt=""></a></td>
          <td width="18%" height="95" align="center" valign="center" background="images/summeryiya/panel.png"><a href="http://www.linuxfans.org/cms/?action-spaces" ><img src="images/summeryiya/space.jpg" width="70" height="70" border="0" alt=""></a></td>
          <td width="5%" height="95" align="right" valign="middle" background="images/summeryiya/panel.png" class="mainnote"></td>
		</tr>
	</table>
		</div>
		<div id="menu">
        <div id="m-l"></div><div id="m-r"></div>
			<span class="avataonline">
							<a href="register.php">注册</a>
				<a href="logging.php?action=login">登录</a>
						</span>
					<ul>
                        						<li><a href="search.php?srchfid=2">搜索</a></li>																						<li><a href="faq.php">帮助</a></li>
			</ul>
		</div><div id="content"><div id="m-b"></div>
<style type="text/css">
.defaultpost { height: auto !important; height:120px; min-height:120px !important; }
.signatures { height: expression(signature(this)); max-height: 180px; }
</style>

<script src="include/javascript/viewthread.js" type="text/javascript"></script>
<script type="text/javascript">zoomstatus = parseInt(1);</script>

<div id="foruminfo">
	<div id="nav">
		<div class="userinfolist">
			<p><a href="index.php">中国Linux公社论坛</a> &raquo; <a href="forum-2-479.html">系统安装</a> &raquo; 也来谈LiveCD的制作</p>
		</div>
	</div>
	<div id="headsearch">
			</div>
</div>

<div id="ad_text"></div>
<div class="pages_btns">
	<div class="threadflow"><a href="redirect.php?fid=2&amp;tid=97099&amp;goto=nextoldset"> &lsaquo;&lsaquo; 上一主题</a> | <a href="redirect.php?fid=2&amp;tid=97099&amp;goto=nextnewset">下一主题 &rsaquo;&rsaquo;</a></div>
				<span class="postbtn" id="newspecial" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu(this.id)"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479"><img src="images/summeryiya/newtopic.gif" border="0" alt="发新话题" title="发新话题" /></a></span>
		<span class="replybtn"><a href="post.php?action=reply&amp;fid=2&amp;tid=97099&amp;extra=page%3D479"><img src="images/summeryiya/reply.gif" border="0" alt="" /></a></span></div>

	<ul class="popupmenu_popup newspecialmenu" id="newspecial_menu" style="display: none">
		<li><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479">发新话题</a></li>
		<li class="poll"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=1">发布投票</a></li>		<li class="trade"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=2">发布商品</a></li>		<li class="reward"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=3">发布悬赏</a></li>		<li class="activity"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=4">发布活动</a></li>		<li class="debate"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=5">发布辩论</a></li>		<li class="video"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479&amp;special=6">发布视频</a></li>			</ul>

<form method="post" name="modactions">
	<input type="hidden" name="formhash" value="91a0bc45" />
	<div class="mainbox viewthread">
		<span class="headactions">
				<a href="viewthread.php?action=printable&amp;tid=97099" target="_blank" class="notabs">打印</a>
				</span>
		<h1>也来谈LiveCD的制作		</h1>
							<table id="pid4246470" summary="pid4246470" cellspacing="0" cellpadding="0">
			<tr>
				<td class="postauthor">
					 					<cite>											<a href="space.php?uid=20387" target="_blank" id="userinfo4246470" class="dropmenu" onmouseover="showMenu(this.id)">wq1977</a></cite>
																			<div class="avatar"><img src="images/avatars/gallery/blank.gif" width="1" height="1" border="0" alt="" /></div>												<p><em>注册会员</em></p>
						<p><img src="images/summeryiya/star_level2.gif" alt="Rank: 2" /></p>
																		
						<ul>
												<li class="pm"><a id="ajax_20387_1" class="" onclick="ajaxmenu(event, this.id, 9000000, null, 0)" target="_blank" href="pm.php?action=send&amp;uid=20387">发短消息</a>
						<li class="buddy"><a href="my.php?item=buddylist&amp;newbuddyid=20387&amp;buddysubmit=yes" target="_blank" id="ajax_buddy_0" onclick="ajaxmenu(event, this.id, 3000, 0)">加为好友</a></li>

																					<li class="offline">当前离线
														</li>
						
						</ul>
									</td>
				<td class="postcontent" >
					<div class="postinfo">
						<strong title="复制帖子链接到剪贴板" id="postnum4246470" onclick="setcopy('http://forum.linuxfans.org/viewthread.php?tid=97099&amp;page=1#pid4246470', '帖子链接已经复制到剪贴板')">1<sup>#</sup></strong>
													<em onclick="$('postmessage_4246470').className='t_bigfont'">大</em>							<em onclick="$('postmessage_4246470').className='t_msgfont'">中</em>
							<em onclick="$('postmessage_4246470').className='t_smallfont'">小</em>												发表于 2004-12-10 17:10&nbsp;																					<a href="viewthread.php?tid=97099&amp;page=1&amp;authorid=20387" rel="nofollow">只看该作者</a>
																		</div>
					<div id="ad_thread2_0"></div>					<div class="postmessage defaultpost">
																		<div id="ad_thread3_0"></div><div id="ad_thread4_0"></div>
													<h2>也来谈LiveCD的制作</h2>
						
						
																											<div id="postmessage_4246470" class="t_msgfont">经过几天的研究,写了几页豆腐,如今也来这里酸一酸,因为贴图不太方便,所以只在这里摘录前面一截,感兴趣的朋友可以下载附件中的pdf文档观看,谢谢.<br />
<br />
另外,在这里下PDF版本:<br />
<br />
http://mypretty.nease.net/livecd/LiveCD_Study.pdf<br />
<br />
看的会舒服点,呵呵.<br />
<br />
前言—为什么要写这篇文档.<br />
整整三天的时间,为了搞清楚linux的启动机制,回过头来看看,一切似乎非常的简单. 可是当这样的事情要由一个人独立的没有任何基础的去研究的时候,就会走很多的弯路.经过这充实的三天,我知道了一些原先不知道或者不清楚的事,我对linux系统的认识又清晰的许多.<br />
现在,假定你还不知道我已经知道的那些,你不必象我一样,通过Google和反复的修改脚本,反复的制作光盘,反复的重启来搞清楚这些,你只需要读我写的这篇文档. 按照文中所说的步骤(这些步骤非常的清晰,所使用的东西也随手可得),你便可以很快的回答以下这些问题:<br />
关于用Grub制作启动光盘的知识.<br />
关于制作Initrd的知识.<br />
制作一个什么都不能做的LiveCD.<br />
其它的一些我有提到但是忘记了写在这里的知识.<br />
如果你喜欢Linux,如果你觉得这篇文档能让你知道了一些你以前不知道并且想知道的,或者仅仅是因为个人感情的原因对作者投以支持的目光,作者便会觉得如坐春风了,这就是写这篇文档的目的.<br />
当然,作者是从一无所知到现在的略有所知,所以肯定会有理解偏颇甚至错误的地方,在大方那里难免被贻笑,也请大家鸡蛋不要仍的太多,但是绝对欢迎批评指正,免的误导更多的人,小弟的罪过就大了.<br />
好了,废话说太多了,赶紧启动你的FedoraCore3吧.<br />
制作Grub启动光盘<br />
LiveCD首先是一个可以自启动的光盘,通常现有的LivdCD使用的都是ISOLinux1 的技术,其实使用Grub也可以制作可以启动的光盘.以下片断参考自Grub的Info文档:<br />
$ mkdir iso&nbsp;&nbsp;# 新建一个iso目录,这将作为LiveCD的镜像目录.<br />
$ mkdir -p iso/boot/grub #在iso目录中创建boot/grub子目录,这其实和你的FedoraCore3的/boot结构是一样的.<br />
$ cp /usr/share/grub/i386-redhat/stage2_eltorito iso/boot/grub #i386-redhat这个目录名字可能不同.2<br />
$ mkisofs -R -b boot/grub/stage2_eltorito -no-emul-boot \<br />
&nbsp; &nbsp;&nbsp;&nbsp;-boot-load-size 4 -boot-info-table -o teach.iso iso&nbsp;&nbsp;#制作以iso目录为镜像目录的启动光盘.3<br />
现在生成了teach.iso文件,打开Vmware,新建一个linux虚拟机,将光盘指定成新生成的teach.iso,如下图所示:<br />
启动这个VirtualMachine, 在系统自检的时候摁F2进入Bios,修改成从光盘启动<br />
,如下图所示<br />
摁F10存盘退出后重新启动, 启动结果如下图所示:<br />
系统已经启动到grub提示符的状态, 这时候我们可以输入后续grub命令来启动系统.<br />
<br />
Ok,让我们重新回到FedoraCore3, 拷贝我们需要的文件到iso,以便我们的LiveCD可以走的更远:<br />
$cp /boot/vmlinuz-2.6.9-1.667 iso/boot/&nbsp; &nbsp;#拷贝系统内核到iso的boot目录<br />
$ mkisofs -R -b boot/grub/stage2_eltorito -no-emul-boot \<br />
&nbsp; &nbsp;&nbsp;&nbsp;-boot-load-size 4 -boot-info-table -o teach.iso iso&nbsp;&nbsp;#重新生成我们的iso文件<br />
<br />
现在重新启动我们的VirtualMachine,在Grub提示符下依次敲入如下命令:<br />
grub&amp;gt; root (cd)<br />
grub&amp;gt; kernel /boot/vmlinuz-2.6.9-1.667<br />
grub&amp;gt; boot<br />
如下图所示:<br />
没错,我们的liveCD又往前走了很多,可以看到kernel被启动,很多的提示信息,不过在kernel启动的最后,出现了错误:<br />
这是因为kernel启动到最后,找不到init程序,也找不到root文件系统导致.接下来,我们要制作 initrd.img这个虚拟镜像文件了.<br />
<br />
在制作initrd.img之前,我们不妨先在iso/boot/grub目录下创建一个grub.conf(按照grub的手册,这个文件好像应该叫做menu.lst)文件,以避免我们每次重新启动liveCD的时候都要输出一堆grub命令. 参考/boot/grub/grub.conf.<br />
grub.conf 的文件内容可以如下所示(As your wish):<br />
#grub.conf start *********************************<br />
default 0<br />
timeout 1<br />
hiddenmenu<br />
title LiLiHome<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;root (cd)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz-2.6.9-1.667 quiet<br />
#grub.conf end *********************************<br />
这个文件告诉grub,启动的时候默认启动第一个title, 等待时间是1秒钟,不要显示选择菜单,第一个Title的名字是LiLiHome(^_^,as your wish),依次执行的命令是 root ...和kernel ...,其中quiet参数告诉kernel启动的时候不要显示那一堆无所谓的信息,我只是个初级的fans,对这些输出并不关心.<br />
重新制作我们的iso文件,不会再出现grub提示符,而是直接启动指定的kernel了.<br />
<br />
我们以后还会回来修改grub.conf的,现在,让我们先来做initrd.img吧.<br />
<br />
制作Initrd.img<br />
为什么要制作initrd,img? 我们的这个initrd.img要完成什么功能?<br />
Initrd可以让kernel分成两个步骤启动,第一个步骤加载一个比较小的kernel,其中可能不包括在编译kernel的时候编译成module的那些模块,第二个步骤中可以加载这些模块并且完成一些最小系统的初始化.Linux的文档是这么说的.不过我们的initrd只是帮我们完成一个小任务,找到光盘.<br />
以下的这些操作中的一部分需要你拥有root权限,所以,现在我们最好su一把,让我们自己变成root.<br />
$ su #输入密码,变成root(牛气的root)<br />
# mkdir initrd #创建一个initrd的目录,我们会把initrd.img挂载到这个目录<br />
# dd if=/dev/zero of=initrd.img bs=400k count=10 #创建一个4M的initrd.img<br />
# /sbin/mke2fs -F -m0 initrd.img&nbsp; &nbsp;# 将initrd.img初始化成ex2文件系统<br />
# mount -o loop initrd.img&nbsp;&nbsp;initrd&nbsp;&nbsp;# 将initrd.img挂载到initrd上<br />
# mkdir initrd/dev&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #在initrd目录(也就是initrd.img文件)中创建/dev目录<br />
# mknod initrd/dev/console c 5 1&nbsp; &nbsp; # 增加一个控制台节点1. 事实上,需要.<br />
<br />
initrd作为kenerl的出口,可以是一个普通的ex2文件系统的压缩文件(并非一定如此),kernel会寻找initrd中的linuxrc文件(这个文件一定要是可以执行的,可以是shell脚本),然后执行它.<br />
<br />
下面的工作,我们会增加initrd.img的核心部分,不过不要着急,在这之前让我们先修改我们的grub.conf2文件,增加需要的内容,按照linux文件,如果要使用initrd.img,grub.conf应该这样修改:<br />
grub.conf 的文件内容可以如下所示(As your wish):<br />
#grub.conf start *********************************<br />
default 0<br />
timeout 1<br />
hiddenmenu<br />
title LiLiHome<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;root (cd)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz quiet root=/dev/ram0 rw&nbsp;&nbsp;init=/linuxrc<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;initrd /boot/initrd.img<br />
#grub.conf end *********************************<br />
这其中除了quiet参数你可以随便以外,别的最好不要修改,尽管有些参数不是必须的.<br />
好了,我们来往initrd.img里面增加内容吧:<br />
# mkdir initrd/bin&nbsp; &nbsp;# 增加bin目录<br />
# cp /bin/bash initrd/bin/ #要运行脚本,当然需要bash(任何一个shell包括busybox3都可以)<br />
# ldd /bin/bash&nbsp;&nbsp;#看看我们的bash需要哪些动态链接库<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;libtermcap.so.2 =&amp;gt; /lib/libtermcap.so.2 (0x005b1000)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;libdl.so.2 =&amp;gt; /lib/libdl.so.2 (0x004c0000)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;libc.so.6 =&amp;gt; /lib/tls/libc.so.6 (0x00372000)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;/lib/ld-linux.so.2 (0x00359000)<br />
# mkdir initrd/lib #看来我们需要lib目录了<br />
# ls -l /lib/libtermcap.so.2&nbsp;&nbsp;#看看我们需要的第一个动态链接库是不是个链接<br />
&nbsp; &nbsp; &nbsp; &nbsp; lrwxrwxrwx&nbsp;&nbsp;1 root root 24 12?&nbsp;&nbsp;9 14:10 /lib/libtermcap.so.2 -&amp;gt; /lib/libtermcap.so.2.0.8<br />
# cp /lib/libtermcap.so.2.0.8 initrd/lib/&nbsp;&nbsp;#果然是个链接,要拷贝真正的文件而不是一个符号哦.<br />
# cd initrd/lib<br />
# ln -s libtermcap.so.2.0.8 libtermcap.so.2&nbsp;&nbsp;#当然符号还是要建的.<br />
......&nbsp; &nbsp;# 依次操作后面的几个库吧.<br />
<br />
好,假定你读到这里的时候,所有需要的库已经拷贝到lib目录了,我们需要检验一下新的bash能不能够运行.<br />
# /usr/sbin/chroot initrd bash&nbsp; &nbsp;#试着执行一下拷贝过去的bash,注意要chroot<br />
bash-3.00#&nbsp; &nbsp; #出现了提示符,说明需要的库我们都拷贝全了.<br />
bash-3.00# exit&nbsp;&nbsp;#退回到原来的提示符下<br />
# cd initrd/bin&nbsp; &nbsp;# 去initrd的bin目录<br />
# ln -s bash sh&nbsp; &nbsp;# 建立 sh符号链接到bash.<br />
好了,我们来测试一下我们的initrd.img. 退回到initrd的上一级目录.<br />
# vi initrd/linuxrc&nbsp;&nbsp;#我们来建立一个linuxrc<br />
&nbsp; &nbsp; &nbsp; &nbsp; #!/bin/sh<br />
&nbsp; &nbsp; &nbsp; &nbsp; echo 'Hellow World!'<br />
&nbsp; &nbsp; &nbsp; &nbsp; sh<br />
# chmod a+x initrd/linuxrc&nbsp;&nbsp;#给予linuxrc可执行属性<br />
# cp /bin/echo initrd/bin/&nbsp; &nbsp;&nbsp;&nbsp;#既然我们的linuxrc中用到了echo,那么拷贝吧<br />
# ldd /bin/echo&nbsp; &nbsp; &nbsp; &nbsp; #看看echo需要的库我们都有吗?<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;libc.so.6 =&amp;gt; /lib/tls/libc.so.6 (0x00372000)<br />
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;/lib/ld-linux.so.2 (0x00359000)<br />
...... #如果有我们没有的,拷贝之.<br />
<br />
好了现在我们的initrd已经不是一个空空的文件了.我们试一下它可不可以执行.<br />
先确定你的grub.conf已经修改.然后<br />
# umount initrd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #确保<br />
# cp initrd.img iso/boot/<br />
# gzip -9 iso/boot/initrd.img<br />
# mv iso/boot/initrd.img.gz iso/boot/initrd.img<br />
# mkisofs -R -b boot/grub/stage2_eltorito -no-emul-boot \<br />
&nbsp; &nbsp;&nbsp;&nbsp;-boot-load-size 4 -boot-info-table -o teach.iso iso&nbsp;&nbsp;#重新生成我们的iso文件<br />
<br />
好了,重新启动虚拟机,看看现在的情况怎么样:<br />
看看现在的initrd.img的目录结构:<br />
<br />
<br />
现在我们可以知道,initrd.img也是一个小的linux系统,我们可以把我们想要拷贝的程序及其库拷贝进去,然后使用根目录下的linuxrc来调度就可以了.<br />
<br />
接下来,我们要完善linuxrc脚本,通过使用udev挂载我们的iso文件. 因为毕竟ramdisk1有大小限制,默认的kernel启动支持的ramdisk的大小是4M, 而无论我们要做的东西是什么,4M都是远远不够的.<br />
此处申明,下文讲述的脚本文件修改自gentoo的安装文件,希望不会有人因此找我的麻烦.<br />
<br />
为了寻找cdrom,我们要做的核心,是通过udev2这个模块,将系统中所有存在的光驱映射到/dev/cdroms/目录下,分别命名为cdrom0,cdrom1...,然后我们将依次挂载这些光驱设备,直到找到我们自己的liveCD:<br />
mount -t sysfs none /sys&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
cd /sys<br />
kill_devfsd<br />
echo 'Checking your hardware, please wait...'<br />
runUdev<br />
mv /dev/* /newroot/dev<br />
findcdmount /newroot/dev/cdroms/*<br />
关于udev的细节请读者自行参阅相关的资料,我也只能大概的说,udev通过/sys目录找到kernel发现的硬件以及相关的信息,将其转换成特定字段的值,然后通过udev的配置文件指定的宏,在指定的位置生成(或者删掉)指向这个硬件的节点文件.所以,如上面引用的脚本所示,使用udev之前要先挂载sys目录,删除老的devfsd,对每个sys中的设备尝试匹配他自己的配置脚本, 然后使用mv命令将发现的放置与/dev的设备移动到新的dev目录,然后依次尝试挂载光驱.<br />
你可以通过man udev或者info udev获得更多关于udev的知识.<br />
在成功挂载上LiveCD以后,就可以建立由根目录到liveCD的链接,这时候我们大概会重建整个文件系统,新建一个newroot目录,然后将liveCD中的bin,sbin,lib,boot,usr,opt目录符号链接到当前的newroot目录,将liveCD中的etc root home var这些目录拷贝到newroot目录(这些目录可能会进行写操作),然后更改根目录,根据initrd.txt卸载initrd的相关目录,参考:<br />
ln -s mnt/livecd/bin bin<br />
ln -s mnt/livecd/sbin sbin<br />
ln -s mnt/livecd/lib lib<br />
ln -s mnt/livecd/lib64 lib64<br />
ln -s mnt/livecd/boot boot<br />
ln -s mnt/livecd/usr usr<br />
ln -s mnt/livecd/opt opt<br />
mkdir initrd proc<br />
chmod 1777 tmp<br />
(cd /newroot/mnt/livecd; cp -a etc root home var /newroot)<br />
pivot_root . tmp/.initrd<br />
exec chroot . /bin/sh &amp;lt;&amp;lt;- EOF<br />
 &nbsp; &nbsp; &nbsp; &nbsp; umount /tmp/.initrd || echo &quot;*: Failed to unmount the initrd!&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; /sbin/blockdev --flushbufs /dev/ram0 &amp;gt;/dev/null 2&amp;gt;&amp;1<br />
 &nbsp; &nbsp; &nbsp; &nbsp; exec /sbin/init ${REAL_INIT}<br />
EOF<br />
好了关于initrd就说这么多了.希望对你有些帮助.接下来大概看看LiveCD的主目录.</div>

															<div class="notice" style="width: 500px">附件: <em>您所在的用户组无法下载或查看附件</em></div>
							
							
							
							
															<div id="post_rate_div_4246470"></div>
																</div>
									<div class="signatures" style="maxHeightIE: 180px;">
						欢迎访问我的博客http://www.wesleywang.cn .^v^					</div>
							</td>
		</tr>
		<tr>
			<td class="postauthor">
								<div class="popupmenu_popup userinfopanel" id="userinfo4246470_menu" style="display: none;">
										<dl><dt>UID</dt><dd>20387&nbsp;</dd><dt>帖子</dt><dd>116&nbsp;</dd><dt>精华</dt><dd><a href="digest.php?authorid=20387">0</a>&nbsp;</dd><dt>积分</dt><dd>284&nbsp;</dd><dt>阅读权限</dt><dd>20&nbsp;</dd><dt>来自</dt><dd>China&nbsp;</dd><dt>在线时间</dt><dd>3 小时&nbsp;</dd><dt>注册时间</dt><dd>2003-3-8&nbsp;</dd><dt>最后登录</dt><dd>2007-9-3&nbsp;</dd></dl>
											<p><a href="http://www.wesleywang.cn" target="_blank">查看个人网站</a></p>
										<p><a href="space.php?uid=20387" target="_blank">查看详细资料</a></p>
														</div>
							</td>
			<td class="postcontent">
				<div class="postactions">
										<p>
																																																						<strong onclick="scroll(0,0)" title="顶部">TOP</strong>
					</p>
					<div id="ad_thread1_0"></div>				</div>
			</td>
		</tr>
		</table>
		</div><div id="ad_interthread">		</div>
	<div class="mainbox viewthread">
			<table id="pid4246494" summary="pid4246494" cellspacing="0" cellpadding="0">
			<tr>
				<td class="postauthor">
					 <a name="lastpost"></a>					<cite>											<a href="space.php?uid=9836" target="_blank" id="userinfo4246494" class="dropmenu" onmouseover="showMenu(this.id)">bigcat00</a></cite>
																			<div class="avatar"><img src="images/avatars/2092612411424a94658de26.gif" width="83" height="92" border="0" alt="" /></div>												<p><em>银牌会员</em></p>
						<p><img src="images/summeryiya/star_level3.gif" alt="Rank: 6" /><img src="images/summeryiya/star_level2.gif" alt="Rank: 6" /></p>
																		
						<ul>
												<li class="pm"><a id="ajax_9836_1" class="" onclick="ajaxmenu(event, this.id, 9000000, null, 0)" target="_blank" href="pm.php?action=send&amp;uid=9836">发短消息</a>
						<li class="buddy"><a href="my.php?item=buddylist&amp;newbuddyid=9836&amp;buddysubmit=yes" target="_blank" id="ajax_buddy_1" onclick="ajaxmenu(event, this.id, 3000, 0)">加为好友</a></li>

																					<li class="offline">当前离线
														</li>
						
						</ul>
									</td>
				<td class="postcontent" >
					<div class="postinfo">
						<strong title="复制帖子链接到剪贴板" id="postnum4246494" onclick="setcopy('http://forum.linuxfans.org/viewthread.php?tid=97099&amp;page=1#pid4246494', '帖子链接已经复制到剪贴板')">2<sup>#</sup></strong>
													<em onclick="$('postmessage_4246494').className='t_bigfont'">大</em>							<em onclick="$('postmessage_4246494').className='t_msgfont'">中</em>
							<em onclick="$('postmessage_4246494').className='t_smallfont'">小</em>												发表于 2004-12-10 17:21&nbsp;																					<a href="viewthread.php?tid=97099&amp;page=1&amp;authorid=9836" rel="nofollow">只看该作者</a>
																		</div>
					<div id="ad_thread2_1"></div>					<div class="postmessage defaultpost">
																		<div id="ad_thread3_1"></div><div id="ad_thread4_1"></div>
						
						
																											<div id="postmessage_4246494" class="t_msgfont">没啦？？ <img src="images/smilies/default/icon_eek.gif" smilieid="64" border="0" alt="" /></div>

							
							
							
							
															<div id="post_rate_div_4246494"></div>
																</div>
									<div class="signatures" style="maxHeightIE: 180px;">
						对那些重洋媚外的汉奸们说句老话吧：
你们大概不知道，在你们崇拜的美国，前总统约翰-肯尼迪的名言：不要问国家给了你什么，想想自己为国家做了什么；
你们大概不知道，在你们崇拜的美国， 著名的西点军校给每个士兵的座右铭：无论对错，这是我的祖国。					</div>
							</td>
		</tr>
		<tr>
			<td class="postauthor">
								<div class="popupmenu_popup userinfopanel" id="userinfo4246494_menu" style="display: none;">
										<dl><dt>UID</dt><dd>9836&nbsp;</dd><dt>帖子</dt><dd>1732&nbsp;</dd><dt>精华</dt><dd><a href="digest.php?authorid=9836">0</a>&nbsp;</dd><dt>积分</dt><dd>3620&nbsp;</dd><dt>阅读权限</dt><dd>70&nbsp;</dd><dt>来自</dt><dd>China&nbsp;</dd><dt>在线时间</dt><dd>11 小时&nbsp;</dd><dt>注册时间</dt><dd>2002-12-27&nbsp;</dd><dt>最后登录</dt><dd>2011-8-15&nbsp;</dd></dl>
										<p><a href="space.php?uid=9836" target="_blank">查看详细资料</a></p>
														</div>
							</td>
			<td class="postcontent">
				<div class="postactions">
										<p>
																																																						<strong onclick="scroll(0,0)" title="顶部">TOP</strong>
					</p>
					<div id="ad_thread1_1"></div>				</div>
			</td>
		</tr>
		</table>
		</div>
</form>



<div class="pages_btns">
	<div class="threadflow"><a href="redirect.php?fid=2&amp;tid=97099&amp;goto=nextoldset"> &lsaquo;&lsaquo; 上一主题</a> | <a href="redirect.php?fid=2&amp;tid=97099&amp;goto=nextnewset">下一主题 &rsaquo;&rsaquo;</a></div>
				<span class="postbtn" id="newspecialtmp" onmouseover="$('newspecial').id = 'newspecialtmp';this.id = 'newspecial';showMenu(this.id)"><a href="post.php?action=newthread&amp;fid=2&amp;extra=page%3D479"><img src="images/summeryiya/newtopic.gif" border="0" alt="发新话题" title="发新话题" /></a></span>
		<span class="replybtn"><a href="post.php?action=reply&amp;fid=2&amp;tid=97099&amp;extra=page%3D479"><img src="images/summeryiya/reply.gif" border="0" alt="" /></a></span></div>

	<div id="footfilter" class="box">
			<span id="forumjump" onmouseover="showMenu(this.id, false, 2)" class="dropmenu">版块跳转</span>&nbsp;
		<ul class="popupmenu_popup" id="forumjump_menu" style="display: none">
		<dl><dt><a href="index.php?gid=77">社区公告专栏：最新通知和公告</a></dt><dd><ul><li><a href="forum-14-1.html">公告区</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=76">基础技术支持专栏:</a></dt><dd><ul><li class="current"><a href="forum-2-1.html">系统安装</a></li><li><a href="forum-21-1.html">硬件配置</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=83">Magic Linux专版:</a></dt><dd><ul><li><a href="forum-17-1.html">Magic Linux技术支持区</a></li><li><a href="forum-46-1.html">Magic Linux开发培训版</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=79">一般应用技巧专栏:</a></dt><dd><ul><li><a href="forum-10-1.html">中文化与桌面美化</a></li><li><a href="forum-23-1.html">桌面使用小技巧</a></li><li><a href="forum-24-1.html">命令行使用小技巧与SHELL编程</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=78">应用解决方案专栏:</a></dt><dd><ul><li><a href="forum-6-1.html">网络工具</a></li><li><a href="forum-25-1.html">办公软件</a></li><li><a href="forum-26-1.html">多媒体应用</a></li><li><a href="forum-27-1.html">游戏乐园</a></li><li><a href="forum-28-1.html">服务器与网络安全</a></li><li><a href="forum-60-1.html">Linux资源共享区</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=80">高级技术学习专栏:</a></dt><dd><ul><li><a href="forum-37-1.html">Debian/LFS/Gentoo专题版</a></li><li><a href="forum-22-1.html">Linux高质量字体研究</a></li><li><a href="forum-53-1.html">easyright计算机研究所</a></li><li><a href="forum-40-1.html">Linux认证考试专题版</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=82">社区开源项目专栏</a></dt><dd><ul><li><a href="forum-29-1.html">应用编程技术与项目孵化</a></li><li><a href="forum-51-1.html">网站开发技术与项目孵化</a></li><li><a href="forum-44-1.html">参与国际开源项目</a></li><li><a href="forum-43-1.html">翻译汉化</a></li><li><a href="forum-59-1.html">中文GNOME用户交流区</a></li><li><a href="forum-58-1.html">Skyeye项目专栏</a></li><li><a href="forum-66-1.html">lumit项目专栏</a></li><li><a href="forum-63-1.html">eva项目专栏</a></li><li><a href="forum-64-1.html">fanx及slax中文专栏</a></li><li><a href="forum-65-1.html">连连看for Linux项目专栏</a></li><li><a href="forum-68-1.html">BitStorm项目专栏</a></li><li><a href="forum-74-1.html">RT-Thread实时操作系统</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=84">Linux内核研读区：公社内核阅读小组</a></dt><dd><ul><li><a href="forum-48-1.html">内核源代码阅读交流</a></li><li><a href="forum-30-1.html">内核安装和升级</a></li><li><a href="forum-50-1.html">嵌入式开发</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=75">社区文化活动专栏：我们是一家人！</a></dt><dd><ul><li><a href="forum-45-1.html">校园行动联盟</a></li><li><a href="forum-42-1.html">Linux与公社文化杂谈</a></li><li><a href="forum-61-1.html">求职与招聘</a></li></ul></dd></dl><dl><dt><a href="index.php?gid=81">请进公社总部:</a></dt><dd><ul><li><a href="forum-20-1.html">公社接待中心</a></li></ul></dd></dl>		</ul>
			</div>

<script type="text/javascript">
var maxpage = 1;
if(maxpage > 1) {
	document.onkeyup = function(e){
		e = e ? e : window.event;
		var tagname = is_ie ? e.srcElement.tagName : e.target.tagName;
		if(tagname == 'INPUT' || tagname == 'TEXTAREA') return;
		actualCode = e.keyCode ? e.keyCode : e.charCode;
					}
}
</script></div>
<style type="text/css">
<!--
.STYLE1 {color: #000000}
-->
</style>	<ul class="popupmenu_popup headermenu_popup" id="memcp_menu" style="display: none">
		<li><a href="memcp.php">控制面板首页</a></li>
		<li><a href="memcp.php?action=profile">编辑个人资料</a></li>
					<li><a href="memcp.php?action=credits">积分交易</a></li>
				<li><a href="memcp.php?action=creditslog">积分记录</a></li>
		<li><a href="memcp.php?action=usergroups">公众用户组</a></li>
							<li><a href="memcp.php">访问推广</a></li>
			</ul>
	<ul class="popupmenu_popup headermenu_popup" id="stats_menu" style="display: none">
		<li><a href="stats.php">基本概况</a></li>
				<li><a href="stats.php?type=forumsrank">版块排行</a></li><li><a href="stats.php?type=threadsrank">主题排行</a></li><li><a href="stats.php?type=postsrank">发帖排行</a></li><li><a href="stats.php?type=creditsrank">积分排行</a></li>
		<li><a href="stats.php?type=trade">交易排行</a></li>
		<li><a href="stats.php?type=onlinetime">在线时间</a></li>		<li><a href="stats.php?type=team">管理团队</a></li>
		<li><a href="stats.php?type=modworks">管理统计</a></li>	</ul>
	<div id="ad_footerbanner1"></div><div id="ad_footerbanner2"></div><div id="ad_footerbanner3"></div>

<div id="f"><div id="f-l"></div><div id="f-r"></div></div></div></div>
<div id="footer">
	<div class="wrap">
		<div id="footlinks">
		  <p>
当前时区 GMT+8, 现在时间是 2012-4-13 09:52 <a href="http://www.miibeian.gov.cn/" target="_blank"><font color="#597501">鄂ICP备08006242号</font></a></p>
			<p>
				<a href="member.php?action=clearcookies&amp;formhash=91a0bc45"><font color="#597501">清除 Cookies</font></a>
				- <a href="mailto:webmaster@linuxfans.org"><font color="#597501">联系我们</font></a> - <a href="http://forum.linuxfans.org" target="_blank"><font color="#597501">中国Linux公社</font></a>
				 - <a href="archiver/" target="_blank"><font color="#597501">Archiver</font></a>				 - <a href="wap/" target="_blank"><font color="#597501">WAP</font></a>				- <span class="scrolltop" onclick="window.scrollTo(0,0);">TOP</span>
							</p>
		</div>

		<a href="http://www.discuz.net" target="_blank" title="Powered by Discuz!"><img src="images/summeryiya/discuz_icon.gif" border="0" alt="Discuz!" /></a>
		<p id="copyright">
			Powered by <strong><a href="http://www.discuz.net" target="_blank">Discuz!</a></strong> 			© 2001-2008 <a href="http://www.comsenz.com" target="_blank"><font color="#597501">Comsenz Inc.</font></a>
		</p>			<p id="debuginfo">Processed in 0.460459 second(s), 5 queries.</p>
			</div>
</div>
</body>
</html>