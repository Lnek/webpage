<!DOCTYPE html>
<html lang='en' xmlns:wb='http://open.weibo.com/wb'>
<head>

<meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
<title>
u010702509/docker_buildimage | 
CODE
</title>
<link href="//csdnimg.cn/public/favicon-b.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
<link href="/assets/base-99a9ec3d91fff252c51f935755f1d4dd.css" media="screen" rel="stylesheet" type="text/css" />
<link href="//csdnimg.cn/public/common/toolbar/css/index.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/code-d24e94dfc2d44f4c06361906b2c41620.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/feature_groups/document-05d42b558da6892983bfc706fa620e02.css" media="screen" rel="stylesheet" type="text/css" />


<script src="/assets/application-3f89aed0b84bec46aae599080a52fa37.js" type="text/javascript"></script>
<script src='https://code.csdn.net/open/api/js/wb.js'></script>


<meta content="authenticity_token" name="csrf-param" />
<meta content="KXNLXUSxmycVDTf9ELrkHy689L9iI22FxrF0N/PYEyI=" name="csrf-token" />
</head>

<body>
<script fixed='true' id='toolbar-tpl-scriptId' prod='code' skin='black' src='//csdnimg.cn/public/common/toolbar/js/html.js' type='text/javascript'></script>
<header class='csdn-nav navbar navbar-static-top' role='banner'>
<div class='container'>
<nav class='navbar-collapse pull-left' role='navigation'>
<ul class='navbar-nav'>
<li class=''>
<a href='/' title='CODE首页'>首页</a>
</li>
<li class=''>
<a href="/news">开源资讯</a>
</li>
<li class=''>
<a href="/explore/projects">发现</a>
</li>
<li class=''>
<a href="/rewards">悬赏大厅</a>
</li>
<li class=''>
<a href='/group'>讨论组</a>
</li>
<li class=''>
<a href='/os_camp'>开源夏令营</a>
</li>
</ul>
</nav>
<div class='search pull-left'>
<div class='input-prepend'>
<div class='btn-group'>
<div class='btn btn-small dropdown-toggle' data-toggle='dropdown'>项目内搜索</div>
<div class='btn btn-small dropdown-toggle' data-toggle='dropdown'>
<span class='caret'></span>
</div>
<ul class='dropdown-menu'>
<li>
<a name='bbb'>项目内搜索</a>
<a name='aaa'>全站搜索</a>
</li>
</ul>
</div>
<form action='/search_project' id='search_form' method='get'>
<input name='pid' placeholder='' type='hidden' value='35742'>
<input accesskey='s' class='span2 header_2_input' id='sprependedDropdownButton' name='search' placeholder='' size='30' tabindex='1' type='text'>
</form>
</div>
</div>
<div class='pull-right'>
<a href="/dashboard/index" class="btn" style="border-right: 0px;">我的CODE</a>
</div>
</div>
</header>
<script>
  //<![CDATA[
    $('.dropdown-menu > li > a[name=aaa]').click(function(){
           $('#search_form').attr('action', '/search');
    
          });
    $('.dropdown-menu > li > a[name=bbb]').click(function(){
           $('#search_form').attr('action', '/search_project');
    
          });
    function btnclick(str){
      var url = (str == "1" ? "/search" : "/search_project");
      $('#search_form').attr('action', url).submit();
    }
  //]]>
</script>
<!--[if lt IE 9]>
<!-- <div class="no-ie8 alert alert-block"> -->
<!-- <h4>请注意：</h4> -->
<!-- <p>Code不支持ie8及以下版本； -->
<!-- 建议您升级到最新的ie浏览器，或者谷歌Chrome、Firefox、Safari等； -->
<!-- 如果您使用的是IE 9+，请关闭“兼容性视图”。</p> -->
<!-- </div> -->
<![endif]-->

<!-- = render "sdev_toolshared/user_diskspace_over_limit" -->

<div class='container main_container'>
<div class='document_header'>
<span class='downfold'>
<i class='icon-double-angle-down tip' data-original-title='展开工具栏' data-placement='bottom' data-toggle='tooltip'></i>
</span>
<div class='project_top'>
<span class="svg" style="background-image: url(/assets/ico_doc_public.svg); "></span>
<div id='project_opts_bar'>
<div class='pull-right btn-box'>
<a href="/single_sign_on/login" class="btn btn-small" role="button"><i class="svg" style="background-image: url(/assets/ico_fork.svg); "></i>
<span class='text'>
派生
</span>
</a><a href="/u010702509/docker_buildimage/forks" class="social-count">0</a>
<a class='btn btn-small' data-method='post' href='/single_sign_on/login' id='watch' rel='nofollow' title='关注'>
<i class="svg" style="background-image: url(/assets/ico_follow.svg); "></i>
<span class='text'>关注</span>
</a>
<a class='social-count' href='/u010702509/docker_buildimage/watchers' id='watchs_count'>
0
</a>
<a class='btn btn-small' data-method='post' href='/single_sign_on/login' id='star' rel='nofollow' title='称赞'>
<i class="svg" style="background-image: url(/assets/ico_praise.svg); "></i>
<span class='text'>称赞</span>
</a>
<a class='social-count' href='/u010702509/docker_buildimage/stars' id='stars_count'>
0
</a>
<div class='btn' data-toggle='modal' href='#correctionModal' id='correctionBtn' role='button'>举报</div>
<div aria-hidden='true' aria-labelledby='myModalLabel' class='modal open_knowledgebase_modal hide fade' id='correctionModal' role='dialog' tabindex='-1'>
<form accept-charset="UTF-8" action="/u010702509/docker_buildimage/doc_tip_off" class="new_doc_tip_off" data-remote="true" id="new_doc_tip_off" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="KXNLXUSxmycVDTf9ELrkHy689L9iI22FxrF0N/PYEyI=" /></div>
<div class='modal-header'>
<button aria-hidden='true' class='close' data-dismiss='modal' type='button'>×</button>
<h3 class='myModalLabel'>我要举报</h3>
</div>
<div class='modal-body'>
<div class='alert fade in'>
<div class='close' data-dismiss='alert'>&times;</div>
CODE开源知识库收录开源相关的社区、人物、项目、文档等信息，信息内容来自网络收集和网友贡献，如果您在阅读过程中发现信息存在侵权、广告、非法内容等情况，点击举报，我们将会作出相应处置。谢谢~！
</div>
<div id='error_show'></div>
<div class='form-horizontal'>
<div class='control-group important'>
<label class='control-label' for=''>举报原因：</label>
<div class='controls'>
<textarea class="span12" cols="40" id="doc_tip_off_reason" name="doc_tip_off[reason]" placeholder="输入要举报的原因" rows="20">
</textarea>
</div>
</div>
</div>
</div>
<div class='modal-footer'>
<button aria-hidden='true' class='btn' data-dismiss='modal' id='close_doc_tip_off'>关闭</button>
<input class="btn btn-success" id="sub" name="commit" type="submit" value="提交" />
</div>
</form>
</div>
<script>
  //<![CDATA[
    $('#correctionModal').appendTo('body');
  //]]>
</script>

</div>

</div>
<span class='project_title'>
<strong>
<a href="/u010702509/docker_buildimage">创建镜像</a>
</strong>
</span>
<p>
<a href="/u010702509">周小璐</a>/<a href="/u010702509/docker_buildimage">Docker_buildimage</a>
</p>
<div>
<span>
<a href="/explore/documents?tag_name=%E6%95%99%E7%A8%8B" class="label">教程</a>
</span>
<span>
<a href="/explore/documents?tag_name=docker" class="label">docker</a>
</span>
<span>
<a href="/explore/documents?tag_name=%E9%95%9C%E5%83%8F" class="label">镜像</a>
</span>
</div>
</div>

<div aria-hidden='true' aria-labelledby='myModalLabel' class='modal hide fade' id='for_show_dialog' role='dialog' tabindex='-1'></div>
<ul class='project_nav'>
<li class='selected'>
<a href="/u010702509/docker_buildimage">文档</a>
</li>
<li class=''>
<a href="/u010702509/docker_buildimage/commits_list">历史</a>
</li>
<li class=''>
<a href="/u010702509/docker_buildimage/merge_requests">合并请求
<span class='count'>
0
</span>
</a></li>
<li class=''>
<a href="/u010702509/docker_buildimage/tree/master">文件列表</a>
</li>
<li class='upfold'>
<a href="#" class="tip" data-original-title="收起工具栏" data-placement="right" data-toggle="tooltip" title=""><i class='icon-double-angle-up'></i>
</a></li>
</ul>
</div>
<script>
  //<![CDATA[
    // for _project_opts_bar
    $(document).on("click", "#watch",
      function(){
        if("false" == "true"){
          $("#for_show_dialog").html("<div class=\'modal-header\'>\n<button aria-hidden class=\'close\' data-dismiss=\'modal\' type=\'button\'>\n&times;\n<\/button>\n<h3>关注项目<\/h3>\n<\/div>\n<div class=\'modal-body\'>\n<p align=\'center\'>\n<\/p>\n<\/div>\n");
        }else{
          $.post("/u010702509/docker_buildimage/watch")
           .success(function(data){
              if(data != "false"){
                $("#project_opts_bar").html(data);
              }else{
                //alert("关注失败！");
              }
    
           });
         }
      }
    );
    
    $(document).on("click", "#unwatch",
      function(){
        $.post("/u010702509/docker_buildimage/unwatch")
         .success(function(data){
            if(data != "false"){
              $("#project_opts_bar").html(data);
            }else{
              //alert("取消关注失败！");
            }
         })
      }
    );
    
    $(document).on("click", "#star",
      function(){
        $.post("/u010702509/docker_buildimage/star")
         .success(function(data){
           if(data != "false"){
             $("#project_opts_bar").html(data);
           }else{
             //alert("赞失败！");
           }
         })
      }
    );
    
    
    $(document).on("click", "#unstar",
      function(){
        $.post("/u010702509/docker_buildimage/unstar")
         .success(function(data){
           if(data != "false"){
             $("#project_opts_bar").html(data);
           }else{
             //alert("取消赞失败！");
           }
         })
      }
    );
  //]]>
</script>


<div class='clearfix'>
<div class='document_left'></div>
<div class='edit_box document_content'>
<input id="old_file_path" name="old_file_path" type="hidden" value="Docker_buildimage.md" />
<div class='document_file_name'>Docker_buildimage.md</div>
<link href="/assets/function/gollum/template-2703482317aae3165f7957c58ecbe5da.css" media="screen" rel="stylesheet" type="text/css" />
<div class='document_file_content markdown-body'>
<h1 id="创建镜像-dockerfile-参考"><a href="#%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F-dockerfile-%E5%8F%82%E8%80%83"><i class="icon-link"></i></a>创建镜像 (Dockerfile 参考)</h1>
<p><strong>Docker可以作为创建者</strong>读取Dockerfile文件中的指令，自动执行步骤并且创建一个新的镜像。执行docker build命令，它会按照文档执行并最终创建一个镜像。</p>

<p>目录</p>

<ul>
<li><p>创建镜像</p>

<ul>
<li>1.使用</li>
<li>2.格式</li>
<li>3.指令

<ul>
<li>3.1 FROM</li>
<li>3.2 MAINTAINER</li>
<li>3.3 RUN</li>
<li>3.4 CMD</li>
<li>3.5 EXPOSE</li>
<li> 3.6 ENV</li>
<li>3.7 ADD</li>
<li>3.8 ENTRYPOINT</li>
<li>3.9 VOLUME</li>
<li>3.10 USER</li>
<li>3.11 WORKDIR</li>
</ul></li>
<li>4.Dockerfile举例</li>
</ul></li>
</ul>
<h2 id="1-usage"><a href="#1-usage"><i class="icon-link"></i></a>1.Usage</h2>
<p>从镜像资源中创建一个镜像，在你的跟目录下创建一个描述文件叫做Dockerfile，这个将描述你创建镜像的步骤.</p>

<p>docker build要用路径的资源库来作为参数(像.)</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">build</span> <span class="p">.</span>
</pre></div>
<p>先从存储源查找要本地创建的环境，build会在docker后台运行的，而不是用命令行界面，所以所有的本地环境都会被后台进程多调度。当环境被发送到后台进程时，Docker命令行会报告&quot;Uploading context&quot;</p>

<p>你可以指定存储卡和标记，来保存构建成功的镜像:</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">shykes</span><span class="o">/</span><span class="n">myapp</span> <span class="p">.</span>
</pre></div>
<p>Docker进程会按照步骤步骤一步操作，必要时会输出必要的结果, 创建完成之后会输出你的镜像id,Docker会自动清楚你发送的环境。</p>

<p>当你构建成功之后，你就要考虑把镜像推送到库中。</p>
<h2 id="2-format"><a href="#2-format"><i class="icon-link"></i></a>2. Format</h2>
<p>Dockerfile格式很简单的:</p>
<div class="highlight"><pre><span class="cp"># Comment</span>
<span class="err">指令</span> <span class="err">参数</span>
</pre></div>
<p>指令是不区分大小写的, 然而约定是大写的以便区分其他的参数</p>

<p>Docker会读测试Dockerfile中的指令，第一条命令必须是&#39;FROM&#39;,来指定你正在构建的基本镜像</p>

<p>docker以#开头为一个注释，一个#在的地方会被认为是一个注释，例如</p>
<div class="highlight"><pre><span class="cp"># Comment</span>
<span class="n">RUN</span> <span class="n">echo</span> <span class="err">&#39;</span><span class="n">we</span> <span class="n">are</span> <span class="n">running</span> <span class="n">some</span> <span class="err">#</span> <span class="n">of</span> <span class="n">cool</span> <span class="n">things</span><span class="err">&#39;</span>
</pre></div><h2 id="3-指令"><a href="#3-%E6%8C%87%E4%BB%A4"><i class="icon-link"></i></a>3.指令</h2>
<p>可以使用Dockerfile中的指令来构建镜像</p>
<h3 id="3-1-from"><a href="#3-1-from"><i class="icon-link"></i></a>3.1 FROM</h3><div class="highlight"><pre><span class="nb">FROM</span> <span class="o">&lt;</span><span class="nb">image</span><span class="o">&gt;</span>
</pre></div>
<p>或者</p>
<div class="highlight"><pre><span class="nb">FROM</span> <span class="o">&lt;</span><span class="nb">image</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="kt">tag</span><span class="o">&gt;</span>
</pre></div>
<p>FROM指令来构建基础镜像。因此，一个有效的Dockerfile必须是用FROM做第一个指令。镜像可以是任何有效的镜像，它会很容易从公共存储卡中获取。</p>

<p>FROM在Dockerfile必须是第一个没有意见性（RUN之类的）指令</p>

<p>FROM命令可以在Dockerfile中出现多次创建多个镜像，在用新的FROM之前简单的记录下镜像的id</p>

<p>如果FROM指令没有tag，就假设tag是latest.如果tag不存在，就会发挥一个错误信息。</p>
<h3 id="3-2-maintainer"><a href="#3-2-maintainer"><i class="icon-link"></i></a>3.2 MAINTAINER</h3><div class="highlight"><pre><span class="nx">MAINTAINER</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</pre></div>
<p>这个指令是允许你设置镜像生成的作者信息</p>
<h3 id="3-3-run"><a href="#3-3-run"><i class="icon-link"></i></a>3.3 RUN</h3><div class="highlight"><pre><span class="nb">RUN</span> <span class="o">&lt;</span><span class="nb">command</span><span class="o">&gt;</span>
</pre></div>
<p>RUN指令将会在当前镜像执行任何命令并提交结果，提交的镜像的结果将用户Dockerfile的下一步操作</p>

<p>分层RUN指令和生成提交是docker的核心概念，提交是廉价的从任何点创建一个镜像历史，就行代码控制一样。</p>

<blockquote>
<p>已知问题</p>
</blockquote>

<ul>
<li><p>问题783 关于文件权限的问题，可能会发生在使用AUFS文件系统。你要注意她视图使用rm文件，例如，描述一个解决方案</p></li>
<li><p>问题2424 本地将不会自动被设置</p></li>
</ul>
<h3 id="3-4-cmd"><a href="#3-4-cmd"><i class="icon-link"></i></a>3.4 CMD</h3>
<p>CMD有三种形式：</p>

<ul>
<li><p>CMD &quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;</p></li>
<li><p>CMD <a href="%E4%BD%9C%E4%B8%BAENTRYPOINT%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0">&quot;param1&quot;,&quot;param2&quot;</a></p></li>
<li><p>CMD command param1 param2 (像shell一样)</p></li>
</ul>

<p>Dockerfile只能有一个CMD，如果你写了多个CMD，最后那个CMD会生效。</p>

<p>CMD主要给一个容器执行提供默认参数，这些默认值可以是一个热可执行的，或者他们可以省略可执行文件，在这种情况下，你必须指定一个ENTRYPOINT你交号</p>

<p>当shell中使用执行格式，CMD命令会设置镜像运行的指令，这个功能相当于docker 提交 -run 将会执行在/bin/sh -c</p>
<div class="highlight"><pre><span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">CMD</span> <span class="n">echo</span> <span class="s">&quot;This is a test.&quot;</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span>
</pre></div>
<p>如果你希望你的容器每次都执行相同的可执行文件，那么你应该考虑使用ENTRYPOINT结合CMD，可以查看3.8 ENTRYPOINT.</p>

<blockquote>
<p>注意</p>

<p>不要混淆运行CMD。RUN CMD，RUN必须提交结果，CMD在构建镜像是并不执行，但在镜像构建成功后会执行</p>
</blockquote>
<h3 id="3-5-expose"><a href="#3-5-expose"><i class="icon-link"></i></a>3.5 EXPOSE</h3><div class="highlight"><pre><span class="nb">EXPOSE</span> <span class="o">&lt;</span><span class="nb">port</span><span class="o">&gt;</span> <span class="err">[</span><span class="o">&lt;</span><span class="nb">port</span><span class="o">&gt;</span><span class="nx">...</span><span class="cp">]</span>
</pre></div>
<p>EXPOSE指令会对连接着开放端口使用，这个功能相当于运行docker提交 -run &#39;{&quot;PortSpecs&quot;: [&quot;&quot;, &quot;&quot;]}&#39;,相当于docker run -p</p>
<h3 id="3-6-env"><a href="#3-6-env"><i class="icon-link"></i></a>3.6 ENV</h3><div class="highlight"><pre><span class="nb">ENV</span> <span class="o">&lt;</span><span class="nb">key</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nb">value</span><span class="o">&gt;</span>
</pre></div>
<p>ENV指令设置环境变量key对应值value,这个值将会被传递给后边使用的指令，这个功能相当于在命令前面加了=</p>

<blockquote>
<p>注意：</p>

<p>环境变量会持续到一个镜像的生成</p>
</blockquote>
<h3 id="3-7-add"><a href="#3-7-add"><i class="icon-link"></i></a>3.7 ADD</h3><div class="highlight"><pre><span class="nb">ADD</span> <span class="o">&lt;</span><span class="nb">src</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">dest</span><span class="o">&gt;</span>
</pre></div>
<p>ADD指令是将复制新文件，并将它们添加到容器的文件系统。</p>

<p>必须是一个文件或者目录相对于源目录（也就是构建的环境）或者一个远程文件的URL。</p>

<p>是容器将被复制的目录地址。</p>

<p>所有新创建的文件和目录都是0755权限，uid和gid 0。</p>

<blockquote>
<p>注意</p>

<p>如果你有stdin标准输入流创建(docker build - &lt; somefile),没有建立环境，所以Dockerfile只能包含一个基于URL添加语句。</p>

<p>注意</p>

<p>如果你的URL文件需要身份认证，你将需要使用运行wget，运行curl或者其他工具添加到容器是不支持身份验证的</p>
</blockquote>

<p>副本必须遵循一下规则：</p>

<p>路径必须是声称到环境中，你不能添加../something/someting,因为docker build第一步会发送环境目录（和子目录）到dicker后台进程</p>

<p>如果是URl，并将不已斜线结尾，然后将从URl中下载并复制到</p>

<p>如果是URL，并且以斜线结尾，则文件名是从URL推断然后文件会下载到/,例如，ADD <a href="http://example.com/foobar/%E5%B0%86%E4%BC%9A%E5%88%9B%E5%BB%BAfile/foobar%EF%BC%8C%E8%BF%99%E4%B8%AAURL%E5%BF%85%E9%A1%BB%E6%98%AF%E4%B8%80%E4%B8%AA%E5%B9%B3%E5%B8%B8%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%90%88%E9%80%82%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%8C%E4%B8%80%E4%B8%8B%E6%83%85%E5%86%B5%E4%B8%8B%E6%98%AF%E6%97%A0%E6%B3%95%E5%B7%A5%E4%BD%9C%E7%9A%84(http://example.com)" rel="nofollow" target="_blank">http://example.com/foobar/将会创建file/foobar，这个URL必须是一个平常的路径，使用合适的文件名，一下情况下是无法工作的(http://example.com)</a></p>

<p>如果是目录，将整个目录复制，包含文件的原始数据</p>

<p>如果是压缩文件个事(譬如,gzip、bzip2或者xz)，那么它会解压到目录，从URL资源不解压</p>

<p>如果一个目录被复制或者解压，他们都会执行相同的行为tar -x 作为结果的集合</p>

<ul>
<li>无论目标路径是否存在</li>
<li>源的tree内容是否存在</li>
</ul>

<p>产生冲突的时候会按照2来解决</p>

<p>如果是其它文件类型，她被单独复制连同它的数据。这种情况下，如果以斜线结尾，它就会被认为是一个目录，并将src中的写入/base（）.</p>

<p>如果不已斜线结尾，它会被认为是一个常规文件，并且的文件会被写入到文件中。</p>

<p>如果不存在，创建连同所有缺失的目录路径</p>
<h3 id="3-8-entrypoint"><a href="#3-8-entrypoint"><i class="icon-link"></i></a>3.8 ENTRYPOINT</h3>
<p>ENTRYPOINT有两种形式：</p>

<ul>
<li><p>ENTRYPOINT <a href="%E5%83%8F%20exec,%20%E9%A6%96%E9%80%89">&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;</a></p></li>
<li><p>ENTRYPOINT command param1 param2 (作为shell执行)</p></li>
</ul>

<p>Dockerfile中只能有一个ENTRYPOINT，如果你有多个ENTRYPOINT，则Dockerfile中只能最后一个会被执行</p>

<p>一个ENTRYPOINT会帮你配置容器作为容器的一个可执行文件，也就是说当你指定一个ENTRYPOINT，那么整个容器中都会运行这个可执行文件</p>

<p>ENTRYPOINT指令将会被当作一个不会被覆盖的命令参数传给运行的docker,不像CMD，这就是允许参数传递给入口，即docker run  -d 将会通过 -d参数来作为执行入口</p>

<p>你可以指定参数在 ENTRYPOINT JSON数组（如exec执行多个），或者通过使用一个CMD命令语句，这个入口的参数不会被docker run所重写，但是通过指定CMD的参数来重写docker run 参数</p>

<p>像CMD，你可以指定一个ENTRYPOINT的字符串，它将会在/bin/sh -c中执行</p>
<div class="highlight"><pre><span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">ENTRYPOINT</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span>
</pre></div>
<p>例如，Dockerfile的镜像经常会将stdin作为输入(&quot;-&quot;)或者但列出行数(&quot;-l&quot;),如果你像让这个可选，默认情况下你可以使用CMD</p>
<div class="highlight"><pre><span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">]</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s">&quot;/usr/bin/wc&quot;</span><span class="p">]</span>
</pre></div><h3 id="3-9-volume"><a href="#3-9-volume"><i class="icon-link"></i></a>3.9 VOLUME</h3>
<p>VOLUME [&quot;/data&quot;]<br>
VOLUME指令会创建一个挂载点根据指定的名字和标记挂在外部的主机或者其他容器，更多实例可以查看docker安装说明，共享文档和目录</p>
<h3 id="3-10-user"><a href="#3-10-user"><i class="icon-link"></i></a>3.10 USER</h3><div class="highlight"><pre><span class="n">USER</span> <span class="n">daemon</span>
</pre></div>
<p>USER质量设置镜像运行时的用户名或者Uid</p>
<h3 id="3-11-workdir"><a href="#3-11-workdir"><i class="icon-link"></i></a>3.11 WORKDIR</h3><div class="highlight"><pre><span class="n">WORKDIR</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">workdir</span>
</pre></div>
<p>WORKDIR命令执行工作目录的来执行CMD</p>
<h2 id="4-dockerfile-例子"><a href="#4-dockerfile-%E4%BE%8B%E5%AD%90"><i class="icon-link"></i></a>4. Dockerfile 例子</h2><div class="highlight"><pre>  <span class="err">#</span> <span class="n">Nginx</span>
  <span class="err">#</span>
  <span class="err">#</span> <span class="n">VERSION</span>               <span class="mf">0.0.1</span>

  <span class="n">FROM</span>      <span class="n">ubuntu</span>
  <span class="n">MAINTAINER</span> <span class="n">Guillaume</span> <span class="n">J</span><span class="p">.</span> <span class="n">Charmes</span> <span class="o">&lt;</span><span class="n">guillaume</span><span class="err">@</span><span class="n">dotcloud</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>

  <span class="err">#</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">the</span> <span class="n">package</span> <span class="n">repository</span> <span class="n">is</span> <span class="n">up</span> <span class="n">to</span> <span class="n">date</span>
  <span class="n">RUN</span> <span class="n">echo</span> <span class="s">&quot;deb http://archive.ubuntu.com/ubuntu precise main universe&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="p">.</span><span class="n">list</span>
  <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>

  <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">inotify</span><span class="o">-</span><span class="n">tools</span> <span class="n">nginx</span> <span class="n">apache2</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span>
  <span class="err">#</span> <span class="n">Firefox</span> <span class="n">over</span> <span class="n">VNC</span>
  <span class="err">#</span>
  <span class="err">#</span> <span class="n">VERSION</span>               <span class="mf">0.3</span>

  <span class="n">FROM</span> <span class="n">ubuntu</span>
  <span class="err">#</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">the</span> <span class="n">package</span> <span class="n">repository</span> <span class="n">is</span> <span class="n">up</span> <span class="n">to</span> <span class="n">date</span>
  <span class="n">RUN</span> <span class="n">echo</span> <span class="s">&quot;deb http://archive.ubuntu.com/ubuntu precise main universe&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="p">.</span><span class="n">list</span>
  <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>

  <span class="err">#</span> <span class="n">Install</span> <span class="n">vnc</span><span class="p">,</span> <span class="n">xvfb</span> <span class="n">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="err">&#39;</span><span class="n">fake</span><span class="err">&#39;</span> <span class="n">display</span> <span class="n">and</span> <span class="n">firefox</span>
  <span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">x11vnc</span> <span class="n">xvfb</span> <span class="n">firefox</span>
  <span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="p">.</span><span class="n">vnc</span>
  <span class="err">#</span> <span class="n">Setup</span> <span class="n">a</span> <span class="n">password</span>
  <span class="n">RUN</span> <span class="n">x11vnc</span> <span class="o">-</span><span class="n">storepasswd</span> <span class="mi">1234</span> <span class="o">~/</span><span class="p">.</span><span class="n">vnc</span><span class="o">/</span><span class="n">passwd</span>
  <span class="err">#</span> <span class="n">Autostart</span> <span class="n">firefox</span> <span class="p">(</span><span class="n">might</span> <span class="n">not</span> <span class="n">be</span> <span class="n">the</span> <span class="n">best</span> <span class="n">way</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">does</span> <span class="n">the</span> <span class="n">trick</span><span class="p">)</span>
  <span class="n">RUN</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">echo</span> <span class="s">&quot;firefox&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="p">.</span><span class="n">bashrc</span><span class="err">&#39;</span>

  <span class="n">EXPOSE</span> <span class="mi">5900</span>
  <span class="n">CMD</span>    <span class="p">[</span><span class="s">&quot;x11vnc&quot;</span><span class="p">,</span> <span class="s">&quot;-forever&quot;</span><span class="p">,</span> <span class="s">&quot;-usepw&quot;</span><span class="p">,</span> <span class="s">&quot;-create&quot;</span><span class="p">]</span>
  <span class="err">#</span> <span class="n">Multiple</span> <span class="n">images</span> <span class="n">example</span>
  <span class="err">#</span>
  <span class="err">#</span> <span class="n">VERSION</span>               <span class="mf">0.1</span>

  <span class="n">FROM</span> <span class="n">ubuntu</span>
  <span class="n">RUN</span> <span class="n">echo</span> <span class="n">foo</span> <span class="o">&gt;</span> <span class="n">bar</span>
  <span class="err">#</span> <span class="n">Will</span> <span class="n">output</span> <span class="n">something</span> <span class="n">like</span> <span class="o">===&gt;</span> <span class="mi">907</span><span class="n">ad6c2736f</span>

  <span class="n">FROM</span> <span class="n">ubuntu</span>
  <span class="n">RUN</span> <span class="n">echo</span> <span class="n">moo</span> <span class="o">&gt;</span> <span class="n">oink</span>
  <span class="err">#</span> <span class="n">Will</span> <span class="n">output</span> <span class="n">something</span> <span class="n">like</span> <span class="o">===&gt;</span> <span class="mi">695</span><span class="n">d7793cbe4</span>

  <span class="err">#</span> <span class="n">You</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">now</span> <span class="n">have</span> <span class="n">two</span> <span class="n">images</span><span class="p">,</span> <span class="mi">907</span><span class="n">ad6c2736f</span> <span class="n">with</span> <span class="o">/</span><span class="n">bar</span><span class="p">,</span> <span class="n">and</span> <span class="mi">695</span><span class="n">d7793cbe4</span> <span class="n">with</span>
  <span class="err">#</span> <span class="o">/</span><span class="n">oink</span><span class="p">.</span>
</pre></div>
</div>


</div>
<div class='modal hide fade' id='deletePage'>
<div class='modal-header'>
<button aria-hidden class='close' data-dismiss='modal'>x</button>
<h3 class='myModalLabel'>
删除警告
</h3>
</div>
<div class='modal-body'>
<div class='alert alert-error'>
确定删除 Docker_buildimage.md 这个页面吗？
</div>
<p align='center' aria-hidden data-dismiss='modal'>
<a href="javascript: delete_page()" class="btn btn-success btn-large" data-method="get">确 定</a>
</p>
</div>
</div>

</div>
<div class='project_intr'></div>
<br>
<div class='discuss_box'>
<div class='notes discuss_box' id='notes-list'></div>
<script>
  //<![CDATA[
    $(function(){
      NoteList.init("", "", "/u010702509/docker_buildimage/note_projects");
    });
    
    function edit_note_show(id){
      var note_show_id = $("#note_body_"+id),  note_edit_id= $("#note_body_"+id+"_edit");
      note_show_id.hide();
      note_edit_id.show();
    }
    
    function cancel_edit_note_show(id){
      var note_show_id = $("#note_body_"+id),  note_edit_id= $("#note_body_"+id+"_edit");
      note_show_id.show();
      note_edit_id.hide();
    }
  //]]>
</script>


</div>
<ul class='sidebar_fixed'>
<li>
<div class='tip btn_catalog' data-original-title='目录' data-placement='left'>
<i class='icon-list'></i>
</div>
<div class='tip btn_catalog_hide' data-original-title='收起目录' data-placement='left'>
<i class='icon-list'></i>
</div>
</li>
<li>
<div class='tip btn_fullscreen' data-original-title='全屏' data-placement='left'>
<i class='icon-fullscreen'></i>
</div>
<div class='tip btn_fullscreen_hide' data-original-title='退出全屏' data-placement='left'>
<i class='icon-fullscreen'></i>
</div>
</li>
<li>
<div class='tip btn_history' data-original-title='历史' data-placement='left'>
<i class='icon-time'></i>
</div>
</li>
</ul>
<div class='sidebar_hidden_box'></div>
<div class='sidebar_submit_info'>
<textarea id='commit_massage_textarea'></textarea>
<span class='btn' onclick='channle()'>取消</span>
<span class='btn btn-success' onclick='do_submit()'>提交</span>
<br>
<br>
<div id='force_diff' style='display: none;'>
<span class='alert' style='padding: 4px 8px 4px 8px;'>修改较多,比较耗时</span>
<span class='btn btn-mini btn-warning'>继续比较</span>
</div>
</div>
<div class='modal hide fade' id='editTips'>
<div class='modal-header'>
<button aria-hidden class='close' data-dismiss='modal'>x</button>
<h3 class='myModalLabel'>
您上次有编辑的信息未及时提交
</h3>
</div>
<div class='modal-body'>
<div class='alert alert-info'>
是否载入您上次未及时保存的信息？
</div>
<div class='pull-right'>
<a class='btn btn-success btn-large' href='/u010702509/docker_buildimage/edit_file?load_flag=true&amp;path=Docker_buildimage.md' id='load_temp_submit_btn'>是</a>
<a class='btn btn-default btn-large' href='/u010702509/docker_buildimage/edit_file?load_flag=false&amp;path=Docker_buildimage.md' id='load_rep_submit_btn'>否</a>
</div>
</div>
</div>
<script>
  //<![CDATA[
    $("#force_diff span.btn").on("click", function(){
      $("#force_diff").hide();
      changed();
      $("#edit").hide();
      $("#diffview").show();
      $("#preview").hide();
    });
    
    //全屏 begin
    //  var winHeight = window.screen.height;
      function launchFullScreen(element) {
        if(element.requestFullScreen) {
            element.requestFullScreen();
          } else if(element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
          } else if(element.webkitRequestFullScreen) {
            element.webkitRequestFullScreen( Element.ALLOW_KEYBOARD_INPUT);
          }
        $('body').addClass('fullscreen');
        }
        function cancelFullscreen() {
          if(document.cancelFullScreen) {
            document.cancelFullScreen();
          } else if(document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if(document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
          }
        $('body').removeClass('fullscreen');
        }
      function toggleFullscreen(){
        var _bodyClass = $('body').attr('class');
        if(_bodyClass == 'fullscreen'){
          cancelFullscreen();
        }else{
          launchFullScreen(document.documentElement);
        }
      }
    
      $(document).ready(function(){
        var toggle_catalog = sessionStorage.getItem('toggle_catalog');
        if(toggle_catalog == "open"){
          $('.sidebar_hidden_box').animate({right:'0px'},100);
          $('.document_left').appendTo('.sidebar_hidden_box');
          $('.sidebar_submit_info').appendTo('body');
          $('.sidebar_fixed .btn_catalog').hide().siblings().show().parent().addClass('active');
        }
      });
    
      $(document).keyup(function(e){
        var code = e.keyCode ? e.keyCode : e.which;
        if(code == 122) {
          toggleFullscreen();
        }else if(code == 27){
        cancelFullscreen();
        $('.sidebar_fixed .btn_fullscreen_hide').hide().siblings().show().parent().addClass('active');
        }
      });
      //全屏 end
    
    
      //点击事件样式变化
      $(".sidebar_fixed li .tip").on("click", function(){
        $(this).parent().addClass('active').siblings().removeClass('active');
        $('.sidebar_hidden_box').animate({right:'-300px'},100);
        sessionStorage.setItem('toggle_catalog','close');
      });
    
      //目录按钮
      $('.sidebar_fixed .btn_catalog').click(function(){
        $('.sidebar_hidden_box').animate({right:'0px'},100);
        $('.document_left').appendTo('.sidebar_hidden_box');
        $('.sidebar_submit_info').appendTo('body');
        $(this).hide().siblings().show();
        sessionStorage.setItem('toggle_catalog','open');
      });
    
      $('.sidebar_fixed .btn_catalog_hide').click(function(){
        $('.sidebar_fixed li').removeClass('active');
        $('.sidebar_hidden_box').animate({right:'-300px'},100);
        $(this).hide().siblings().show();
        sessionStorage.setItem('toggle_catalog','close');
      });
    
      //全屏按钮
      $('.sidebar_fixed .btn_fullscreen').click(function(){
        launchFullScreen(document.documentElement);
        $(this).hide().siblings().show();
      });
    
      $('.sidebar_fixed .btn_fullscreen_hide').click(function(){
        cancelFullscreen();
        $(this).hide().siblings().show();
      });
    
    //历史
    $('.sidebar_fixed .btn_history').click(function(){
      old_file_path = $("#old_file_path").val();
      $.get("/u010702509/docker_buildimage/modify_history?id="+old_file_path)
    });
    
    //预览按钮
    $('.sidebar_fixed .btn_preview').click(function(){
        if (typeof(editor) != "undefined" && editor.getValue()!=""){
          var content = editor.getValue();
          var file_name = $('#file_name').val();
          var url = "/u010702509/docker_buildimage/preview";
          $.post(url, {content: content, file_name: file_name}, function(data){
            $("#preview").html(data);
            $('#preview.document_content ul, #preview.document_content ol').addClass('normal_li');
            $("#edit").hide();
            $("#diffview").hide();
            $("#preview").show();
          })
        }else{
          chang_flag = false;
        }
    });
    
    //新建
    $('.sidebar_fixed .btn_new').click(function(){
        window.location.href = "/u010702509/docker_buildimage/new_file"
    });
    
    //编辑按钮
    $('.sidebar_fixed .btn_edit').click(function(){
      var doc_redis_exist = "false";
      $.get("/u010702509/docker_buildimage/temp_doc_redis_exist", function(data){
        doc_redis_exist = data;
      
        if (doc_redis_exist == "true"){
          $('#editTips').modal('show');
        }else{
          if(typeof(editor) == "undefined"){
            old_file_path = $("#old_file_path").val();
            if(old_file_path!=null || old_file_path != ""){
              url = "/u010702509/docker_buildimage/edit_file?path=" + encodeURI(old_file_path)
              window.location.href = url;
            }
          }else{
            $("#edit").show();
            $("#diffview").hide();
            $("#preview").hide();
          }
        }
      });
    });
    
    //保存按钮
    $('.sidebar_fixed .btn_save').click(function(){
    
      old_file_path = $("#old_file_path").val();
      var submit_massage = ""
      if(old_file_path != null && old_file_path != ""){
        submit_massage = "Modified file " + old_file_path;
      }else{
        var file_name  = $("#file_name").val();
        submit_massage = "Add file " + file_name + ".md";
      }
    
      $('#commit_massage_textarea').text(submit_massage);
      $('.sidebar_hidden_box').animate({right:'0px'},100);
      $('.sidebar_submit_info').appendTo('.sidebar_hidden_box');
      $('.document_left').appendTo('body');
    
      if(editor._changeSize > 2000){
        $("#force_diff").show();
      }else {
        changed();
        $("#edit").hide();
        $("#diffview").show();
        $("#preview").hide();
      }
    
    });
    
    
    //取消提交
    function channle(){
        $("#edit").show();
        $("#diffview").hide();
        $("#preview").hide();
        $('.sidebar_hidden_box').animate({right:'-300px'},100); 
        $('.sidebar_fixed .btn_save').parent().removeClass('active'); 
        $('.sidebar_fixed .btn_edit').parent().addClass('active'); 
    }
    
    
    //删除
    $('.sidebar_fixed .btn_delete').click(function(){
        if(typeof(editor) == "undefined"){
          old_file_path = $("#old_file_path").val();
          url = "/u010702509/docker_buildimage/delete_file";
          if(old_file_path!=null || old_file_path != ""){
            $("#deletePage").modal('toggle');
          }  
        }
    });
    
    //保存出现的diff begin
    function changed() {
        var result = document.getElementById('diffview');
    
        if(window.diffType == 'applyPatch') {
            //b.textContent = JsDiff.applyPatch(a.textContent, result.textContent);
        } else if(window.diffType == 'createPatch') {
            //result.textContent = JsDiff.createPatch('filename',a.textContent, b.textContent,'left','right');
        } else {
          if(typeof(editor) != "undefined"){
            //var diff = JsDiff[window.diffType](originText, editor.getValue());
            var diff = JsDiff.diffChars(originText, editor.getValue())
            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {
    
                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }
    
                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }
    
            result.textContent = '';
            result.appendChild(fragment);
          }
        }
    }
    
    window.onload = function() {
        onDiffTypeChange("diffChars");
        changed();
    
    };
    
    // type: diffChars,  diffWords,  diffLines,  createPatch,  applyPatch
    function onDiffTypeChange(diffType) {
        window.diffType = diffType;
        $("#diffview").hide();
    }
    
    //保存出现的diff end
    
    //删除事件
    function delete_page() {
      if(typeof(editor) == "undefined"){
        old_file_path = $("#old_file_path").val();
        url = "/u010702509/docker_buildimage/delete_file";
        if(old_file_path!=null || old_file_path != ""){
          $.post(url, {id: old_file_path}, function(){
            window.location.href = "/u010702509/docker_buildimage";
          })
        }
      }
    }
    
    //提交按钮
    function do_submit(){
      var commit_massage = $("#commit_massage_textarea").val();
      $("#commit_massage").val(commit_massage);
      $("#file_form").submit();
    }
    
    //加载目录
    $(function(){
      $.get("/u010702509/docker_buildimage/file_list?path=u010702509%2Fdocker_buildimage")
    });
  //]]>
</script>


<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_trackPageview','/xuni/CODE/doc/']);
  //]]>
</script>


</div>
<div class='footer'>
<div class='container'>
<ul class='pull-left'>
<li>
<a href='/CSDN_Code/code_support/issues'>反馈</a>
</li>
<li>
<a href="/blog">博客</a>
</li>
<li>
<a href="/help">帮助</a>
</li>
</ul>
<div class='pull-right'>Copyright &copy; 2013, CSDN.NET, All Rights Reserved</div>
</div>
</div>
<script src='https://csdnimg.cn/pubfooter/js/tracking.js?4683549'></script>
<script btnid='header_notice_num' count='5' id='noticeScript' src='//csdnimg.cn/rabbit/notev2/js/notify.js?4683549' subcount='5' type='text/javascript' wrapid='note1'></script>
<script btnId='header_notice_num' count='5' id='csdn-toolbar-id' src='//csdnimg.cn/public/common/toolbar/js/toolbar.js' subCount='5' type='text/javascript' wrapId='note1'></script>
<script>
  //<![CDATA[
    var _hmt = _hmt || [];
    if (window.location.href.toLowerCase().indexOf("code.csdn.net") != -1) {
      (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?109cc247ce415a3d1af4bb90c8252d2e";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
       })();
    }
  //]]>
</script>

</body>
</html>

