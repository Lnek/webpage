<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ganglia python插件标准 - Charliee - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=iQQnf2q8V83bi9LbN6IvkHJyxj8GLI9A8HLPvxO-IBQ1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="http://common.cnblogs.com/Skins/LessIsMore/style.css?id=20140415"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/xuechao/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/xuechao/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/xuechao/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'xuechao', cb_enable_mathjax=false;</script>
<script src="/bundles/blog-common.js?v=15gzXd7pJ_PNpSlGpVykf0EBaNg79HWL7oD5vVw0NGA1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/xuechao/"></a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="MyLinks1_HomeLink" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="MyLinks1_MyHomeLink" class="menu" href="http://www.cnblogs.com/xuechao/">首页</a></li>
<li id="nav_q"><a class="menu" href="http://q.cnblogs.com/">博问</a></li>
<li id="nav_ing"><a class="menu" href="http://home.cnblogs.com/ing/">闪存</a></li>
<li id="nav_newpost"><a id="MyLinks1_NewPostLink" class="menu" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="MyLinks1_ContactLink" class="menu" rel="nofollow" href="http://space.cnblogs.com/msg/send/Charliee">联系</a></li>
<li id="nav_rss"><a id="MyLinks1_Syndication" class="menu" href="http://www.cnblogs.com/xuechao/rss">订阅</a>
<!--<a id="MyLinks1_XMLLink" class="aHeaderXML" href="http://www.cnblogs.com/xuechao/rss"><img src="http://www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="MyLinks1_Admin" class="menu" rel="nofollow" href="http://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			
<!--done-->
随笔-127&nbsp;
文章-6&nbsp;
评论-3&nbsp;

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		

<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/xuechao/articles/1967191.html">ganglia python插件标准</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><div id="sf_header">     <a href="http://sourceforge.net/" id="sf_logo"><strong>SourceForge</strong></a>     <p id="hl">         <a href="http://sourceforge.net/projects/ganglia" title="Project summary page hosted on SourceForge.net">Visit project ganglia</a>          <a href="http://sourceforge.net/account/registration/" title="Get a SourceForge.net account">Register</a> <a href="https://sourceforge.net/account/login.php" title="Log in">Log&nbsp;In</a>     </p>     <div id="fad1">               </div> </div>       	<div id="doc3"> 		<div id="bd"> 			<a name="content"></a>      <div id="banner">       <div id="header">         <h1><a href="http://sourceforge.net/projects/ganglia/">ganglia</a></h1>       </div>       <form id="search" action="/apps/trac/ganglia/search" method="get">         <div>           <label for="proj-search">Search:</label>           <input id="proj-search" name="q" size="18" value="" type="text" />           <input value="Search" type="submit" />         </div>       </form>       <div id="metanav">     <ul><li><a href="http://sourceforge.net/apps/trac/ganglia/prefs">Preferences</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/wiki/TracGuide">Help/Guide</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/about">About Trac</a></li></ul>   </div>     </div>     <div id="mainnav">     <ul><li active=""><a href="http://sourceforge.net/apps/trac/ganglia/wiki">Wiki</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/timeline">Timeline</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/roadmap">Roadmap</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/browser">Browse Source</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/search">Search</a></li></ul>   </div>     <div id="main">       <div id="ctxtnav">         <h2>Context Navigation</h2>           <ul><li><a href="http://sourceforge.net/apps/trac/ganglia/wiki/WikiStart">Start Page</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/wiki/TitleIndex">Index</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules?action=history">History</a></li><li><a href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules?action=diff&amp;version=10">Last Change</a></li></ul>         <hr />       </div>     <div id="content">       <div searchable="">                    <h1>Gmond Python metric modules<a title="Link to this section" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules#GmondPythonmetricmodules"> &#182;</a></h1> <p> One of the new features of Ganglia 3.1.x is the ability to create  C/Python metric gathering modules. These modules can be plugged directly  into gmond to monitor user-specified metrics. </p> <p> In previous versions (2.5.x, 3.0.x), the only way to add user-specified  metrics is via a command line tool called gmetric and the way to inject  metrics into gmond is simply to run gmetric via a cronjob or some other  process. While this works for most people, it makes user-specified  metrics difficult to manage. </p> <p> This document will dive into the specifics for writing a Python metric monitoring module. </p> <p> The following are prerequisites for building/using Python module support: </p> <ul><li>Ganglia 3.1.x </li><li>Python 2.3.4+ (this is the oldest tested version which comes  with Red Hat Enterprise Linux 4, older 2.3 versions should work as well) </li><li>Python development headers (usually in the form of <tt>python-devel</tt> binary packages) </li></ul><h2>Installation<a title="Link to this section" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules#Installation"> &#182;</a></h2> <p> If you are trying to install Python metric modules support on a RPM-based system, install the <tt>ganglia-gmond-modules-python</tt> RPM.  This includes everything needed for Python metric modules support to work. </p> <p> If you are building from source, please make sure that you include the <tt>--with-python</tt> option during configure.  If the Python interpreter is detected, this option will be added automatically. </p> <h2>Checklist<a title="Link to this section" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules#Checklist"> &#182;</a></h2> <p> To confirm that your Ganglia installation has Python support correctly setup, double check the following: </p> <ul><li><tt>gmond.conf</tt> has a line which reads something along the lines of <tt>include ("/etc/ganglia/conf.d/*.conf")</tt>.  This is the directory where you should place configuration files for your Python modules as <tt>.pyconf</tt> files </li><li>You have <tt>modpython.so</tt> in <tt>/usr/lib{64}/ganglia</tt> </li><li>The directory <tt>/usr/lib{64}/ganglia/python_modules</tt> exists.  This is the directory where Python modules should be placed as <tt>.py</tt> files. </li></ul><p> These things should be automatically done for you if you installed  Python modules support via binary packages.  If that is not the case  please file a bug at the distribution's corresponding bug tracker. </p> <h2>Writing Python modules<a title="Link to this section" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules#WritingPythonmodules"> &#182;</a></h2> <p> Writing a Python module is very simple. You just need to write it  following a template and put the resulting Python module (.py) in  /usr/lib(64)/ganglia/python_modules. A corresponding Python  Configuration (.pyconf) file needs to reside in /etc/ganglia/conf.d/. </p> <p> If your Python module needs to access certain files on the server, keep  in mind that the module will be executed as the user which runs <tt>gmond</tt>.  In other words, if <tt>gmond</tt> runs as user <tt>nobody</tt> then your module will also run as <tt>nobody</tt>. So make sure that the user which runs <tt>gmond</tt> has the correct permissions to access the files in question. </p> <p> The Ganglia distribution comes with an example Python module in  /usr/lib(64)/ganglia/python_modules/example.py. Alternatively, this file  is also viewable from our SVN repository: <a href="http://ganglia.svn.sourceforge.net/viewvc/ganglia/branches/monitor-core-3.1/gmond/python_modules/example/example.py?view=markup">http://ganglia.svn.sourceforge.net/viewvc/ganglia/branches/monitor-core-3.1/gmond/python_modules/example/example.py?view=markup</a> </p> <p> Let's look at a real-life example of a Python module which monitors the  temperature of the host, by reading a file in the /proc file system,  let's call this temp.py: </p> <pre>def temp_handler(name):<br />    acpi_file = "/proc/acpi/thermal_zone/THRM/temperature"<br /><br />    try:<br />        f = open(acpi_file, 'r')<br /><br />    except IOError:<br />        return 0<br /><br />    for l in f:<br />        line = l.split()<br /><br />    return int(line[1])<br /><br />def metric_init(params):<br />    global descriptors<br /><br />    d1 = {'name': 'temp',<br />        'call_back': temp_handler,<br />        'time_max': 90,<br />        'value_type': 'uint',<br />        'units': 'C',<br />        'slope': 'both',<br />        'format': '%u',<br />        'description': 'Temperature of host',<br />        'groups': 'health'}<br /><br />    descriptors = [d1]<br /><br />    return descriptors<br /><br />def metric_cleanup():<br />    '''Clean up the metric module.'''<br />    pass<br /><br />#This code is for debugging and unit testing<br />if __name__ == '__main__':<br />    metric_init(None)<br />    for d in descriptors:<br />        v = d['call_back'](d['name'])<br />        print 'value for %s is %u' % (d['name'],  v)<br /></pre><p> There are three functions that must exist in every python metric module. These functions are: </p> <ul><li>def metric_init(params): </li><li>def metric_cleanup(): </li><li>def metric_handler(): </li></ul><p> While the first two functions above must exist explicitly (ie. they must  be named as specified above), the metric_handler() function can  actually be named anything. The only requirement is that the <em>call_back</em>  function that is specified in the metric descriptor (described below)  must match the name of the metric_handler function. In addition if your  metric module supports multiple metrics, each being defined through  their own metric descriptor, your module may actually implement more  than one metric_handler function. </p> <p> Let's go through each function one by one. The temp_handler() function  simply parses the file with the temperature readings and returns it.  This is the metric_handler function that was described above. The name  of this function must match the function name that is specified for the <em>call_back</em>  attribute of the corresponding metric descriptor (see below). It must  also return the appropriately typed value. For example, if the <em>value_type</em> attribute of the metric descriptor specifies a UINT, then the metric_handler function must return a UINT data type. </p> <p> The metric_init() function creates and initializes metric descriptors  for each metric that the module supports. If the module supports a  single metric, then the return value from the metric_init() function can  be just a single descriptor. If however the module supports multiple  metrics, the return value must be a list of descriptors. Each metric  that is supported by the module must create and initialize a metric  descriptor in the following manner: </p> <ul><li>name: name of the metric </li><li>call_back: function to call when collecting metric data </li><li>time_max: maximum time in seconds between metric collection calls </li><li>value_type: string | uint | float | double </li><li>units: unit of your metric </li><li>slope: zero | positive | negative | both <ul><li>If 'positive', RRD file generated will be of COUNTER type, otherwise will be of GAUGE type </li><li>If 'zero', the metric will appear in the "Time and String Metrics" or the "Constant Metrics" depending on the <tt>value_type</tt> of the metric </li></ul></li><li>format: format string of your metric <ul><li>Must correspond to value_type otherwise value of your metric will be unpredictable (reference: <a href="http://docs.python.org/library/stdtypes.html#string-formatting">http://docs.python.org/library/stdtypes.html#string-formatting</a>) </li></ul></li><li>description: description of your metric <ul><li>Which is visible in web frontend if you hover over host metric graph </li></ul></li><li>group: group of your metric <ul><li>Metrics in the web frontend hostview is grouped by this </li></ul></li></ul><p> The metric descriptor can include additional attributes and values which  will be attached to the metric metadata as extra data. The extra data  will be ignored by Ganglia itself but can be used by the web front as  additional display or metric handling data. <em>(The use of SPOOF_HOST and SPOOF_NAME extra attributes are examples that will be described in a later version.)</em> </p> <p> In addition, the metric_init() function takes one parameter. This  parameter is a list of name/value pairs that correspond to configuration  parameters that were included in the gmond.conf file for a specific  metric module. These name/value pairs are read from the configuration  file, passed directly to the module and are only meaningful to the  metric module itself. The metric module must know what the params values  mean and how to apply them to the metric module functionality. How  these configuration parameters are defined is explained below. </p> <p> The corresponding temp.pyconf looks like this: </p> <pre>modules {<br />  module {<br />    name = "temp"<br />    language = "python"<br />    # The following params are examples only<br />    #  They are not actually used by the temp module<br />    param RandomMax {<br />      value = 600<br />    }<br />    param ConstantValue {<br />      value = 112<br />    }<br />  }<br />}<br /><br />collection_group {<br />  collect_every = 10<br />  time_threshold = 50<br />  metric {<br />    name = "temp"<br />    title = "Temperature"<br />    value_threshold = 70<br />  }<br />}<br /></pre><p> The above configuration file contains two major sections with various sub-sections. The <em>modules</em> section contains configuration data that is specific to each module being loaded. It may contain either a single <em>module</em> sub-section or multiple sub-sections. Within each <em>module</em> sub-section is the <em>name</em> of the metric module, the <em>language</em> in which the module was written and zero or more module specific <em>param</em>(s). Each <em>param</em> sub-section has a <em>name</em> and a <em>value</em>. The <em>name</em> and <em>value</em> make up the name/value pair that is passed into the metric_init() function as a <em>params</em> list as described above. The rest of the configuration file follows the same format as for any other <em>collection_group</em> or <em>metric</em>. </p> <h2>Further reading<a title="Link to this section" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules#Furtherreading"> &#182;</a></h2> <p> Additional information about Python modules can be found in the README file: <a href="http://ganglia.svn.sourceforge.net/viewvc/ganglia/branches/monitor-core-3.1/gmond/modules/python/README.in?view=markup">http://ganglia.svn.sourceforge.net/viewvc/ganglia/branches/monitor-core-3.1/gmond/modules/python/README.in?view=markup</a> </p> <p> Some helpful user-contributed resources:   </p> <ul><li><a href="https://github.com/hirose31/ganglia-pymodule_skeleton">ganglia-pymodule_skeleton</a> </li><li><a href="http://github.com/davidbirdsong/pygmonlib">pygmonlib</a> </li></ul>                         </div>     </div>     <div id="altlinks">       <h3>Download in other formats:</h3>       <ul><li first="">           <a rel="nofollow" href="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules?format=txt">Plain Text</a>         </li></ul>     </div>     </div>     <div id="footer"><hr />       <a id="tracpowered" href="http://trac.edgewall.org/"><img src="http://sourceforge.net/apps/trac/ganglia/chrome/common/trac_logo_mini.png" alt="Trac Powered" width="107" height="30" /></a>       <p>         Powered by <a href="http://sourceforge.net/apps/trac/ganglia/about"><strong>Trac 0.11.2.1</strong></a><br />         By <a href="http://www.edgewall.org/">Edgewall Software</a>.       </p>            </div>  		</div>         </div>        <p>&#169; 2011 <a title="Network which provides and promotes Open Source software downloads, development, discussion and news." href="http://geek.net/">Geeknet, Inc.</a> &nbsp; <a href="http://p.sf.net/sourceforge/terms">Terms of Use</a> - <a href="http://p.sf.net/sourceforge/privacy">Privacy Policy</a></p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2011-02-28 17:18</span> <a href='http://www.cnblogs.com/xuechao/'>Charliee</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>) &nbsp;<a href="http://i.cnblogs.com/EditArticles.aspx?postid=1967191" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(1967191);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=78051,cb_entryId=1967191,cb_blogApp=currentBlogApp,cb_blogUserGuid='c3ea0186-b9e4-df11-ac81-842b2b196315',cb_entryCreatedDate='2011/2/28 17:18:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
<a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="程序员的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="ad_under_post_holder"></div>
<script type="text/javascript">
var enableGoogleAd = true;
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
fixPostBodyFormat();
loadAdUnderPost();
</script>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
loadBlogSignature();
LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
</script>
<script type="text/javascript">
    $.ajax({ url: 'http://counter.cnblogs.com/blog/post/' + cb_entryId, type: 'get', dataType: 'script', cache: true });
</script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2014 Charliee
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
</body>
</html>
