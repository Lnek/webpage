        <!DOCTYPE html><html  id="customDoc"><!--STATUS OK--> <head> <meta http-equiv=Content-Type content="text/html; charset=utf-8"> <title> 【转】django 笔记 基础3 模型_醉梦轩_百度空间</title> <link rel="shortcut icon" href="http://hi.bdimg.com/static/qbase/img/mod/16_favicon.ico?v=49f19c7f.ico" type=image/x-icon>   <meta name=keywords content="【转】django 笔记 基础3 模型,Python"> <meta name=description content="老婆，我爱你！,【转】django 笔记 基础3 模型"><script>window.wpo={start:new Date*1,pid:109,page:'qing'}</script><!--[if IE]><script type="text/javascript">(function(){var b=("abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video").split(","),a=b.length;while(a--){document.createElement(b[a])}})();</script><![endif]--><script>window.qDomain={"qing":"http://hi.baidu.com","static":"http://hi.bdimg.com","passport":"https://passport.baidu.com","portrait":"http://tx.bdimg.com","hiup":"http://hiup.baidu.com","photo":"http://hiphotos.baidu.com","message":"http://msg.baidu.com","friend":"http://frd.baidu.com","mp3":"http://mp3.baidu.com","ting":"http://ting.baidu.com","image":"http://img.baidu.com","qup":"http://upload.hi.baidu.com","www":"http://www.baidu.com"};window.qUserInfo={"userName":"drunkdream","portrait":"2d2e6472756e6b647265616d2001","qingUrl":"\/drunkdream","spaceName":"醉梦轩","right":"0","avatarStatus":"1","flagNeedInvite":"0","flagNotInvited":"0","version":"2"};window.qVisitorInfo={"userName":"","portrait":"","isHost": false,"loginStatus":"not_login","qingUrl":"","right":"0","version":"0"};window.qPageInfo={"pageUrl":"http:\/\/hi.baidu.com\/drunkdream\/item\/a23f17c202a04f2d47d5c0c1","referUrl":"http:\/\/www.baidu.com\/s?ie=utf-8&bs=connection.cursor&f=8&rsv_bp=1&rsv_spt=3&wd=django+connection&inputT=5127"};window.qUserAvatar={size20:"http://hiphotos.baidu.com/space/scrop=20;q=100/sign=67acd2fd34a85edffed2b97c39693b13/b17eca8065380cd74abe1940a144ad34588281ff.jpg",size40:"http://hiphotos.baidu.com/space/scrop=40;q=100/sign=ef35d0428db1cb133a377b4cad69627e/b17eca8065380cd74abe1940a144ad34588281ff.jpg",size65:"http://hiphotos.baidu.com/space/scrop=65;q=100/sign=562c458e49540923ae372421e265e73c/b17eca8065380cd74abe1940a144ad34588281ff.jpg",size110:"http://hiphotos.baidu.com/space/scrop=110;q=100/sign=70f98dd278f0f736dca00b5e7a688228/b17eca8065380cd74abe1940a144ad34588281ff.jpg",size160:"http://hiphotos.baidu.com/space/scrop=160;q=100/sign=70f98dd278f0f736dca00b5e7a68822f/b17eca8065380cd74abe1940a144ad34588281ff.jpg"};window.qVisitorAvatar={size20:"",size40:"",size65:"",size110:"",size160:""};window.qBdsToken="the fisrt two args should be string type:0,1!";window.qErrorInfo={"no":"0","msg":""};window.qServerInfo={"timeStamp":"1344988921"};window.qLongPolling={"url":"http:\/\/m.hi.baidu.com\/i\/msg\/listen"}</script><!--[if (lt IE 8.0)]><link href="http://hi.bdimg.com/static/qbase/css/qbase.css?v=be8a5272.css" type=text/css rel=stylesheet><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link href="http://hi.bdimg.com/static/qbase/css/qbase_datauri.css?v=00440ea5.css" type=text/css rel=stylesheet><!--<![endif]-->     <!--[if (lt IE 8.0)]><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qcomment/css/qcomment.css?v=45ade295.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qcomment/css/qcomment_datauri.css?v=97b9740e.css"><!--<![endif]--><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qhome/css/common/mod_userInfo.css?v=86bf4259.css">   <!--[if (lt IE 8.0)]><link type=text/css rel=stylesheet href="http://hi.bdimg.com/static/qhome/css/detail/20002/detail.css?v=9501d8c5.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link type=text/css rel=stylesheet href="http://hi.bdimg.com/static/qhome/css/detail/20002/detail_datauri.css?v=319135e0.css"><!--<![endif]-->   <script src="http://hi.bdimg.com/static/qbase/js/qing/qing.js?v=43b043ad.js"></script>  <script>
    /*最终页页面变量*/ 
    window.detailPage = {
        threadId : "a23f17c202a04f2d47d5c0c1",
        blogTitle: "【转】django 笔记 基础3 模型" || "无标题",
        contentType : "text",
        originAuthorName : "",
        originPortrait : "",
        originThreadId : ""
    }; 
    </script><script>wpo.head=new Date*1;</script> </head> <body>  <header class=mod-topbar id=modTopbar><iframe class=mod-topbar-bgframe></iframe><div class=mod-topbar-pseudo-real><div class="wrapper-box clearfix"><div class=left-box><a href="http://hi.baidu.com" class=logo-box><span id=baiduSpaceLogo class=q-logo></span></a></div><div class=center-box><ul class=q-menubox><li class=q-menuitem><a href="http://hi.baidu.com/tag" >推荐</a></ul></div><div class=right-box><ul class=q-navbox><li class=q-navitem><a href="http://hi.baidu.com/go/login" class=q-goto-login>登录</a><li class="q-navitem q-nav-sp"><span></span><li class=q-navitem><a href="http://hi.baidu.com/go/reg">注册</a> </ul><div class="right mod-qhome-follow-box"><a href="#" class="follow-btn a-btn-follow">关注此空间</a></div></div></div></div></header>  <section class=mod-page-body> <div class="mod-page-main wordwrap clearfix">  <div class=x-page-container>
    <section class="mod-topspaceinfo mod-cs-header"><div class=head-topbar></div><div class=container><h1><a class="space-name cs-header-spacename" href="/new/drunkdream">醉梦轩</a></h1><p class="space-description cs-header-spacesummary">老婆，我爱你！</p></div><div class=head-footer></div></section>    <div class="mod-blogpage-wraper">
        <div class="blog-bg-main-repeat hide"></div>
        <div class="grid-80 mod-blogpage">
            <div class="blog-bg-main hide"></div>
            
        <div class="mod-text-content mod-post-content">   
                      <div class="content-head clearfix">  <div class=content-other-info> <span>2011-07-28 09:48</span> </div>   <h2 class="title content-title">【转】django 笔记 基础3 模型</h2>  </div> <div id=content class="content text-content clearfix"> <p><strong><p><strong>欢迎各位python django爱好者加入我们的PDW大家庭！QQ群：80692368</strong></p></strong></p><p><strong>ＭＴＶ开发模式</strong></p><p><em>M</em> 代表模型（Model），即数据存取层。 该层处理与数据相关的所有事务： 如何存取、如何验证有效性、包含哪些行为以及数据之间的关系等。</p><p><em>T</em> 代表模板(Template)，即表现层。 该层处理与表现相关的决定： 如何在页面或其他类型文档中进行显示。</p><p><em>V</em> 代表视图（View），即业务逻辑层。 该层包含存取模型及调取恰当模板的相关逻辑。 你可以把它看作模型与模板之间的桥梁。</p><p>Django MVC 中:视图用来描述要展现给用户的数据；不是数据 <em>如何</em>展现 ,而且展现 <em>哪些</em> 数据。 ?</p><p>Ruby on Rails 及一些同类框架:控制器负责决定向用户展现哪些数据，而视图则仅决定 <em>如何</em> 展现数据，而不是展现 <em>哪些</em> 数据。 ?</p><p>&nbsp;</p><p><strong>数据库配置</strong></p><p>settings.py <br /><strong></strong></p><p>DATABASE_ENGINE = '' #数据库引擎<br />DATABASE_NAME = ''&nbsp;&nbsp;&nbsp; #数据库名称<br />DATABASE_USER = ''&nbsp;&nbsp;&nbsp; #用哪个用户连接数据库<br />DATABASE_PASSWORD = '' #连接用户的密码<br />DATABASE_HOST = ''&nbsp;&nbsp;&nbsp;&nbsp; #数据库服务器<br />DATABASE_PORT = ''&nbsp;&nbsp;&nbsp; #数据库服务器端口</p><p><br /><strong>测试</strong></p><p>&gt;&gt;&gt; from django.db import connection</p><p>&gt;&gt;&gt; cursor = connection.cursor()</p><p>&nbsp;</p><p><strong>Ｄjango项目(project)和应用(app)</strong></p><p>一个project包含很多个Django app以及对它们的配置。</p><p>技术上，project的作用是提供配置文件，比方说哪里定义数据库连接信息, 安装的app列表，TEMPLATE_DIRS ，等等</p><p>一个app是一套Django功能的集合，通常包括模型和视图，按Python的包结构的方式存在。</p><p>例如，Django本身内建有一些app，例如注释系统和自动管理界面。 app的一个关键点是它们是很容易移植到其他project和被多个project复用。当然，一个project也可以不用创建app，但是如果你使用了Django的数据库层（模型），你 必须创建一个Django app</p><p>&nbsp;</p><p><strong>创建app</strong></p><p>python manage.py startapp books<br /><br /><strong>创建模型<br /></strong>Django模型是用Python代码形式表述的数据在数据库中的定义。 <br />对数据层来说它等同于 CREATE TABLE 语句，只不过执行的是Python代码而不是 SQL，<br />而且还包含了比数据库字段定义更多的含义（如ＵＲＬ）。<br /></p><p>＃Django提供了实用工具来从现有的数据库表中自动扫描生成模型。</p><p>＃“每个数据库表对应一个类”这条规则的例外情况是多对多关系</p><p>from django.db import models　<br />class Author(models.Model): #创建模型的示例<br />first_name = models.CharField(max_length=30)<br />last_name = models.CharField(max_length=40)<br /></p><p>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; email = models.EmailField('e-mail',blank=True, null=True)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #blank=True，null=True设置字段是可选，可null的，'e-mail‘｜verbose_name='e-mail' 自定义标签为e-mail</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __unicode__(sefl): ＃此方法告诉Python如何将对象以unicode的方式显示出来,'e-mail'是</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return self.first_name</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class Meta:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ＃缺省人排序方式<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ordering = ['first_name']</p><p><br /></p><p>＃会自动为模型生成一个自增长的整数主键字段,每个Django模型都要求有单独的主键:id</p><p>＃请确保你的每一个模型里都包含 __unicode__() 方法</p><p><br /><strong>模型安装</strong><br /><br /><em>激活</em> 模型<br />settings.pyINSTALLED_APPS 设置 告诉 Django 项目哪些 app 处于激活状态。 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIDDLEWARE_CLASSES&nbsp; 设置 <br /><em>验检</em> 模型<br />python manage.py validate<br /><br /><strong>创建数据表</strong><br /></p><p>生成 CREATETABLE 语句</p><p>python manage.py sqlall books</p><p>生成数据表</p><p>python manage.py sqlall books　打印出books app的数据表的sql语句＃主要是用来检查<br /></p><p>python manage.py syncdb　生成表</p><p>syncdb 命令是同步模型到数据库的一个简单方法。 它根据 INSTALLED_APPS 的设置检查数据库，如表不存在，就会创建它。 注意：syncdb 并 <em>不能</em>将模型的修改或删除同步到数据库。重复运行pythonmanage.pysyncdb总是安全的，因为它不会重复执行SQL语句</p><p><strong>基本数据访问</strong></p><p>from books.models import Publisher&nbsp;&nbsp; ＃导入Publisher模型类</p><p>1.增加</p><p>&gt;&gt;&gt; p1 = Publisher(name='Apress', address='2855 Telegraph Avenue') ＃创建类实例，设置字段值<br />&gt;&gt;&gt; p1.save()&nbsp;&nbsp; ＃将对象保存到数据库中。 Django 会在后台执行一条 INSERT 语句</p><p>&gt;&gt;&gt; Publisher.objects.create(name='Apress', address='2855 Telegraph Avenue')＃一步完成对象的创建与存储,<strong>等同</strong>上两句</p><p>2查询</p><p>&gt;&gt;&gt; publisher_list = Publisher.objects.all() #从数据库取出出版商的信息,后台执行一条 select 语句，返回QuerySet 对象</p><p>返回一个记录集(QuerySet)</p><p>Publisher.objects.filter(country=&quot;U.S.A.&quot;, state_province=&quot;CA&quot;,name__contains=&quot;press&quot;)</p><p>查找类型有：contains(like),icontains(大小写无关的LIKE),startswith和endswith, 还有range(BETWEEN查询）</p><p>返回单个对象</p><p>Publisher.objects.get(name=&quot;Apress&quot;) #如果结果是多个对象，会导致抛出异常DoesNotExist</p><p>捕获并处理DoesNotExist异常</p><p>try:<br />&nbsp;&nbsp; p = Publisher.objects.get(name='Apress')<br />except Publisher.DoesNotExist:<br />&nbsp;&nbsp; print &quot;Apress isn't in the database yet.&quot;<br />else:<br />&nbsp;&nbsp; print &quot;Apress is in the database.&quot;</p><p>数据排序</p><p>&gt;&gt;&gt; Publisher.objects.order_by(&quot;state_province&quot;, &quot;address&quot;,&quot;-name&quot;) [0] #减号是反向排序 [0]是取第一个也可用[0:2]不可用负</p><p>3. 更新</p><p>&gt;&gt;&gt;Publisher.objects.all().update(country='USA') #修改所有记录某字段</p><p>&gt;&gt;&gt;Publisher.objects.filter(id=52).update(name='Apress Publishing')＃修改指定记录指定字段</p><p>4.删除<br />&gt;&gt;&gt; p = Publisher.objects.get(name=&quot;O'Reilly&quot;) &nbsp;<br />&gt;&gt;&gt; p.delete() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ＃删除指定记录<br />&gt;&gt;&gt; Publisher.objects.filter(country='USA').delete() ＃删除记录集<br />&gt;&gt;&gt; Publisher.objects.all().delete() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ＃删除所有记录<br /><br /></p><p><strong>访问外键(Foreign Key)值</strong></p><p>当你获取一个ForeignKey 字段时,你会得到相关的数据模型对象。 例如:</p><p>&gt;&gt;&gt; b = Book.objects.get(id=50)<br />&gt;&gt;&gt; b.publisher<br />&lt;Publisher: Apress Publishing&gt;<br />&gt;&gt;&gt; b.publisher.website<br />u'http://www.apress.com/'<br /></p><p>对于用`` ForeignKey`` 来定义的关系来说，在关系的另一端也能反向的追溯回来，只不过由于不对称性的关系而稍有不同。 通过一个`` publisher`` 对象，直接获取 books ，用 publisher.book_set.all() ，如下：</p><p>&gt;&gt;&gt; p = Publisher.objects.get(name='Apress Publishing')<br />&gt;&gt;&gt; p.book_set.all()<br />[&lt;Book: The Django Book&gt;, &lt;Book: Dive Into Python&gt;, ...]<br /></p><p>实际上，book_set 只是一个 QuerySet（参考第5章的介绍），所以它可以像QuerySet一样,能实现数据过滤和分切，例如：</p><p>&gt;&gt;&gt; p = Publisher.objects.get(name='Apress Publishing')<br />&gt;&gt;&gt; p.book_set.filter(name__icontains='django')<br />[&lt;Book: The Django Book&gt;, &lt;Book: Pro Django&gt;]<br /></p><p>属性名称book_set是由模型名称的小写(如book)加_set组成的。</p><p>&nbsp;</p><p><strong>访问多对多值(Many-to-Many Values)</strong></p><p>&gt;&gt;&gt; b = Book.objects.get(id=50)<br />&gt;&gt;&gt; b.authors.all() <br />&gt;&gt;&gt; b.authors.filter(first_name='Adrian')<br />#反向查询也可以</p><p>&nbsp;</p><p><strong>更改数据库模式</strong></p><p>Django的数据库层的工作流程</p><p>*如果模型包含一个未曾在数据库里建立的字段，Django会报出错信息。 当你第一次用Django的数据库API请求表中不存在的字段时会导致错误（就是说，它会在运行时出错，而不是编译时）。</p><p>*Django<em>不</em>关心数据库表中是否存在未在模型中定义的列。</p><p>*Django<em>不</em>关心数据库中是否存在未被模型表示的表格。</p><p>*改变模型的模式架构意味着需要按照顺序更改Python代码和数据库。</p><p>1添加字段</p><p>添加 非NULL 字段</p><p>首先，进入开发环境(也就是说，不是在发布环境里)：</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 在你的模型里添加字段。</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 运行 manage.pysqlall[yourapp] 来测试模型新的 CREATETABLE 语句。 注意为新字段的列定义。</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 开启数据库交互命令界面(比如psql或mysql ,或者可以使用 manage.pydbshell ),执行 ALTERTABLE 语句来添加新列。</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 使用Python的manage.pyshell，通过导入模型和选中表单来验证字段是否正确添加 ,如一切顺利,所有语句都不会报错。</p><p>然后在你的产品服务器上再实施一遍这些步骤：</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 启动数据库的交互界面</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 执行在开发环境步骤中，第三步的ALTERTABLE语句。</p><p>&nbsp;&nbsp;&nbsp;&nbsp; 将新的字段加入到模型中,如果你使用了某种版本控制工具,并且在第一步中,已经提交了你在开发环境上的修改,现在,可以在生产环境中更新你的代码了（例如，如果你使用Subversion，执行svnupdate)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 重新启动Web server，使修改生效。</p><p>2删除字段</p><p>&nbsp; 从Model中删除字段，然后重新启动你的web服务器,用以下命令从数据库中删除字段</p><p>&nbsp; ALTER TABLE books_book DROP COLUMN num_pages;</p><p>3删除多对多关联字段</p><p>&nbsp; 从你的模型中删除ManyToManyField，然后重启web服务器,用下面的命令从数据库删除关联表：</p><p>&nbsp; DROP TABLE books_book_authors;<br /></p><p>4删除模型</p><p>&nbsp; 从文件中删除你想要删除的模型，然后重启web 服务器models.py,然后用以下命令从数据库中删除表：</p><p>&nbsp; DROP TABLE books_book;</p><p>Managers </p><p>在语句Book.objects.all()中，objects是一个特殊的属性，需要通过它查询数据库。 在第5章，我们只是简要地说这是模块的manager 。现在是时候深入了解managers是什么和如何使用了。</p><p>总之，模块manager是一个对象，Django模块通过它进行数据库查询。 每个Django模块至少有一个manager，你可以创建自定义manager以定制数据库访问。</p><p>下面是你创建自定义manager的两个原因： 增加额外的manager方法，修改manager返回的初始QuerySet。</p><p><strong>为模型增加额外的Manager方法</strong></p><p>class BookManager(models.Manager):<br />&nbsp; def title_count(self,keyword):<br />&nbsp;&nbsp;&nbsp;&nbsp; return self.filter(title__icontains=keyword).count() #此处self指manager本身<br />class Book(models.Model):<br />&nbsp; title=models.CharField(max_length=100)<br />&nbsp; authors=models.ManyToManyField(Author)<br />&nbsp; publisher=models.ForeignKey(Publisher)<br />&nbsp; publication_date=models.DateField()<br />&nbsp; num_pages=models.IntegerField(blank=True,null=True)<br />&nbsp; objects=BookManager()&nbsp;&nbsp; #也可objects_test, Book.objects_test.title_count('python')</p><p>#将取代模型的默认manager(objects)如没定义,会自动创建,命名为objects,为了与自动创建的manager保持一致<br />&nbsp; def __unicode__(self):<br />&nbsp;&nbsp;&nbsp; return self.title</p><p>调用：<br />&gt;&gt;&gt; Book.objects.title_count('python')<br />18</p><p><strong>修改manager返回的初始QuerySet</strong></p><p>class MaleManager(models.Manager):<br />&nbsp;&nbsp;&nbsp; def get_query_set(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return super(MaleManager, self).get_query_set().filter(sex='M')<br /><br />class FemaleManager(models.Manager):<br />&nbsp;&nbsp;&nbsp; def get_query_set(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return super(FemaleManager, self).get_query_set().filter(sex='F')<br /><br />class Person(models.Model):<br />&nbsp;&nbsp;&nbsp; first_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; last_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; sex = models.CharField(max_length=1, choices=(('M', 'Male'), ('F', 'Female')))<br />&nbsp;&nbsp;&nbsp; people = models.Manager()&nbsp; #将objects设置成manager的实例，如不这么做，可用的manager只是men,women<br />&nbsp;&nbsp;&nbsp; men = MaleManager()<br />&nbsp;&nbsp;&nbsp; women = FemaleManager()<br /><br />这个例子允许你执行`` Person.men.all()`` ，`` Person.women.all()`` ，`` Person.people.all()`` 查询，<br /></p><p>注意：Django将会把第一个Manager 定义为默认Manager，你应该小心地选择你的默认manager。因为覆盖get_query_set()</p><p>了，你可能接受到一个无用的返回对像</p><p>&nbsp;</p><p><strong>模型方法</strong></p><p>from django.contrib.localflavor.us.models import USStateField<br />from django.db import models<br />class Person(models.Model):<br />&nbsp;&nbsp;&nbsp; first_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; last_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; birth_date = models.DateField()<br />&nbsp;&nbsp;&nbsp; address = models.CharField(max_length=100)<br />&nbsp;&nbsp;&nbsp; city = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; state = USStateField() # Yes, this is U.S.-centric...<br />&nbsp;&nbsp;&nbsp; def is_midwestern(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Returns True if this person is from the Midwest.&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return self.state in ('IL', 'WI', 'MI', 'IN', 'OH', 'IA', 'MO')<br />&nbsp;&nbsp;&nbsp; def _get_full_name(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Returns the person's full name.&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return u'%s %s' % (self.first_name, self.last_name)<br />&nbsp;&nbsp;&nbsp; full_name = property(_get_full_name) #property ？！</p><p>#调用</p><p>&gt;&gt;&gt; p = Person.objects.get(first_name='Barack', last_name='Obama')<br />&gt;&gt;&gt; p.is_midwestern()<br />&gt;&gt;&gt; p.full_name</p><p><strong>执行原始SQL查询</strong></p><p>有时候你发现Django数据库API带给你的也只有这么多，那你可以写一些自定义SQL查询。 你可以通过导入django.db.connection对像来实现，它代表当前数据库连接。 要使用它，需要通过connection.cursor()得到一个游标对像。 然后，使用cursor.execute(sql,[params])来执行SQL语句，使用cursor.fetchone()或者cursor.fetchall()来返回记录集。 例如:</p><p>from django.db import connection, models<br />class PersonManager(models.Manager):<br />&nbsp;&nbsp;&nbsp; def first_names(self, last_name):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cursor = connection.cursor()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cursor.execute(&quot;&quot;&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SELECT DISTINCT first_name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM people_person<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE last_name = %s&quot;&quot;&quot;, [last_name])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return [row[0] for row in cursor.fetchone()]<br />class Person(models.Model):<br />&nbsp;&nbsp;&nbsp; first_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; last_name = models.CharField(max_length=50)<br />&nbsp;&nbsp;&nbsp; objects = PersonManager()</p><p>#不要把视图代码和django.db.connection语句混杂，把它们放在自定义模型或自定义manager方法中是个不错的主意。</p><p>#使用方法</p><p>&gt;&gt;&gt; Person.objects.first_names('Lennon')<br />['John', 'Cynthia']</p> </div>   <div class="mod-post-info clearfix"> <div class="tag-box clearfix">  <a class=tag href="/tag/Python/feeds">#Python</a>  </div> <div class=op-box>  <a class="report-btn hide" href="#" onclick="return false"> 举报 </a>  <span class=pv>浏览(282)</span> <a class=comment-bnt id=commentBnt href="#" onclick="return false"> 评论<span class=comment-nub></span> </a>   <a href="#" id=shareBnt onclick="return false" class=share-bnt> 转载<span id=shareNub class=share-nub></span> </a>   </div></div>              </div>
    
            <div class="mod-share-detail" id="shareDetail" style="display:none"></div>
            
            <div class="mod-detail-pager clearfix">
                                    <div class="detail-nav-pre">
                       <a href="http://hi.baidu.com/drunkdream/item/aa29966c5dfb4c146995e6df" hidefocus title="上一篇"></a>
                    </div>
                                                    <div class="detail-nav-next">
                        <a  href="http://hi.baidu.com/drunkdream/item/02888308a293ec813d42e2df" hidefocus title="下一篇"></a>
                    </div>
                            </div>
                            <div id="commentDetail" class="mod-comment-detail clearfix">
                    <div class="comment-title">评论</div>
                    <div class="comment-content"></div>
                </div>
                    </div>
    </div>
 </div> </div> </section>  <footer class="mod-footer mod-cs-footer"><div class="clearfix hidden-box"></div><div class=footer-box><div class=inner-box><a href="http://hi.baidu.com/go/show/introduce" target=_blank>帮助中心</a><span>&nbsp;|&nbsp;</span><a href=http://tieba.baidu.com/p/1781683739 target=_blank>空间客服</a><span>&nbsp;|&nbsp;</span><a href=http://tousu.baidu.com/hi/add target=_blank>投诉中心</a><span>&nbsp;|&nbsp;</span><a href=http://www.baidu.com/search/hi_contract.html target=_blank>空间协议</a></div><div class=copy-box>&copy;2012&nbsp;Baidu</div></div></footer>  <script src="http://hi.bdimg.com/static/qbase/js/mod/mod_foot.js?v=267e28ab.js"></script> <script>
        	qing.dom.ready(function(){
				if (qVisitorInfo.loginStatus == 'activated'){
					qext.fn.setStoken();
				}
			});
        </script>     <script>qext.stat.ns('m_20120425_20002');</script> 
    <script src="http://hi.bdimg.com/static/qcomment/js/qcmt_import.js?v=98e733fd.js"></script>	
	<script type="text/javascript">
		window.qIsNotice = '';
		window.qUserInfo.sex = '男';
		window.qUserInfo.age = '26';
		window.qUserInfo.residenceProvince = '';
		window.qUserInfo.residenceCity = '';
		window.qUserInfo.residenceDistrict = '';
	</script>
	
    <script src="http://hi.bdimg.com/static/qhome/js/detail/20001/detail.js?v=17f417db.js"></script>
        <script type="text/javascript" id="bdshare_js" data="type=slide&amp;mini=1&amp;img=4&amp;uid=713670" ></script>
    <script type="text/javascript" id="bdshell_js"></script>
    <script type="text/javascript">
        var bds_config = {'bdTop':240};
                    var all_img = qing.g('content').getElementsByTagName('img');
            if(all_img.length>0){
                bds_config.bdPic = all_img[0].src;
            }
                document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?v=44223225.js?cdnversion=" + new Date().getHours();
		
    </script>
	
     <script>wpo.tti=new Date*1;</script><script>document.write(unescape("%3Cscript src='http://hm.baidu.com/h.js%3F8c869b543955d43e496c2efee5b55823' type='text/javascript'%3E%3C/script%3E"));qext.stat.ns('m_20120713_qing_pv');</script>