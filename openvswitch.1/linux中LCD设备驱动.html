<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>linux中LCD设备驱动（6）——Fbmem.c文件 - 玉中石的专栏 - 博客频道 - CSDN.NET</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="前面几篇主要关注的是LCD驱动在6410平台上的实现，这一篇来说下linux帧缓冲设备驱动的上层建筑Fbmem.c文件。1、先上第一道菜：1.1、那我们现在来说Fbmem.c (linux2.6.28\drivers\video)文件中的应用程序访问帧缓冲设备的接口，大家对下面这些应该都不陌生吧。：/**&#160;* fbmem_init - init frame buffer s" />
<script src="http://static.blog.csdn.net/scripts/jquery.js" type="text/javascript"></script>
<script type="text/javascript" src="http://static.blog.csdn.net/scripts/ad.js?v=1.1"></script>
<link rel="Stylesheet" type="text/css" href="http://static.blog.csdn.net/skin/default/css/style.css?v=1.1" />
<link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="/tianxiawuzhei/rss/list" />
<link rel="shortcut icon" href="/favicon.ico" />
<link type="text/css" rel="stylesheet" href="http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/default.css" />
</head>
<body>
<script src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"type="text/javascript"></script>

<div id="container">
<div id="header">
    <div class="header">
        <div id="blog_title">
            <h1><a href="/tianxiawuzhei">玉中石的专栏</a></h1>
            <h2>知识源于思考</h2>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
    </div>
</div>
<div id="navigator">
    <div class="navigator_bg"></div>
    <div class="navigator">
        <ul>
            <li id="btnContents"><a href="/tianxiawuzhei?viewmode=contents"><span><img src="http://static.blog.csdn.net/images/ico_list.gif">目录视图</span></a></li>
            <li id="btnView"><a href="/tianxiawuzhei?viewmode=list"><span><img src="http://static.blog.csdn.net/images/ico_summary.gif">摘要视图</span></a></li>
            <li id="btnRss"><a href="/tianxiawuzhei/rss/list"><span><img src="http://static.blog.csdn.net/images/ico_rss.gif">订阅</span></a></li>
</ul>
    </div>
</div>
<script type="text/javascript">
    var username = "tianxiawuzhei";
    var _blogger = username;
    var blog_address = "http://blog.csdn.net/tianxiawuzhei";
    var static_host = "http://static.blog.csdn.net";
    var currentUserName = "";
</script>

<div id="body">
<div id="main">
<div class="main">
<div class="notice"> 

<a href="http://blog.csdn.net/blogdevteam/article/details/8899926" target="_blank">
<font color=red>有奖征集活动系列——【HTML5游戏编程之旅】 
   </font></a>



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://www.csdn.net/article/2013-05-13/2815252" target="_blank"><font color=blue>专访雷果国：我从1.5K到18K的成长之路 
</font></a>

&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://blog.csdn.net/blogdevteam/article/details/8863634" target="_blank"><font color=red>【限时优惠】第五届云计算大会社区门票抢购




</font></a>

<br />





<a href="http://events.csdn.net/wy/APC/invite.html
"target="_blank">
<font color=red>探究云计算数据中心节能增效之道


 </font></a>

&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://blog.csdn.net/blogdevteam/article/details/8900468 "target="_blank">
<font color=red>CSDN博客第一期云计算最佳博主评选
 </font></a>


&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://blog.csdn.net/blogdevteam/article/details/8853291"target="_blank">
<font color=blue>CSDN博客第二期最佳移动开发博主评选
 </font></a>




</div>
<div id="article_details" class="details">
    <div class="article_title">
    <span class="ico ico_type_Original"></span>
    <h3>
        <span class="link_title"><a href="/tianxiawuzhei/article/details/7602956">
        linux中LCD设备驱动（6）——Fbmem.c文件
        </a></span>
    </h3>
</div>

        
    <div class="article_manage">
        <span class="link_categories">
        分类：
            <a href="/tianxiawuzhei/article/category/1079275">linux驱动</a> 
        </span>
    <span class="link_postdate">2012-05-25 22:02</span>
    <span class="link_view" title="阅读次数">885人阅读</span>
    <span class="link_comments" title="评论次数"><a href="#comments">评论</a>(0)</span>
    <span class="link_collect"><a href="javascript:void(0);" onclick="javascript:collectArticle('linux中LCD设备驱动（6）——Fbmem.c文件','7602956');return false;" title="收藏">收藏</a></span>
    <span class="link_report"><a href="#report"  onclick="javascript:report(7602956,2);return false;" title="举报">举报</a></span>
    
</div>
<div class="tag2box"><a href='http://blog.csdn.net/tag/details.html?tag=linux' target=_blank>linux</a><a href='http://blog.csdn.net/tag/details.html?tag=struct' target=_blank>struct</a><a href='http://blog.csdn.net/tag/details.html?tag=user' target=_blank>user</a><a href='http://blog.csdn.net/tag/details.html?tag=module' target=_blank>module</a><a href='http://blog.csdn.net/tag/details.html?tag=file' target=_blank>file</a><a href='http://blog.csdn.net/tag/details.html?tag=buffer' target=_blank>buffer</a></div>


    
<div id="article_content" class="article_content">

<p><span style="font-size:18px">前面几篇主要关注的是LCD驱动在6410平台上的实现，这一篇来说下linux帧缓冲设备驱动的上层建筑<span style="font-size:18px">Fbmem.c文件</span>。</span></p>
<p><span style="font-size:18px"><span style="color:#cc0000">1、</span>先上第一道菜：</span></p>
<p><span style="font-size:18px"><img src="http://my.csdn.net/uploads/201205/25/1337943045_6840.jpg" alt=""><br>
</span></p>
<p><span style="font-size:18px"><span style="color:#990000">1.1、</span>那我们现在来说Fbmem.c (linux2.6.28\drivers\video)文件中的应用程序访问帧缓冲设备的接口，大家对下面这些应该都不陌生吧。：</span></p>
<p><span style="font-size:18px">/**<br>
&nbsp;*<span style="white-space:pre"> </span>fbmem_init - init frame buffer subsystem<br>
&nbsp;*<br>
&nbsp;*<span style="white-space:pre"> </span>Initialize the frame buffer subsystem.<br>
&nbsp;*<br>
&nbsp;*<span style="white-space:pre"> </span>NOTE: This function is _only_ to be called by drivers/char/mem.c.<br>
&nbsp;*<br>
&nbsp;*/<br>
static int __init<br>
fbmem_init(void)<br>
{<br>
<span style="white-space:pre"></span>proc_create(&quot;fb&quot;, 0, NULL, &amp;fb_proc_fops);看名字就知道与proc文件系统有关，其中<span style="font-size:18px">fb_proc_fops是个<span style="font-size:18px">file_operations的结构体，在同一个文件中定义。</span></span></span></p>
<p><span style="font-size:16px">static const struct file_operations fb_proc_fops = {<br>
<span style="white-space:pre"></span>.owner<span style="white-space:pre"> </span>
= THIS_MODULE,<br>
<span style="white-space:pre"></span>.open<span style="white-space:pre"> </span>= proc_fb_open,<br>
<span style="white-space:pre"></span>.read<span style="white-space:pre"> </span>= seq_read,<br>
<span style="white-space:pre"></span>.llseek<span style="white-space:pre"> </span>
= seq_lseek,<br>
<span style="white-space:pre"></span>.release<span style="white-space:pre"> </span>
= seq_release,<br>
};</span></p>
<p><span style="font-size:18px">对应的&nbsp;open函数实例proc_fb_open源码如下：</span></p>
<p><span style="font-size:16px">static int proc_fb_open(struct inode *inode, struct file *file)<br>
{<br>
<span style="white-space:pre"></span>return seq_open(file, &amp;proc_fb_seq_ops);<br>
}</span></p>
<p><span style="font-size:18px">同样proc_fb_seq_ops是seq_operations类型的结构体实例。如下所示：</span></p>
<p><span style="font-size:16px"><span style="font-size:16px">static const struct seq_operations proc_fb_seq_ops = {<br>
<span style="white-space:pre"></span>.start<span style="white-space:pre"> </span>
= fb_seq_start,<br>
<span style="white-space:pre"></span>.next<span style="white-space:pre"> </span>= fb_seq_next,<br>
<span style="white-space:pre"></span>.stop<span style="white-space:pre"> </span>= fb_seq_stop,<br>
<span style="white-space:pre"></span>.show<span style="white-space:pre"> </span>= fb_seq_show,<br>
};<br>
</span></span></p>
<p><span style="font-size:18px">这些函数都在这个文件中被定义，现在想想fbmem.c文件已经被我们去掉很多东西了。</span></p>
<p><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (register_chrdev(FB_MAJOR,&quot;fb&quot;,&amp;fb_fops))这个函数就太常见了，字符设备一出现，就肯定会出现，不过以前我们有时看到的是分开的那三个函数，现在把它们和在一起了。</span></p>
<p><span style="font-size:18px">其中<span style="font-size:18px">fb_fops是file_operations结构体的实例，如下所示：</span></span></p>
<p><span style="font-size:18px">static const struct file_operations fb_fops = {<br>
<span style="white-space:pre"></span>.owner =<span style="white-space:pre"> </span>
THIS_MODULE,<br>
<span style="white-space:pre"></span>.read =<span style="white-space:pre"> </span>
fb_read,<br>
<span style="white-space:pre"></span>.write =<span style="white-space:pre"> </span>
fb_write,<br>
<span style="white-space:pre"></span>.unlocked_ioctl = fb_ioctl,<br>
#ifdef CONFIG_COMPAT<br>
<span style="white-space:pre"></span>.compat_ioctl = fb_compat_ioctl,<br>
#endif<br>
<span style="white-space:pre"></span>.mmap =<span style="white-space:pre"> </span>
fb_mmap,<br>
<span style="white-space:pre"></span>.open =<span style="white-space:pre"> </span>
fb_open,<br>
<span style="white-space:pre"></span>.release =<span style="white-space:pre"> </span>
fb_release,<br>
#ifdef HAVE_ARCH_FB_UNMAPPED_AREA<br>
<span style="white-space:pre"></span>.get_unmapped_area = get_fb_unmapped_area,<br>
#endif<br>
#ifdef CONFIG_FB_DEFERRED_IO<br>
<span style="white-space:pre"></span>.fsync =<span style="white-space:pre"> </span>
fb_deferred_io_fsync,<br>
#endif<br>
};<br>
</span><span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">printk(&quot;unable to get major %d for fb devs\n&quot;, FB_MAJOR);</span><br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">fb_class = class_create(THIS_MODULE, &quot;graphics&quot;);创建一个类</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (IS_ERR(fb_class)) {</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">printk(KERN_WARNING &quot;Unable to create fb class; errno = %ld\n&quot;, PTR_ERR(fb_class));</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">fb_class = NULL;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">}</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return 0;</span><br>
<span style="font-size:18px">}</span><br>
</p>
<p><span style="font-size:18px"><span style="color:#cc0000">module_init(fbmem_init);</span><br>
static void __exit<br>
fbmem_exit(void) &nbsp;做和init函数相反的事。<br>
{<br>
<span style="white-space:pre"></span>remove_proc_entry(&quot;fb&quot;, NULL);<br>
<span style="white-space:pre"></span>class_destroy(fb_class);<br>
<span style="white-space:pre"></span>unregister_chrdev(FB_MAJOR, &quot;fb&quot;);<br>
}<br>
<br>
<span style="color:#cc0000">module_exit(fbmem_exit);</span><br>
</span></p>
<p><span style="font-size:18px"><span style="color:#cc0000">2、</span>在Fbmem.c (linux2.6.28\drivers\video)文件中还有很多函数是关于LOGO显示的，这个我们也不用关心，所以其实在这个文件中我们主要关心的就是<span style="font-size:18px">struct file_operations fb_fops这个结构体中的函数。</span></span></p>
<p><span style="font-size:18px"><span style="font-size:18px"><span style="color:#990000">2.1、</span>简要分析几个<span style="font-size:18px">struct file_operations fb_fops结构体中的函数：</span></span></span></p>
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">先来看fb_read函数，源码如下：</span></span></span></p>
<p><span style="font-size:18px"><span style="font-size:18px"><span style="font-size:18px">static ssize_t<br>
fb_read(struct file *file, char __user *buf, size_t count, loff_t *ppos)<br>
{<br>
<span style="white-space:pre"></span>unsigned long p = *ppos;<br>
<span style="white-space:pre"></span>struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;<br>
<span style="white-space:pre"></span>int fbidx = iminor(inode);这个函数看下面的源码，应该知道它的作用了：</span></span></span></p>
<p><span style="font-size:16px">static inline unsigned iminor(const struct inode *inode)<br>
{<br>
<span style="white-space:pre"></span>return MINOR(inode-&gt;i_rdev);<br>
}</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">struct fb_info *info = registered_fb[fbidx];这个全局的结构数组，我们以前说过</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">u32 *buffer, *dst;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">u32 __iomem *src;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">int c, i, cnt = 0, err = 0;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">unsigned long total_size;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (!info || ! info-&gt;screen_base)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return -ENODEV;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (info-&gt;state != FBINFO_STATE_RUNNING)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return -EPERM;</span><br>
<br>
<br>
<span style="color:rgb(204,0,0); font-size:18px; white-space:pre"></span><span style="font-size:18px"><span style="color:#cc0000">if (info-&gt;fbops-&gt;fb_read)
</span>如果定义了fb_read函数，</span><span style="font-size:18px"><span style="font-size:18px">就调用具体的read函数，也就是我们在前面说过的<span style="font-size:18px; white-space:pre">
</span>&nbsp;&nbsp;</span></span></p>
<p><span style="font-size:18px"><span style="font-size:18px">&nbsp; &nbsp; &nbsp;<span style="font-size:18px; white-space:pre">fb_ops s3cfb_ops</span>结构体中定义的函数。</span></span><br>
<span style="color:rgb(204,0,0); font-size:18px; white-space:pre"></span><span style="font-size:18px; color:rgb(204,0,0)">return info-&gt;fbops-&gt;fb_read(info, buf, count, ppos);</span></p>
<p><span style="font-size:16px; white-space:pre"></span><span style="font-size:16px; white-space:pre">struct fb_ops s3cfb_ops = {</span></p>
<p><span style="white-space:pre"><span style="font-size:16px"><span style="white-space:pre"></span>.owner<span style="white-space:pre">
</span>= THIS_MODULE,<br>
<span style="white-space:pre"></span>.fb_check_var<span style="white-space:pre"> </span>
= s3cfb_check_var,<br>
<span style="white-space:pre"></span>.fb_set_par<span style="white-space:pre"> </span>
= s3cfb_set_par,<br>
<span style="white-space:pre"></span>.fb_blank<span style="white-space:pre"> </span>
= s3cfb_blank,<br>
<span style="white-space:pre"></span>.fb_pan_display<span style="white-space:pre">
</span>= s3cfb_pan_display,<br>
<span style="white-space:pre"></span>.fb_setcolreg<span style="white-space:pre"> </span>
= s3cfb_setcolreg,<br>
<span style="white-space:pre"></span>.fb_fillrect<span style="white-space:pre"> </span>
= cfb_fillrect,<br>
<span style="white-space:pre"></span>.fb_copyarea<span style="white-space:pre"> </span>
= cfb_copyarea,<br>
<span style="white-space:pre"></span>.fb_imageblit<span style="white-space:pre"> </span>
= cfb_imageblit,<br>
<span style="white-space:pre"></span>.fb_cursor<span style="white-space:pre"> </span>
= soft_cursor,<br>
<span style="white-space:pre"></span>.fb_ioctl<span style="white-space:pre"> </span>
= s3cfb_ioctl,<br>
};</span></span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">total_size = info-&gt;screen_size;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (total_size == 0)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">total_size = info-&gt;fix.smem_len;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (p &gt;= total_size)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return 0;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (count &gt;= total_size)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">count = total_size;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (count &#43; p &gt; total_size)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">count = total_size - p;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">buffer = kmalloc((count &gt; PAGE_SIZE) ? PAGE_SIZE : count,</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">GFP_KERNEL);</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (!buffer)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return -ENOMEM;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">src = (u32 __iomem *) (info-&gt;screen_base &#43; p);</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (info-&gt;fbops-&gt;fb_sync)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">info-&gt;fbops-&gt;fb_sync(info);</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">while (count) {</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">c &nbsp;= (count &gt; PAGE_SIZE) ? PAGE_SIZE : count;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">dst = buffer;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">for (i = c &gt;&gt; 2; i--; )</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">*dst&#43;&#43; = fb_readl(src&#43;&#43;);</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if (c &amp; 3) {</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">u8 *dst8 = (u8 *) dst;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">u8 __iomem *src8 = (u8 __iomem *) src;</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">for (i = c &amp; 3; i--;)</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">*dst8&#43;&#43; = fb_readb(src8&#43;&#43;);</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">src = (u32 __iomem *) src8;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">}</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">if
<span style="color:#006600">(copy_to_user(buf, buffer, c)</span>) {</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">err = -EFAULT;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">break;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">}</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">*ppos &#43;= c;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">buf &#43;= c;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">cnt &#43;= c;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">count -= c;</span><br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">}</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">kfree(buffer);</span><br>
<br>
<br>
<span style="font-size:18px; white-space:pre"></span><span style="font-size:18px">return (err) ? err : cnt;</span><br>
<span style="font-size:18px">}</span><br>
</p>
<p><span style="font-size:18px"><span style="color:#990000">2.2、</span>fb_ioctl函数：源码如下：</span></p>
<p><span style="font-size:18px">static long fb_ioctl(struct file *file, unsigned int cmd, unsigned long arg)<br>
__acquires(&amp;info-&gt;lock)<br>
__releases(&amp;info-&gt;lock)<br>
{<br>
<span style="white-space:pre"></span>struct inode *inode = file-&gt;f_path.dentry-&gt;d_inode;<br>
<span style="white-space:pre"></span>int fbidx = iminor(inode);<br>
<span style="white-space:pre"></span>struct fb_info *info;<br>
<span style="white-space:pre"></span>long ret;<br>
<br>
<br>
<span style="white-space:pre"></span>info = registered_fb[fbidx];<br>
<span style="white-space:pre"></span>mutex_lock(&amp;info-&gt;lock);<br>
<span style="white-space:pre"></span>ret =<span style="color:#cc0000"> do_fb_ioctl</span>(info, cmd, arg);</span></p>
<p><span style="font-size:18px">此函数源码如下：</span></p>
<p><span style="font-size:18px">static long <span style="color:#cc0000">do_fb_ioctl</span>(struct fb_info *info, unsigned int cmd,<br>
<span style="white-space:pre"></span>unsigned long arg)<br>
{<br>
<span style="white-space:pre"></span>struct fb_ops *fb;<br>
<span style="white-space:pre"></span>struct fb_var_screeninfo var;<br>
<span style="white-space:pre"></span>struct fb_fix_screeninfo fix;<br>
<span style="white-space:pre"></span>struct fb_con2fbmap con2fb;<br>
<span style="white-space:pre"></span>struct fb_cmap_user cmap;<br>
<span style="white-space:pre"></span>struct fb_event event;<br>
<span style="white-space:pre"></span>void __user *argp = (void __user *)arg;<br>
<span style="white-space:pre"></span>long ret = 0;<br>
<br>
<br>
<span style="white-space:pre"></span><span style="color:#006600">fb = info-&gt;fbops;</span><br>
<span style="white-space:pre"></span>if (!fb)<br>
<span style="white-space:pre"></span>return -ENODEV;<br>
<br>
<br>
<span style="white-space:pre"></span><span style="color:#000099">switch (cmd)</span> {<br>
<span style="white-space:pre"></span>case FBIOGET_VSCREENINFO: &nbsp;获得可变的屏幕参数<br>
<span style="white-space:pre"></span>ret = copy_to_user(argp, &amp;info-&gt;var,<br>
<span style="white-space:pre"></span>&nbsp; &nbsp;sizeof(var)) ? -EFAULT : 0;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOPUT_VSCREENINFO:设置可变的屏幕参数<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;var, argp, sizeof(var))) {<br>
<span style="white-space:pre"></span>ret = &nbsp;-EFAULT;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>acquire_console_sem();<br>
<span style="white-space:pre"></span>info-&gt;flags |= FBINFO_MISC_USEREVENT;<br>
<span style="white-space:pre"></span>ret = fb_set_var(info, &amp;var);<br>
<span style="white-space:pre"></span>info-&gt;flags &amp;= ~FBINFO_MISC_USEREVENT;<br>
<span style="white-space:pre"></span>release_console_sem();<br>
<span style="white-space:pre"></span>if (ret == 0 &amp;&amp; copy_to_user(argp, &amp;var, sizeof(var)))<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOGET_FSCREENINFO:获得固定的屏幕参数设置<br>
<span style="white-space:pre"></span>ret = copy_to_user(argp, &amp;info-&gt;fix,<br>
<span style="white-space:pre"></span>&nbsp; &nbsp;sizeof(fix)) ? -EFAULT : 0;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOPUTCMAP:设置颜色表<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;cmap, argp, sizeof(cmap)))<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>else<br>
<span style="white-space:pre"></span>ret = fb_set_user_cmap(&amp;cmap, info);<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOGETCMAP: 获得颜色表<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;cmap, argp, sizeof(cmap)))<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>else<br>
<span style="white-space:pre"></span>ret = fb_cmap_to_user(&amp;info-&gt;cmap, &amp;cmap);<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOPAN_DISPLAY:<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;var, argp, sizeof(var))) {<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>acquire_console_sem();<br>
<span style="white-space:pre"></span>ret = fb_pan_display(info, &amp;var);<br>
<span style="white-space:pre"></span>release_console_sem();<br>
<span style="white-space:pre"></span>if (ret == 0 &amp;&amp; copy_to_user(argp, &amp;var, sizeof(var)))<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIO_CURSOR:<br>
<span style="white-space:pre"></span>ret = -EINVAL;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOGET_CON2FBMAP:<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;con2fb, argp, sizeof(con2fb)))<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>else if (con2fb.console &lt; 1 || con2fb.console &gt; MAX_NR_CONSOLES)<br>
<span style="white-space:pre"></span>ret = -EINVAL;<br>
<span style="white-space:pre"></span>else {<br>
<span style="white-space:pre"></span>con2fb.framebuffer = -1;<br>
<span style="white-space:pre"></span>event.info = info;<br>
<span style="white-space:pre"></span>event.data = &amp;con2fb;<br>
<span style="white-space:pre"></span>fb_notifier_call_chain(FB_EVENT_GET_CONSOLE_MAP,<br>
<span style="white-space:pre"></span>&amp;event);<br>
<span style="white-space:pre"></span>ret = copy_to_user(argp, &amp;con2fb,<br>
<span style="white-space:pre"></span>&nbsp; &nbsp;sizeof(con2fb)) ? -EFAULT : 0;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOPUT_CON2FBMAP:<br>
<span style="white-space:pre"></span>if (copy_from_user(&amp;con2fb, argp, sizeof(con2fb))) {<br>
<span style="white-space:pre"></span>ret = -EFAULT;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>if (con2fb.console &lt; 1 || con2fb.console &gt; MAX_NR_CONSOLES) {<br>
<span style="white-space:pre"></span>ret = -EINVAL;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>if (con2fb.framebuffer &lt; 0 || con2fb.framebuffer &gt;= FB_MAX) {<br>
<span style="white-space:pre"></span>ret = -EINVAL;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>if (!registered_fb[con2fb.framebuffer])<br>
<span style="white-space:pre"></span>request_module(&quot;fb%d&quot;, con2fb.framebuffer);<br>
<span style="white-space:pre"></span>if (!registered_fb[con2fb.framebuffer]) {<br>
<span style="white-space:pre"></span>ret = -EINVAL;<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>event.info = info;<br>
<span style="white-space:pre"></span>event.data = &amp;con2fb;<br>
<span style="white-space:pre"></span>ret = fb_notifier_call_chain(FB_EVENT_SET_CONSOLE_MAP,<br>
<span style="white-space:pre"></span>&nbsp; &nbsp; &nbsp;&amp;event);<br>
<span style="white-space:pre"></span>break;<br>
<span style="white-space:pre"></span>case FBIOBLANK:<br>
<span style="white-space:pre"></span>acquire_console_sem();<br>
<span style="white-space:pre"></span>info-&gt;flags |= FBINFO_MISC_USEREVENT;<br>
<span style="white-space:pre"></span>ret = fb_blank(info, arg);<br>
<span style="white-space:pre"></span>info-&gt;flags &amp;= ~FBINFO_MISC_USEREVENT;<br>
<span style="white-space:pre"></span>release_console_sem();<br>
<span style="white-space:pre"></span>break;;<br>
<span style="white-space:pre"></span>default:<br>
<span style="white-space:pre"></span>if (fb-&gt;fb_ioctl == NULL)<br>
<span style="white-space:pre"></span>ret = -ENOTTY;<br>
<span style="white-space:pre"></span>else<br>
<span style="white-space:pre"></span>ret = fb-&gt;fb_ioctl(info, cmd, arg);<br>
<span style="white-space:pre"></span>}<br>
<span style="white-space:pre"></span>return ret;<br>
}<br>
<span style="white-space:pre"></span>mutex_unlock(&amp;info-&gt;lock);<br>
<span style="white-space:pre"></span>return ret;<br>
}<br>
</span></p>
<p><span style="font-size:18px">fb_mem.c文件分析到这里差不多也结束了，当然，我们还有很多没分析，只是分析了一小部分，但是这个文件的大致结构和作用我们应该清楚了。</span></p>
<p><span style="font-size:18px">在这个文件中其他重要的函数，我们都没有分析，如：fb_mmap、register_framebuffer、unregister_framebuffer函数等等，后面这两个函数，我们前面有涉及，所以，要走的路还有很长。</span></p>
<p><span style="font-size:18px"><br>
</span></p>
<p><span style="font-size:18px"><br>
</span></p>
<p><span style="font-size:18px"><br>
</span></p>

</div>

<div class="share_buttons" id="sharePanel"></div>
<!--192.168.1.237-->
<div class="article_next_prev">
    <li class="prev_article"><span>上一篇：</span><a href="/tianxiawuzhei/article/details/7603163">Documentation/fb目录中帮助文档的索引</a></li>
    <li class="next_article"><span>下一篇：</span><a href="/tianxiawuzhei/article/details/7604035">s3c6410硬件ADC &amp; TOUCH SCREEN INTERFACE（AD转化和触摸屏接口）</a></li>
</div>


            <div id="digg" ArticleId="7602956">
            <dl id="btnDigg" class="digg digg_disable">
                <dt>顶</dt>
                <dd>0</dd>
            </dl>
            <dl id="btnBury" class="digg digg_disable">
                <dt>踩</dt>
                <dd>1</dd>
            </dl>
        </div>

</div>
<div id="ad_cen">
<script type="text/javascript" >BAIDU_CLB_SLOT_ID = "117306";</script>
<script type="text/javascript" src="http://cbjs.baidu.com/js/o.js"></script>
</div>
<script type="text/javascript">
    //new Ad(4, 'ad_cen');
</script>
<div id="comment_title" class="panel_head">查看评论<a name="comments"></a></div>
<div id="comment_list"></div>
<div id="comment_bar"></div>
<div id="comment_form"></div>
<div class="announce">* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a name="reply"></a><a name="quote"></a></div>
<script type="text/javascript">
    var fileName = '7602956';
    var commentscount = 0;
    var islock = false
</script>
<script type="text/javascript" src="http://static.blog.csdn.net/scripts/comment.js"></script>
<div id="ad_bot"></div>
<script type="text/javascript">
    new Ad(5, 'ad_bot');
</script>
<div id="report_dialog"></div>

<div id="d-top" style="display:none;">
<a id="d-top-a" href="#" title="回到顶部">
<img src="http://static.blog.csdn.net/images/top.png" alt="TOP" /></a>
</div>
<script type="text/javascript">
    $(function(){
        var d_top=$('#d-top');
        document.onscroll=function(){
            var scrTop=(document.body.scrollTop||document.documentElement.scrollTop);
            if(scrTop>500){
                d_top.show();
            }else{
                d_top.hide();
            }
        }
        $('#d-top-a').click(function(){
            scrollTo(0,0);
            this.blur();
            return false;
        });
    });
</script>

<div class="clear"></div>
</div>
</div>

<div id="side">
<div class="side">
<div id="panel_Profile" class="panel">
<ul class="panel_head"><span>个人资料</span></ul>
<ul class="panel_body profile">
<div id="blog_userface">
    <a href="http://my.csdn.net/tianxiawuzhei" target="_blank">
    <img src="http://avatar.csdn.net/4/8/3/1_tianxiawuzhei.jpg" title="访问我的空间" style="max-width:90%"/>
    </a>
    <br />
    <span><a href="http://my.csdn.net/tianxiawuzhei" class="user_name" target="_blank">tianxiawuzhei</a></span>
</div>
<div class="interact">
<a href="javascript:void(0);" class="attent" id="span_add_follow" title="[加关注]"></a>
<a href="javascript:void(0);" class="letter" onclick="loginto(1)" title="[发私信]"></a>
</div>
<div id="blog_medal">
</div>
<ul id="blog_rank">
    <li>访问：<span>110084次</span></li>
    <li>积分：<span>2469分</span></li>
    <li>排名：<span>第2781名</span></li>
</ul>
<ul id="blog_statistics">
    <li>原创：<span>128篇</span></li>
    <li>转载：<span>33篇</span></li>
    <li>译文：<span>9篇</span></li>
    <li>评论：<span>23条</span></li>
</ul>
</ul>
</div>



<div class="panel" id="panel_Search">
    <ul class="panel_head"><span>文章搜索</span></ul>
    <ul class="panel_body">
        <form id="frmSearch" action="http://so.csdn.net/search" class="form_search" target="_blank">
        <span><input id="inputSearch" type="text" class="blogsearch" title="请输入关键字" /></span>
        <input id="btnSubmit" type="submit" value="搜索" title="search in blog" />
        <input type="hidden" name="q" id="inputQ" />
        <input type="hidden" name="t" value="blog" />
        <a id="btnSearchBlog" target="_blank"></a>
        </form>
    </ul>
</div><div id="panel_Category" class="panel">
    <ul class="panel_head"><span>博客专栏</span></ul>
    <ul class="panel_body" id="sp_column">
    <table cellpadding="0" cellspacing="0"><tr>
    <td style="padding:10px 10px 0 0;">
    <a href="http://blog.csdn.net/column/details/boot-and-load.html" target="_blank"><img src="http://avatar.csdn.net/blogpic/20120616192642832.jpg" style="width:75px;height:75px;" /></a>
    </td>
    <td style="padding:10px 0; vertical-align:top;">
    <a href="http://blog.csdn.net/column/details/boot-and-load.html" target="_blank">三星uboot-1.1.6源码分析</a>
    <p>文章：7篇</p>
    <span>阅读：6127</span>
    </td>
    </tr></table>
    <table cellpadding="0" cellspacing="0"><tr>
    <td style="padding:10px 10px 0 0;">
    <a href="http://blog.csdn.net/column/details/linux-device-drivers.html" target="_blank"><img src="http://avatar.csdn.net/blogpic/20120525233123683.jpg" style="width:75px;height:75px;" /></a>
    </td>
    <td style="padding:10px 0; vertical-align:top;">
    <a href="http://blog.csdn.net/column/details/linux-device-drivers.html" target="_blank">s3c6410平台的linux驱动分析</a>
    <p>文章：31篇</p>
    <span>阅读：28868</span>
    </td>
    </tr></table>
    </ul>
</div><div id="panel_Category" class="panel">
<ul class="panel_head"><span>文章分类</span></ul>
<ul class="panel_body">
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1079275">linux驱动</a><span>(71)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1081516">X86 linux</a><span>(10)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1090526">U-boot</a><span>(41)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1090529">工具</a><span>(2)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1091212">桌面linux</a><span>(6)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1115001">arm</a><span>(17)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1131928">linux内核</a><span>(7)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1139902">杂谈</a><span>(14)</span>
</li>
<li>
<a href="http://blog.csdn.net/tianxiawuzhei/article/category/1308160">C/C++</a><span>(1)</span>
</li>
</ul>
</div><div id="hotarticls" class="panel">
<ul class="panel_head"><span>阅读排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="/tianxiawuzhei/article/details/7264873" title="linux串口驱动分析">linux串口驱动分析</a><span>(5683)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7264953" title="Linux串口（serial、uart）驱动程序设计">Linux串口（serial、uart）驱动程序设计</a><span>(2259)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7593292" title="linux中LCD设备驱动（1）——framebuffer(帧缓冲)">linux中LCD设备驱动（1）——framebuffer(帧缓冲)</a><span>(1902)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7561294" title="Linux下s3c6410的GPIO操作（1）">Linux下s3c6410的GPIO操作（1）</a><span>(1678)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7558451" title="s3c6410的UART设备驱动(1)">s3c6410的UART设备驱动(1)</a><span>(1427)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7604927" title="linux中触摸屏驱动的实现（1）——基于s3c6410处理器">linux中触摸屏驱动的实现（1）——基于s3c6410处理器</a><span>(1391)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7518126" title="linux串口驱动——s3c6410平台（一）">linux串口驱动——s3c6410平台（一）</a><span>(1381)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7490984" title="ARM-linux内存管理">ARM-linux内存管理</a><span>(1353)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7667383" title="三星uboot1.1.6源码分析——start.s（1）">三星uboot1.1.6源码分析——start.s（1）</a><span>(1298)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7720286" title="s3c6410 uboot代码分析《二》">s3c6410 uboot代码分析《二》</a><span>(1237)</span>
</li>
</ul>
</div>
<div id="hotarticls2" class="panel">
<ul class="panel_head"><span>评论排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="/tianxiawuzhei/article/details/7606709" title="linux驱动——input输入子系统（3）——evdev">linux驱动——input输入子系统（3）——evdev</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7264953" title="Linux串口（serial、uart）驱动程序设计">Linux串口（serial、uart）驱动程序设计</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7604035" title="s3c6410硬件ADC &amp; TOUCH SCREEN INTERFACE（AD转化和触摸屏接口）">s3c6410硬件ADC &amp; TOUCH SCREEN INTERFACE（AD转化和触摸屏接口）</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7671424" title="三星uboot1.1.6源码分析——start.s（4）——从NAND复制源码到RAM（3）">三星uboot1.1.6源码分析——start.s（4）——从NAND复制源码到RAM（3）</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7598918" title="linux中LCD设备驱动（3）——基于s3c6410平台">linux中LCD设备驱动（3）——基于s3c6410平台</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7562488" title="Linux下s3c6410的GPIO操作（5）">Linux下s3c6410的GPIO操作（5）</a><span>(2)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7582390" title="s3c6410硬件RTC（实时时钟）">s3c6410硬件RTC（实时时钟）</a><span>(1)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7605397" title="linux中触摸屏驱动的实现（3）——基于s3c6410处理器">linux中触摸屏驱动的实现（3）——基于s3c6410处理器</a><span>(1)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7538057" title="Linux书籍9——Linux操作系统之奥秘(第2版)">Linux书籍9——Linux操作系统之奥秘(第2版)</a><span>(1)</span>
</li>
<li>
<a href="/tianxiawuzhei/article/details/7606020" title="linux驱动——input输入子系统（1）—输入子系统核心层（Input Core）">linux驱动——input输入子系统（1）—输入子系统核心层（Input Core）</a><span>(1)</span>
</li>
</ul>
</div>
<div id="newcomments" class="panel">
<ul class="panel_head"><span>最新评论</span></ul>
<ul class="panel_body itemlist">
    <li>
    <a href="/tianxiawuzhei/article/details/7582390#comments">s3c6410硬件RTC（实时时钟）</a>
    <p style="margin:0px;"><a href="/tdr3726108" class="user_name">tdr3726108</a>:
您好，可不可以问您一个问题，我最近在调一个6410的板子，想从SD卡启动，SD卡的card dete...
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7598918#comments">linux中LCD设备驱动（3）——基于s3c6410平台</a>
    <p style="margin:0px;"><a href="/tianxiawuzhei" class="user_name">tianxiawuzhei</a>:
谢谢楼上
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7598918#comments">linux中LCD设备驱动（3）——基于s3c6410平台</a>
    <p style="margin:0px;"><a href="/windseeker520" class="user_name">windseeker520</a>:
S3CFB_NUM的含义比较简单，drivers/video/s3c/s3cfb.h里面定义的#de...
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7604927#comments">linux中触摸屏驱动的实现（1）——基于s3c6410处理器</a>
    <p style="margin:0px;"><a href="/kangear" class="user_name">kangear</a>:
明明“resol_bit = 10”可是打印出来的是：”S5P TouchScreen got lo...
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7605397#comments">linux中触摸屏驱动的实现（3）——基于s3c6410处理器</a>
    <p style="margin:0px;"><a href="/kangear" class="user_name">kangear</a>:
请问：if (ts-&gt;count &lt; (1&lt;shift)) {     如果缓冲区未满，再次激活AD...
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7537268#comments">Linux书籍4——Linux设备驱动开发详解（第二版）</a>
    <p style="margin:0px;"><a href="/zhangzhixxm" class="user_name">zhangzhixxm</a>:
买了这本书，我找不到源码在哪，哎
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/7264953#comments">Linux串口（serial、uart）驱动程序设计</a>
    <p style="margin:0px;"><a href="/fwh20" class="user_name">fwh20</a>:
弱弱问下，申请串口一些必要的资源,如IO端口/IO内存资源，有什么用？？
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/8104771#comments">大四了，找工作中</a>
    <p style="margin:0px;"><a href="/skyandcode" class="user_name">skyandcode</a>:
呵呵，我是大三的而已。。。
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/8104771#comments">大四了，找工作中</a>
    <p style="margin:0px;"><a href="/tianxiawuzhei" class="user_name">tianxiawuzhei</a>:
你怎么知道？校友？
    </p>
    </li>
    <li>
    <a href="/tianxiawuzhei/article/details/8104771#comments">大四了，找工作中</a>
    <p style="margin:0px;"><a href="/tianxiawuzhei" class="user_name">tianxiawuzhei</a>:
是
    </p>
    </li>
</ul>
</div>
</div>
<div class="clear"></div>
</div>

<div class="clear"></div>
</div>

<script type="text/javascript" src="http://static.blog.csdn.net/scripts/newblog.min.js?v=1.1"></script>
<script type="text/javascript" src="http://medal.blog.csdn.net/showblogmedal.ashx?blogid=1197985"></script>

<script type="text/javascript">
document.write('<script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js?' + Math.floor(new Date()/120000).toString(36) + '="></'+'script>');
</script>

<script type="text/javascript" src="http://passport.csdn.net/content/loginbox/login.js"></script>
<script type="text/javascript">document.write("<img src=http://counter.csdn.net/pv.aspx?id=24 border=0 width=0 height=0>");</script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js?v=1"></script>


<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-blog.js"></script>

</div>
</body>
</html>