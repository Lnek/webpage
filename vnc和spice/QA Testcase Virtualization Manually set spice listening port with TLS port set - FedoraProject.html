<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="generator" content="MediaWiki 1.19.7" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="FedoraProject (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://fedoraproject.org/w/api.php?action=rsd" />
<link rel="copyright" href="/wiki/Legal:Main" />
<link rel="alternate" type="application/atom+xml" title="FedoraProject Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />		<title>QA:Testcase Virtualization Manually set spice listening port with TLS port set - FedoraProject</title>
		<link rel="stylesheet" href="https://fedoraproject.org/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared&amp;only=styles&amp;skin=fedora&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://fedoraproject.org/w/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=fedora&amp;*" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: fpo-mediawiki-en_:resourceloader:filter:minify-css:7:c88e2bcd56513749bec09a7e29cb3ffa */</style>

  <link rel="stylesheet" type="text/css" media="all" href="/static/css/fedora.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/static/css/print.css" />

		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/w/skins/fedora/main.css?272"; /*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="/w/skins/common/commonPrint.css?272" />
		<link rel="stylesheet" type="text/css" media="handheld" href="/w/skins/fedora/handheld.css?272" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "/w/skins/fedora/IE50Fixes.css?272";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "/w/skins/fedora/IE55Fixes.css?272";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "/w/skins/fedora/IE60Fixes.css?272";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "/w/skins/fedora/IE70Fixes.css?272";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/w/skins/common/IEFixes.js?272"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		
		<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"QA","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":104,"wgPageName":"QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set","wgTitle":"Testcase Virtualization Manually set spice listening port with TLS port set","wgCurRevisionId":255162,"wgArticleId":40723,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Virtualization Spice Test Cases"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgRelevantPageName":"QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script>                
		<script type="text/javascript" src="/w/skins/common/wikibits.js?272"><!-- wikibits js --></script>
		<!-- Head Scripts -->
<script src="https://fedoraproject.org/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=fedora&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"QA","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":104,"wgPageName":"QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set","wgTitle":"Testcase Virtualization Manually set spice listening port with TLS port set","wgCurRevisionId":255162,"wgArticleId":40723,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Virtualization Spice Test Cases"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgRelevantPageName":"QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"fedora","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,
"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":true,"searchNs5":false,"searchNs6":true,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":true,"searchNs13":false,"searchNs14":true,"searchNs15":false,"searchNs100":false,"searchNs101":false,"searchNs102":false,"searchNs103":false,"searchNs104":false,"searchNs105":false,"searchNs106":true,"searchNs107":false,"searchNs108":true,"searchNs109":false,"searchNs110":true,"searchNs111":false,"searchNs112":true,"searchNs113":false,"searchNs114":true,"searchNs115":false,"searchNs116":true,"searchNs117":false});;},{},{});mw.loader.implement("user.tokens",function($){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});

/* cache key: fpo-mediawiki-en_:resourceloader:filter:minify-js:7:2e839801c875f3062717112bdc5ea3e0 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>	</head>
<body  class="mediawiki  ltr ns-104 ns-subject page-QA_Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set">
	<div id="wrapper">
        <div id="head">
        <h1><a href="/wiki/Fedora_Project_Wiki" title="Visit the main page [z]" accesskey="z" >Fedora</a></h1>
	<div id="p-personal">
		<h5>Personal tools</h5>
			<ul>
				<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=QA%3ATestcase+Virtualization+Manually+set+spice+listening+port+with+TLS+port+set" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o" >Log in</a></li>
			</ul>
	</div>

<!-- Top actions bar -->
	<div id="p-cactions">
		<h5>Views</h5>
			<ul>
					 <li id="ca-nstab-qa" class="selected"><a href="/wiki/QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set" >QA</a></li>
					 <li id="ca-talk" class="new"><a href="/w/index.php?title=QA_talk:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t" >Discussion</a></li>
					 <li id="ca-viewsource"><a href="/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e" >View source</a></li>
					 <li id="ca-history"><a href="/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;action=history" title="Past revisions of this page [h]" accesskey="h" >History</a></li>
				</ul>
	</div>

        </div>
<div id="sidebar">
<div id="nav">
<!-- Sidebar -->
		<div id='p-wiki'>
		<h2>wiki</h2>
			<ul>
				<li id="n-mainpage"><a href="/wiki/Fedora_Project_Wiki" title="Visit the main page [z]" accesskey="z" >Fedora Project Wiki</a></li>
				<li id="n-News"><a href="/wiki/FWN/LatestIssue" >News</a></li>
				<li id="n-Events"><a href="/wiki/FedoraEvents" >Events</a></li>
				<li id="n-Features"><a href="/wiki/Features" >Features</a></li>
				<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r" >Recent changes</a></li>
				<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random page [x]" accesskey="x" >Random page</a></li>
				<li id="n-Help"><a href="/wiki/Help" title="The place to find out" >Help</a></li>
			</ul>
	</div>
		<div id='p-navigation'>
		<h2>Navigation</h2>
			<ul>
				<li id="n-Home"><a href="http://fedoraproject.org/" >Home</a></li>
				<li id="n-Get-Fedora"><a href="http://get.fedoraproject.org/" >Get Fedora</a></li>
				<li id="n-Join-Fedora"><a href="http://join.fedoraproject.org/" >Join Fedora</a></li>
			</ul>
	</div>
		<div id='p-sub-projects'>
		<h2>sub-projects</h2>
			<ul>
				<li id="n-Ambassadors"><a href="/wiki/Ambassadors" >Ambassadors</a></li>
				<li id="n-Bug-Zappers"><a href="/wiki/BugZappers" >Bug Zappers</a></li>
				<li id="n-Design"><a href="/wiki/Design" >Design</a></li>
				<li id="n-Documentation"><a href="/wiki/DocsProject" >Documentation</a></li>
				<li id="n-EPEL"><a href="/wiki/EPEL" >EPEL</a></li>
				<li id="n-Infrastructure"><a href="/wiki/Infrastructure" >Infrastructure</a></li>
				<li id="n-Internationalization"><a href="/wiki/I18N" >Internationalization</a></li>
				<li id="n-Localization"><a href="/wiki/L10N" >Localization</a></li>
				<li id="n-Marketing"><a href="/wiki/Marketing" >Marketing</a></li>
				<li id="n-Package-Maintainers"><a href="/wiki/PackageMaintainers" >Package Maintainers</a></li>
				<li id="n-Websites"><a href="/wiki/Websites" >Websites</a></li>
				<li id="n-Weekly-News"><a href="/wiki/FWN" >Weekly News</a></li>
				<li id="n-All-projects"><a href="/wiki/Projects" >All projects</a></li>
			</ul>
	</div>
		<div id="p-search">
		<h2><label for="searchInput">Search</label></h2>
			<form action="/wiki/Special:Search" id="searchform"><div>
				<input id="searchInput" name="search" type="text" title="Search FedoraProject [f]" accesskey="f"  value="" /><br />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" />
			</div></form>
	</div>
	<div id="p-tb">
		<h2>Toolbox</h2>
			<ul>
				<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set" title="A list of all wiki pages that link here [j]" accesskey="j" >What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set" title="Recent changes in pages linked from this page [k]" accesskey="k" >Related changes</a></li>
<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q" >Special pages</a></li>
				<li id="t-print"><a href="/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;printable=yes"title="Printable version of this page [p]" accesskey="p" >Printable version</a></li>				<li id="t-permalink"><a href="/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;oldid=255162"title="Permanent link to this revision of the page" >Permanent link</a></li>			</ul>
	</div>
</div>
</div><!-- end of the left (by default at least) column -->

	<div id="content">
		<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"></div></div>		<h2>QA:Testcase Virtualization Manually set spice listening port with TLS port set</h2>
			<h3 id="siteSub">From FedoraProject</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1"><a href="#Setup"><span class="tocnumber">2</span> <span class="toctext">Setup</span></a></li>
<li class="toclevel-1"><a href="#How_to_test"><span class="tocnumber">3</span> <span class="toctext">How to test</span></a></li>
<li class="toclevel-1"><a href="#Expected_Results"><span class="tocnumber">4</span> <span class="toctext">Expected Results</span></a></li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Description"> Description </span></h1>
<h1> <span class="mw-headline" id="Setup"> Setup </span></h1>
<p>Make sure you have a guest, which could be started successfully 
</p>
<h1> <span class="mw-headline" id="How_to_test"> How to test </span></h1>
<ol>
<li> force off the running guest
<li> go the guest detail pannel, remove the "Display VNC" device
<li> click the "Add Hardware" button at the left bottom
<li> Add "Graphics" -&gt; Type "SPICE server"
<li> Check OFF the "Automatically allocation"
<li> Specify the Port to 5901 TLS port to 5902
<li> Click Finish , and back to guest detail overview panel, click Apply button
<li> modify the followings in /etc/libvirt/qemu.conf
<pre>
-# spice_tls = 1
+ spice_tls = 1

-# spice_tls_x509_cert_dir = &quot;/etc/pki/libvirt-spice&quot;
+ spice_tls_x509_cert_dir = &quot;/etc/pki/libvirt-spice&quot;
</pre>
<li> perform the following script, to generate the cert files for ssl , and then copy *.pem file info <code>/etc/pkil/libvirt-spice</code> directory
<pre>
#!/bin/bash

SERVER_KEY=server-key.pem

# creating a key for our ca
if [&#160;! -e ca-key.pem ]; then
 openssl genrsa -des3 -out ca-key.pem 1024
fi
# creating a ca
if [&#160;! -e ca-cert.pem ]; then
 openssl req -new -x509 -days 1095 -key ca-key.pem -out ca-cert.pem  -subj &quot;/C=IL/L=Raanana/O=Red Hat/CN=my CA&quot;
fi
# create server key
if [&#160;! -e $SERVER_KEY ]; then
 openssl genrsa -out $SERVER_KEY 1024
fi
# create a certificate signing request (csr)
if [&#160;! -e server-key.csr ]; then
 openssl req -new -key $SERVER_KEY -out server-key.csr -subj &quot;/C=IL/L=Raanana/O=Red Hat/CN=my server&quot;
fi
# signing our server certificate with this ca
if [&#160;! -e server-cert.pem ]; then
 openssl x509 -req -days 1095 -in server-key.csr -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem
fi

# now create a key that doesn't require a passphrase
openssl rsa -in $SERVER_KEY -out $SERVER_KEY.insecure
mv $SERVER_KEY $SERVER_KEY.secure
mv $SERVER_KEY.insecure $SERVER_KEY

# show the results (no other effect)
openssl rsa -noout -text -in $SERVER_KEY
openssl rsa -noout -text -in ca-key.pem
openssl req -noout -text -in server-key.csr
openssl x509 -noout -text -in server-cert.pem
openssl x509 -noout -text -in ca-cert.pem

# copy *.pem file to /etc/pki/libvirt-spice
if [[ -d &quot;/etc/pki/libvirt-spice&quot; ]] 
then
 cp ./*.pem /etc/pki/libvirt-spice
else
 mkdir /etc/pki/libvirt-spice
     cp ./*.pem /etc/pki/libvirt-spice
fi

# echo --host-subject
echo &quot;your --host-subject is&quot; \&quot; `openssl x509 -noout -text -in server-cert.pem | grep Subject: | cut -f 10- -d &quot; &quot;` \&quot;
 </pre>
<li> restart libvirtd to rescan the configuration: <code>service libvirtd restart</code>
<li> Start the guest: <code>virsh start &lt;guest&gt;</code>
<li> Access the guest via following command line
<pre>spicec -h 127.0.0.1 -p 5901 -s 5902 --host-subject &quot;C=IL,L=Raanana,O=Red Hat,CN=my CA&quot;</pre>
</ol>
<h1> <span class="mw-headline" id="Expected_Results"> Expected Results </span></h1>
<ol><li> Make sure you CAN access the spice interface via private 127.0.0.1 with TLS port set
</li></ol>

<!-- 
NewPP limit report
Preprocessor node count: 59/1000000
Post‐expand include size: 1404/2097152 bytes
Template argument size: 1170/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key fpo-mediawiki-en_:pcache:idhash:40723-0!*!*!!en!*!* and timestamp 20130827014301 -->
</div><div class="printfooter">
Retrieved from "<a href="https://fedoraproject.org/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;oldid=255162">https://fedoraproject.org/w/index.php?title=QA:Testcase_Virtualization_Manually_set_spice_listening_port_with_TLS_port_set&amp;oldid=255162</a>"</div>
			<div id="catlinks"><div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:Virtualization_Spice_Test_Cases" title="Category:Virtualization Spice Test Cases">Virtualization Spice Test Cases</a></li></ul></div></div></div>			<!-- end content -->
	</div>

<!-- Top login, etc. bar -->
<!-- #p-personal moved to inside #content so the text color says the same -->
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
</div>
			<div id="bottom">
			<div id="footer">
				<div id="f-poweredbyico"><a href="//www.mediawiki.org/"><img src="/w/skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>
      <p class="copy">
      Copyright &copy; 2013 Red Hat, Inc. and others.  All Rights Reserved.  For comments or queries, please <a href="/contact">contact us</a>.
      </p>
      <p class="disclaimer">
      The Fedora Project is maintained and driven by the community and sponsored by Red Hat.  This is a community maintained site.  Red Hat is not responsible for content.
      </p>
			<ul>
				<li class="first" id="lastmod"> This page was last modified on 28 September 2011, at 19:00.</li>
				<li id="copyright">Content is available under <a href="/wiki/Legal:Main" title="Legal:Main">Attribution-Share Alike 3.0 Unported</a>.</li>
			</ul>
			<ul>
				<li class="first" id="privacy"><a href="/wiki/FedoraProject:Privacy_policy" title="FedoraProject:Privacy policy">Privacy policy</a></li>
				<li id="about"><a href="/wiki/FedoraProject:About" title="FedoraProject:About">About FedoraProject</a></li>
				<li id="disclaimer"><a href="/wiki/FedoraProject:General_disclaimer" title="FedoraProject:General disclaimer">Disclaimers</a></li>
        <li><a href="http://fedoraproject.org/en/sponsors">Sponsors</a></li>
        <li><a href="http://fedoraproject.org/wiki/Legal:Main">Legal</a></li>
        <li><a href="http://fedoraproject.org/wiki/Legal:Trademark_guidelines">Trademark Guidelines</a></li>
      </ul>
		</div>
		</div>
		
	<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready"], null, true);
}</script>
<script src="https://fedoraproject.org/w/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=fedora&amp;*"></script>
<!-- Served in 0.139 secs. --></body></html>
