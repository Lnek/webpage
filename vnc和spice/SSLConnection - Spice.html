<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="SSLConnection" />
<link rel="shortcut icon" href="/favicon.ico" />
		<title>SSLConnection - Spice</title>
		<link rel="icon" type="image/png" href="/wiki/skins/spice/favicon.png"/>
		<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/wiki/skins/spice/main.css?7"; /*]]>*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="/wiki/skins/common/commonPrint.css" />
		<!--[if lt IE 5.5000]><style type="text/css">@import "/wiki/skins/spice/IE50Fixes.css";</style><![endif]-->
		<!--[if IE 5.5000]><style type="text/css">@import "/wiki/skins/spice/IE55Fixes.css";</style><![endif]-->
		<!--[if IE 6]><style type="text/css">@import "/wiki/skins/spice/IE60Fixes.css";</style><![endif]-->
		<!--[if IE 7]><style type="text/css">@import "/wiki/skins/spice/IE70Fixes.css?1";</style><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/wiki/skins/common/IEFixes.js"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
		<script type="text/javascript">var skin = 'spice';var stylepath = '/wiki/skins';</script>
		<script type="text/javascript" src="/wiki/skins/common/wikibits.js"><!-- wikibits js --></script>
		<script type="text/javascript" src="/wiki/index.php?title=-&amp;action=raw&amp;gen=js"><!-- site js --></script>
		<style type="text/css">/*<![CDATA[*/
@import "/wiki/index.php?title=MediaWiki:Common.css&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php?title=MediaWiki:Spice.css&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>
		<!-- Head Scripts -->
		
<script>

function GetEventTarget(event)
{
  if (!event) {
    event = window.event;
  }

  if (event.target) {
    object = event.target;
  } else {
    object = event.srcElement;
  }
  return object;
}

function OnEnterMenuItem(event)
{
  var object = GetEventTarget(event);
  object.style.backgroundColor = "#666666";
  object.style.borderColor = "#c8c4b7";
}

function OnLeaveMenuItem(event)
{
  var object = GetEventTarget(event);
  object.style.backgroundColor = "transparent";
  object.style.borderColor = "transparent";
}

function OnMenuItemClick(event, url)
{  
  var object = GetEventTarget(event);
  object.style.backgroundColor = "transparent";
  object.style.borderColor = "transparent";
  window.location = url;  
}

function GetIEVersion()
{
  var version = -1;

  if (window.navigator.appName == "Microsoft Internet Explorer") {
    var user_agent = navigator.userAgent;
    var reg_expresion = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
    if (reg_expresion.exec(user_agent) != null) {
      version = parseFloat(RegExp.$1);
    }
  }
  return version;
}

function TestIE()
{
  var ie_version = GetIEVersion();
  if (ie_version == -1) {
    return;
  }
  if (ie_version < 7) {
    window.location = "ie_version.html" 
  }
}


</script>


	</head>
<body  class="ns-0 ltr">

	<div id="header" width="100%" style="background-image: url('/wiki/skins/spice/plasma.jpg'); background-repeat:no-repeat;">

	<table width="100%" style="background: transparent;">
	<tr>
    		<td><img alt="logo" src="/wiki/skins/spice/spice_wiki_logo.png" style="padding-left:40px; padding-top:10px" /></td>
    		<td align="right" valign="top">
        	<div id="search-area">
        		<form action="http://www.google.com/search" method="get">
        			Search:<input class="search-box" id="q" name="q" type="text"/>
				<input type="hidden" name="sitesearch" value="spice-space.org"/> <!--************************* -->
        		</form> 
        	</div>
    		</td>
	</tr>
	</table>


	<table>
	<tr id="menu-bar">

			
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Main_Page" )'>
								Main Page</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Todo" )'>
								Todo</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Howtos" )'>
								Howtos</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Repositories" )'>
								Repositories</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Testing" )'>
								Testing</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/In_progress" )'>
								In progress</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Ideas" )'>
								Ideas</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Your_space" )'>
								Your space</td>

		
			<td class="menu-item" onmouseover="OnEnterMenuItem(event)" onmouseout="OnLeaveMenuItem(event)"
       				onclick='OnMenuItemClick(event, "/page/Links" )'>
								Links</td>

			
	</tr>
	</table>



	</div>
<div>
<table width="100%" border="0" style="margin-top: 20px;" cellspacing=0 cellpadding=0>
<tr>
  <td valign="top" style="padding-right: 50px;">
       <!--div style="background-image: url('/wiki/skins/spice/plasma.jpg'); background-repeat:no-repeat; background-position: 0px -190px; height: 48px; "-->
       <div style="background-color: #000; background-repeat:no-repeat; background-position: 0px -190px; height: 48px;">

	<div style="padding-top:12px; padding-left:15px; font-size: 18px; float:left; font-weight: bold; color: #f0f0f0;">SSLConnection </div>
      </div>
      <div id="content">
<!-- ************************************************************************************************************************************************** -->

	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	
		<a name="top" id="top"></a>
		   <!--h1 class="firstHeading">SSLConnection</h1-->
		<div id="bodyContent">
			<h3 id="siteSub">From Spice</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>,<a href="#searchInput">search</a></div>
			<!-- start content -->
			
			<!-- this is where the search blob was before -->

			<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class='toclevel-1'><a href="#Example_invocation"><span class="tocnumber">2</span> <span class="toctext">Example invocation</span></a>
<ul>
<li class='toclevel-2'><a href="#Host"><span class="tocnumber">2.1</span> <span class="toctext">Host</span></a></li>
<li class='toclevel-2'><a href="#Client"><span class="tocnumber">2.2</span> <span class="toctext">Client</span></a>
<ul>
<li class='toclevel-3'><a href="#remote_viewer_.28supported_client.29"><span class="tocnumber">2.2.1</span> <span class="toctext">remote viewer (supported client)</span></a></li>
<li class='toclevel-3'><a href="#spicec_.28Old_deprecated_client.29"><span class="tocnumber">2.2.2</span> <span class="toctext">spicec (Old deprecated client)</span></a></li>
</ul>
</li>
<li class='toclevel-2'><a href="#Certificate_creation"><span class="tocnumber">2.3</span> <span class="toctext">Certificate creation</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a>]</div><a name="Introduction"></a><h1> Introduction </h1>
<p>Spice supports SSL connections. The documentation in the user guide is adaquate to creating certificates using openssl, but doesn't go into length about using them.
</p><p><b>TODO</b>: All of this needs to go into an updated user manual.
</p><p>There are two certificates, the server cert and the ca cert (certificate authority, the verifier of the server certificate). The ca is the only one that needs to be in sync between the client and server.
</p><p><b>TODO</b>: update this part for remote-viewer
</p><p>spicec looks for %APPDATA%\spicec\spice_truststore.pem / $HOME/.spicec/spice_truststore.pem. This needs to be identical to the ca-cert.pem on the server, i.e. the ca used to sign the server certificate. The client will use this to authenticate the server.
</p><p>The server has a number of flags (renamed but essentially the same as in the 0.4 user manual):
</p>
<ul><li> ca-cert
</li><li> ca-crl - not really required?
</li><li> server-cert
</li><li> server-key
</li></ul>
<p>you can use the predefined names, in that case you only need to specify a single subdirectory parameter.
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=2" title="Edit section: Example invocation">edit</a>]</div><a name="Example_invocation"></a><h1> Example invocation </h1>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=3" title="Edit section: Host">edit</a>]</div><a name="Host"></a><h2> Host </h2>
<pre>qemu -snapshot /images2/f14_alpha.raw -m 1024 -vga qxl -spice port=5913,tls-port=5914,disable-ticketing,x509-dir=/images2/pki_certs/,tls-channel=main,tls-channel=inputs
</pre>
<p>If your server key requires a passphrase you can provide it with the x509-key-password parameter (but since that will be visible from ps it is not recommended)
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=4" title="Edit section: Client">edit</a>]</div><a name="Client"></a><h2> Client </h2>
<ul><li> Copy ca-cert.pem to %APPDATA%\Roaming\spicec\spice_truststore.pem
</li><li> Take SUBJECT from the server-cert.pem file:
</li></ul>
<pre>  * SUBJECT=`openssl x509 -noout -text -in server-cert.pem | grep Subject: | cut -f 10- -d " "`
</pre>
<ul><li> Run:
</li></ul>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=5" title="Edit section: remote viewer (supported client)">edit</a>]</div><a name="remote_viewer_.28supported_client.29"></a><h3> remote viewer (supported client) </h3>
<pre>remote-viewer --spice-ca-file=ca-cert.pem spice://localhost:5913?tls-port=5914 "--spice-host-subject=$SUBJECT"
</pre>
<p>Note: quoting is because of possible spaces in $SUBJECT
</p><p>Note2: If there is no non-secure port (i.e. -spice tls-port=5914 only) then use the following uri: spice://localhost?tls-port=5914
</p>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=6" title="Edit section: spicec (Old deprecated client)">edit</a>]</div><a name="spicec_.28Old_deprecated_client.29"></a><h3> spicec (Old deprecated client) </h3>
<pre>spicec -h host -p 5913 -s 5914 --secure-channels all --host-subject "$SUBJECT"
</pre>
<div class="editsection" style="float:right;margin-left:5px;">[<a href="/wiki/index.php?title=SSLConnection&amp;action=edit&amp;section=7" title="Edit section: Certificate creation">edit</a>]</div><a name="Certificate_creation"></a><h2> Certificate creation </h2>
<p>Creating a self signed ca and signing a server certificate. the host-subject is the server certificate subject, not the ca's:
</p><p>(In this example "C=IL,L=Raanana,O=Red Hat,CN=my server"
</p>
<pre>#!/bin/bash
</pre>
<pre>SERVER_KEY=server-key.pem
</pre>
<pre># creating a key for our ca
if [&nbsp;! -e ca-key.pem ]; then
    openssl genrsa -des3 -out ca-key.pem 1024
fi
# creating a ca
if [&nbsp;! -e ca-cert.pem ]; then
    openssl req -new -x509 -days 1095 -key ca-key.pem -out ca-cert.pem -utf8 -subj "/C=IL/L=Raanana/O=Red Hat/CN=my CA"
fi
# create server key
if [&nbsp;! -e $SERVER_KEY ]; then
    openssl genrsa -out $SERVER_KEY 1024
fi
# create a certificate signing request (csr)
if [&nbsp;! -e server-key.csr ]; then
    openssl req -new -key $SERVER_KEY -out server-key.csr -utf8 -subj "/C=IL/L=Raanana/O=Red Hat/CN=my server"
fi
# signing our server certificate with this ca
if [&nbsp;! -e server-cert.pem ]; then
    openssl x509 -req -days 1095 -in server-key.csr -CA ca-cert.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem
fi
</pre>
<pre># now create a key that doesn't require a passphrase
openssl rsa -in $SERVER_KEY -out $SERVER_KEY.insecure
mv $SERVER_KEY $SERVER_KEY.secure
mv $SERVER_KEY.insecure $SERVER_KEY
</pre>
<pre># show the results (no other effect)
openssl rsa -noout -text -in $SERVER_KEY
openssl rsa -noout -text -in ca-key.pem
openssl req -noout -text -in server-key.csr
openssl x509 -noout -text -in server-cert.pem
openssl x509 -noout -text -in ca-cert.pem
</pre>
<!-- Saved in parser cache with key spice:pcache:idhash:1421-0!1!0!0!!en!2 and timestamp 20130825084411 -->
<div class="printfooter">
Retrieved from "<a href="http://spice-space.org/page/SSLConnection">http://spice-space.org/page/SSLConnection</a>"</div>
			 			<!-- end content -->
			<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>

	<script type="text/javascript"> if (window.runOnloadHook) runOnloadHook();</script>
</div>


<!-- ************************************************************************************************************************************************** -->
	</div>
  </td>
    <td width="160" valign="top">
      <div class="banner" style="height: 49px;">
        <div style="margin-top: 12px;">
          <a style="color: #ffffff; font-size:18px; font-weight: bold;" href="/">{ main_site(); }</a>
        </div>
      </div>
      <!-- div class="banner" style="height: 212px;">
        <img style="margin-top: 10px;" src="/wiki/skins/spice/join_us_plasma.png" />
        <div style="margin-top: 5px; color: #ffffff; font-size:18px; font-weight: bold;">Join us!</div>
      </div -->
    </td>
  
   </tr>
   </table>
</div>


<div id="new_footer"">

<table width="100%">
<tr>
<td width="180px">
<a href="http://et.redhat.com"> <img alt="et" src="/wiki/skins/spice/et-banner.png" style="padding-left:15px; padding-top:12px; border: 0px;" /> </a>
</td>
<td align="left">
	<div id="p-cactions" class="portlet">
		<table><tr>
		<td><strong>Views</strong>:&nbsp;</td>
				 <td id="ca-nstab-main" class="selected"><a href="/page/SSLConnection">Article</a></td>
				 <td id="ca-talk" class="new"><a href="/wiki/index.php?title=Talk:SSLConnection&amp;action=edit">Discussion</a></td>
				 <td id="ca-edit"><a href="/wiki/index.php?title=SSLConnection&amp;action=edit">Edit</a></td>
				 <td id="ca-history"><a href="/wiki/index.php?title=SSLConnection&amp;action=history">History</a></td>
		</tr></table>
	</div>

	<div class="portlet" id="p-personal">
			<table><tr>
		<td><strong>Personal tools:&nbsp;</strong></td>
				<td id="pt-login"><a href="/wiki/index.php?title=Special:Userlogin&amp;returnto=SSLConnection">Log in / create account</a></td>
			</tr></table>
	</div>

	<div class="portlet" id="p-tb">
		<div class="pBody">
		<table><tr>
		<td><strong>Toolbox</strong>:&nbsp;</td>
				<td id="t-whatlinkshere"><a href="/page/Special:Whatlinkshere/SSLConnection">What links here</a></td>
				<td id="t-recentchangeslinked"><a href="/page/Special:Recentchangeslinked/SSLConnection">Related changes</a></td>
<td id="t-upload"><a href="/page/Special:Upload">Upload file</a></td>
<td id="t-specialpages"><a href="/page/Special:Specialpages">Special pages</a></td>
				<td id="t-print"><a href="/wiki/index.php?title=SSLConnection&amp;printable=yes">Printable version</a></td>				<td id="t-permalink"><a href="/wiki/index.php?title=SSLConnection&amp;oldid=2764">Permanent link</a></td>		    </tr></table>
		</div>
	</div>
</td>
<td width="10px">
                                <div id="f-poweredbyico" style="padding-right:15px;border: 0px;"  ><a href="http://www.mediawiki.org/"><img src="/wiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="MediaWiki" /></a></div>

</td>
</tr>
</table>
</div> <!--my footer -->

<!-- Served by et.redhat.com in 0.20 secs. -->

</body></html>
