

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Paste Deployment &mdash; Paste Deploy v1.5.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Paste Deploy v1.5.0 documentation" href="#" />
    <link rel="next" title="Paste Deployment News" href="news.html" />
 
<link rel="stylesheet" type="text/css"
 href="_static/paste.css.html">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="news.html" title="Paste Deployment News"
             accesskey="N">next</a> |</li>
        <li><a href="#">Paste Deploy v1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="paste-deployment">
<h1><a class="toc-backref" href="#id3">Paste Deployment</a><a class="headerlink" href="#paste-deployment" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">author:</th><td class="field-body">Ian Bicking &lt;<a class="reference external" href="mailto:ianb&#37;&#52;&#48;colorstudy&#46;com">ianb<span>&#64;</span>colorstudy<span>&#46;</span>com</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#paste-deployment" id="id3">Paste Deployment</a><ul>
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#status" id="id5">Status</a></li>
<li><a class="reference internal" href="#installation" id="id6">Installation</a></li>
<li><a class="reference internal" href="#from-the-user-perspective" id="id7">From the User Perspective</a><ul>
<li><a class="reference internal" href="#the-config-file" id="id8">The Config File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-usage" id="id9">Basic Usage</a></li>
<li><a class="reference internal" href="#config-uris" id="id10"><tt class="docutils literal"><span class="pre">config:</span></tt> URIs</a><ul>
<li><a class="reference internal" href="#config-format" id="id11">Config Format</a></li>
<li><a class="reference internal" href="#applications" id="id12">Applications</a></li>
<li><a class="reference internal" href="#configuration" id="id13">Configuration</a></li>
<li><a class="reference internal" href="#global-configuration" id="id14">Global Configuration</a></li>
<li><a class="reference internal" href="#composite-applications" id="id15">Composite Applications</a></li>
<li><a class="reference internal" href="#other-objects" id="id16">Other Objects</a></li>
<li><a class="reference internal" href="#filter-composition" id="id17">Filter Composition</a></li>
<li><a class="reference internal" href="#getting-configuration" id="id18">Getting Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#egg-uris" id="id19"><tt class="docutils literal"><span class="pre">egg:</span></tt> URIs</a></li>
<li><a class="reference internal" href="#defining-factories" id="id20">Defining Factories</a><ul>
<li><a class="reference internal" href="#paste-app-factory" id="id21"><tt class="docutils literal"><span class="pre">paste.app_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-composite-factory" id="id22"><tt class="docutils literal"><span class="pre">paste.composite_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-filter-factory" id="id23"><tt class="docutils literal"><span class="pre">paste.filter_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-filter-app-factory" id="id24"><tt class="docutils literal"><span class="pre">paste.filter_app_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-server-factory" id="id25"><tt class="docutils literal"><span class="pre">paste.server_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-server-runner" id="id26"><tt class="docutils literal"><span class="pre">paste.server_runner</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#outstanding-issues" id="id27">Outstanding Issues</a></li>
</ul>
</li>
</ul>
</div>
<p>Documents:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="news.html">Paste Deployment News</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/loadwsgi.html"><tt class="docutils literal"><span class="pre">paste.deploy.loadwsgi</span></tt> &#8211; Load WSGI applications from config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/config.html"><tt class="docutils literal"><span class="pre">paste.deploy.config</span></tt> &#8211; Configuration and Environment middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/converters.html"><tt class="docutils literal"><span class="pre">paste.deploy.converters</span></tt> &#8211; Conversion helpers for String Configuration</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id4">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Paste Deployment is a system for finding and configuring WSGI
applications and servers.  For WSGI application consumers it provides
a single, simple function (<tt class="docutils literal"><span class="pre">loadapp</span></tt>) for loading a WSGI application
from a configuration file or a Python Egg.  For WSGI application
providers it only asks for a single, simple entry point to your
application, so that application users don&#8217;t need to be exposed to the
implementation details of your application.</p>
<p>The result is something a system administrator can install and manage
without knowing any Python, or the details of the WSGI application or
its container.</p>
<p>Paste Deployment currently does not require other parts of <a class="reference external" href="http://pythonpaste.org">Paste</a>, and is distributed as a separate package.</p>
<p>To see updates that have been made to Paste Deploy see the <a class="reference external" href="news.html">news file</a>.</p>
<p>Paste Deploy is released under the <a class="reference external" href="http://www.opensource.org/licenses/mit-license.php">MIT license</a>.</p>
</div>
<div class="section" id="status">
<h2><a class="toc-backref" href="#id5">Status</a><a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Paste Deploy has passed version 1.0.  Paste Script is an actively
maintained project.  As of 1.0, we&#8217;ll make a strong effort to maintain
backward compatibility (this actually started happening long before
1.0, but now it is explicit).  This will include deprecation warnings
when necessary.  Major changes will take place under new functions or
with new entry points.</p>
<p>Note that the most key aspect of Paste Deploy is the entry points it
defines (such as <tt class="docutils literal"><span class="pre">paste.app_factory</span></tt>).  Paste Deploy is not the only
consumer of these entry points, and many extensions can best take
place by utilizing the entry points instead of using Paste Deploy
directly.  The entry points will not change; if changes are necessary,
new entry points will be defined.</p>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id6">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>First make sure you have either
<a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools">setuptools</a> or its
modern replacement
<a class="reference external" href="http://pypi.python.org/pypi/distribute">distribute</a> installed.
For Python 3.x you need distribute as setuptools does not work on it.</p>
<p>Then you can install Paste Deployment using <a class="reference external" href="http://www.pip-installer.org/en/latest/installing.html">pip</a> by running:</p>
<div class="highlight-python"><pre>$ sudo pip install PasteDeploy</pre>
</div>
<p>If you want to track development, do:</p>
<div class="highlight-python"><pre>$ hg clone http://bitbucket.org/ianb/pastedeploy
$ cd pastedeploy
$ sudo python setup.py develop</pre>
</div>
<p>This will install the package globally, but will load the files in the
checkout.  You can also simply install <tt class="docutils literal"><span class="pre">PasteDeploy==dev</span></tt>.</p>
<p>For downloads and other information see the <a class="reference external" href="http://cheeseshop.python.org/pypi/PasteDeploy">Cheese Shop PasteDeploy
page</a>.</p>
<p>A complimentary package is <a class="reference external" href="/script/">Paste Script</a>.  To install
that, use <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">PasteScript</span></tt> (or <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span>
<span class="pre">PasteScript==dev</span></tt>).</p>
</div>
<div class="section" id="from-the-user-perspective">
<h2><a class="toc-backref" href="#id7">From the User Perspective</a><a class="headerlink" href="#from-the-user-perspective" title="Permalink to this headline">¶</a></h2>
<p>In the following sections, the Python API for using Paste Deploy is
given.  This isn&#8217;t what users will be using (but it is useful for
Python developers and useful for setting up tests fixtures).</p>
<p>The primary interaction with Paste Deploy is through its configuration
files.  The primary thing you want to do with a configuration file is
serve it.  To learn about serving configuration files, see <cite>the
``paster serve`</cite> command
&lt;<a class="reference external" href="http://pythonpaste.org/script/#paster-serve">http://pythonpaste.org/script/#paster-serve</a>&gt;`_.</p>
<div class="section" id="the-config-file">
<h3><a class="toc-backref" href="#id8">The Config File</a><a class="headerlink" href="#the-config-file" title="Permalink to this headline">¶</a></h3>
<p>A config file has different sections.  The only sections Paste Deploy
cares about have prefixes, like <tt class="docutils literal"><span class="pre">app:main</span></tt> or <tt class="docutils literal"><span class="pre">filter:errors</span></tt> &#8211;
the part after the <tt class="docutils literal"><span class="pre">:</span></tt> is the &#8220;name&#8221; of the section, and the part
before gives the &#8220;type&#8221;.  Other sections are ignored.</p>
<p>The format is a simple <a class="reference external" href="http://en.wikipedia.org/wiki/INI_file">INI format</a>: <tt class="docutils literal"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">value</span></tt>.  You can
extend the value by indenting subsequent lines.  <tt class="docutils literal"><span class="pre">#</span></tt> is a comment.</p>
<p>Typically you have one or two sections, named &#8220;main&#8221;: an application
section (<tt class="docutils literal"><span class="pre">[app:main]</span></tt>) and a server section (<tt class="docutils literal"><span class="pre">[server:main]</span></tt>).
<tt class="docutils literal"><span class="pre">[composite:...]</span></tt> signifies something that dispatches to multiple
applications (example below).</p>
<p>Here&#8217;s a typical configuration file that also shows off mounting
multiple applications using <a class="reference external" href="http://pythonpaste.org/module-paste.urlmap.html">paste.urlmap</a>:</p>
<div class="highlight-python"><pre>[composite:main]
use = egg:Paste#urlmap
/ = home
/blog = blog
/wiki = wiki
/cms = config:cms.ini

[app:home]
use = egg:Paste#static
document_root = %(here)s/htdocs

[filter-app:blog]
use = egg:Authentication#auth
next = blogapp
roles = admin
htpasswd = /home/me/users.htpasswd

[app:blogapp]
use = egg:BlogApp
database = sqlite:/home/me/blog.db

[app:wiki]
use = call:mywiki.main:application
database = sqlite:/home/me/wiki.db</pre>
</div>
<p>I&#8217;ll explain each section in detail now:</p>
<div class="highlight-python"><pre>[composite:main]
use = egg:Paste#urlmap
/ = home
/blog = blog
/cms = config:cms.ini</pre>
</div>
<p>That this is a <tt class="docutils literal"><span class="pre">composite</span></tt> section means it dispatches the request
to other applications.  <tt class="docutils literal"><span class="pre">use</span> <span class="pre">=</span> <span class="pre">egg:Paste#urlmap</span></tt> means to use the
composite application named <tt class="docutils literal"><span class="pre">urlmap</span></tt> from the <tt class="docutils literal"><span class="pre">Paste</span></tt> package.
<tt class="docutils literal"><span class="pre">urlmap</span></tt> is a particularly common composite application &#8211; it uses a
path prefix to map your request to another application.  These are
the applications like &#8220;home&#8221;, &#8220;blog&#8221;, &#8220;wiki&#8221; and &#8220;config:cms.ini&#8221;.  The last
one just refers to another file <tt class="docutils literal"><span class="pre">cms.ini</span></tt> in the same directory.</p>
<p>Next up:</p>
<div class="highlight-python"><pre>[app:home]
use = egg:Paste#static
document_root = %(here)s/htdocs</pre>
</div>
<p><tt class="docutils literal"><span class="pre">egg:Paste#static</span></tt> is another simple application, in this case it
just serves up non-dynamic files.  It takes one bit of configuration:
<tt class="docutils literal"><span class="pre">document_root</span></tt>.  You can use variable substitution, which will pull
variables from the section <tt class="docutils literal"><span class="pre">[DEFAULT]</span></tt> (case sensitive!) with
markers like <tt class="docutils literal"><span class="pre">%(var_name)s</span></tt>.  The special variable <tt class="docutils literal"><span class="pre">%(here)s</span></tt> is
the directory containing the configuration file; you should use that
in lieu of relative filenames (which depend on the current directory,
which can change depending how the server is run).</p>
<p>Then:</p>
<div class="highlight-python"><pre>[filter-app:blog]
use = egg:Authentication#auth
next = blogapp
roles = admin
htpasswd = /home/me/users.htpasswd

[app:blogapp]
use = egg:BlogApp
database = sqlite:/home/me/blog.db</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">[filter-app:blog]</span></tt> section means that you want an application
with a filter applied.  The application being filtered is indicated
with <tt class="docutils literal"><span class="pre">next</span></tt> (which refers to the next section).  The
<tt class="docutils literal"><span class="pre">egg:Authentication#auth</span></tt> filter doesn&#8217;t actually exist, but one
could imagine it logs people in and checks permissions.</p>
<p>That last section is just a reference to an application that you
probably installed with <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">BlogApp</span></tt>, and one bit of
configuration you passed to it (<tt class="docutils literal"><span class="pre">database</span></tt>).</p>
<p>Lastly:</p>
<div class="highlight-python"><pre>[app:wiki]
use = call:mywiki.main:application
database = sqlite:/home/me/wiki.db</pre>
</div>
<p>This section is similar to the previous one, with one important difference.
Instead of an entry point in an egg, it refers directly to the <tt class="docutils literal"><span class="pre">application</span></tt>
variable in the <tt class="docutils literal"><span class="pre">mywiki.main</span></tt> module. The reference consist of two parts,
separated by a colon. The left part is the full name of the module and the
right part is the path to the variable, as a Python expression relative to the
containing module.</p>
<p>So, that&#8217;s most of the features you&#8217;ll use.</p>
</div>
</div>
<div class="section" id="basic-usage">
<h2><a class="toc-backref" href="#id9">Basic Usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>The basic way you&#8217;ll use Paste Deployment is to load <a class="reference external" href="http://www.python.org/peps/pep-3333.html">WSGI</a> applications.  Many
Python frameworks now support WSGI, so applications written for these
frameworks should be usable.</p>
<p>The primary function is <tt class="docutils literal"><span class="pre">paste.deploy.loadapp</span></tt>.  This loads an
application given a URI.  You can use it like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.deploy</span> <span class="kn">import</span> <span class="n">loadapp</span>
<span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">loadapp</span><span class="p">(</span><span class="s">&#39;config:/path/to/config.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There&#8217;s two URI formats currently supported: <tt class="docutils literal"><span class="pre">config:</span></tt> and <tt class="docutils literal"><span class="pre">egg:</span></tt>.</p>
</div>
<div class="section" id="config-uris">
<h2><a class="toc-backref" href="#id10"><tt class="docutils literal"><span class="pre">config:</span></tt> URIs</a><a class="headerlink" href="#config-uris" title="Permalink to this headline">¶</a></h2>
<p>URIs that being with <tt class="docutils literal"><span class="pre">config:</span></tt> refer to configuration files.  These
filenames can be relative if you pass the <tt class="docutils literal"><span class="pre">relative_to</span></tt> keyword
argument to <tt class="docutils literal"><span class="pre">loadapp()</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Filenames are never considered relative to the current working
directory, as that is a unpredictable location.  Generally when
a URI has a context it will be seen as relative to that context;
for example, if you have a <tt class="docutils literal"><span class="pre">config:</span></tt> URI inside another
configuration file, the path is considered relative to the
directory that contains that configuration file.</p>
</div>
<div class="section" id="config-format">
<h3><a class="toc-backref" href="#id11">Config Format</a><a class="headerlink" href="#config-format" title="Permalink to this headline">¶</a></h3>
<p>Configuration files are in the INI format.  This is a simple format
that looks like:</p>
<div class="highlight-python"><pre>[section_name]
key = value
another key = a long value
    that extends over multiple lines</pre>
</div>
<p>All values are strings (no quoting is necessary).  The keys and
section names are case-sensitive, and may contain punctuation and
spaces (though both keys and values are stripped of leading and
trailing whitespace).  Lines can be continued with leading whitespace.</p>
<p>Lines beginning with <tt class="docutils literal"><span class="pre">#</span></tt> (preferred) or <tt class="docutils literal"><span class="pre">;</span></tt> are considered
comments.</p>
</div>
<div class="section" id="applications">
<h3><a class="toc-backref" href="#id12">Applications</a><a class="headerlink" href="#applications" title="Permalink to this headline">¶</a></h3>
<p>You can define multiple applications in a single file; each
application goes in its own section.  Even if you have just one
application, you must put it in a section.</p>
<p>Each section name defining an application should be prefixed with
<tt class="docutils literal"><span class="pre">app:</span></tt>.  The &#8220;main&#8221; section (when just defining one application)
would go in <tt class="docutils literal"><span class="pre">[app:main]</span></tt> or just <tt class="docutils literal"><span class="pre">[app]</span></tt>.</p>
<p>There&#8217;s two ways to indicate the Python code for the application.  The
first is to refer to another URI or name:</p>
<div class="highlight-python"><pre>[app:myapp]
use = config:another_config_file.ini#app_name

# or any URI:
[app:myotherapp]
use = egg:MyApp

# or a callable from a module:
[app:mythirdapp]
use = call:my.project:myapplication

# or even another section:
[app:mylastapp]
use = myotherapp</pre>
</div>
<p>It would seem at first that this was pointless; just a way to point to
another location.  However, in addition to loading the application
from that location, you can also add or change the configuration.</p>
<p>The other way to define an application is to point exactly to some
Python code:</p>
<div class="highlight-python"><pre>[app:myapp]
paste.app_factory = myapp.modulename:app_factory</pre>
</div>
<p>You must give an explicit <em>protocol</em> (in this case
<tt class="docutils literal"><span class="pre">paste.app_factory</span></tt>), and the value is something to import.  In
this case the module <tt class="docutils literal"><span class="pre">myapp.modulename</span></tt> is loaded, and the
<tt class="docutils literal"><span class="pre">app_factory</span></tt> object retrieved from it.</p>
<p>See <a class="reference internal" href="#defining-factories">Defining Factories</a> for more about the protocols.</p>
</div>
<div class="section" id="configuration">
<h3><a class="toc-backref" href="#id13">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Configuration is done through keys besides <tt class="docutils literal"><span class="pre">use</span></tt> (or the protocol
names).  Any other keys found in the section will be passed as keyword
arguments to the factory.  This might look like:</p>
<div class="highlight-python"><pre>[app:blog]
use = egg:MyBlog
database = mysql://localhost/blogdb
blogname = This Is My Blog!</pre>
</div>
<p>You can override these in other sections, like:</p>
<div class="highlight-python"><pre>[app:otherblog]
use = blog
blogname = The other face of my blog</pre>
</div>
<p>This way some settings could be defined in a generic configuration
file (if you have <tt class="docutils literal"><span class="pre">use</span> <span class="pre">=</span> <span class="pre">config:other_config_file</span></tt>) or you can
publish multiple (more specialized) applications just by adding a
section.</p>
</div>
<div class="section" id="global-configuration">
<h3><a class="toc-backref" href="#id14">Global Configuration</a><a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h3>
<p>Often many applications share the same configuration.  While you can
do that a bit by using other config sections and overriding values,
often you want that done for a bunch of disparate configuration
values.  And typically applications can&#8217;t take &#8220;extra&#8221; configuration
parameters; with global configuration you do something equivalent to
&#8220;if this application wants to know the admin email, this is it&#8221;.</p>
<p>Applications are passed the global configuration separately, so they
must specifically pull values out of it; typically the global
configuration serves as the basis for defaults when no local
configuration is passed in.</p>
<p>Global configuration to apply to every application defined in a file
should go in a special section named <tt class="docutils literal"><span class="pre">[DEFAULT]</span></tt>.  You can override
global configuration locally like:</p>
<div class="highlight-python"><pre>[DEFAULT]
admin_email = webmaster@example.com

[app:main]
use = ...
set admin_email = bob@example.com</pre>
</div>
<p>That is, by using <tt class="docutils literal"><span class="pre">set</span></tt> in front of the key.</p>
</div>
<div class="section" id="composite-applications">
<h3><a class="toc-backref" href="#id15">Composite Applications</a><a class="headerlink" href="#composite-applications" title="Permalink to this headline">¶</a></h3>
<p>&#8220;Composite&#8221; applications are things that act like applications, but
are made up of other applications.  One example would be a URL mapper,
where you mount applications at different URL paths.  This might look
like:</p>
<div class="highlight-python"><pre>[composite:main]
use = egg:Paste#urlmap
/ = mainapp
/files = staticapp

[app:mainapp]
use = egg:MyApp

[app:staticapp]
use = egg:Paste#static
document_root = /path/to/docroot</pre>
</div>
<p>The composite application &#8220;main&#8221; is just like any other application
from the outside (you load it with <tt class="docutils literal"><span class="pre">loadapp</span></tt> for instance), but it
has access to other applications defined in the configuration file.</p>
</div>
<div class="section" id="other-objects">
<h3><a class="toc-backref" href="#id16">Other Objects</a><a class="headerlink" href="#other-objects" title="Permalink to this headline">¶</a></h3>
<p>In addition to sections with <tt class="docutils literal"><span class="pre">app:</span></tt>, you can define filters and
servers in a configuration file, with <tt class="docutils literal"><span class="pre">server:</span></tt> and <tt class="docutils literal"><span class="pre">filter:</span></tt>
prefixes.  You load these with <tt class="docutils literal"><span class="pre">loadserver</span></tt> and <tt class="docutils literal"><span class="pre">loadfilter</span></tt>.  The
configuration works just the same; you just get back different kinds
of objects.</p>
</div>
<div class="section" id="filter-composition">
<h3><a class="toc-backref" href="#id17">Filter Composition</a><a class="headerlink" href="#filter-composition" title="Permalink to this headline">¶</a></h3>
<p>There are several ways to apply filters to applications.  It mostly
depends on how many filters, and in what order you want to apply them.</p>
<p>The first way is to use the <tt class="docutils literal"><span class="pre">filter-with</span></tt> setting, like:</p>
<div class="highlight-python"><pre>[app:main]
use = egg:MyEgg
filter-with = printdebug

[filter:printdebug]
use = egg:Paste#printdebug
# and you could have another filter-with here, and so on...</pre>
</div>
<p>Also, two special section types exist to apply filters to your
applications: <tt class="docutils literal"><span class="pre">[filter-app:...]</span></tt> and <tt class="docutils literal"><span class="pre">[pipeline:...]</span></tt>.  Both of
these sections define applications, and so can be used wherever an
application is needed.</p>
<p><tt class="docutils literal"><span class="pre">filter-app</span></tt> defines a filter (just like you would in a
<tt class="docutils literal"><span class="pre">[filter:...]</span></tt> section), and then a special key <tt class="docutils literal"><span class="pre">next</span></tt> which
points to the application to apply the filter to.</p>
<p><tt class="docutils literal"><span class="pre">pipeline:</span></tt> is used when you need apply a number of filters.  It
takes <em>one</em> configuration key <tt class="docutils literal"><span class="pre">pipeline</span></tt> (plus any global
configuration overrides you want).  <tt class="docutils literal"><span class="pre">pipeline</span></tt> is a list of filters
ended by an application, like:</p>
<div class="highlight-python"><pre>[pipeline:main]
pipeline = filter1 egg:FilterEgg#filter2 filter3 app

[filter:filter1]
...</pre>
</div>
</div>
<div class="section" id="getting-configuration">
<h3><a class="toc-backref" href="#id18">Getting Configuration</a><a class="headerlink" href="#getting-configuration" title="Permalink to this headline">¶</a></h3>
<p>If you want to get the configuration without creating the application,
you can use the <tt class="docutils literal"><span class="pre">appconfig(uri)</span></tt> function, which is just like the
<tt class="docutils literal"><span class="pre">loadapp()</span></tt> function except it returns the configuration that would
be used, as a dictionary.  Both global and local configuration is
combined into a single dictionary, but you can look at just one or the
other with the attributes <tt class="docutils literal"><span class="pre">.local_conf</span></tt> and <tt class="docutils literal"><span class="pre">.global_conf</span></tt>.</p>
</div>
</div>
<div class="section" id="egg-uris">
<h2><a class="toc-backref" href="#id19"><tt class="docutils literal"><span class="pre">egg:</span></tt> URIs</a><a class="headerlink" href="#egg-uris" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://peak.telecommunity.com/DevCenter/PythonEggs">Python Eggs</a>
are a distribution and installation format produced by <a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools">setuptools</a> and
<a class="reference external" href="http://packages.python.org/distribute/">distribute</a> that adds metadata to a
normal Python package (among other things).</p>
<p>You don&#8217;t need to understand a whole lot about Eggs to use them.  If
you have a <a class="reference external" href="http://python.org/doc/current/lib/module-distutils.html">distutils</a>
<tt class="docutils literal"><span class="pre">setup.py</span></tt> script, just change:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
</pre></div>
</div>
<p>Now when you install the package it will be installed as an egg.</p>
<p>The first important part about an Egg is that it has a
<em>specification</em>.  This is formed from the name of your distribution
(the <tt class="docutils literal"><span class="pre">name</span></tt> keyword argument to <tt class="docutils literal"><span class="pre">setup()</span></tt>), and you can specify a
specific version.  So you can have an egg named <tt class="docutils literal"><span class="pre">MyApp</span></tt>, or
<tt class="docutils literal"><span class="pre">MyApp==0.1</span></tt> to specify a specific version.</p>
<p>The second is <em>entry points</em>.  These are references to Python objects
in your packages that are named and have a specific protocol.
&#8220;Protocol&#8221; here is just a way of saying that we will call them with
certain arguments, and expect a specific return value.  We&#8217;ll talk
more about the protocols <a class="reference internal" href="#defining-factories">later</a>.</p>
<p>The important part here is how we define entry points.  You&#8217;ll add an
argument to <tt class="docutils literal"><span class="pre">setup()</span></tt> like:</p>
<div class="highlight-python"><pre>setup(
    name='MyApp',
    ...
    entry_points={
        'paste.app_factory': [
            'main=myapp.mymodule:app_factory',
            'ob2=myapp.mymodule:ob_factory'],
        },
    )</pre>
</div>
<p>This defines two applications named <tt class="docutils literal"><span class="pre">main</span></tt> and <tt class="docutils literal"><span class="pre">ob2</span></tt>.  You can
then refer to these by <tt class="docutils literal"><span class="pre">egg:MyApp#main</span></tt> (or just <tt class="docutils literal"><span class="pre">egg:MyApp</span></tt>,
since <tt class="docutils literal"><span class="pre">main</span></tt> is the default) and <tt class="docutils literal"><span class="pre">egg:MyApp#ob2</span></tt>.</p>
<p>The values are instructions for importing the objects.  <tt class="docutils literal"><span class="pre">main</span></tt> is
located in the <tt class="docutils literal"><span class="pre">myapp.mymodule</span></tt> module, in an object named
<tt class="docutils literal"><span class="pre">app_factory</span></tt>.</p>
<p>There&#8217;s no way to add configuration to objects imported as Eggs.</p>
</div>
<div class="section" id="defining-factories">
<h2><a class="toc-backref" href="#id20">Defining Factories</a><a class="headerlink" href="#defining-factories" title="Permalink to this headline">¶</a></h2>
<p>This lets you point to factories (that obey the specific protocols we
mentioned).  But that&#8217;s not much use unless you can create factories
for your applications.</p>
<p>There&#8217;s a few protocols: <tt class="docutils literal"><span class="pre">paste.app_factory</span></tt>,
<tt class="docutils literal"><span class="pre">paste.composite_factory</span></tt>, <tt class="docutils literal"><span class="pre">paste.filter_factory</span></tt>, and lastly
<tt class="docutils literal"><span class="pre">paste.server_factory</span></tt>.  Each of these expects a callable (like a
function, method, or class).</p>
<div class="section" id="paste-app-factory">
<h3><a class="toc-backref" href="#id21"><tt class="docutils literal"><span class="pre">paste.app_factory</span></tt></a><a class="headerlink" href="#paste-app-factory" title="Permalink to this headline">¶</a></h3>
<p>The application is the most common.  You define one like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">app_factory</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">wsgi_app</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">global_config</span></tt> is a dictionary, and local configuration is
passed as keyword arguments.  The function returns a WSGI application.</p>
</div>
<div class="section" id="paste-composite-factory">
<h3><a class="toc-backref" href="#id22"><tt class="docutils literal"><span class="pre">paste.composite_factory</span></tt></a><a class="headerlink" href="#paste-composite-factory" title="Permalink to this headline">¶</a></h3>
<p>Composites are just slightly more complex:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">composite_factory</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">wsgi_app</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">loader</span></tt> argument is an object that has a couple interesting
methods.  <tt class="docutils literal"><span class="pre">get_app(name_or_uri,</span> <span class="pre">global_conf=None)</span></tt> return a WSGI
application with the given name.  <tt class="docutils literal"><span class="pre">get_filter</span></tt> and <tt class="docutils literal"><span class="pre">get_server</span></tt>
work the same way.</p>
<p>A more interesting example might be a composite factory that does
something.  For instance, consider a &#8220;pipeline&#8221; application:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">pipeline_factory</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">global_config</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">):</span>
    <span class="c"># space-separated list of filter and app names:</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">loader</span><span class="o">.</span><span class="n">get_filter</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_app</span><span class="p">(</span><span class="n">pipeline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c"># apply in reverse order!</span>
    <span class="k">for</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>Then we use it like:</p>
<div class="highlight-python"><pre>[composite:main]
use = &lt;pipeline_factory_uri&gt;
pipeline = egg:Paste#printdebug session myapp

[filter:session]
use = egg:Paste#session
store = memory

[app:myapp]
use = egg:MyApp</pre>
</div>
</div>
<div class="section" id="paste-filter-factory">
<h3><a class="toc-backref" href="#id23"><tt class="docutils literal"><span class="pre">paste.filter_factory</span></tt></a><a class="headerlink" href="#paste-filter-factory" title="Permalink to this headline">¶</a></h3>
<p>Filter factories are just like app factories (same signature), except
they return filters.  Filters are callables that take a WSGI
application as the only argument, and return a &#8220;filtered&#8221; version of
that application.</p>
<p>Here&#8217;s an example of a filter that checks that the <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> CGI
variable is set, creating a really simple authentication filter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">auth_filter_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="n">req_usernames</span><span class="p">):</span>
    <span class="c"># space-separated list of usernames:</span>
    <span class="n">req_usernames</span> <span class="o">=</span> <span class="n">req_usernames</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AuthFilter</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">req_usernames</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">filter</span>

<span class="k">class</span> <span class="nc">AuthFilter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">req_usernames</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_usernames</span> <span class="o">=</span> <span class="n">req_usernames</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;REMOTE_USER&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">req_usernames</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
        <span class="n">start_response</span><span class="p">(</span>
            <span class="s">&#39;403 Forbidden&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;You are forbidden to view this resource&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="paste-filter-app-factory">
<h3><a class="toc-backref" href="#id24"><tt class="docutils literal"><span class="pre">paste.filter_app_factory</span></tt></a><a class="headerlink" href="#paste-filter-app-factory" title="Permalink to this headline">¶</a></h3>
<p>This is very similar to <tt class="docutils literal"><span class="pre">paste.filter_factory</span></tt>, except that it also
takes a <tt class="docutils literal"><span class="pre">wsgi_app</span></tt> argument, and returns a WSGI application.  So if
you changed the above example to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AuthFilter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">global_conf</span><span class="p">,</span> <span class="n">req_usernames</span><span class="p">):</span>
        <span class="o">....</span>
</pre></div>
</div>
<p>Then <tt class="docutils literal"><span class="pre">AuthFilter</span></tt> would serve as a filter_app_factory
(<tt class="docutils literal"><span class="pre">req_usernames</span></tt> is a required local configuration key in this
case).</p>
</div>
<div class="section" id="paste-server-factory">
<h3><a class="toc-backref" href="#id25"><tt class="docutils literal"><span class="pre">paste.server_factory</span></tt></a><a class="headerlink" href="#paste-server-factory" title="Permalink to this headline">¶</a></h3>
<p>This takes the same signature as applications and filters, but returns
a server.</p>
<p>A server is a callable that takes a single argument, a WSGI
application.  It then serves the application.</p>
<p>An example might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">server_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">serve</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">serve</span>
</pre></div>
</div>
<p>The implementation of <tt class="docutils literal"><span class="pre">Server</span></tt> is left to the user.</p>
</div>
<div class="section" id="paste-server-runner">
<h3><a class="toc-backref" href="#id26"><tt class="docutils literal"><span class="pre">paste.server_runner</span></tt></a><a class="headerlink" href="#paste-server-runner" title="Permalink to this headline">¶</a></h3>
<p>Like <tt class="docutils literal"><span class="pre">paste.server_factory</span></tt>, except <tt class="docutils literal"><span class="pre">wsgi_app</span></tt> is passed as the
first argument, and the server should run immediately.</p>
</div>
</div>
<div class="section" id="outstanding-issues">
<h2><a class="toc-backref" href="#id27">Outstanding Issues</a><a class="headerlink" href="#outstanding-issues" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Should there be a &#8220;default&#8221; protocol for each type of object?  Since
there&#8217;s currently only one protocol, it seems like it makes sense
(in the future there could be multiple).  Except that
<tt class="docutils literal"><span class="pre">paste.app_factory</span></tt> and <tt class="docutils literal"><span class="pre">paste.composite_factory</span></tt> overlap
considerably.</p>
</li>
<li><p class="first">ConfigParser&#8217;s INI parsing is kind of annoying.  I&#8217;d like it both
more constrained and less constrained.  Some parts are sloppy (like
the way it interprets <tt class="docutils literal"><span class="pre">[DEFAULT]</span></tt>).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">config:</span></tt> URLs should be potentially relative to other locations,
e.g., <tt class="docutils literal"><span class="pre">config:$docroot/...</span></tt>.  Maybe using variables from
<tt class="docutils literal"><span class="pre">global_conf</span></tt>?</p>
</li>
<li><p class="first">Should other variables have access to <tt class="docutils literal"><span class="pre">global_conf</span></tt>?</p>
</li>
<li><p class="first">Should objects be Python-syntax, instead of always strings?  Lots of
code isn&#8217;t usable with Python strings without a thin wrapper to
translate objects into their proper types.</p>
</li>
<li><p class="first">Some short-form for a filter/app, where the filter refers to the
&#8220;next app&#8221;.  Maybe like:</p>
<div class="highlight-python"><pre>[app-filter:app_name]
use = egg:...
next = next_app

[app:next_app]
...</pre>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="http://pythonpaste.org/" class="invisible-link">Python Paste</a></h3>

<ul>
<li><a href="http://trac.pythonpaste.org">Issue tracker</a></li>
<li><a href="http://pythonpaste.org/">Paste core</a></li>
<li><a href="http://pythonpaste.org/deploy/">Paste Deploy</a></li>
<li><a href="http://pythonpaste.org/script/">Paste Script</a></li>
</ul>


  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Paste Deployment</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#from-the-user-perspective">From the User Perspective</a><ul>
<li><a class="reference internal" href="#the-config-file">The Config File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#config-uris"><tt class="docutils literal"><span class="pre">config:</span></tt> URIs</a><ul>
<li><a class="reference internal" href="#config-format">Config Format</a></li>
<li><a class="reference internal" href="#applications">Applications</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#global-configuration">Global Configuration</a></li>
<li><a class="reference internal" href="#composite-applications">Composite Applications</a></li>
<li><a class="reference internal" href="#other-objects">Other Objects</a></li>
<li><a class="reference internal" href="#filter-composition">Filter Composition</a></li>
<li><a class="reference internal" href="#getting-configuration">Getting Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#egg-uris"><tt class="docutils literal"><span class="pre">egg:</span></tt> URIs</a></li>
<li><a class="reference internal" href="#defining-factories">Defining Factories</a><ul>
<li><a class="reference internal" href="#paste-app-factory"><tt class="docutils literal"><span class="pre">paste.app_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-composite-factory"><tt class="docutils literal"><span class="pre">paste.composite_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-filter-factory"><tt class="docutils literal"><span class="pre">paste.filter_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-filter-app-factory"><tt class="docutils literal"><span class="pre">paste.filter_app_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-server-factory"><tt class="docutils literal"><span class="pre">paste.server_factory</span></tt></a></li>
<li><a class="reference internal" href="#paste-server-runner"><tt class="docutils literal"><span class="pre">paste.server_runner</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#outstanding-issues">Outstanding Issues</a></li>
</ul>
</li>
</ul>


  <h4>Next topic</h4>
  <p class="topless"><a href="news.html"
                        title="next chapter">Paste Deployment News</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="news.html" title="Paste Deployment News"
             >next</a> |</li>
        <li><a href="#">Paste Deploy v1.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Ian Bicking and contributors.
      Last updated on May 24, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>