<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>python 序列化 - linyawen - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=YYJLqcS-yQBgPcBQD0DFeVOtWATm3SiivBaq_g8VruA1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/BlackSun/bundle-BlackSun.css?v=cjspy28G783rIsTSXk7szarHiaYj1T6WUxovI8nmoCg1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/linyawen/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/linyawen/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/linyawen/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'linyawen', cb_enable_mathjax=false;</script>
<script src="/bundles/blog-common.js?v=dkln2pS2oY4g0UmnwuCbUZ0RytVF5RudpYVB73ig5sc1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="top">
	
<div>
	<table class="HeaderTitles">
		<tr>
			<td>
				<h1 class="HeaderTitle"><a id="Header1_HeaderTitle" class="HeaderMainTitle" href="http://www.cnblogs.com/linyawen/">linyawen</a></h1>
				<p id="tagline"></p>
			</td>
		</tr>
	</table>
</div>
<div>
	<table id="HeaderBar" class="HeaderBar">
		<tr>
			<td class="HeaderBarTab" nowrap>
				
&nbsp;
<a id="Header1_MyLinks1_HomeLink" href="http://www.cnblogs.com/">博客园</a>&nbsp;::
<a id="Header1_MyLinks1_MyHomeLink" href="http://www.cnblogs.com/linyawen/">首页</a>&nbsp;::
<a id="Header1_MyLinks1_NewPostLink" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a>&nbsp;::
<a id="Header1_MyLinks1_ContactLink" accesskey="9" rel="nofollow" href="http://space.cnblogs.com/msg/send/linyawen">联系</a>&nbsp;::
<a id="Header1_MyLinks1_Syndication" href="http://www.cnblogs.com/linyawen/rss">订阅</a>
<a id="Header1_MyLinks1_XMLLink" class="XMLLink" href="http://www.cnblogs.com/linyawen/rss"><img src="http://www.cnblogs.com/images/xml.gif" alt="订阅" /></a>&nbsp;::
<a id="Header1_MyLinks1_Admin" rel="nofollow" href="http://i.cnblogs.com/">管理</a>

			</td>
			
			<td class="HeaderBarTabBack" nowrap width="100%">
				

	<table class="BlogStatsBar">
		<tr>
			<td width="100%">
			</td>
			<td class="BlogStatsBar" nowrap>
				&nbsp;
				276 
				Posts&nbsp;::
				0 Stories
				::
				20 Comments
				::
				0 Trackbacks
			</td>
		</tr>
	</table>

			</td>
		</tr>
	</table>
</div>

</div>
<table id="maintable">
	<tr><td id="leftmenu">
	
		
<h3>公告</h3>
<div class="News">
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

		<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
	
</td><td id="main">
	

<div class="post">
			<div class="postTitle">
				<a id="cb_post_title_url" href="http://www.cnblogs.com/linyawen/archive/2012/03/22/2411381.html">python 序列化</a>
			</div>
	
	<div class="postText">
		<div id="cnblogs_post_body"><p>转自</p>
<p><a href="http://blog.csdn.net/shark0001/article/details/6175783">http://blog.csdn.net/shark0001/article/details/6175783</a></p>
<p>From: http://woodpecker.org.cn/diveintopython3/serializing.html</p>
<h1>序列化Python对象</h1>
<blockquote class="q">
<p><span class="u">❝</span>&nbsp;Every Saturday since we&rsquo;ve lived in this apartment, I have awakened at 6:15, poured myself a bowl of cereal, added<br />a quarter-cup of 2% milk, sat on&nbsp;<strong>this</strong>&nbsp;end of&nbsp;<strong>this</strong>&nbsp;couch, turned on BBC America, and watched Doctor Who.&nbsp;<span class="u">❞</span>&nbsp;<br />&mdash; Sheldon,&nbsp;<a href="http://en.wikiquote.org/wiki/The_Big_Bang_Theory#The_Dumpling_Paradox_.5B1.07.5D">The Big Bang Theory</a></p>
</blockquote>
<p id="toc"><span class="nm u">‣</span>&nbsp;<a>显示目录</a></p>
<h2 id="divingin">深入<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#divingin">#</a></h2>
<p><dfn>序列化</dfn>&nbsp;的概念很简单。内存里面有一个数据结构，你希望将它保存下来，重用，或者发送给其他人。你会怎么做？嗯, 这取决于你想要怎么保存，怎么重用，发送给谁。很多游戏允许你在退出的时候保存进度，然后你再次启动的时候回到上次退出的地方。(实际上, 很多非游戏程序也会这么干。) 在这个情况下, 一个捕获了当前进度的数据结构需要在你退出的时候保存到磁盘上，接着在你重新启动的时候从磁盘上加载进来。这个数据只会被创建它的程序使用，不会发送到网 络上，也不会被其它程序读取。因此，互操作的问题被限制在保证新版本的程序能够读取以前版本的程序创建的数据。</p>
<p>在这种情况下，<code>pickle</code>&nbsp;模块是理想的。它是Python标准库的一部分, 所以它总是可用的。它很快; 它的大部分同Python解释器本身一样是用C写的。 它可以存储任意复杂的Python数据结构。</p>
<p>什么东西能用<code>pickle</code>&nbsp;模块存储?</p>
<ul>
<li>所有Python支持的&nbsp;<a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html">原生类型</a>&nbsp;: 布尔, 整数, 浮点数, 复数, 字符串,&nbsp;<code>bytes</code>&nbsp;(字节串)对象, 字节数组, 以及&nbsp;<code>None</code>&nbsp;.</li>
<li>由任何原生类型组成的列表，元组，字典和集合。</li>
<li>由任何原生类型组成的列表，元组，字典和集合组成的列表，元组，字典和集合(可以一直嵌套下去，直至<a title="sys.getrecursionlimit()" href="http://docs.python.org/3.1/library/sys.html#sys.getrecursionlimit">Python支持的最大递归层数</a>&nbsp;).</li>
<li>函数，类，和类的实例(带警告)。</li>
</ul>
<p>如果这还不够用，<code>pickle</code>&nbsp;模块也是可扩展的。如果你对可扩展性有兴趣，请查看本章最后的<a href="http://woodpecker.org.cn/diveintopython3/serializing.html#furtherreading">进一步阅读</a>&nbsp;小节中的链接。</p>
<h3 id="administrivia">本章例子的快速笔记<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#administrivia">#</a></h3>
<p>本章会使用两个Python Shell来讲故事。本章的例子都是一个单独的故事的一部分。当我演示<code>pickle</code>&nbsp;和&nbsp;<code>json</code>&nbsp;模块时，你会被要求在两个Python Shell中来回切换。</p>
<p>为了让事情简单一点，打开Python Shell 并定义下面的变量:</p>
<pre name="code" class="nd screen"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell&nbsp;</span><span class="pun">=</span>&nbsp;<span class="lit">1</span></kbd></pre>
<p>保持该窗口打开。 现在打开另一个Python Shell 并定义下面下面的变量:</p>
<pre name="code" class="nd screen"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell&nbsp;</span><span class="pun">=</span>&nbsp;<span class="lit">2</span></kbd></pre>
<p>贯穿整个章节, 在每个例子中我会使用<code>shell</code>&nbsp;变量来标识使用的是哪个Python Shell。</p>
<p class="a">⁂</p>
<h2 id="dump">保存数据到 Pickle 文件<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#dump">#</a></h2>
<p><code>pickle</code>&nbsp;模块的工作对象是数据结构。让我们来创建一个：</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre0">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pun">{}</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'article_link'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="kwd">None</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="str">'/xDE/xD5/xB4/xF8'</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="kwd">True</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">time</span>&nbsp;</kbd><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">strptime</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'Fri Mar 27 22:20:42 2009'</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">]</span>&nbsp;</kbd><br /><samp class="pp"><span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">struct_time</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">tm_year</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">2009</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mon</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">3</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">27</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_hour</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">22</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_min</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">20</span>&nbsp;<span class="pun">,</span><span class="pln">tm_sec</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">42</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_wday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">4</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_yday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">86</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_isdst</span>&nbsp;<span class="pun">=-</span>&nbsp;<span class="lit">1</span>&nbsp;<span class="pun">)</span></samp></div>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>在Python Shell #1 里面。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>想法是建立一个Python字典来表示一些有用的东西，比如<a href="http://woodpecker.org.cn/diveintopython3/xml.html#xml-structure">一个Atom 供稿的entry</a>&nbsp;。但是为了炫耀一下<code>pickle</code>模块我也想保证里面包含了多种不同的数据类型。不需要太关心这些值。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td><code>time</code>&nbsp;模块包含一个表示时间点(精确到1毫秒)的数据结构(<code>time_struct</code>&nbsp;)以及操作时间结构的函数。<code>strptime()</code>&nbsp;函数接受一个格式化过的字符串并将其转化成一个<code>time_struct</code>&nbsp;。这个字符串使用的是默认格式，但你可以通过格式化代码来控制它。查看<a href="http://docs.python.org/3.1/library/time.html"><code>time</code>&nbsp;模块</a>&nbsp;来获得更多细节。</td>
</tr>
</tbody>
</table>
<p>这是一个很帅的Python 字典。让我们把它保存到文件。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre1">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">pickle</span>&nbsp;</kbd><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.pickle'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'wb'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; pickle</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="p">...</samp></div>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>仍然在Python Shell #1 中。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>使用<code>open()</code>&nbsp;函数来打开一个文件。设置文件模式为<code>'wb'</code>&nbsp;来以<a href="http://woodpecker.org.cn/diveintopython3/files.html#binary">二进制</a>&nbsp;写模式打开文件。把它放入<a href="http://woodpecker.org.cn/diveintopython3/files.html#with"><code>with</code>&nbsp;语句</a>&nbsp;中来保证在你完成的时候文件自动被关闭。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td><code>pickle</code>&nbsp;模块中的<code>dump()</code>&nbsp;函数接受一个可序列化的Python 数据结构, 使用最新版本的pickle协议将其序列化为一个二进制的，Python特定的格式， 并且保存到一个打开的文件里。</td>
</tr>
</tbody>
</table>
<p>最后一句话很重要。</p>
<ul>
<li><code>pickle</code>&nbsp;模块接受一个Python数据结构并将其保存的一个文件。</li>
<li>要做到这样，它使用一个被称为&ldquo;pickle协议&rdquo;的东西<em>序列化</em>&nbsp;该数据结构。</li>
<li>pickle 协议是Python特定的，没有任何跨语言兼容的保证。你很可能不能使用Perl,&nbsp;<abbr>PHP</abbr>&nbsp;, Java, 或者其他语言来对你刚刚创建的<code>entry.pickle</code>&nbsp;文件做任何有用的事情。</li>
<li>并非所有的Python数据结构都可以通过<code>pickle</code>&nbsp;模块序列化。随着新的数据类型被加入到Python语言中，pickle协议已经被修改过很多次了，但是它还是有一些限制。</li>
<li>由于这些变化，不同版本的Python的兼容性也没有保证。新的版本的Python支持旧的序列化格式，但是旧版本的Python不支持新的格式(因为它们不支持新的数据类型)。</li>
<li>除非你指定，<code>pickle</code>&nbsp;模块中的函数将使用最新版本的pickle协议。这保证了你对可以被序列化的数据类型有最大的灵活度，但这也意味着生成的文件不能被不支持新版pickle协议的旧版本的Python读取。</li>
<li>最新版本的pickle协议是二进制格式的。请确认使用<a href="http://woodpecker.org.cn/diveintopython3/files.html#binary">二进制模式</a>&nbsp;来打开你的pickle文件,否则当你写入的时候数据会被损坏。</li>
</ul>
<p class="a">⁂</p>
<h2 id="load">从Pickle文件读取数据<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#load">#</a></h2>
<p>现在切换到你的第二个Python Shell&nbsp;&mdash;&nbsp;<em>即</em>&nbsp;不是你创建<code>entry</code>&nbsp;字典的那个。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre2">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="lit">2</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="traceback">Traceback (most recent call last):<br />File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />NameError: name 'entry' is not defined</samp>&nbsp;<br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">pickle</span>&nbsp;</kbd><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.pickle'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'rb'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; entry&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">pickle</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">load</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">④</span>&nbsp;</a><br /><samp class="p">...&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><span class="u">⑤</span>&nbsp;</a><br /><samp class="pp"><span class="pun">{</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">None</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="str">'/xDE/xD5/xB4/xF8'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">),</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'article_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">struct_time</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">tm_year</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">2009</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mon</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">3</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">27</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_hour</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">22</span><span class="pun">,</span>&nbsp;<span class="pln">tm_min</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">20</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_sec</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">42</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_wday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">4</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_yday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">86</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_isdst</span>&nbsp;<span class="pun">=-</span>&nbsp;<span class="lit">1</span>&nbsp;<span class="pun">),</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">True</span>&nbsp;<span class="pun">}</span></samp></div>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>这是Python Shell #2.</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>这里没有<var>entry</var>&nbsp;变量被定义过。你在Python Shell #1 中定义了<var>entry</var>&nbsp;变量, 但是那是另一个拥有自己状态的完全不同的环境。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>打开你在Python Shell #1中创建的<code>entry.pickle</code>&nbsp;文件。<code>pickle</code>&nbsp;模块使用二进制数据格式，所以你总是应该使用二进制模式打开pickle文件。</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td><code>pickle.load()</code>&nbsp;函数接受一个<a href="http://woodpecker.org.cn/diveintopython3/files.html#file-objects">流对象</a>&nbsp;, 从流中读取序列化后的数据，创建一个新的Python对象，在新的Python对象中重建被序列化的数据，然后返回新建的Python对象。</td>
</tr>
<tr>
<td><span class="u">⑤</span></td>
<td>现在<var>entry</var>&nbsp;变量是一个键和值看起来都很熟悉的字典。</td>
</tr>
</tbody>
</table>
<p><code>pickle.dump() / pickle.load()</code>&nbsp;循环的结果是一个和原始数据结构等同的新的数据结构。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre3">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.pickle'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'rb'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; entry2&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">pickle</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">load</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="p">...&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2&nbsp;</span><span class="pun">==</span>&nbsp;<span class="pln">entry</span>&nbsp;</kbd><span class="u">④</span>&nbsp;</a><br /><samp class="pp"><span class="kwd">True</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2&nbsp;</span><span class="kwd">is</span>&nbsp;<span class="pln">entry</span>&nbsp;</kbd><span class="u">④</span>&nbsp;</a><br /><samp class="pp"><span class="kwd">False</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">]</span>&nbsp;</kbd><span class="u">⑥</span>&nbsp;</a><br /><samp class="pp"><span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">)</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">]</span>&nbsp;</kbd><br /><samp class="pp"><span class="pln">b</span>&nbsp;<span class="str">'/xDE/xD5/xB4/xF8'</span></samp></div>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>切换回Python Shell #1。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>打开<code>entry.pickle</code>&nbsp;文件。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>将序列化后的数据装载到一个新的变量,&nbsp;<var>entry2</var>&nbsp;。</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td>Python 确认两个字典,&nbsp;<var>entry</var>&nbsp;和&nbsp;<var>entry2</var>&nbsp;是相等的。在这个shell里, 你从零开始构造了<var>entry</var>&nbsp;, 从一个空字典开始然后手工给各个键赋值。你序列化了这个字典并将其保存在<code>entry.pickle</code>&nbsp;文件中。现在你从文件中读取序列化后的数据并创建了原始数据结构的一个完美复制品。</td>
</tr>
<tr>
<td><span class="u">⑤</span></td>
<td>相等和相同是不一样的。我说的是你创建了原始数据结构的一个<em>完美复制品</em>&nbsp;, 这没错。但它仅仅是一个复制品。</td>
</tr>
<tr>
<td><span class="u">⑥</span></td>
<td>我要指出<code>'tags'</code>&nbsp;键对应的值是一个元组，而<code>'internal_id'</code>&nbsp;键对应的值是一个<code>bytes</code>&nbsp;对象。原因在这章的后面就会清楚了。</td>
</tr>
</tbody>
</table>
<p class="a">⁂</p>
<h2 id="dumps">不使用文件来进行序列化<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#dumps">#</a></h2>
<p>前一节中的例子展示了如果将一个Python对象序列化到磁盘文件。但如果你不想或不需要文件呢？你也可以序列化到一个内存中的<code>bytes</code>&nbsp;对象。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre4">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">b&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">pickle</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">dumps</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">entry</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">type</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="pp"><span class="tag">&lt;class</span>&nbsp;<span class="atv">'bytes'</span>&nbsp;<span class="tag">&gt;</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry3&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">pickle</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">loads</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry3&nbsp;</span><span class="pun">==</span>&nbsp;<span class="pln">entry</span>&nbsp;</kbd><span class="u">④</span>&nbsp;</a><br /><samp class="pp"><span class="kwd">True</span></samp></div>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td><code>pickle.dumps()</code>&nbsp;函数(注意函数名最后的<code>'s'</code>&nbsp;)执行和<code>pickle.dump()</code>&nbsp;函数相同的序列化。取代接受流对象并将序列化后的数据保存到磁盘文件，这个函数简单的返回序列化的数据。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>由于pickle协议使用一个二进制数据格式，所以<code>pickle.dumps()</code>&nbsp;函数返回<code>bytes</code>&nbsp;对象。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td><code>pickle.loads()</code>&nbsp;函数(再一次, 注意函数名最后的<code>'s'</code>&nbsp;) 执行和<code>pickle.load()</code>&nbsp;函数一样的反序列化。取代接受一个流对象并去文件读取序列化后的数据，它接受包含序列化后的数据的<code>bytes</code>&nbsp;对象, 比如<code>pickle.dumps()</code>函数返回的对象。</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td>最终结果是一样的: 原始字典的完美复制。</td>
</tr>
</tbody>
</table>
<p class="a">⁂</p>
<h2 id="protocol-versions">字节串和字符串又一次抬起了它们丑陋的头。<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#protocol-versions">#</a></h2>
<p>pickle协议已经存在好多年了，它随着Python本身的成熟也不断成熟。现在存在<a href="http://docs.python.org/3.1/library/pickle.html#data-stream-format">四个不同版本</a>&nbsp;的pickle协议。</p>
<ul>
<li>Python 1.x 有两个pickle协议，一个基于文本的格式(&ldquo;版本 0&rdquo;) 以及一个二进制格式(&ldquo;版本 1&rdquo;).</li>
<li>Python 2.3 引入了一个新的pickle协议(&ldquo;版本 2&rdquo;) 来处理Python 类对象的新功能。它是一个二进制格式。</li>
<li>Python 3.0 引入了另一个pickle 协议 (&ldquo;版本 3&rdquo;) ，显式的支持<code>bytes</code>&nbsp;对象和字节数组。它是一个二进制格式。</li>
</ul>
<p>你看,&nbsp;<a href="http://woodpecker.org.cn/diveintopython3/strings.html#byte-arrays">字节串和字符串的区别</a>&nbsp;又一次抬起了它们丑陋的头。 (如果你觉得惊奇，你肯定开小差了。) 在实践中这意味着, 尽管Python 3 可以读取版本 2 的pickle 协议生成的数据, Python 2 不能读取版本 3的协议生成的数据.</p>
<p class="a">⁂</p>
<h2 id="debugging">调试Pickle 文件<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#debugging">#</a></h2>
<p>pickle 协议是长什么样的呢？让我们离开Python Shell一会会，来看一下我们创建的<code>entry.pickle</code>&nbsp;文件。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre5">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>ls -l entry.pickle</kbd>&nbsp;<br /><samp>-rw-r--r-- 1 you you 358 Aug 3 13:34 entry.pickle</samp>&nbsp;<br /><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>cat entry.pickle</kbd>&nbsp;<br /><samp>comments_linkqNXtagsqXdiveintopythonqXdocbookqXhtmlq?qX publishedq?<br />XlinkXJhttp://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition<br />q Xpublished_dateq<br />ctime<br />struct_time<br />?qRqXtitleqXDive into history, 2009 editionqu.</samp></div>
<p id="postautopre5">这不是很有用。你可以看见字符串，但是其他数据类型显示为不可打印的(或者至少是不可读的)字符。域之间没有明显的分隔符(比如跳格符或空格)。你肯定不希望来调试这样一个格式。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre6">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">pickletools</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.pickle'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'rb'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; pickletools</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">dis</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp>0: /x80 PROTO 3<br />2: } EMPTY_DICT<br />3: q BINPUT 0<br />5: ( MARK<br />6: X BINUNICODE 'published_date'<br />25: q BINPUT 1<br />27: c GLOBAL 'time struct_time'<br />45: q BINPUT 2<br />47: ( MARK<br />48: M BININT2 2009<br />51: K BININT1 3<br />53: K BININT1 27<br />55: K BININT1 22<br />57: K BININT1 20<br />59: K BININT1 42<br />61: K BININT1 4<br />63: K BININT1 86<br />65: J BININT -1<br />70: t TUPLE (MARK at 47)<br />71: q BINPUT 3<br />73: } EMPTY_DICT<br />74: q BINPUT 4<br />76: /x86 TUPLE2<br />77: q BINPUT 5<br />79: R REDUCE<br />80: q BINPUT 6<br />82: X BINUNICODE 'comments_link'<br />100: q BINPUT 7<br />102: N NONE<br />103: X BINUNICODE 'internal_id'<br />119: q BINPUT 8<br />121: C SHORT_BINBYTES '脼脮麓酶'<br />127: q BINPUT 9<br />129: X BINUNICODE 'tags'<br />138: q BINPUT 10<br />140: X BINUNICODE 'diveintopython'<br />159: q BINPUT 11<br />161: X BINUNICODE 'docbook'<br />173: q BINPUT 12<br />175: X BINUNICODE 'html'<br />184: q BINPUT 13<br />186: /x87 TUPLE3<br />187: q BINPUT 14<br />189: X BINUNICODE 'title'<br />199: q BINPUT 15<br />201: X BINUNICODE 'Dive into history, 2009 edition'<br />237: q BINPUT 16<br />239: X BINUNICODE 'article_link'<br />256: q BINPUT 17<br />258: X BINUNICODE 'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'<br />337: q BINPUT 18<br />339: X BINUNICODE 'published'<br />353: q BINPUT 19<br />355: /x88 NEWTRUE<br />356: u SETITEMS (MARK at 5)<br />357: . STOP<br />highest protocol among opcodes = 3</samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre6">这个反汇编中最有趣的信息是最后一行,<br />因为它包含了文件保存时使用的pickle协议的版本号。在pickle协议里面没有明确的版本标志。为了确定保存pickle文件时使用的协议版本，你<br />需要查看序列化后的数据的标记(&ldquo;opcodes&rdquo;)并且使用硬编码的哪个版本的协议引入了哪些标记的知识(来确定版本号)。<code>pickle.dis()</code>&nbsp;函数正是这么干的，并且它在反汇编的输出的最后一行打印出结果。下面是一个不打印，仅仅返回版本号的函数:</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre7">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;] [<a href="http://woodpecker.org.cn/diveintopython3/examples/pickleversion.py">下载&nbsp;<code>pickleversion.py</code>&nbsp;</a>]</div>
<div class="b"><code><span class="kwd">import</span>&nbsp;<span class="pln">pickletools<br /><br /></span><span class="kwd">def</span>&nbsp;<span class="pln">protocol_version</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">file_object</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; maxproto&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pun">-</span>&nbsp;<span class="lit">1</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp;&nbsp;</span><span class="kwd">for</span>&nbsp;<span class="pln">opcode</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">arg</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">pos&nbsp;</span><span class="kwd">in</span>&nbsp;<span class="pln">pickletools</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">genops</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">file_object</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; maxproto&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">max</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">maxproto</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">opcode</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">proto</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pln">maxproto</span></code></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre7">实际使用它:</p>
<pre name="code" class="screen"><br /><br /></pre>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre8">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">pickleversion</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.pickle'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'rb'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; v&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">pickleversion</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">protocol_version</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">v</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">3</span></samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre8" class="a">⁂</p>
<h2 id="json">序列化Python对象以供其它语言读取<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#json">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<p><code>pickle</code>&nbsp;模块使用的数据格式是Python特定的。它没有做任何兼容其它编程语言的努力。如果跨语言兼容是你的需求之一，你得去寻找其它的序列化格式。一个这样的格式是<a href="http://json.org/"><abbr>JSON</abbr>&nbsp;</a>。 &ldquo;<abbr>JSON</abbr>&nbsp;&rdquo; 代表 &ldquo;JavaScript Object Notation,&rdquo; 但是不要让名字糊弄你。&nbsp;&mdash;&nbsp;<abbr>JSON</abbr>&nbsp;是被设计为跨语言使用的。</p>
<p>Python 3 在标准库中包含了一个&nbsp;<code>json</code>&nbsp;模块。同&nbsp;<code>pickle</code>&nbsp;模块类似,&nbsp;<code>json</code>&nbsp;模块包含一些函数，可以序列化数据结构，保存序列化后的数据至磁盘，从磁盘上读取序列化后的数据，将数据反序列化成新的Pythone对象。但两者也有一些很重要的区别。 首先,&nbsp;<abbr>JSON</abbr>&nbsp;数据格式是基于文本的, 不是二进制的。<a href="http://www.ietf.org/rfc/rfc4627.txt">RFC 4627</a>&nbsp;定义了<abbr>JSON</abbr>&nbsp;格式以及怎样将各种类型的数据编码成文本。比如，一个布尔值要么存储为5个字符的字符串<code>'false'</code>&nbsp;，要么存储为4个字符的字符串&nbsp;<code>'true'</code>&nbsp;。 所有的<abbr>JSON</abbr>&nbsp;值都是大小写敏感的。</p>
<p>第二，由于是文本格式, 存在空白(whitespaces)的问题。&nbsp;<abbr>JSON</abbr>&nbsp;允许在值之间有任意数目的空白(空格, 跳格, 回车，换行)。空白是&ldquo;无关紧要的&rdquo;，这意味着<abbr>JSON</abbr>&nbsp;编码器可以按它们的喜好添加任意多或任意少的空白, 而<abbr>JSON</abbr>&nbsp;解码器被要求忽略值之间的任意空白。这允许你&ldquo;美观的打印（pretty-print）&rdquo; 你的&nbsp;<abbr>JSON</abbr>&nbsp;数据, 通过不同的缩进层次嵌套值，这样你就可以在标准浏览器或文本编辑器中阅读它。Python 的&nbsp;<code>json</code>&nbsp;模块有在编码时执行美观打印（pretty-printing）的选项。</p>
<p>第三, 字符编码的问题是长期存在的。<abbr>JSON</abbr>&nbsp;用纯文本编码数据, 但是你知道,&nbsp;<a href="http://woodpecker.org.cn/diveintopython3/strings.html">&ldquo;不存在纯文本这种东西。&rdquo;</a><abbr>JSON</abbr>&nbsp;必须以Unicode 编码(UTF-32, UTF-16, 或者默认的,&nbsp;<abbr>UTF-8</abbr>&nbsp;)方式存储,&nbsp;<a href="http://www.ietf.org/rfc/rfc4627.txt">RFC 4627的第3节</a>&nbsp;定义了如何区分使用的是哪种编码。</p>
<p class="a">⁂</p>
<h2 id="json-dump">将数据保存至&nbsp;<abbr>JSON</abbr>&nbsp;文件<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#json-dump">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<p><abbr>JSON</abbr>&nbsp;看起来非常像你在Javascript中手工定义的数据结构。这不是意外; 实际上你可以使用JavaScript 的<code>eval()</code>&nbsp;函数来&ldquo;解码&rdquo;&nbsp;<abbr>JSON</abbr>&nbsp;序列化过的数据。(通常的<a href="http://woodpecker.org.cn/diveintopython3/advanced-iterators.html#eval">对非信任输入的警告</a>&nbsp;也适用, 但关键点是<abbr>JSON</abbr>&nbsp;<em>是</em>&nbsp;合法的JavaScript。) 因此, 你可能已经熟悉<abbr>JSON</abbr>&nbsp;了。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre9">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pun">{}</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'id'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">256</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="kwd">True</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">basic_entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="kwd">None</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">json</span>&nbsp;</kbd><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'basic.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">mode</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'w'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">basic_entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span></a></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>我们将创建一个新的数据结构，而不是重用现存的<var>entry</var>&nbsp;数据结构。在这章的后面, 我们将会看见当我们试图用<abbr>JSON</abbr>&nbsp;编码更复杂的数据结构的时候会发生什么。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td><abbr>JSON</abbr>&nbsp;是一个基于文本的格式， 这意味你可以以文本模式打开文件，并给定一个字符编码。用<abbr>UTF-8</abbr>&nbsp;总是没错的。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>同<code>pickle</code>&nbsp;模块一样,&nbsp;<code>json</code>&nbsp;模块定义了<code>dump()</code>&nbsp;函数，它接受一个Python 数据结构和一个可写的流对象。<code>dump()</code>&nbsp;函数将Python数据结构序列化并写入到流对象中。在<code>with</code>&nbsp;语句内工作保证当我们完成的时候正确的关闭文件。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>那么生成的<abbr>JSON</abbr>&nbsp;序列化数据是什么样的呢？</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre10">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>cat basic.json</kbd>&nbsp;<br /><samp>{"published": true, "tags": ["diveintopython", "docbook", "html"], "comments_link": null,<br />"id": 256, "title": "Dive into history, 2009 edition"}</samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre10">这肯定<a href="http://woodpecker.org.cn/diveintopython3/serializing.html#debugging">比pickle 文件更可读</a>&nbsp;。然而&nbsp;<abbr>JSON</abbr>&nbsp;的值之间可以包含任意数目的空把, 并且<code>json</code>&nbsp;模块提供了一个方便的途径来利用这一点生成更可读的<abbr>JSON</abbr>&nbsp;文件。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre11">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'basic-pretty.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">mode</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'w'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">basic_entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">indent</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">2</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="u">①</span></kbd></a></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>如果你给<code>json.dump()</code>&nbsp;函数传入<var>indent</var>&nbsp;参数, 它以文件变大为代价使生成的<abbr>JSON</abbr>&nbsp;文件更可读。<var>indent</var>&nbsp;参数是一个整数。0 意味着&ldquo;每个值单独一行。&rdquo; 大于0的数字意味着&ldquo;每个值单独一行并且使用这个数目的空格来缩进嵌套的数据结构。&rdquo;</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>这是结果:</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre12">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>cat basic-pretty.json</kbd>&nbsp;<br /><samp>{<br />"published": true,&nbsp;<br />"tags": [<br />"diveintopython",&nbsp;<br />"docbook",&nbsp;<br />"html"<br />],&nbsp;<br />"comments_link": null,&nbsp;<br />"id": 256,&nbsp;<br />"title": "Dive into history, 2009 edition"<br />}</samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre12" class="a">⁂</p>
<h2 id="json-types">将Python数据类型映射到<abbr>JSON</abbr>&nbsp;<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#json-types">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<p>由于<abbr>JSON</abbr>&nbsp;不是Python特定的，对应到Python的数据类型的时候有很多不匹配。有一些仅仅是名字不同，但是有两个Python数据类型完全缺少。看看你能能把它们指出来:</p>
<table border="0">
<tbody>
<tr><th>笔记</th><th>JSON</th><th>Python 3</th></tr>
<tr><th>&nbsp;</th>
<td>object</td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#dictionaries">dictionary</a></td>
</tr>
<tr><th>&nbsp;</th>
<td>array</td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#lists">list</a></td>
</tr>
<tr><th>&nbsp;</th>
<td>string</td>
<td><a href="http://woodpecker.org.cn/diveintopython3/strings.html#divingin">string</a></td>
</tr>
<tr><th>&nbsp;</th>
<td>integer</td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#numbers">integer</a></td>
</tr>
<tr><th>&nbsp;</th>
<td>real number</td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#numbers">float</a></td>
</tr>
<tr><th>*</th>
<td><code>true</code></td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#booleans"><code>True</code></a></td>
</tr>
<tr><th>*</th>
<td><code>false</code></td>
<td><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#booleans"><code>False</code></a></td>
</tr>
<tr><th>*</th>
<td><code>null</code></td>
<td><code><a href="http://woodpecker.org.cn/diveintopython3/native-datatypes.html#none">None</a></code></td>
</tr>
</tbody>
<tfoot>
<tr>
<td colspan="3">* 所有的&nbsp;<abbr>JSON</abbr>&nbsp;值都是大小写敏感的。</td>
</tr>
</tfoot>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>注意到什么被遗漏了吗？元组和&nbsp;<em class="baa">&amp;</em>&nbsp;字节串（bytes）!&nbsp;<abbr>JSON</abbr>&nbsp;有数组类型,&nbsp;<code>json</code>&nbsp;模块将其映射到Python的列表, 但是它没有一个单独的类型对应 &ldquo;冻结数组(frozen arrays)&rdquo; (元组)。而且尽管&nbsp;<abbr>JSON</abbr>&nbsp;非常好的支持字符串，但是它没有对<code>bytes</code>&nbsp;对象或字节数组的支持。</p>
<p class="a">⁂</p>
<h2 id="json-unknown-types">序列化<abbr>JSON</abbr>&nbsp;不支持的数据类型<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#json-unknown-types">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<p>即使<abbr>JSON</abbr>&nbsp;没有内建的字节流支持, 并不意味着你不能序列化<code>bytes</code>&nbsp;对象。<code>json</code>&nbsp;模块提供了编解码未知数据类型的扩展接口。(&ldquo;未知&rdquo;的意思是≴<abbr>JSON</abbr>&nbsp;没有定义&rdquo;。很显然<code>json</code>&nbsp;模块认识字节数组, 但是它被<abbr>JSON</abbr>&nbsp;规范的限制束缚住了。) 如果你希望编码字节串或者其它<abbr>JSON</abbr>&nbsp;没有原生支持的数据类型，你需要给这些类型提供定制的编码和解码器。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre13">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="pun">{</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">None</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="str">'/xDE/xD5/xB4/xF8'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">),</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'article_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">struct_time</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">tm_year</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">2009</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mon</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">3</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">27</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_hour</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">22</span><span class="pun">,</span>&nbsp;<span class="pln">tm_min</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">20</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_sec</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">42</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_wday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">4</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_yday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">86</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_isdst</span>&nbsp;<span class="pun">=-</span>&nbsp;<span class="lit">1</span>&nbsp;<span class="pun">),</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">True</span>&nbsp;<span class="pun">}</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">json</span>&nbsp;</kbd><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'w'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="p">...&nbsp;</samp><br /><samp class="traceback">Traceback (most recent call last):<br />File "&lt;stdin&gt;", line 5, in &lt;module&gt;<br />File "C:/Python31/lib/json/__init__.py", line 178, in dump<br />for chunk in iterable:<br />File "C:/Python31/lib/json/encoder.py", line 408, in _iterencode<br />for chunk in _iterencode_dict(o, _current_indent_level):<br />File "C:/Python31/lib/json/encoder.py", line 382, in _iterencode_dict<br />for chunk in chunks:<br />File "C:/Python31/lib/json/encoder.py", line 416, in _iterencode<br />o = _default(o)<br />File "C:/Python31/lib/json/encoder.py", line 170, in default<br />raise TypeError(repr(o) + " is not JSON serializable")<br />TypeError: b'/xDE/xD5/xB4/xF8' is not JSON serializable</samp></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>好的, 是时间再看看<var>entry</var>&nbsp;数据结构了。它包含了所有的东西: 布尔值，<code>None</code>&nbsp;值，字符串，字符串元组,<code>bytes</code>&nbsp;对象, 以及<code>time</code>&nbsp;结构体。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>我知道我已经说过了，但是这值得再重复一次：<abbr>JSON</abbr>&nbsp;是一个基于文本的格式。总是应使用<abbr>UTF-8</abbr>&nbsp;字符编码以文本模式打开<abbr>JSON</abbr>&nbsp;文件。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>嗯，<em>这</em>&nbsp;可不好。发生什么了？</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>情况是这样的:&nbsp;<code>json.dump()</code>&nbsp;函数试图序列化<code>bytes</code>&nbsp;对象&nbsp;<code>b'/xDE/xD5/xB4/xF8'</code>&nbsp;，但是它失败了，原因是<abbr>JSON</abbr>不支持<code>bytes</code>&nbsp;对象。然而, 如果保存字节串对你来说很重要，你可以定义自己的&ldquo;迷你序列化格式。&rdquo;</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre14">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;] [<a href="http://woodpecker.org.cn/diveintopython3/examples/customserializer.py">download&nbsp;<code>customserializer.py</code>&nbsp;</a>]</div>
<div class="b"><code><span class="pln"><br /></span><a><span class="kwd">def</span>&nbsp;<span class="pln">to_json</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="u"><span class="pun">①</span>&nbsp;</span></a><span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="pln">isinstance</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">bytes</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">②</span>&nbsp;</span></a><span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pun">{</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'bytes'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="str">'__value__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">list</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">)}</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="u"><span class="pun">③</span>&nbsp;</span></a><span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp;&nbsp;</span><span class="kwd">raise</span>&nbsp;<span class="typ">TypeError</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">repr</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="pun">+</span>&nbsp;<span class="str">' is not JSON serializable'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="pln">&nbsp;</span>&nbsp;<span class="u"><span class="pun">④</span></span></a></code></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>为了给一个<abbr>JSON</abbr>&nbsp;没有原生支持的数据类型定义你自己的&ldquo;迷你序列化格式&rdquo;, 只要定义一个接受一个Python对象为参数的函数。这个对象将会是<code>json.dump()</code>&nbsp;函数无法自己序列化的实际对象&nbsp;&mdash;&nbsp;这个例子里是<code>bytes</code>对象&nbsp;<code>b'/xDE/xD5/xB4/xF8'</code>&nbsp;。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>你的自定义序列化函数应该检查<code>json.dump()</code>&nbsp;函数传给它的对象的类型。当你的函数只序列化一个类型的时候这不是必须的，但是它使你的函数的覆盖的内容清楚明白，并且在你需要序列化更多类型的时候更容易扩展。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>在这个例子里面, 我将<code>bytes</code>&nbsp;对象转换成字典。<code>__class__</code>&nbsp;键持有原始的数据类型(以字符串的形式,<code>'bytes'</code>&nbsp;), 而&nbsp;<code>__value__</code>&nbsp;键持有实际的数据。当然它不能是<code>bytes</code>&nbsp;对象; 大体的想法是将其转换成某些可以被<abbr>JSON</abbr>&nbsp;序列化的东西!&nbsp;<code>bytes</code>&nbsp;对象就是一个范围在0&ndash;255的整数的序列。 我们可以使用<code>list()</code>&nbsp;函数将<code>bytes</code>&nbsp;对象转换成整数列表。所以<code>b'/xDE/xD5/xB4/xF8'</code>&nbsp;变成&nbsp;<code>[222, 213, 180, 248]</code>&nbsp;. (算一下! 这是对的! 16进制的字节&nbsp;<code>/xDE</code>&nbsp;是十进制的 222,&nbsp;<code>/xD5</code>&nbsp;是 213, 以此类推。)</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td>这一行很重要。你序列化的数据结构可能包含<abbr>JSON</abbr>&nbsp;内建的可序列化类型和你的定制序列化器支持的类型之外的东西。在这种情况下，你的定制序列化器抛出一个<code>TypeError</code>&nbsp;，那样<code>json.dump()</code>&nbsp;函数就可以知道你的定制序列化函数不认识该类型。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>就这么多；你不需要其它的东西。特别是, 这个定制序列化函数<em>返回Python字典</em>&nbsp;，不是字符串。你不是自己做所有序列化到<abbr>JSON</abbr>&nbsp;的工作; 你仅仅在做转换成被支持的类型那部分工作。<code>json.dump()</code>&nbsp;函数做剩下的事情。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre15">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">customserializer</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'w'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="kwd">default</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">customserializer</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">to_json</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="u">③</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><br /><samp class="traceback">Traceback (most recent call last):<br />File "&lt;stdin&gt;", line 9, in &lt;module&gt;<br />json.dump(entry, f, default=customserializer.to_json)<br />File "C:/Python31/lib/json/__init__.py", line 178, in dump<br />for chunk in iterable:<br />File "C:/Python31/lib/json/encoder.py", line 408, in _iterencode<br />for chunk in _iterencode_dict(o, _current_indent_level):<br />File "C:/Python31/lib/json/encoder.py", line 382, in _iterencode_dict<br />for chunk in chunks:<br />File "C:/Python31/lib/json/encoder.py", line 416, in _iterencode<br />o = _default(o)<br />File "/Users/pilgrim/diveintopython3/examples/customserializer.py", line 12, in to_json</samp></a><a>raise TypeError(repr(python_object) + ' is not JSON serializable')&nbsp;<span class="u">④</span>&nbsp;</a><br />TypeError: time.struct_time(tm_year=2009, tm_mon=3, tm_mday=27, tm_hour=22, tm_min=20, tm_sec=42, tm_wday=4, tm_yday=86, tm_isdst=-1) is not JSON serializable</div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td><code>customserializer</code>&nbsp;模块是你在前一个例子中定义<code>to_json()</code>&nbsp;函数的地方。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>文本模式,&nbsp;<abbr>UTF-8</abbr>&nbsp;编码, yadda yadda。(你很可能会忘记这一点! 我就忘记过好几次! 事情一切正常直到它失败的时刻, 而它的失败很令人瞩目。)</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>这是重点: 为了将定制转换函数钩子嵌入<code>json.dump()</code>&nbsp;函数, 只要将你的函数以<var>default</var>&nbsp;参数传入<code>json.dump()</code>&nbsp;函数。(万岁,&nbsp;<a href="http://woodpecker.org.cn/diveintopython3/your-first-python-program.html#everythingisanobject">Python里一切皆对象</a>&nbsp;!)</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td>好吧, 实际上还是不能工作。但是看一下异常。<code>json.dump()</code>&nbsp;函数不再抱怨无法序列化<code>bytes</code>&nbsp;对象了。现在它在抱怨另一个完全不同的对象:&nbsp;<code>time.struct_time</code>&nbsp;对象。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>尽管得到另一个不同的异常看起来不是什么进步, 但它确实是个进步! 再调整一下就可以解决这个问题。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre16">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><code><span class="pln"><br /></span><span class="kwd">import</span>&nbsp;<span class="pln">time<br /><br /></span><span class="kwd">def</span>&nbsp;<span class="pln">to_json</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="pln">isinstance</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">struct_time</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">①</span>&nbsp;</span></a><span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pun">{</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'time.asctime'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="str">'__value__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">asctime</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">)}</span>&nbsp;<span class="pln">&nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">②</span>&nbsp;</span></a><span class="pln"><br />&nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="pln">isinstance</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">bytes</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pun">{</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'bytes'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="str">'__value__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">list</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">)}</span>&nbsp;<span class="pln"><br />&nbsp; &nbsp;&nbsp;</span><span class="kwd">raise</span>&nbsp;<span class="typ">TypeError</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">repr</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">python_object</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="pun">+</span>&nbsp;<span class="str">' is not JSON serializable'</span>&nbsp;<span class="pun">)</span></code></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>在现存的<code>customserializer.to_json()</code>&nbsp;函数里面, 我们加入了Python 对象 (<code>json.dump()</code>&nbsp;处理不了的那些) 是不是&nbsp;<code>time.struct_time</code>&nbsp;的判断。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>如果是的，我们做一些同处理<code>bytes</code>&nbsp;对象时类似的事情来转换: 将<code>time.struct_time</code>&nbsp;结构转化成一个只包含<abbr>JSON</abbr>&nbsp;可序列化值的字典。在这个例子里, 最简单的将日期时间转换成<abbr>JSON</abbr>&nbsp;可序列化值的方法是使用<code>time.asctime()</code>&nbsp;函数将其转换成字符串。<code>time.asctime()</code>&nbsp;函数将难看的<code>time.struct_time</code>&nbsp;转换成字符串<code>'Fri Mar 27 22:20:42 2009'</code>&nbsp;。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>有了两个定制的转换, 整个<var>entry</var>&nbsp;数据结构序列化到<abbr>JSON</abbr>&nbsp;应该没有进一步的问题了。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre17">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'w'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="kwd">dump</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">entry</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="kwd">default</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">customserializer</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">to_json</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp class="p">...</samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre18">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>ls -l example.json</kbd>&nbsp;<br /><samp>-rw-r--r-- 1 you you 391 Aug 3 13:34 entry.json</samp>&nbsp;<br /><samp class="p">you@localhost:~/diveintopython3/examples$&nbsp;</samp><kbd>cat example.json</kbd>&nbsp;<br /><samp>{"published_date": {"__class__": "time.asctime", "__value__": "Fri Mar 27 22:20:42 2009"},<br />"comments_link": null, "internal_id": {"__class__": "bytes", "__value__": [222, 213, 180, 248]},<br />"tags": ["diveintopython", "docbook", "html"], "title": "Dive into history, 2009 edition",<br />"article_link": "http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition",<br />"published": true}</samp></div>
<pre name="code" class="screen"><br /><br /></pre>
<p id="postautopre18" class="a">⁂</p>
<h2 id="json-load">从<abbr>JSON</abbr>&nbsp;文件加载数据<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#json-load">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<p>类似<code>pickle</code>&nbsp;模块，<code>json</code>&nbsp;模块有一个<code>load()</code>&nbsp;函数接受一个流对象，从中读取&nbsp;<abbr>JSON</abbr>&nbsp;编码过的数据, 并且创建该<abbr>JSON</abbr>&nbsp;数据结构的Python对象的镜像。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre19">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">2</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">del</span>&nbsp;<span class="pln">entry</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><br /><samp class="traceback">Traceback (most recent call last):<br />File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br />NameError: name 'entry' is not defined</samp>&nbsp;<br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">json</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'r'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; entry&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">load</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="p">...&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="pp"><span class="pun">{</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">None</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">{</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'bytes'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'__value__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="lit">222</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="lit">213</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="lit">180</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="lit">248</span>&nbsp;<span class="pun">]},</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">],</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'article_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">{</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'time.asctime'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'__value__'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'Fri Mar 27 22:20:42 2009'</span>&nbsp;<span class="pun">},</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">True</span>&nbsp;<span class="pun">}</span></samp></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>为了演示目的，切换到Python Shell #2 并且删除在这一章前面使用<code>pickle</code>&nbsp;模块创建的<var>entry</var>&nbsp;数据结构。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>最简单的情况下，<code>json.load()</code>&nbsp;函数同<code>pickle.load()</code>&nbsp;函数的结果一模一样。你传入一个流对象，它返回一个新的Python对象。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>有好消息也有坏消息。好消息先来:&nbsp;<code>json.load()</code>&nbsp;函数成功的读取了你在Python Shell #1中创建的<code>entry.json</code>&nbsp;文件并且生成了一个包含那些数据的新的Python对象。接着是坏消息: 它没有重建原始的<var>entry</var>&nbsp;数据结构。<code>'internal_id'</code>&nbsp;和&nbsp;<code>'published_date'</code>&nbsp;这两个值被重建为字典&nbsp;&mdash;&nbsp;具体来说, 你在<code>to_json()</code>&nbsp;转换函数中使用<abbr>JSON</abbr>&nbsp;兼容的值创建的字典。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p><code>json.load()</code>&nbsp;并不知道你可能传给<code>json.dump()</code>&nbsp;的任何转换函数的任何信息。你需要的是<code>to_json()</code>&nbsp;函数的逆函数&nbsp;&mdash;&nbsp;一个接受定制转换出的<abbr>JSON</abbr>&nbsp;对象并将其转换回原始的Python数据类型。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre20">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><code><span class="com"># add this to customserializer.py</span>&nbsp;<span class="pln"><br /></span><a><span class="kwd">def</span>&nbsp;<span class="pln">from_json</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">):</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="u"><span class="pun">①</span>&nbsp;</span></a><span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="kwd">in</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">②</span>&nbsp;</span></a><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">==</span>&nbsp;<span class="str">'time.asctime'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">strptime</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'__value__'</span>&nbsp;<span class="pun">])</span>&nbsp;<span class="pln">&nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">③</span>&nbsp;</span></a><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">if</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'__class__'</span>&nbsp;<span class="pun">]</span>&nbsp;<span class="pun">==</span>&nbsp;<span class="str">'bytes'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln"><br /></span><a><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pln">bytes</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">json_object</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'__value__'</span>&nbsp;<span class="pun">])</span>&nbsp;<span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>&nbsp;<span class="u"><span class="pun">④</span>&nbsp;</span></a><span class="pln"><br />&nbsp; &nbsp;&nbsp;</span><span class="kwd">return</span>&nbsp;<span class="pln">json_object</span></code></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>这函数也同样接受一个参数返回一个值。但是参数不是字符串，而是一个Python对象&nbsp;&mdash;&nbsp;反序列化一个<abbr>JSON</abbr>编码的字符串为Python的结果。</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>你只需要检查这个对象是否包含<code>to_json()</code>&nbsp;函数创建的<code>'__class__'</code>&nbsp;键。如果是的，<code>'__class__'</code>&nbsp;键对应的值将告诉你如何将值解码成原来的Python数据类型。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>为了解码由<code>time.asctime()</code>&nbsp;函数返回的字符串，你要使用<code>time.strptime()</code>&nbsp;函数。这个函数接受一个格式化过的时间字符串(格式可以自定义，但默认值同<code>time.asctime()</code>&nbsp;函数的默认值相同) 并且返回<code>time.struct_time</code>&nbsp;.</td>
</tr>
<tr>
<td><span class="u">④</span></td>
<td>为了将整数列表转换回<code>bytes</code>&nbsp;对象, 你可以使用&nbsp;<code>bytes()</code>&nbsp;函数。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>就是这样;&nbsp;<code>to_json()</code>&nbsp;函数处理了两种数据类型，现在这两个数据类型也在<code>from_json()</code>&nbsp;函数里面处理了。下面是结果:</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre21">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">2</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">customserializer</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'r'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><a><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; entry&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">load</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">object_hook</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">customserializer</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">from_json</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="p">...&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="pp"><span class="pun">{</span>&nbsp;<span class="str">'comments_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">None</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'internal_id'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">b</span>&nbsp;<span class="str">'/xDE/xD5/xB4/xF8'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'title'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'Dive into history, 2009 edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">],</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'article_link'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="str">'http://diveintomark.org/archives/2009/03/27/dive-into-history-2009-edition'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published_date'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="pln">time</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">struct_time</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">tm_year</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">2009</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mon</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">3</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_mday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">27</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_hour</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">22</span><span class="pun">,</span>&nbsp;<span class="pln">tm_min</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">20</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_sec</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">42</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_wday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">4</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_yday</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="lit">86</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">tm_isdst</span>&nbsp;<span class="pun">=-</span>&nbsp;<span class="lit">1</span>&nbsp;<span class="pun">),</span>&nbsp;<span class="pln"><br />&nbsp;</span>&nbsp;<span class="str">'published'</span>&nbsp;<span class="pun">:</span>&nbsp;<span class="kwd">True</span>&nbsp;<span class="pun">}</span></samp></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>为了将<code>from_json()</code>&nbsp;函数嵌入到反序列化过程中，把它作为<var>object_hook</var>&nbsp;参数传入到<code>json.load()</code>&nbsp;函数中。接受函数作为参数的函数; 真方便!</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td><var>entry</var>&nbsp;数据结构现在有一个值为<code>bytes</code>&nbsp;对象的<code>'internal_id'</code>&nbsp;键。它也包含一个<code>'published_date'</code>&nbsp;键，其值为<code>time.struct_time</code>&nbsp;对象。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<p>然而，还有最后一个缺陷。</p>
<p class="skip"><a href="http://woodpecker.org.cn/diveintopython3/serializing.html#postautopre22">跳过该代码清单</a></p>
<div class="w">[<a class="toggle">隐藏</a>&nbsp;] [<a>在新窗口中打开</a>&nbsp;]</div>
<div class="b"><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">shell</span>&nbsp;</kbd><br /><samp class="pp"><span class="lit">1</span>&nbsp;</samp><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">import</span>&nbsp;<span class="pln">customserializer</span>&nbsp;</kbd><br /><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="kwd">with</span>&nbsp;<span class="pln">open</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="str">'entry.json'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'r'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">encoding</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="str">'utf-8'</span>&nbsp;<span class="pun">)</span>&nbsp;<span class="kwd">as</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">:</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><kbd class="pp"><span class="pln">&nbsp; &nbsp; entry2&nbsp;</span><span class="pun">=</span>&nbsp;<span class="pln">json</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">load</span>&nbsp;<span class="pun">(</span>&nbsp;<span class="pln">f</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="pln">object_hook</span>&nbsp;<span class="pun">=</span>&nbsp;<span class="pln">customserializer</span>&nbsp;<span class="pun">.</span>&nbsp;<span class="pln">from_json</span>&nbsp;<span class="pun">)</span>&nbsp;</kbd><br /><samp class="p">...&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2&nbsp;</span><span class="pun">==</span>&nbsp;<span class="pln">entry</span>&nbsp;</kbd><span class="u">①</span>&nbsp;</a><br /><samp class="pp"><span class="kwd">False</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">]</span>&nbsp;</kbd><span class="u">②</span>&nbsp;</a><br /><samp class="pp"><span class="pun">(</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">)</span>&nbsp;</samp><br /><a><samp class="p">&gt;&gt;&gt;&nbsp;</samp><kbd class="pp"><span class="pln">entry2</span>&nbsp;<span class="pun">[</span>&nbsp;<span class="str">'tags'</span>&nbsp;<span class="pun">]</span>&nbsp;</kbd><span class="u">③</span>&nbsp;</a><br /><samp class="pp"><span class="pun">[</span>&nbsp;<span class="str">'diveintopython'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'docbook'</span>&nbsp;<span class="pun">,</span>&nbsp;<span class="str">'html'</span>&nbsp;<span class="pun">]</span></samp></div>
<pre name="code" class="screen"></pre>
<table border="0">
<tbody>
<tr>
<td><span class="u">①</span></td>
<td>即使在序列化过程中加入了<code>to_json()</code>&nbsp;钩子函数, 也在反序列化过程中加入<code>from_json()</code>&nbsp;钩子函数, 我们仍然没有重新创建原始数据结构的完美复制品。为什么没有？</td>
</tr>
<tr>
<td><span class="u">②</span></td>
<td>在原始的<var>entry</var>&nbsp;数据结构中,&nbsp;<code>'tags'</code>&nbsp;键的值为一个三个字符串组成的元组。</td>
</tr>
<tr>
<td><span class="u">③</span></td>
<td>但是重现创建的<var>entry2</var>&nbsp;数据结构中,&nbsp;<code>'tags'</code>&nbsp;键的值是一个三个字符串组成的<em>列表</em>&nbsp;。<abbr>JSON</abbr>&nbsp;并不区分元组和列表；它只有一个类似列表的数据类型，数组，并且<code>json</code>&nbsp;模块在序列化过程中会安静的将元组和列表两个都转换成<abbr>JSON</abbr>&nbsp;数组。大多数情况下，你可以忽略元组和列表的区别，但是在使用<code>json</code>&nbsp;模块时应记得有这么一回使。</td>
</tr>
</tbody>
</table>
<pre name="code" class="screen"><br /><br /></pre>
<h2 id="furtherreading">进一步阅读<a class="hl" href="http://woodpecker.org.cn/diveintopython3/serializing.html#furtherreading">#</a></h2>
<pre name="code" class="screen"><br /><br /></pre>
<blockquote class="note"><br />
<p><span class="u">☞</span>&nbsp;很多关于<code>pickle</code>&nbsp;模块的文章提到了<code>cPickle</code>&nbsp;。在Python 2中,&nbsp;<code>pickle</code>&nbsp;模块有两个实现, 一个由纯Python写的而另一个用C写的(但仍然可以在Python中调用)。在Python 3中,&nbsp;<a href="http://woodpecker.org.cn/diveintopython3/porting-code-to-python-3-with-2to3.html#othermodules">这两个模块已经合并</a>, 所以你总是简单的<code>import pickle</code>&nbsp;就可以。你可能会发现这些文章很有用，但是你应该忽略已过时的关于的<code>cPickle</code>&nbsp;的信息.</p>
</blockquote>
<pre name="code" class="screen"><br /><br /></pre>
<p>使用<code>pickle</code>&nbsp;模块打包:</p>
<p>&nbsp;</p>
<ul>
<li><a href="http://docs.python.org/3.1/library/pickle.html"><code>pickle</code>&nbsp;module</a></li>
<li><a href="http://www.doughellmann.com/PyMOTW/pickle/"><code>pickle</code>&nbsp;and&nbsp;<code>cPickle</code>&nbsp;&nbsp;&mdash;&nbsp;Python object serialization</a></li>
<li><a href="http://wiki.python.org/moin/UsingPickle">Using&nbsp;<code>pickle</code></a></li>
<li><a href="http://www.ibm.com/developerworks/library/l-pypers.html">Python persistence management</a></li>
</ul>
<pre name="code" class="screen"><br /><br /></pre>
<p>使用<abbr>JSON</abbr>&nbsp;和&nbsp;<code>json</code>&nbsp;模块:</p>
<p>&nbsp;</p>
<ul>
<li><a href="http://www.doughellmann.com/PyMOTW/json/"><code>json</code>&nbsp;&nbsp;&mdash;&nbsp;JavaScript Object Notation Serializer</a></li>
<li><a href="http://blog.quaternio.net/2009/07/16/json-encoding-and-decoding-with-custom-objects-in-python/">JSON encoding and ecoding with custom objects in Python</a></li>
</ul></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


	</div>
	
	<div class="postfoot">
		posted on <span id="post-date">2012-03-22 11:55</span> <a href='http://www.cnblogs.com/linyawen/'>linyawen</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="http://i.cnblogs.com/EditPosts.aspx?postid=2411381" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(2411381);return false;">收藏</a>
	</div>
</div>
<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=71646,cb_entryId=2411381,cb_blogApp=currentBlogApp,cb_blogUserGuid='80180618-0c52-df11-ba8f-001cf0cd104b',cb_entryCreatedDate='2012/3/22 11:55:00';loadViewCount(cb_entryId);</script>

<a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="开发者的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="opt_under_post"></div>
<script type="text/javascript">
    var enableGoogleAd = canShowAdsense(); var googletag = googletag || {}; googletag.cmd = googletag.cmd || [];
    fixPostBodyFormat();
</script>
<div id="ad_under_post_holder">
<script type='text/javascript'>
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function () {
        if (enableGoogleAd) {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        }
    })();
</script>
<script type='text/javascript'>
    try {
        if (enableGoogleAd) {
            googletag.cmd.push(function () {
                googletag.defineSlot('/1090369/cnblogs_blogpost_C1_sitehome', [300, 250], 'div-gpt-ad-1346480159711-0').addService(googletag.pubads());
                googletag.defineSlot('/1090369/cnblogs_blogpost_C2', [468, 60], 'div-gpt-ad-1410860226396-0').addService(googletag.pubads());
                googletag.pubads().enableSingleRequest();
                googletag.enableServices();
            });
        };
    } catch (e) { }
</script>
<div id="google_ad_c1" class="c_ad_block">
    <div id='div-gpt-ad-1346480159711-0' style='width:300px; height:250px;'>
    <script type='text/javascript'>
        try {
            if (enableGoogleAd) {
                googletag.cmd.push(function () { googletag.display('div-gpt-ad-1346480159711-0'); });            
            } else {
                $('#div-gpt-ad-1346480159711-0').hide();
            }
    } catch (e) { }
    </script>
    </div>
</div>
</div>
<div id="under_post_news"></div>
<div id="google_ad_c2" class="c_ad_block">
<div id='div-gpt-ad-1410860226396-0' style='width:468px; height:60px;'>
<script type='text/javascript'>
try {
    if (enableGoogleAd) {
        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1410860226396-0'); });
    } else {
        $('#div-gpt-ad-1346480159711-0').hide();
    }
} catch (e) { }
</script>
</div>
</div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    setTimeout(function () { incrementViewCount(cb_entryId); }, 200);
});
</script>
</div>

</tr>
</table>

<p id="footer">
	Copyright @
	linyawen<BR>
	Powered by:
	<a href="http://scottwater.com/blog" target=_blank>.Text</a> and 
	<a href="http://asp.net" target=_blank>ASP.NET</a>
	<br>
	Theme by: <a href="http://www.DotNetMonster.com" target=_blank>.NET Monster</a>
</p>


</body>
</html>
