<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
 <title>Planet MySQL  - Archives - MySQL 5.7 multi-source replication</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="google-site-verification" content="hJyLdGNlZRAGDaJga_XXJtcpRalHh7D4yX_8L3tZfCY" />
	<!--[if IE ]>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
	<![endif]-->
		<meta http-equiv="Refresh" content="3600" />
		
        <script language="javascript">

        var vote_location = "/entry/vote/";
        var tagset_location = "/entry/tagset/";
        var tagget_location = "/entry/gettags/";

        //You can set the following text to be whatever you want, including pulling these from translation tables/tmx files

        //var no_auth_alert = "You need to be logged into perform this action. Please login to MySQL.com and try again.";
        //var no_more_alert = "You have already used up the votes available to you in a 24 hour period. Please try again later.";
        //var invalid_vote_alert = "An invalid vote was submitted. Cannot be processed.";
        //var already_voted_alert = "You have already voted for this entry and the time to change your vote has passed.";
        </script>
        	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="stylesheet" href="http://planet.mysql.com/style.css?ver20090806" type="text/css" />
		<link  rel="alternate"
        type="application/rss+xml"
        title=" RSS 2.0 English"
        href="/rss20.xml" />
		                    <script language="javascript" type="text/javascript" src="/common/yui/utilities/utilities.js"></script>
                    <script language="javascript" type="text/javascript" src="/common/yui/container/container-min.js"></script>
                    <script language="javascript" type="text/javascript" src="/common/yui/json/json-min.js"></script>
                    <script language="javascript" type="text/javascript" src="/common/js/community_vote.js?ver20090604"></script>
                    <script language="javascript" type="text/javascript" src="/common/js/community_tag.js?ver20090604"></script>
            	</head>
<body>
    <div class="header-mask">
    <div id="header">
        <div id="header-logo">
            <a href="/">
               <img src="http://planet.mysql.com/images/MySQL_Ying-Yang.gif" alt="Planet MySQL" width="70" height="70" />
            </a>
        </div>
        <div id="header-text">
            Planet MySQL  - Archives - MySQL 5.7 multi-source replication
            <br /><span class="header-subtext">Your blogs, news and opinions.</span>

        </div>
        <div id="header-advert">

        </div>
        <div id="header-login-links">
                        <p>

                                    <a href="https://dev.mysql.com/auth/login/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853">Login</a> |
                    <a href="https://dev.mysql.com/auth/register/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853">Register</a>
                                &nbsp;&nbsp;
            </p>

        </div>
        </div>
<!--
   <div id="header-banner">
     <a href="http://dev.mysql.com/tech-resources/articles/mysql-5.1-use-case-competition.html">
       <img src="http://planet.mysql.com/images/dev-mysql-5.1-competition_421x72_anim.gif" alt="MySQL 5.1 Use Case Competition" width="421" height="72" />
     </a>
    </div>-->
    </div>
<div id="topnavi">
  <span class="navlinks">
    <a href="/">Home</a>&nbsp;|&nbsp;
    <a href="/buzz">MySQL Buzz</a>&nbsp;|&nbsp;
    <a href="/faq">FAQ</a>&nbsp;|&nbsp;
    <a href="/feed">Feeds</a>&nbsp;|&nbsp;
    <a href="/new">Submit <i>your</i> blog feed</a>&nbsp;|&nbsp;
    <a href="http://dev.mysql.com/contact/?topic=community">Feedback</a>&nbsp;|&nbsp;
    <a href="/archives/">Archive</a>&nbsp;|&nbsp;
    <a href="/rss20.xml">Aggregate feed
    <img src="/images/rss20.png" width="80" height="15" alt="RSS 2.0" border="0" style="vertical-align: middle;" />
    </a>
    English
  </span>

   <span class="flags">
                             <a href="http://de.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Deutsch">
          <img src="/common/img/flags/deu.png" alt="Deutsch"/>
        </a>
                         <a href="http://es.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Español">
          <img src="/common/img/flags/esp.png" alt="Español"/>
        </a>
                         <a href="http://fr.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Français">
          <img src="/common/img/flags/fra.png" alt="Français"/>
        </a>
                         <a href="http://it.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Italiano">
          <img src="/common/img/flags/ita.png" alt="Italiano"/>
        </a>
                         <a href="http://jp.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication 日本語">
          <img src="/common/img/flags/jpn.png" alt="日本語"/>
        </a>
                         <a href="http://ru.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Русский">
          <img src="/common/img/flags/rus.png" alt="Русский"/>
        </a>
                         <a href="http://pt.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication Português">
          <img src="/common/img/flags/bra.png" alt="Português"/>
        </a>
                         <a href="http://cn.planet.mysql.com/" title="Planet MySQL  - Archives - MySQL 5.7 multi-source replication 中文">
          <img src="/common/img/flags/chn.png" alt="中文"/>
        </a>
              </span>
  </div>


	
<div id="middlecontent">
<div class="entry team">
	<div class="entry-title">
		<a href="http://www.mysqlperformanceblog.com/2013/10/02/mysql-5-7-multi-source-replication/">
					MySQL 5.7 multi-source replication
	</a>

	<div style="float:right">
	
					<span style="font-size: smaller; font-style: italic">+4</span> <a href="https://dev.mysql.com/auth/login/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853" onclick="return confirm('You must login first')"><img align="middle" src="/images/thumbs_up_blue.jpg" border="0"  alt="Vote Up"  /></a>
			<span style="font-size: smaller; font-style: italic">-0</span> <a href="https://dev.mysql.com/auth/login/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853" onclick="return confirm('You must login first')"><img align="middle" src="/images/thumbs_down_blue.jpg" border="0"  alt="Vote Down"  /></a>
				</div>

	</div>
	<div class="entry-byline">
	posted by <strong><a href="http://www.mysqlperformanceblog.com/">Miguel Angel Nieto</a>  of team blog MySQL Performance Blog</strong>
	on <em><span class="entry-date">Wed 02 Oct 2013 05:00 UTC</span></em>
	<br/>
		Tags: <div style="display: inline" id="entry_tags_show_497853">
		(<a href="javascript:void(0)" onclick="set_tag_edit_visible(497853)">edit</a>)
				 		   <a href="/?tag_search=152">mysql</a>,		 		   <a href="/?tag_search=180">Oracle</a>,		 		   <a href="/?tag_search=14073">MySQL 5.7</a>,		 		   <a href="/?tag_search=14306">Multi-source replication</a>,		 		   <a href="/?tag_search=14822">Miguel Angel Nieto</a>		 				</div>
		<div style="display: none" id="entry_tags_edit_497853">
		(<a href="javascript:void(0)" onclick="set_tag_edit_invisible(497853)">close</a>)
			<form style="display: inline" method="post" name="entry_tags_form_497853">
				<input type="text" id="entry_tags_input_497853" name="entry_tags" value="mysql,Oracle,MySQL 5.7,Multi-source replication,Miguel Angel Nieto"/>
				<input type="hidden" name="entry_id" value="497853" />
				<input type="button" name="entry_submit" value="go" onclick="javascript:set_tags( 497853 )"/>
			</form>

		</div>
		<br/><br/>
	</div>

	
 	<div class="entry-content">
	<p>Recently Oracle announced several new features for the latest available development version of MySQL that is 5.7.2 at the time of writing this article. Most of them are performance and replication related that show us how incredible the new release will be.</p><p>In this post I&#8217;m going to try to explain in some easy steps how the new multi-source replication works and how we can configure it for our own tests. It is important to mention that this is a development release, so it is not production ready. Therefore this post is intend to people that want to test the new feature and see how it works with their application, always in a staging environment.</p><h3>What is multi-source replication?</h3><p>First, we need to have clear that <strong>multi-master</strong> and <strong>multi-source</strong> replication are not the same. Multi-Master replication is the usual circular replication where you can write on any server and data gets replicated to all others.</p><p><center><img src="http://www.mysqlperformanceblog.com/wp-content/uploads/2013/09/multi_master-285x300.jpg" /></center>Multi-source is different. MySQL replication had a limitation, fixed with this new release, that said that one slave could have only one master. That is a limiting factor when we are designing our replication environment. There were some &#8220;hacks&#8221; to make it work, but now there is an official way. So, in a nutshell, Multi-Source means that a slave can have more than one master. Now, replication environments like these one are possible:</p><p><center><img src="http://www.mysqlperformanceblog.com/wp-content/uploads/2013/09/multi_source-300x253.jpg" /></center>This will help us create some replication hierarchies that were impossible in the past. For example, you can have a slave in your office replicating the data from all servers that you have in the offices spread around the world.</p><h3>How does it work?</h3><p>Now we have the concept of communication channels. Each communication channel is a connection from slave to master to get the binary log events. That means we will have one IO_THREAD for each communication channel. We will need to run different &#8220;CHANGE MASTER&#8221; commands, one for each master, with the &#8220;<strong>FOR CHANNEL</strong>&#8221; argument that we will use to give a name to that channel.</p><pre>CHANGE MASTER MASTER_HOST='something', MASTER_USER=... FOR CHANNEL="name_of_channel";</pre><p>Pretty easy. There is one single pre-requisite. The slave should have been configured first with the crash-safe feature of MySQL 5.6. That means that info usually included in master.info or relay-log.info should be on a table. Let&#8217;s start with the configuration.</p><h3>Show me an example!</h3><p>First you need to download the lab version of mysql from this <a href="http://labs.mysql.com/">link</a>.</p><p>We have a sandbox environment with 2 masters and 1 slave servers. I won&#8217;t go over the details of how to configure the server_id, binary logs or replication users. I assume they are well configured. If you need a howto, you can follow <a href="https://www.digitalocean.com/community/articles/how-to-set-up-mysql-master-master-replication" target="_blank">this one</a>.</p><p>First, we have to enable the crash safe feature on the slave:</p><pre>master_info_repository=TABLE;
relay_log_info_repository=TABLE;</pre><p>After a restart of the slave we can start creating the channels with the names &#8220;master1&#8243; and &#8220;master2&#8243;:</p><pre>slave &gt; change master to master_host="127.0.0.1", master_port=12047, master_user="msandbox",master_password="msandbox" for channel="master1";
slave &gt; change master to master_host="127.0.0.1", master_port=12048, master_user="msandbox",master_password="msandbox" for channel="master2";</pre><p>To start the slave processes you need to specify what channel are you referring to:</p><pre>slave &gt; start slave for channel="master1";
slave &gt; start slave for channel="master2";</pre><p>Now, we want to check the status of the slave:</p><pre>slave &gt; show slave status\G
Empty set (0.00 sec)</pre><p>Oh, it is empty. We have to specify again which channel we want to check:</p><pre>slave &gt; SHOW SLAVE STATUS FOR CHANNEL="master1"\G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 127.0.0.1
                  Master_User: msandbox
                  Master_Port: 12047
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000002
          Read_Master_Log_Pos: 232
               Relay_Log_File: squeeze-relay-bin-master1.000003
                Relay_Log_Pos: 395
        Relay_Master_Log_File: mysql-bin.000002
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
[...]</pre><p>and we can also check that the <strong>IO_THREAD</strong> and <strong>SQL_THREADS</strong> are running:</p><pre>slave &gt; SHOW PROCESSLIST;
+----+-------------+-----------------------------------------------------------------------------+
| Id | User        | State                                                                       |
+----+-------------+-----------------------------------------------------------------------------+
|  2 | system user | Waiting for master to send event                                            |
|  3 | system user | Slave has read all relay log; waiting for the slave I/O thread to update it |
|  4 | system user | Waiting for master to send event                                            |
|  5 | system user | Slave has read all relay log; waiting for the slave I/O thread to update it |
+----+-------------+-----------------------------------------------------------------------------+</pre><p>Let&#8217;s test it:</p><pre>master1 &gt; create database master1;
master2 &gt; create database master2;
slave &gt; show databases like 'master%';
+--------------------+
| Database (master%) |
+--------------------+
| master1            |
| master2            |
+--------------------+</pre><p>It works, that easy!</p><h3>Conclusion</h3><p>The new multi-source feature allow us to create new replication environments that were impossible in the past without some complex &#8220;hacks&#8221;. Of course, your application should be designed and developed with this new architecture in mind. Like with multi-master, multi-source needs special care to not end up with your data messed up.</p><p>MySQL replication is getting better on every release giving us more configuration, performance and design possibilities. And all those new features can be combined. Your replication environment can be even better if you mix some of the new (and old) features added recently to the replication. For example, you can configure <a href="http://www.mysqlperformanceblog.com/2013/02/08/how-to-createrestore-a-slave-using-gtid-replication-in-mysql-5-6/">GTID</a> or enable <a href="http://scriptingmysql.wordpress.com/2013/01/07/mysql-replication-multi-threaded-slaves-parallel-event-execution/">multi-threaded slave per schema</a> or <a href="http://geek.rohitkalhans.com/2013/09/enhancedMTS-deepdive.html">intra-database</a>.</p><p>The post <a href="http://www.mysqlperformanceblog.com/2013/10/02/mysql-5-7-multi-source-replication/">MySQL 5.7 multi-source replication</a> appeared first on <a href="http://www.mysqlperformanceblog.com">MySQL Performance Blog</a>.</p>
	</div>

			<p><b>Votes: </b></p>
					<p>You must be
			<a href="https://dev.mysql.com/auth/login/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853">logged in</a>
			with a <a href="https://dev.mysql.com/auth/register/?dest=http%3a%2f%2fplanet.mysql.com%2Fentry%2F%3Fid%3D497853">MySQL account</a> to vote on Planet MySQL entries.
			<a href="/faq#16">More information on PlanetMySQL voting</a>.</p>
			</div>

<div align="center">
<p class="footertext">Planet MySQL &copy;  1995, 2014, Oracle Corporation and/or its affiliates
&nbsp; <a href="http://www.mysql.com/about/legal/">Legal Policies</a> | <a href="http://www.oracle.com/us/legal/privacy/index.htm">Your Privacy Rights</a> | <a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a></p>
 <div id="disclaimer">Content reproduced on this site is the property of the respective copyright holders. It is not reviewed in advance by Oracle and does not necessarily represent the opinion of Oracle or any other party.</div>
</div>
</div>

<div id="two-col-right">

            
    <div class="menu">
	<h3 class="sidebar-header">Search</h3>
		<form method="post" action="/">
			<input type="text" name="search" value="" />
			<input type="submit" name="search_btn" value="search" />
		</form>

		<p><b>Help:</b> <a href="/faq#15">Searching</a>, <a href="/faq#16">Tag Searching</a>, <a href="/faq#17">Edit Tags</a></p>
  </div>
      
    <div class="menu">
        <h3 class="sidebar-header">MySQL Links</h3>
        <a href="http://dev.mysql.com/downloads/" class="author-blog">MySQL Downloads</a>
        <a href="http://dev.mysql.com/doc/" class="author-blog">MySQL Docs</a>
        <a href="http://bugs.mysql.com/" class="author-blog">MySQL Bugs</a>
        <a href="http://forums.mysql.com/" class="author-blog">MySQL Forums</a>
    </div>

    
    <div class="menu">
        <h3 class="sidebar-header">Oracle MySQL Blogs</h3>
        <a href="https://blogs.oracle.com/mysql/" class="author-blog">Oracle's MySQL Blog</a>
        <a href="http://dev.mysql.com/support/blogs/" class="author-blog">MySQL Support Team</a>
        <a href="http://mysqlserverteam.com/" class="author-blog">MySQL Server Team</a>
        <a href="http://mysqlrelease.com/" class="author-blog">MySQL Release Eng</a>
        <a href="https://blogs.oracle.com/mysqlworkbench/" class="author-blog">MySQL Workbench</a>
        <a href="https://blogs.oracle.com/MySqlOnWindows/" class="author-blog">MySQL on Windows</a>
        <a href="https://blogs.oracle.com/mysqlinnodb/" class="author-blog">MySQL InnoDB</a>
        <a href="https://blogs.oracle.com/mysqlenterprisebackup/" class="author-blog">MySQL Backup</a>
        <a href="https://blogs.oracle.com/mysqlenterprise/" class="author-blog">MySQL Monitor</a>
        <a href="https://blogs.oracle.com/mysqltesting/" class="author-blog">MySQL Testing</a>
    </div>

    

</div>
</body>
</html>