<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-

transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" /> 
<meta http-equiv="X-UA-Compatible" content="IE=7" />
<script type="text/javascript">
function hidead()
{document.getElementById("ad").style.display="none";}
</script>
<div id="ad" style="position:absolute; z-index:99;">
<a href="#" target="_blank"><img src="images/1.png" border="0">
</a>
<DIV onclick="hidead();" style="FONT-SIZE: 9pt; CURSOR: hand" align=right>关闭×</DIV></div>
<script>
var x = 50,y = 60
var xin = true, yin = true
var step = 1
var delay = 1
var obj=document.getElementById("ad")
function floatAD() {
var L=T=0
var R= document.body.clientWidth-obj.offsetWidth
var B = document.body.clientHeight-obj.offsetHeight
obj.style.left = x + document.body.scrollLeft
obj.style.top = y + document.body.scrollTop
x = x + step*(xin?1:-1)
if (x < L) { xin = true; x = L}
if (x > R){ xin = false; x = R}
y = y + step*(yin?1:-1)
if (y < T) { yin = true; y = T }
if (y > B) { yin = false; y = B }
}
var itl= setInterval("floatAD()", delay)
obj.onmouseover=function(){clearInterval(itl)}
obj.onmouseout=function(){itl=setInterval("floatAD()", delay)}
</script>
<style type="text/css">
<!--
#lovexin12,#lovexin14{
width:110px;
height:423px;
background-image:url(dl.jpg);
border:1px solid #ddd;
}
#lovexin12,#lovexin14:hover{
cursor:pointer;
}

-->
</style>

<script language="JavaScript" type="text/javascript">
lastScrollY=0;
function heartBeat(){ 
var diffY;
if (document.documentElement && document.documentElement.scrollTop)
diffY = document.documentElement.scrollTop;
else if (document.body)
diffY = document.body.scrollTop
else
{/*Netscape stuff*/}
percent=.1*(diffY-lastScrollY); 
if(percent>0)percent=Math.ceil(percent); 
else percent=Math.floor(percent); 
document.getElementById("lovexin12").style.top=parseInt(document.getElementById
("lovexin12").style.top)+percent+"px";
document.getElementById("lovexin14").style.top=parseInt(document.getElementById
("lovexin12").style.top)+percent+"px";
lastScrollY=lastScrollY+percent; 
}
suspendcode12="<a href='http://www.enjoylinux.cn/kfbshop.asp' target='_blank'><DIV id=\"lovexin12\" style='left:2px;POSITION:absolute;TOP:120px;'></div></a>"
suspendcode14="<a href='http://www.enjoylinux.cn/kfbshop.asp' target='_blank'><DIV id=\"lovexin14\" style='right:2px;POSITION:absolute;TOP:120px;'></div></a>"
document.write(suspendcode12); 
document.write(suspendcode14); 
window.setInterval("heartBeat()",1);
</script>

<title>libcgroup资源控制-IT新闻--成都国嵌教育</title>
<link href="images/css.css" rel="stylesheet" type="text/css" />
</head>
<!--[if lte IE 6]>
	<script src="js/DD_belatedPNG_0.0.8a.js" type="text/javascript"></script>
    <script type="text/javascript">
        DD_belatedPNG.fix('div, img, li, input , a, b, span, h1, h2, h3, h4, h5, h6, code' );
    </script>
<![endif]-->
<body>
<script language="javascript" src="inc/js.js"></script>
<div class="header">
  <div class="wrap">
    <div class="logo">
      <div><img src="images/logo.png" /></div>  
    </div>
    <div class="top_text"><img src="images/top_text.png" /></div>
    
    
    <div class="top_link"><a href="javascript:AddFavorite('http://www.enjoylinux.cn/','成都国嵌培训中心')" class="cl1">加入收藏</a><a target="_blank" href="bbs/" class="cl2">论坛</a></div>
    
    <div class="btn_img_list">
      <ul>
        <li><a href="downloads.asp"><img src="images/ImgBtn04.png" /></a></li>
        <li><a href="shop.asp"><img src="images/ImgBtn03.png" /></a></li>
        <li><a href="course.asp"><img src="images/ImgBtn02.png" /></a></li>
        <li><a href="videos.asp"><img src="images/ImgBtn01.png" /></a></li>
      </ul>
    </div>
    <div class="nav_box">
      <ul class="nav">
        <li><a href="index.asp" class="nav_a1"></a></li>
        <li><a href="about.asp" class="nav_a2"></a></li>
        <li><a href="Course.asp" class="nav_a3"></a></li>
        <li><a href="Videos.asp" class="nav_a4"></a></li>
        <li><a href="shop.asp" class="nav_a5"></a></li>
        <li><a href="Downloads.asp" class="nav_a6"></a></li>
        <li><a href="bbs/" target="_blank" class="nav_a7"></a></li>
        <li><a href="Teachers.asp" class="nav_a8"></a></li>
        <li><a href="baoming.asp" class="nav_a9"></a></li>
        <li><a href="http://www.examcoo.com/" class="nav_a10"></a></li>
      </ul>
      
      <div class="c"></div>
      <div class="nav_text">公告：2011春节招生于3月初正式启动，请广大学员朋友提前预订课程，网上报名立即优惠百分之五！</div>
    </div>
  </div>
  
</div>
<div class="wrap mr15">
  <div class="box237 left">
    <h3><img src="images/News_title.png" title="IT 新闻" /></h3>
    <div class="center_border">
       <div class="boxMain" style="font-size:15px;">
        <ul class="nav_menu">
          <li><b><code>・</code><a href="news.asp?Cid=166">系统管理</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=184">应用开发</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=186">内核驱动</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=191">C/C++语言</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=192">网络技术</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=193">Android</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=195">云计算与虚拟化</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=196">程序人生</a></b></li>
          <li><b><code>・</code><a href="news.asp?Cid=197">招聘信息</a></b></li>
        </ul>
      </div>
    </div>
    <div class="bottom_border"><span class="l"></span><span class="r"></span></div>
    
    

      <div style="width:237px; overflow:hidden; margin-top:20px;">
         <img src="images/dianhua.png" alt="电 话：028-66501487
" />
	<div style=" width:237px; height:69px; background:url(images/qq.jpg); ">
           <div style="font-size:16px; padding-top:25px; margin-left:75px;"><b>范老师:</b>&nbsp;&nbsp;<a href="http://wpa.qq.com/msgrd?V=1&Uin=550491596&Site=成都国嵌培训中心&Menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=1:550491596:1" alt="有事请Q我" border="0"></a></div></div>
        
       <img src="images/dizhi.png" />
   

 </div>

    <div class="bottom_border"><span class="l"></span><span class="r"></span></div>
  </div>
  
  <div class="box722 right">
 
    <h3 style="font-family:'楷体'" class="title">◎ 当前位置：首页->IT 新闻</h3>
    
    <div class="top_border mr10"><span class="l"></span><span class="r"></span></div>
    <div class="center_border">
      <div class="boxMain">
<h1 align="center" style="font-size:18px">libcgroup资源控制</h1>
        <div class="boxWidth">
        <p>&nbsp;</p>
<p>&nbsp;</p>
          <p>&nbsp;&nbsp; cgroup是Linux内核提供的一种新的资源管理机制，全称为Control Group（控制群组），在Red Hat  Enterprise Linux  6.x系统中已经全面支持，对应的软件包为libcgroup。cgroup可以为系统中所运行的任务（进程）的用户定义群组，并根据群组来分配资源，例 如CPU、内存、网络带宽等等。<br />
&nbsp;&nbsp;&nbsp; Cgroup使用预定义的控制器（子系统）来决定具体的资源限制类型，以及具体的限制参数，通过挂载伪文件系统的方式来读取设置、应用控制细节。相对于PAM认证模块的分散性来说，cgroup具有集中管理的便利性。可用的控制子系统主要包括：<br />
&nbsp;&nbsp;&nbsp; blkio：为块设备定义输入/输出限制<br />
&nbsp;&nbsp;&nbsp; cpu：为任务所使用的cpu时间提供调度控制<br />
&nbsp;&nbsp;&nbsp; cpuacct：为任务自动生成cpu资源使用报告<br />
&nbsp;&nbsp;&nbsp; cpuset：为任务分配独立CPU（对于多核处理器）和内存节点<br />
&nbsp;&nbsp;&nbsp; devices：允许或者拒绝某些任务访问指定的设备<br />
&nbsp;&nbsp;&nbsp; freezer：允许挂起或者恢复群组中的任务<br />
&nbsp;&nbsp;&nbsp; memory：限制任务所使用的内存，并自动生成内存资源报告<br />
&nbsp;&nbsp;&nbsp; net_cls：使用登记识别符（classid）来标记网络数据包，从而允许tc等流量控制程序使用<br />
&nbsp;&nbsp;&nbsp; ns：允许为任务分配不同的名称空间<br />
&nbsp;<br />
############################################################################## <br />
&nbsp;<br />
系统环境： <br />
&nbsp;&nbsp;&nbsp; RHEL 6.2 [2.6.32-220.el6.i686]</p>
<div>软件环境： <br />
&nbsp;&nbsp;&nbsp; libcgroup-0.37-3.el6.i686<br />
&nbsp;&nbsp;&nbsp; httpd-2.2.15-15.el6.i686<br />
&nbsp;<br />
############################################################################## <br />
&nbsp;<br />
一、配置cgroup、定义新群组</div>
<div>&nbsp;</div>
<div>[root@localhost ~]# vim /etc/cgconfig.conf &nbsp;//参考 man cgconfig.conf<br />
mount {&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//伪文件系统挂载设置，此部分为默认<br />
&nbsp;&nbsp;&nbsp; cpuset = /cgroup/cpuset;<br />
&nbsp;&nbsp;&nbsp; cpu = /cgroup/cpu;<br />
&nbsp;&nbsp;&nbsp; cpuacct = /cgroup/cpuacct;<br />
&nbsp;&nbsp;&nbsp; memory = /cgroup/memory;<br />
&nbsp;&nbsp;&nbsp; devices = /cgroup/devices;<br />
&nbsp;&nbsp;&nbsp; freezer = /cgroup/freezer;<br />
&nbsp;&nbsp;&nbsp; net_cls = /cgroup/net_cls;<br />
&nbsp;&nbsp;&nbsp; blkio = /cgroup/blkio;<br />
}<br />
group exgroup {&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//新建的组，控制器类型为memory<br />
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//挂载后位于/cgroup/memory/exgroup/*<br />
&nbsp;&nbsp;&nbsp; memory {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memory.limit_in_bytes = 209715200; &nbsp;//限制使用的内存大小（200MB）<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
group daemons/http {&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;//新建的组，控制器类型为cpu<br />
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//挂载后位于/cgroup/cpu/daemons/http/*<br />
&nbsp;&nbsp;&nbsp; cpu {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu.share = &quot;512&quot;;&nbsp; &nbsp;&nbsp;&nbsp;//CPU优先级，默认为1024<br />
&nbsp;&nbsp;&nbsp; }<br />
}</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>二、配置资源限制规则</div>
<div>&nbsp;</div>
<div>1. 对于系统服务，建议采用daemon模式 &mdash;&mdash; /etc/sysconfig/xxxx</div>
<div>[root@localhost ~]# vim /etc/sysconfig/httpd<br />
... ...<br />
CGROUP_DAEMON=&quot;cpu:daemons/http&quot;</div>
<div>//通过CGROUP_DAEMON指定httpd服务要使用的控制器类型（cpu）、资源群组（daemons/http）<br />
//可参考文档：/usr/share/doc/libcgrou-0.37/README.RedHat</div>
<div>&nbsp;</div>
<div>2. 对于用户进程，需要编辑策略文件 &mdash;&mdash; /etc/cgrules.conf</div>
<div>[root@localhost ~]# vim /etc/cgrules.conf<br />
... ...<br />
&lt;user&gt;:&lt;process name&gt;&nbsp;&nbsp;&nbsp; &lt;controllers&gt;&nbsp;&nbsp;&nbsp; &lt;destination&gt;<br />
harry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exgroup/<br />
*:httpd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; daemons/http</div>
<div>&nbsp;</div>
<div>//第1-3列依次表示：用户和进程、控制器类型、资源群组<br />
//用户名与进程名之间以冒号分隔，允许使用通配符<br />
//如果使用多个控制器，以逗号分隔<br />
//资源群组只需要写相对（于伪文件系统根目录的）路径</div>
<div>&nbsp;</div>
<div><br />
三、启动cgroup相关服务<br />
&nbsp;&nbsp;&nbsp; 系统服务cgconfig会读取cgconfig.conf配置文件，并据此挂载伪文件系统；系统服务cgred会调用文件cgrules.conf，并应用其中设置的规则来控制资源使用。</div>
<div>&nbsp;</div>
<div>[root@localhost ~]# service cgconfig start ; chkconfig cgconfig on<br />
[root@localhost ~]# service cgred start ; chkconfig cgred on</div>
<div>&nbsp;</div>
<div><br />
四、查看、验证cgroup信息</div>
<div>&nbsp;</div>
<div>1. 查看已挂载的cgroup伪文件系统</div>
<div>[root@localhost ~]# ls /cgroup/&nbsp; &nbsp;&nbsp;//查看cpu控制器子树<br />
cgroup.procs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu.rt_period_us&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu.stat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; release_agent<br />
cpu.cfs_period_us&nbsp;&nbsp; cpu.rt_runtime_us&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; daemons&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tasks<br />
cpu.cfg_quota_us&nbsp;&nbsp;&nbsp; cpu.shares&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notify_on_release</div>
<div>[root@localhost ~]# ls /cgroup/cpu/daemons/http &nbsp;//查看daemons/http资源组<br />
cgroup.procs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu.rt_period_us&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cpu.stat<br />
cpu.cfs_period_us&nbsp;&nbsp; cpu.rt_runtime_us&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notify_on_release<br />
cpu.cfg_quota_us&nbsp;&nbsp;&nbsp; cpu.shares&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tasks</div>
<div>&nbsp;</div>
<div>2. 查看httpd服务受控状态</div>
<div>[root@localhost ~]# service httpd restart<br />
[root@localhost ~]# cat /cgroup/cpu/daenmons/http/tasks&nbsp; &nbsp;//受控的PID列表<br />
22985<br />
22987<br />
... ...<br />
[root@localhost ~]# pgrep -i httpd&nbsp; &nbsp;&nbsp;//实际的httpd进程与受控列表相吻合<br />
22985 httpd<br />
22987 httpd<br />
... ...<br />
[root@localhost ~]# cat /cgroup/cpu/daenmons/http/cpu.shares&nbsp; &nbsp;//确认与所限制的值一致<br />
512</div>
<div>&nbsp;</div>
<div>3. 查看exgroup群组的受控状态</div>
<div>[root@localhost ~]# cgget -g memory exgroup&nbsp; &nbsp;//使用cgget查看<br />
exgroup:<br />
memory.memsw.failcnt: 0<br />
memory.memsw.limit_in_bytes: 9223372036854775807<br />
memory.memsw.max_usage_in_bytes: 8192<br />
memory.memsw.usage_in_bytes: 0<br />
memory.move_charge_at_immigrate: 0<br />
... ...<br />
memory.limit_in_bytes: 209715200<br />
... ...</div>
<div>[root@localhost ~]# cat /cgroup/memory/exgroup/memory.limit_in_bytes<br />
209715200</div>
<div>以harry用户登录，并执行相关人物，查看并验证资源限制（使用的内存不能超过200MiB）</div>
<div>[root@localhost ~]# cat /cgroup/memory/exgroup/tasks<br />
1454<br />
23375<br />
23398<br />
... ...</div>
<div>&nbsp;<br />
##############################################################################</div>
<p>&nbsp;</p>
        </div>
      </div>
    </div>
    <div class="bottom_border"><span class="l"></span><span class="r"></span></div>
  </div>
  <div class="c"></div>
</div>

<div class="wrap mr15">
  <div class="top_border"><span class="l"></span><span class="r"></span></div>
  <div class="center_border">
     <div class="link_title"><img src="images/link_title.png" /></div>
     <div class="link_box">
       <div>
       <ul>
       
         <li><a href="http://www.witech.com.cn/" target="_blank" title="飞凌嵌入式"><img src="upload/2011210115459.png" /></a></li>
       
         <li><a href="http://www.cn.kernel.org/pub/linux/kernel/" target="_blank" title="linux"><img src="upload/2011210115424.png" /></a></li>
       
         <li><a href="ftp://ftp.denx.de/pub/u-boot/" target="_blank" title="u-boot"><img src="upload/201121011542.png" /></a></li>
       
         <li><a href="http://qt.nokia.com/title-cn" target="_blank" title="qt"><img src="upload/2011210115333.png" /></a></li>
       
         <li><a href="http://enjoylinux.taobao.com/" target="_blank" title="淘宝官方网站"><img src="upload/2011210115211.png" /></a></li>
       
         <li><a href="http://www.arm9.net/" target="_blank" title="arm"><img src="upload/2011210115023.png" /></a></li>
       
       </ul>
       </div>
     </div>
     <div class="c"></div>
  </div>
  <div class="bottom_border"><span class="l"></span><span class="r"></span></div>
</div>

<div class="foot">
本站关键字：嵌入式,Linux,ARM<br />
招生咨询电话：028-66501487 Copyright@2011 成都国嵌信息技术有限公司 All Reserived 蜀ICP备：7488****** 号 Design by <a href="http://www.senion.cn" target="_blank">Senion</a>
</div>
<center><script language="javascript" type="text/javascript" src="http://js.users.51.la/5436397.js"></script>
<noscript><a href="http://www.51.la/?5436397" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/5436397.asp" style="border:none" /></a></noscript></center>
</body>
</html>
