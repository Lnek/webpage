<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Plymouth文本模式启动画面修改 - wangst4321的专栏 - 博客频道 - CSDN.NET</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="1.Plymouth源代码目录介绍源码包里最重要的就是src这个目录，这是程序的源代码目录。下面将介绍src目录的内容，src目录的主要内容如下所示。这里只列举出了与文本模式启动显示相关的主要文件，并非全部。./src&#160; ├── client &#160; │&#160;&#160; ├──plymouth.c&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;# plymouth客户程序&#160; ├── libply&#160; │" />
<script src="http://static.blog.csdn.net/scripts/jquery.js" type="text/javascript"></script>
<script type="text/javascript" src="http://static.blog.csdn.net/scripts/ad.js?v=1.1"></script>
<link rel="Stylesheet" type="text/css" href="http://static.blog.csdn.net/skin/default/css/style.css?v=1.1" />
<link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="/wangst4321/rss/list" />
<link rel="shortcut icon" href="/favicon.ico" />
<link type="text/css" rel="stylesheet" href="http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/default.css" />
</head>
<body>
<script src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"type="text/javascript"></script>

<div id="container">
<div id="header">
    <div class="header">
        <div id="blog_title">
            <h1><a href="/wangst4321">wangst4321的专栏</a></h1>
            <h2></h2>
            <div class="clear"></div>
        </div>
        <div class="clear"></div>
    </div>
</div>
<div id="navigator">
    <div class="navigator_bg"></div>
    <div class="navigator">
        <ul>
            <li id="btnContents"><a href="/wangst4321?viewmode=contents"><span><img src="http://static.blog.csdn.net/images/ico_list.gif">目录视图</span></a></li>
            <li id="btnView"><a href="/wangst4321?viewmode=list"><span><img src="http://static.blog.csdn.net/images/ico_summary.gif">摘要视图</span></a></li>
            <li id="btnRss"><a href="/wangst4321/rss/list"><span><img src="http://static.blog.csdn.net/images/ico_rss.gif">订阅</span></a></li>
</ul>
    </div>
</div>
<script type="text/javascript">
    var username = "wangst4321";
    var _blogger = username;
    var blog_address = "http://blog.csdn.net/wangst4321";
    var static_host = "http://static.blog.csdn.net";
    var currentUserName = "";
</script>

<div id="body">
<div id="main">
<div class="main">
<div class="notice"> 

<a href="http://blog.csdn.net/blogdevteam/article/details/8899926" target="_blank">
<font color=red>有奖征集活动系列——【HTML5游戏编程之旅】 
   </font></a>



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://www.csdn.net/article/2013-05-13/2815252" target="_blank"><font color=blue>专访雷果国：我从1.5K到18K的成长之路 
</font></a>

&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://events.csdn.net/wy/APC/invite.html
"target="_blank">
<font color=red>探究云计算数据中心节能增效之道


 </font></a>

&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://blog.csdn.net/blogdevteam/article/details/8900468 "target="_blank">
<font color=red>CSDN博客第一期云计算最佳博主评选
 </font></a>


&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://blog.csdn.net/blogdevteam/article/details/8853291"target="_blank">
<font color=blue>CSDN博客第二期最佳移动开发博主评选
 </font></a>




</div>
<div id="article_details" class="details">
    <div class="article_title">
    <span class="ico ico_type_Original"></span>
    <h3>
        <span class="link_title"><a href="/wangst4321/article/details/8029169">
        Plymouth文本模式启动画面修改
        </a></span>
    </h3>
</div>

        
    <div class="article_manage">
        <span class="link_categories">
        分类：
            <a href="/wangst4321/article/category/1248151">Plymouth Linux 启动</a> 
        </span>
    <span class="link_postdate">2012-09-28 16:57</span>
    <span class="link_view" title="阅读次数">220人阅读</span>
    <span class="link_comments" title="评论次数"><a href="#comments">评论</a>(4)</span>
    <span class="link_collect"><a href="javascript:void(0);" onclick="javascript:collectArticle('Plymouth文本模式启动画面修改','8029169');return false;" title="收藏">收藏</a></span>
    <span class="link_report"><a href="#report"  onclick="javascript:report(8029169,2);return false;" title="举报">举报</a></span>
    
</div>
<div class="tag2box"><a href='http://blog.csdn.net/tag/details.html?tag=terminal' target=_blank>terminal</a><a href='http://blog.csdn.net/tag/details.html?tag=scripting' target=_blank>scripting</a><a href='http://blog.csdn.net/tag/details.html?tag=string' target=_blank>string</a><a href='http://blog.csdn.net/tag/details.html?tag=os' target=_blank>os</a><a href='http://blog.csdn.net/tag/details.html?tag=plugins' target=_blank>plugins</a><a href='http://blog.csdn.net/tag/details.html?tag=%e8%af%ad%e8%a8%80' target=_blank>语言</a></div>


    
<div id="article_content" class="article_content">

<p><span style="font-size:24px"><strong>1.Plymouth源代码目录介绍</strong></span><br>
</p>
<p>源码包里最重要的就是src这个目录，这是程序的源代码目录。下面将介绍src目录的内容，src目录的主要内容如下所示。这里只列举出了与文本模式启动显示相关的主要文件，并非全部。</p>
<p><span style="color:#C0504D">./src</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├── client </p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; ├──plymouth.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;# plymouth<span style="color:#C0504D">客户程序</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├── libply</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; ├──ply-event-loop.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #plymouth<span style="color:#C0504D">启动过程中的事件处理流程</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├──libply-splash-core</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; ├──ply-text-progress-bar.c&nbsp;&nbsp; #<span style="color:#C0504D">文本模式下使用到的画面刷新函数</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├──libply-splash-graphics</p>
<p><span style="color:#C0504D">&nbsp; </span>├── plugins</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; ├── controls</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; ├── renderers</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp; └── splash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;#plymouth<span style="color:#C0504D">的</span><span style="color:#C0504D">splash</span><span style="color:#C0504D">插件目录</span></p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ├── details</p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├── script&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<span style="color:#C0504D">该模块负责解析</span><span style="color:#C0504D">scripting</span><span style="color:#C0504D">脚本语言编写的启动代码</span></p>
<p><span style="color:#C0504D">&nbsp; </span>│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; └── text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<span style="color:#C0504D">文本模式下的启动</span><span style="color:#C0504D">splash</span><span style="color:#C0504D">插件</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├──upstart-bridge</p>
<p><span style="color:#C0504D">&nbsp; ├── viewer</span></p>
<p><span style="color:#C0504D">&nbsp; </span>├──main.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #plymouthd<span style="color:#C0504D">启动的主函数</span></p>
<p><span style="color:#C0504D">&nbsp; </span>└──ply-boot-server.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #plymouthd<span style="color:#C0504D">中负责与</span><span style="color:#C0504D">client</span><span style="color:#C0504D">通信的代码</span></p>
<p>&nbsp;</p>
<p>Plymouth的主题（theme）使用splash插件（plugins）来完成实际的启动界面显示工作。不同的主题使用到不同的splash插件。例如，红帽6的Ring主题使用的是two-step插件来显示启动画面的，许多主题使用的是script插件，这个插件支持scripting语言，可以更方便地实现我们想要的启动效果。文本模式下的启动界面，则是由text插件负责的。</p>
<p><br>
</p>
<p><strong><span style="font-size:24px">2. Plymouth启动过程介绍</span></strong><br>
</p>
<p></p>
<p>Plymouth在系统启动的过程中由initramfs中的init启动。Init分别启动Plymouthd守护进程和plymouth客户程序。由plymouth客户程序，通过Socket向Plymouthd守护进程发送show-splash，开始显示启动画面。同时，ply_boot_splash_update_progress被注册为Timeout事件，而定期地调用on_boot_progress，刷新启动界面。on_boot_progress是插件（plugin）提供的方法。Text插件的on_boot_progress方法会调用ply-text-progress-bar.c的ply_text_progress_bar_draw()方法显示启动画面。</p>
<p><img src="http://img.my.csdn.net/uploads/201209/28/1348822581_3656.JPG" alt=""></p>
<p><br>
</p>
<p><span style="font-size:24px"><strong>3. 如何修改文本模式的启动界面</strong></span><a name="_Toc336613556">&nbsp; 如何修改文本模式的启动界面</a></p>
<p></p>
<p>由上文可以知道文本模式下的启动画面主要是由ply-text-progress-bar.c的ply_text_progress_bar_draw()方法完成的，所以接下来看看这个方法是如何显示启动画面的。</p>
<p>代码如下所示，并不复杂。首先，使用progress_bar-&gt;percent_done进度&#20540;，计算三种颜色的显示位置和比例，绘制进度条。然后，显示OS名称字符串。</p>
<p><strong><span style="color:#7F0055">void</span></strong></p>
<p><strong><span style="color:black; background:silver">ply_text_progress_bar_draw</span></strong><span style="color:black"> (</span><span style="color:#005032">ply_text_progress_bar_t</span><span style="color:black"> *progress_bar)</span></p>
<p><span style="color:black">{</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>width = progress_bar-&gt;<span style="color:#0000C0">number_of_columns</span><span style="color:black"> - 2 -
</span><strong><span style="color:#642880">strlen</span></strong><span style="color:black"> (os_string);//</span><span style="color:black">获取进度条的宽度</span><span style="color:black">width</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>ply_text_display_set_cursor_position(progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>//<span style="color:black">设置输出光标在屏幕上的位置</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;progress_bar-&gt;<span style="color:#0000C0">column</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>progress_bar-&gt;<span style="color:#0000C0">row</span><span style="color:black">);</span></p>
<p>//根据启动进度percent_done获取三种颜色的显示比例</p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>brown_fraction = - (progress_bar-&gt;<span style="color:#0000C0">percent_done</span><span style="color:black"> * progress_bar-&gt;</span><span style="color:#0000C0">percent_done</span><span style="color:black">) &#43; 2 * progress_bar-&gt;</span><span style="color:#0000C0">percent_done</span><span style="color:black">;</span></p>
<p><span style="color:black">&nbsp;&nbsp; </span>&nbsp;blue_fraction&nbsp;= progress_bar-&gt;<span style="color:#0000C0">percent_done</span><span style="color:black">;</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>white_fraction = progress_bar-&gt;<span style="color:#0000C0">percent_done</span><span style="color:black"> * progress_bar-&gt;</span><span style="color:#0000C0">percent_done</span><span style="color:black">;</span></p>
<p>&nbsp;</p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">for</span></strong><span style="color:black"> (i = 0; i &lt; width; i&#43;&#43;) {//</span><span style="color:black">设置进度条每个显示单位的颜色</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">double</span></strong><span style="color:black"> f;</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>f = (<strong><span style="color:#7F0055">double</span></strong><span style="color:black">) i / (</span><strong><span style="color:#7F0055">double</span></strong><span style="color:black">) width;</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">if</span></strong><span style="color:black"> (f &lt; white_fraction)</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ply_text_display_set_background_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="color:#0000C0">PLY_TERMINAL_COLOR_WHITE</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">else</span><span style="color:#7F0055">if</span></strong><span style="color:black"> (f &lt; blue_fraction)</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ply_text_display_set_background_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<em><span style="color:#0000C0">PLY_TERMINAL_COLOR_BLUE</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">else</span><span style="color:#7F0055">if</span></strong><span style="color:black"> (f &lt; brown_fraction)</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ply_text_display_set_background_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<em><span style="color:#0000C0">PLY_TERMINAL_COLOR_BROWN</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">else</span></strong></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">break</span></strong><span style="color:black">;</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ply_text_display_write(progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,
</span><span style="color:#2A00FF">&quot;%c&quot;</span><span style="color:black">, </span>
<span style="color:#2A00FF">' '</span><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>}</p>
<p>&nbsp;</p>
<p><strong><span style="color:#7F0055">if</span></strong><span style="color:black">(brown_fraction &gt; 0.5) {//</span><span style="color:black">当启动进度达到一定&#20540;后，显示</span><span style="color:black">OS</span><span style="color:black">名称字符串</span></p>
<p><span style="color:black">//</span><span style="color:black">设置</span><span style="color:black">OS</span><span style="color:black">名称字符串的颜色</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">if</span></strong><span style="color:black"> (white_fraction &gt; 0.875)</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ply_text_display_set_foreground_color(progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="color:#0000C0">PLY_TERMINAL_COLOR_WHITE</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong><span style="color:#7F0055">else</span><span style="color:#7F0055">if</span></strong><span style="color:black"> (blue_fraction &gt; 0.66)</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ply_text_display_set_foreground_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em><span style="color:#0000C0">PLY_TERMINAL_COLOR_BLUE</span></em><span style="color:black">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>
<p><strong><span style="color:#7F0055">else</span></strong></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ply_text_display_set_foreground_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><em><span style="color:#0000C0">PLY_TERMINAL_COLOR_BROWN</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ply_text_display_set_cursor_position(progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;progress_bar-&gt;<span style="color:#0000C0">column</span><span style="color:black"> &#43; width,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>progress_bar-&gt;<span style="color:#0000C0">row</span><span style="color:black">);</span></p>
<p>&nbsp;</p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ply_text_display_write(progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,
</span><span style="color:#2A00FF">&quot;%s&quot;</span><span style="color:black">,os_string); //</span><span style="color:black">显示</span><span style="color:black">OS</span><span style="color:black">名称字符串</span></p>
<p><span style="color:black">&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ply_text_display_set_foreground_color (progress_bar-&gt;<span style="color:#0000C0">display</span><span style="color:black">,</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<em><span style="color:#0000C0">PLY_TERMINAL_COLOR_DEFAULT</span></em><span style="color:black">);</span></p>
<p><span style="color:black">&nbsp;&nbsp;&nbsp; </span>}</p>
<p><span style="color:black">}</span></p>
<p>在屏幕上显示字符时，首先确定光标的位置，使用set_cursor_position设置，然后使用set_foreground_color设置字符颜色，最后使用write输出字符。其中进度条使用的是空&#26684;做为显示字符。</p>
<p>OS名称字符串是通过全局变量os_string获得的，由get_os_string()得到。get_os_string方法读取initramfs中的/etc/system-release文件，这个文件里就存放一个字符串。字符串的&#26684;式要求很严&#26684;，必须是“os名称&#43;空&#26684;&#43;release&#43;空&#26684;&#43;os版本&#43;（代号）”，否则得到的os_string将是空字符串。</p>
<p><br>
</p>
<strong><span style="font-size:24px">4. 编译及制作rpm</span></strong>
<p></p>
<p>这里介绍的方法是基于SRPM源码包的。以plymouth-0.8.3-24.el6.1.src.rpm为例。</p>
<p>首先，安装SRPM源码包。</p>
<p><span style="color:#0070C0">rpm –i </span><span style="color:#0070C0">plymouth-0.8.3-24.el6.1.src.rpm</span></p>
<p>在rpmbuild/SOURCE目录下产生Plymouth的原文件的压缩档案plymouth-0.8.3.tar.bz2，将其解压缩。产生plymouth-0.8.3原码目录。</p>
<p><span style="color:#0070C0">tar xvf plymouth-0.8.3.tar.bz2</span></p>
<p>接着，在plymouth-0.8.3原文件目录下，修改相关文件。完成后，Plymouth的原码目录重新压缩为plymouth-0.8.3.tar.bz2</p>
<p>最后，在rpmbuild/SPEC目录下，运行‘rpmbuild –ba plymouth.spec’，开始重新编译及RPM包的生成。</p>
<p>Plymouth的编译过程，需要依赖于很多安装包，如果在这个过程中出错，通常都是缺少相应的安装包。</p>
<p><br>
</p>
<p><span style="font-size:24px"><strong>5.参考</strong></span></p>
<ul>
<li><span style="font-size:24px"><strong></strong></span>
<p>http://www.freedesktop.org/wiki/Software/Plymouth</p>
</li><li><span style="font-size:24px"><strong></strong></span>
<p><a href="http://blog.fpmurphy.com/2009/09/project-plymouth.html">http://blog.fpmurphy.com/2009/09/project-plymouth.html</a></p>
</li><li><span style="font-size:24px"><strong></strong></span>
<p>Plymouth源码包含的Doc文档：development.txt</p>
</li></ul>
<p></p>
<p></p>
<p><span style="font-size:24px"><strong><br>
</strong></span></p>
<p><br>
</p>
<p>&nbsp;</p>
<br>
<br>

</div>

<div class="share_buttons" id="sharePanel"></div>
<!--192.168.1.236-->
<div class="article_next_prev">
    <li class="next_article"><span>下一篇：</span><a href="/wangst4321/article/details/8081738">AWStats使用</a></li>
</div>


    
</div>
<div id="ad_cen">
<script type="text/javascript" >BAIDU_CLB_SLOT_ID = "117306";</script>
<script type="text/javascript" src="http://cbjs.baidu.com/js/o.js"></script>
</div>
<script type="text/javascript">
    //new Ad(4, 'ad_cen');
</script>
<div id="comment_title" class="panel_head">查看评论<a name="comments"></a></div>
<div id="comment_list"></div>
<div id="comment_bar"></div>
<div id="comment_form"></div>
<div class="announce">* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a name="reply"></a><a name="quote"></a></div>
<script type="text/javascript">
    var fileName = '8029169';
    var commentscount = 4;
    var islock = false
</script>
<script type="text/javascript" src="http://static.blog.csdn.net/scripts/comment.js"></script>
<div id="ad_bot"></div>
<script type="text/javascript">
    new Ad(5, 'ad_bot');
</script>
<div id="report_dialog"></div>

<div id="d-top" style="display:none;">
<a id="d-top-a" href="#" title="回到顶部">
<img src="http://static.blog.csdn.net/images/top.png" alt="TOP" /></a>
</div>
<script type="text/javascript">
    $(function(){
        var d_top=$('#d-top');
        document.onscroll=function(){
            var scrTop=(document.body.scrollTop||document.documentElement.scrollTop);
            if(scrTop>500){
                d_top.show();
            }else{
                d_top.hide();
            }
        }
        $('#d-top-a').click(function(){
            scrollTo(0,0);
            this.blur();
            return false;
        });
    });
</script>

<div class="clear"></div>
</div>
</div>

<div id="side">
<div class="side">
<div id="panel_Profile" class="panel">
<ul class="panel_head"><span>个人资料</span></ul>
<ul class="panel_body profile">
<div id="blog_userface">
    <a href="http://my.csdn.net/wangst4321" target="_blank">
    <img src="http://avatar.csdn.net/9/2/2/1_wangst4321.jpg" title="访问我的空间" style="max-width:90%"/>
    </a>
    <br />
    <span><a href="http://my.csdn.net/wangst4321" class="user_name" target="_blank">wangst4321</a></span>
</div>
<div class="interact">
<a href="javascript:void(0);" class="attent" id="span_add_follow" title="[加关注]"></a>
<a href="javascript:void(0);" class="letter" onclick="loginto(1)" title="[发私信]"></a>
</div>
<div id="blog_medal">
</div>
<ul id="blog_rank">
    <li>访问：<span>4405次</span></li>
    <li>积分：<span>268分</span></li>
    <li>排名：<span>千里之外</span></li>
</ul>
<ul id="blog_statistics">
    <li>原创：<span>22篇</span></li>
    <li>转载：<span>4篇</span></li>
    <li>译文：<span>0篇</span></li>
    <li>评论：<span>5条</span></li>
</ul>
</ul>
</div>



<div class="panel" id="panel_Search">
    <ul class="panel_head"><span>文章搜索</span></ul>
    <ul class="panel_body">
        <form id="frmSearch" action="http://so.csdn.net/search" class="form_search" target="_blank">
        <span><input id="inputSearch" type="text" class="blogsearch" title="请输入关键字" /></span>
        <input id="btnSubmit" type="submit" value="搜索" title="search in blog" />
        <input type="hidden" name="q" id="inputQ" />
        <input type="hidden" name="t" value="blog" />
        <a id="btnSearchBlog" target="_blank"></a>
        </form>
    </ul>
</div><div id="panel_Category" class="panel">
<ul class="panel_head"><span>文章分类</span></ul>
<ul class="panel_body">
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1280455">django</a><span>(2)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1310643">Python标准库</a><span>(6)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1277976">openstack</a><span>(1)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1248151">Plymouth Linux 启动</a><span>(1)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1236711">start</a><span>(0)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1323323">c语言学习</a><span>(5)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1332444">openvpn</a><span>(2)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1365469">git</a><span>(1)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1368953">网站分析</a><span>(2)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1371266">xml学习笔记</a><span>(3)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1372599">linux编程</a><span>(4)</span>
</li>
<li>
<a href="http://blog.csdn.net/wangst4321/article/category/1386192">nginx开发</a><span>(2)</span>
</li>
</ul>
</div><div id="panel_Archive" class="panel">
<ul class="panel_head"><span>文章存档</span></ul>
<ul class="panel_body">
<div id="archive_list">
<!--归档统计-->
<li><a href="http://blog.csdn.net/wangst4321/article/month/2013/05">2013年05月</a><span>(1)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2013/04">2013年04月</a><span>(2)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2013/03">2013年03月</a><span>(10)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2013/02">2013年02月</a><span>(1)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2013/01">2013年01月</a><span>(2)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2012/12">2012年12月</a><span>(2)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2012/11">2012年11月</a><span>(6)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2012/10">2012年10月</a><span>(1)</span></li><li><a href="http://blog.csdn.net/wangst4321/article/month/2012/09">2012年09月</a><span>(1)</span></li>
</div>
</ul>
</div>
<div id="hotarticls" class="panel">
<ul class="panel_head"><span>阅读排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="/wangst4321/article/details/8168344" title="openstack初步">openstack初步</a><span>(489)</span>
</li>
<li>
<a href="/wangst4321/article/details/8704263" title="非阻塞io和IO多路转接">非阻塞io和IO多路转接</a><span>(262)</span>
</li>
<li>
<a href="/wangst4321/article/details/8454118" title="Unittest使用和代码简介">Unittest使用和代码简介</a><span>(256)</span>
</li>
<li>
<a href="/wangst4321/article/details/8789779" title="socket编程缓冲区大小对send()的影响">socket编程缓冲区大小对send()的影响</a><span>(234)</span>
</li>
<li>
<a href="/wangst4321/article/details/8531922" title="openvpn体验">openvpn体验</a><span>(226)</span>
</li>
<li>
<a href="/wangst4321/article/details/8029169" title="Plymouth文本模式启动画面修改">Plymouth文本模式启动画面修改</a><span>(220)</span>
</li>
<li>
<a href="/wangst4321/article/details/8697838" title="ElementTree处理xml">ElementTree处理xml</a><span>(212)</span>
</li>
<li>
<a href="/wangst4321/article/details/8729204" title="文件锁">文件锁</a><span>(208)</span>
</li>
<li>
<a href="/wangst4321/article/details/8733212" title="socket编程：backlog值对listen连接状态的影响">socket编程：backlog值对listen连接状态的影响</a><span>(201)</span>
</li>
<li>
<a href="/wangst4321/article/details/8658859" title="python标准库logging模块代码分析">python标准库logging模块代码分析</a><span>(185)</span>
</li>
</ul>
</div>
<div id="hotarticls2" class="panel">
<ul class="panel_head"><span>评论排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="/wangst4321/article/details/8029169" title="Plymouth文本模式启动画面修改">Plymouth文本模式启动画面修改</a><span>(4)</span>
</li>
<li>
<a href="/wangst4321/article/details/8168344" title="openstack初步">openstack初步</a><span>(1)</span>
</li>
<li>
<a href="/wangst4321/article/details/8673728" title="git使用介绍（一）">git使用介绍（一）</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8688003" title="网站分析的基本概念">网站分析的基本概念</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8697682" title="XML基础知识">XML基础知识</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8697838" title="ElementTree处理xml">ElementTree处理xml</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8700815" title="sax模块处理xml">sax模块处理xml</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8704263" title="非阻塞io和IO多路转接">非阻塞io和IO多路转接</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8729204" title="文件锁">文件锁</a><span>(0)</span>
</li>
<li>
<a href="/wangst4321/article/details/8733212" title="socket编程：backlog值对listen连接状态的影响">socket编程：backlog值对listen连接状态的影响</a><span>(0)</span>
</li>
</ul>
</div>
<div id="homepageArticles" class="panel">
<ul class="panel_head"><span>推荐文章</span></ul>
<ul class="panel_body" id="ad_commend"></ul>
</div>
<script type="text/javascript">
 new Ad(12, 'ad_commend');
</script><div id="newcomments" class="panel">
<ul class="panel_head"><span>最新评论</span></ul>
<ul class="panel_body itemlist">
    <li>
    <a href="/wangst4321/article/details/8029169#comments">Plymouth文本模式启动画面修改</a>
    <p style="margin:0px;"><a href="/ping1214" class="user_name">ping1214</a>:
@wangst4321:我是要修改rings这个主题，现在看到它的插件（two-step）plugi...
    </p>
    </li>
    <li>
    <a href="/wangst4321/article/details/8029169#comments">Plymouth文本模式启动画面修改</a>
    <p style="margin:0px;"><a href="/wangst4321" class="user_name">wangst4321</a>:
@ping1214:有一段时间了，对于这个事件循环具体的原理，我当时也只是懂了个大概，把当时的任务完...
    </p>
    </li>
    <li>
    <a href="/wangst4321/article/details/8029169#comments">Plymouth文本模式启动画面修改</a>
    <p style="margin:0px;"><a href="/ping1214" class="user_name">ping1214</a>:
lz,能不能讲讲plymouth中的事件循环处理是怎么个回事，我看的一头雾水
    </p>
    </li>
    <li>
    <a href="/wangst4321/article/details/8029169#comments">Plymouth文本模式启动画面修改</a>
    <p style="margin:0px;"><a href="/ping1214" class="user_name">ping1214</a>:
你好，我因为工作需要也在分析Plymouth的代码，看了你的这篇文章，很有帮助，如果看代码过程中遇到...
    </p>
    </li>
    <li>
    <a href="/wangst4321/article/details/8168344#comments">openstack初步</a>
    <p style="margin:0px;"><a href="/Adela_09" class="user_name">Adela_09</a>:
推荐 这个 一键安装的奇葩东东给你看http://blog.csdn.net/hilyoo/arti...
    </p>
    </li>
</ul>
</div>
</div>
<div class="clear"></div>
</div>

<div class="clear"></div>
</div>

<script type="text/javascript" src="http://static.blog.csdn.net/scripts/newblog.min.js?v=1.1"></script>
<script type="text/javascript" src="http://medal.blog.csdn.net/showblogmedal.ashx?blogid=1332472"></script>

<script type="text/javascript">
document.write('<script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js?' + Math.floor(new Date()/120000).toString(36) + '="></'+'script>');
</script>

<script type="text/javascript" src="http://passport.csdn.net/content/loginbox/login.js"></script>
<script type="text/javascript">document.write("<img src=http://counter.csdn.net/pv.aspx?id=24 border=0 width=0 height=0>");</script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js?v=1"></script>


<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-blog.js"></script>

</div>
</body>
</html>