<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Samba - Indie IT - Wiki</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Indie IT - Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.indie-it.com/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Indie IT - Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.indie-it.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="http://wiki.indie-it.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: db371761041-mw_:resourceloader:filter:minify-css:7:185d685179ab522637e5019bc1cb5157 */</style>

<script src="http://wiki.indie-it.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Samba","wgTitle":"Samba","wgCurRevisionId":6449,"wgArticleId":198,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Linux","Software"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Samba","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: db371761041-mw_:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Samba skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">Samba</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Indie IT - Wiki</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#SAMBA4"><span class="tocnumber">1</span> <span class="toctext">SAMBA4</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#SAMBA4_HOWTO:_Fix_Error_In_DC_Replication"><span class="tocnumber">2</span> <span class="toctext">SAMBA4 HOWTO: Fix Error In DC Replication</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#SAMBA4_HOWTO:_Query_.2F_Show_All_Entries_In_DNS"><span class="tocnumber">3</span> <span class="toctext">SAMBA4 HOWTO: Query / Show All Entries In DNS</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#SAMBA4_HOWTO:_Change_Administrator_Password"><span class="tocnumber">4</span> <span class="toctext">SAMBA4 HOWTO: Change Administrator Password</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#SAMBA4_TO_DO"><span class="tocnumber">5</span> <span class="toctext">SAMBA4 TO DO</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#HOWTO:_Restrict_File_Sharing_To_Particular_Users_or_Network_Addresses"><span class="tocnumber">6</span> <span class="toctext">HOWTO: Restrict File Sharing To Particular Users or Network Addresses</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Shut_Down_A_Windows_PC_Remotely"><span class="tocnumber">7</span> <span class="toctext">Shut Down A Windows PC Remotely</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#ERROR:_read_data:_Accessing_Share_From_Windows_7"><span class="tocnumber">8</span> <span class="toctext">ERROR: read_data: Accessing Share From Windows 7</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Adding_And_Testing_Users"><span class="tocnumber">9</span> <span class="toctext">Adding And Testing Users</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Add_Roaming_Profile_Machine_Trust_Account"><span class="tocnumber">10</span> <span class="toctext">Add Roaming Profile Machine Trust Account</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Test_Samba_Share_Via_Command_Line"><span class="tocnumber">11</span> <span class="toctext">Test Samba Share Via Command Line</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Tweaks_For_Network_Browsing"><span class="tocnumber">12</span> <span class="toctext">Tweaks For Network Browsing</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Fix_Subnet_Interface_Errors"><span class="tocnumber">13</span> <span class="toctext">Fix Subnet Interface Errors</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Windows_7:_Domain_Log_On"><span class="tocnumber">14</span> <span class="toctext">Windows 7: Domain Log On</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Primary_Domain_Controller"><span class="tocnumber">15</span> <span class="toctext">Primary Domain Controller</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="SAMBA4"> SAMBA4  </span></h2>
<p><a rel="nofollow" class="external free" href="https://wiki.samba.org/index.php/Samba_4/OS_Requirements#Gentoo">https://wiki.samba.org/index.php/Samba_4/OS_Requirements#Gentoo</a>
</p>
<pre>eselect python set python2.7
python-updater
emerge --unmerge --ask app-crypt/mit-krb5
emerge --ask --quiet app-crypt/heimdal
revdep-rebuild -- -ask

echo "net-dns/bind berkdb dlz gssapi" &gt;&gt;/etc/portage/package.use
echo "net-dns/bind-tools gssapi" &gt;&gt;/etc/portage/package.use

emerge --ask --quiet net-dns/bind net-dns/bind-tools

nano /etc/portage/package.keywords
# required by samba4
sys-libs/tevent ~amd64
sys-libs/tdb ~amd64
sys-libs/ldb ~amd64
sys-libs/talloc ~amd64

nano /etc/portage/package.use
sys-libs/tdb python
sys-libs/talloc python 

emerge --ask --quiet sys-libs/talloc sys-libs/tdb sys-libs/tevent sys-libs/ldb   
emerge --ask --quiet net-libs/gnutls sys-apps/acl dev-libs/cyrus-sasl dev-python/subunit dev-python/dnspython net-dns/libidn

nano /etc/fstab
/dev/md4   /home     ext4     user_xattr,acl,barrier=1,noatime         1 1

cd /usr/src/linux
make menuconfig
make &amp;&amp; make modules_install
cp -av arch/x86/boot/bzImage /boot/kernel-3.3.8-gentoo 
cp -av System.map /boot/System.map-3.3.8-gentoo 
cp -av .config /boot/config-3.3.8-gentoo 
reboot

mkdir /root/misc/
cd /root/misc/
touch test.txt
setfattr -n user.test -v test test.txt
setfattr -n security.test -v test2 test.txt
getfattr -d test.txt
getfattr -n security.test -d test.txt
touch test3.txt
setfacl -m g:adm:rwx test3.txt
getfacl test3.txt

eselect python set python2.7

mkdir /usr/src/samba4
cd /usr/src/samba4
git clone git://git.samba.org/samba.git samba-master
cd samba-master
./configure --enable-debug --enable-selftest
make
Waf: Leaving directory `/usr/src/samba4/samba-master/bin'
'build' finished successfully (11m54.988s)

make install
Waf: Leaving directory `/usr/src/samba4/samba-master/bin'
'install' finished successfully (3m15.214s)

samba.EXAMPLE.com ~ $ /usr/local/samba/bin/samba-tool domain provision
Realm [EXAMPLE.COM]:
 Domain [EXAMPLE]:
 Server Role (dc, member, standalone) [dc]:
 DNS backend (SAMBA_INTERNAL, BIND9_FLATFILE, BIND9_DLZ, NONE) [SAMBA_INTERNAL]:
 DNS forwarder IP address (write 'none' to disable forwarding) [192.168.0.1]:
Administrator password:
Retype password:
Looking up IPv4 addresses
More than one IPv4 address found. Using 172.16.215.1
Looking up IPv6 addresses
No IPv6 address will be assigned
Setting up share.ldb
Setting up secrets.ldb
Setting up the registry
Setting up the privileges database
Setting up idmap db
Setting up SAM db
Setting up sam.ldb partitions and settings
Setting up sam.ldb rootDSE
Pre-loading the Samba 4 and AD schema
Adding DomainDN: DC=EXAMPLE,DC=com
Adding configuration container
Setting up sam.ldb schema
Setting up sam.ldb configuration data
Setting up display specifiers
Modifying display specifiers
Adding users container
Modifying users container
Adding computers container
Modifying computers container
Setting up sam.ldb data
Setting up well known security principals
Setting up sam.ldb users and groups
Setting up self join
Adding DNS accounts
Creating CN=MicrosoftDNS,CN=System,DC=EXAMPLE,DC=com
Creating DomainDnsZones and ForestDnsZones partitions
Populating DomainDnsZones and ForestDnsZones partitions
Setting up sam.ldb rootDSE marking as synchronized
Fixing provision GUIDs
A Kerberos configuration suitable for Samba 4 has been generated at /usr/local/samba/private/krb5.conf
Once the above files are installed, your Samba4 server will be ready to use
Server Role:           active directory domain controller
Hostname:              samba
NetBIOS Domain:        EXAMPLE
DNS Domain:            EXAMPLE.com
DOMAIN SID:            S-1-5-21-1142887457-1374467446-1811036830

cp /usr/local/samba/private/krb5.conf /etc/

cat /etc/resolv.conf
domain example.com
nameserver 192.168.0.208

cat /usr/local/samba/etc/smb.conf
# Global parameters
[global]
       workgroup = EXAMPLE
       realm = EXAMPLE.COM
       netbios name = SAMBA
       server role = active directory domain controller
       dns forwarder = 192.168.0.1

[netlogon]
       path = /usr/local/samba/var/locks/sysvol/example.com/scripts
       read only = No

[sysvol]
       path = /usr/local/samba/var/locks/sysvol
       read only = No


/usr/local/samba/sbin/samba -i -M single
</pre>
<pre>(separate terminal)

$ /usr/local/samba/bin/smbclient --version
Version 4.1.0pre1-GIT-8aae8b5

$ /usr/local/samba/bin/smbclient -L localhost -U%
Domain=[EXAMPLE] OS=[Unix] Server=[Samba 4.1.0pre1-GIT-8aae8b5]

       Sharename       Type      Comment
       ---------       ----      -------
       netlogon        Disk
       sysvol          Disk
       IPC$            IPC       IPC Service (Samba 4.1.0pre1-GIT-8aae8b5)
Domain=[EXAMPLE] OS=[Unix] Server=[Samba 4.1.0pre1-GIT-8aae8b5]
</pre>
<pre>/usr/local/samba/bin/smbclient //localhost/netlogon -UAdministrator%'passW0rd' -c 'ls'
</pre>
<pre>host -t SRV _ldap._tcp.example.com.
_ldap._tcp.example.com has SRV record 0 100 389 samba.example.com.
host -t SRV _kerberos._udp.example.com.
_kerberos._udp.example.com has SRV record 0 100 88 samba.example.com.

kinit Administrator@EXAMPLE.COM
Administrator@EXAMPLE.COM's Password:
 
klist
Credentials cache: FILE:/tmp/krb5cc_0
       Principal: Administrator@EXAMPLE.COM
Issued                Expires               Principal
Apr 10 15:52:04 2013  Apr 11 01:52:04 2013  krbtgt/EXAMPLE.COM@EXAMPLE.COM


-= DNS ISSUES / PROBLEMS / HOW TO EDIT SAMBA4_INTERNAL A RECORDS =-

host -t A samba.example.com
samba.example.com has address 172.16.215.1
samba.example.com has address 172.16.224.1
samba.example.com has address 192.168.0.208

/usr/local/samba/bin/samba-tool dns zonelist 192.168.0.208

/usr/local/samba/bin/samba-tool dns delete samba example.com @ A 172.16.215.1
/usr/local/samba/bin/samba-tool dns delete samba example.com samba.example.com A 172.16.215.1
/usr/local/samba/bin/samba-tool dns delete samba example.com @ A 172.16.224.1
/usr/local/samba/bin/samba-tool dns delete samba example.com samba.example.com A 172.16.224.1
</pre>
<p>Testing From Windows
</p>
<pre>ipconfig /release
ipconfig /renew
ipconfig /all
net view /domain:$DOMAIN
net view \\$ADHOST
nbtstat -A $ADHOST_IP4
</pre>
<p>0. <a rel="nofollow" class="external free" href="http://en.gentoo-wiki.com/wiki/Samba4_as_Active_Directory_Server">http://en.gentoo-wiki.com/wiki/Samba4_as_Active_Directory_Server</a>
</p><p>1. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Samba4">http://wiki.samba.org/index.php/Samba4</a>
</p><p>2. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Samba_4/OS_Requirements">http://wiki.samba.org/index.php/Samba_4/OS_Requirements</a>
</p><p>3. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO">http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO</a>
</p><p>4. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD">http://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD</a>
</p><p>5. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Samba_AD_management_from_windows">http://wiki.samba.org/index.php/Samba_AD_management_from_windows</a>
</p><p>6. <a rel="nofollow" class="external free" href="http://www.alexwyn.com/computer-tips/centos-samba4-active-directory-domain-controller">http://www.alexwyn.com/computer-tips/centos-samba4-active-directory-domain-controller</a>
</p><p>7. <a rel="nofollow" class="external free" href="http://wiki.samba.org/index.php/Backup_and_Recovery">http://wiki.samba.org/index.php/Backup_and_Recovery</a>
</p>
<h2> <span class="mw-headline" id="SAMBA4_HOWTO:_Fix_Error_In_DC_Replication"> SAMBA4 HOWTO: Fix Error In DC Replication </span></h2>
<p>If you are getting these errors in your logs...
</p>
<pre>[2013/05/31 12:21:57,  0] ../source4/dsdb/repl/drepl_ridalloc.c:43(drepl_new_rid_pool_callback)
 ../source4/dsdb/repl/drepl_ridalloc.c:43: RID Manager failed RID allocation - WERR_BADFILE - extended_ret[0x0]
</pre>
<p>...and domain replication does not appear to be working, then you have the glibc (at
least 2.17) nss dns resolver bug - where the resolver cannot look up names with an _ underscore.
</p><p>To find your _msdcs_ name, look it up...
</p>
<pre>/usr/local/samba/bin/ldbsearch -H /usr/local/samba/private/sam.ldb '(invocationid=*)' --cross-ncs objectguid
</pre>
<p>To test this, try to ping the _msdcs_ name. You will receive an unknown host error...
</p>
<pre>ping 5813325c-fa80-4e0e-b76e-4666f6afe1e2._msdcs.xyz.com
</pre>
<p>To fix this, first add the _msdcs_ entry to /etc/hosts
</p>
<pre>127.0.0.1       localhost.localdomain localhost
#127.0.1.1      samba2.xyz.com  samba2
192.168.0.208   5813325c-fa80-4e0e-b76e-4666f6afe1e2._msdcs.xyz.com samba.xyz.com samba
192.168.0.209   f0605966-1d4f-4fef-8a75-2a24863dbaa9._msdcs.xyz.com samba2.xyz.com samba2 
</pre>
<p>Second, make sure you add <b>all</b> the correct CNAME and A record entries in your Samba4 DCs DNS... that is, details of the secondary DC2 to _both_ DCs...
</p>
<pre>/usr/local/samba/bin/samba-tool dns add 192.168.0.<b>208</b> xyz.com samba2 A 192.168.0.209
/usr/local/samba/bin/samba-tool dns add 192.168.0.<b>209</b> xyz.com samba2 A 192.168.0.209
/usr/local/samba/bin/samba-tool dns add 192.168.0.<b>208</b> _msdcs.xyz.com f0605966-1d4f-4fef-8a75-2a24863dbaa9 CNAME samba2.xyz.com -UAdministrator
/usr/local/samba/bin/samba-tool dns add 192.168.0.<b>209</b> _msdcs.xyz.com f0605966-1d4f-4fef-8a75-2a24863dbaa9 CNAME samba2.xyz.com -UAdministrator
</pre>
<p>Now try to ping the _msdcs_ name. It will work...
</p>
<pre>ping 5813325c-fa80-4e0e-b76e-4666f6afe1e2._msdcs.xyz.com
</pre>
<p>And you will see two-way tcp connections in netstat...
</p>
<pre>tcp        0      0 192.168.0.209:<b>1024</b>      192.168.0.208:36814     ESTABLISHED 582/samba       
tcp        0      0 192.168.0.209:35246     192.168.0.208:<b>1024</b>      ESTABLISHED 589/samba       
</pre>
<p>Amazingly simple, but it fixes it.
</p><p>You should see the extra Domain Computers that were not on your Secondary Samba4 Domain Controller.
</p><p>To confirm all is working, add or edit a user and check it on the DC2...
</p>
<pre>/usr/local/samba/bin/samba-tool group listmembers "Domain Computers" |sort -f
</pre>
<p>or
</p>
<pre>/usr/local/samba/bin/samba-tool user list |sort -f
</pre>
<p>And look at the Replication status log...
</p>
<pre>/usr/local/samba/bin/samba-tool drs showrepl

Default-First-Site-Name\SAMBA2
DSA Options: 0x00000001
DSA object GUID: f0605966-1d4f-4fef-8a75-2a24863dbaa9
DSA invocationId: d84e13de-4ed4-45e5-ba94-f04954536c51

==== INBOUND NEIGHBORS ====

CN=Configuration,DC=xyz,DC=com
        Default-First-Site-Name\SAMBA via RPC
                DSA object GUID: 5813325c-fa80-4e0e-b76e-4666f6afe1e2
                Last attempt @ Fri May 31 13:17:06 2013 BST was successful
                0 consecutive failure(s).
                Last success @ Fri May 31 13:17:06 2013 BST

==== OUTBOUND NEIGHBORS ====

CN=Configuration,DC=xyz,DC=com
        Default-First-Site-Name\SAMBA via RPC
                DSA object GUID: 5813325c-fa80-4e0e-b76e-4666f6afe1e2
                Last attempt @ NTTIME(0) was successful
                0 consecutive failure(s).
                Last success @ NTTIME(0)

==== KCC CONNECTION OBJECTS ====

Connection --
        Connection name: 32efa02a-2852-45e8-bb49-78f0f3927895
        Enabled       &#160;: TRUE
        Server DNS name&#160;: samba.xyz.com
        Server DN name &#160;: CN=NTDS Settings,CN=SAMBA,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=xyz,DC=com
                TransportType: RPC
                options: 0x00000001
</pre>
<p>And check the Active Directory database consistency, etc...
</p>
<pre>root@samba:~# <b>/usr/local/samba/bin/samba-tool drs kcc</b>
Consistency check on samba.xyz.com successful.

root@samba2:~# /usr/local/samba/bin/samba-tool drs kcc
Consistency check on samba2.xyz.com successful.
</pre>
<pre>/usr/local/samba/bin/samba-tool dbcheck
Checking 274 objects
Checked 274 objects (0 errors)
</pre>
<p>Both DC1 and DC2 should give the <b>same number of objects</b>.
</p>
<h2> <span class="mw-headline" id="SAMBA4_HOWTO:_Query_.2F_Show_All_Entries_In_DNS"> SAMBA4 HOWTO: Query / Show All Entries In DNS </span></h2>
<pre>/usr/local/samba/bin/samba-tool dns query localhost domain.com @ ALL
</pre>
<h2> <span class="mw-headline" id="SAMBA4_HOWTO:_Change_Administrator_Password"> SAMBA4 HOWTO: Change Administrator Password </span></h2>
<pre>kpasswd
</pre>
<p>and
</p>
<pre>/usr/local/samba/bin/samba-tool user setpassword Administrator
New Password: 
Enter it again:
Password changed.
</pre>
<p><a rel="nofollow" class="external free" href="http://www.golinuxhub.com/2013/03/changing-password-of-administrator-in.html">http://www.golinuxhub.com/2013/03/changing-password-of-administrator-in.html</a>
</p>
<h2> <span class="mw-headline" id="SAMBA4_TO_DO"> SAMBA4 TO DO </span></h2>
<ul><li> Updating From GIT
</li></ul>
<p><b>Shut down Samba on both DC1 and DC2.</b>
</p>
<pre>git pull
</pre>
<p>...but may have to do:-
</p>
<pre>git clean -x -f -d
</pre>
<p>Make and Install as above.
</p><p><b>Start Samba on both DC1 and DC2.</b>
</p>
<ul><li> <strike>Ubuntu Startup Script</strike>
</li></ul>
<p><a rel="nofollow" class="external free" href="https://wiki.samba.org/index.php/Samba4/InitScript">https://wiki.samba.org/index.php/Samba4/InitScript</a>
</p>
<ul><li> <strike>Secondary AD DC</strike>
</li></ul>
<pre>samba-tool rds showrepl
</pre>
<p>1. On the server you have already installed what you want to match:-
</p>
<pre>  $ cd /usr/src/samba4/samba-master
  $ git log -1
</pre>
<p>This will show you have HASH revision number.
</p><p>2. On the server you want to install the same:-
</p>
<pre>  $ mkdir /usr/src/samba4
  $ cd /usr/src/samba4/
  $ git clone git://git.samba.org/samba.git samba-master
  $ cd samba-master/
  $ git checkout 8aae8b5bad167ac732b7f8949dfb40aebb2f26a9
  $ git reset --hard
</pre>
<p>Proceed as above for installing the software.
</p><p><a rel="nofollow" class="external free" href="https://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC">https://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC</a>
</p>
<ul><li> <strike>List Domain Users</strike>
</li></ul>
<pre>/usr/local/samba/bin/samba-tool user list |sort
</pre>
<ul><li> <strike>Active Directory Windows Tool</strike>
</li></ul>
<pre>dsa.msc
</pre>
<ul><li> <strike>DNS Editing</strike>
</li></ul>
<p>Adding an A record...
</p>
<pre>samba-tool dns add server zone name A|AAAA|PTR|CNAME|NS|MX|SRV|TXT data
</pre>
<p>Example...
</p>
<pre>samba-tool dns add samba example.com www A 123.456.789.0

Record added successfully
</pre>
<p>Testing...
</p>
<pre>nslookup www.example.com samba
Server:         samba
Address:        192.168.0.208#53

Name:   www.example.com
Address: 123.456.789.0
</pre>
<ul><li> <strike>Slow Logons</strike>
</li></ul>
<pre>Fixed by deleting multiple incorrect IP addresses for Samba4 server.
</pre>
<ul><li> <strike>Add New Users in Linux command-line</strike>
</li></ul>
<pre>/usr/local/samba/bin/samba-tool user add jbloggs joe
</pre>
<ul><li> <strike>Non Complex Passwords</strike>
</li></ul>
<pre>/usr/local/samba/bin/samba-tool domain passwordsettings set --complexity=off
Password complexity deactivated!
All changes applied successfully!

/usr/local/samba/bin/samba-tool domain passwordsettings set --min-pwd-length=3
Minimum password length changed!
All changes applied successfully!
</pre>
<ul><li> <strike>Backup and Restore</strike>
</li></ul>
<p><a rel="nofollow" class="external free" href="https://wiki.samba.org/index.php/Backup_and_Recovery">https://wiki.samba.org/index.php/Backup_and_Recovery</a>
</p>
<ul><li> <strike>Gentoo Samba4 Startup Script</strike>
</li></ul>
<pre>#!/sbin/runscript
# Copyright 1999-2011 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/net-fs/samba/files/samba4.initd,v 1.3 2011/09/14 22:52:33 polynomial-c Exp  $

extra_started_commands="reload"

description="The samba daemon init script"
description_reload="Reloads the samba daemon"

depend() {
       need net
}

start() {
       ebegin "Starting samba"
       start-stop-daemon --start --exec /usr/local/samba/sbin/samba
       eend $?
}

stop() {
       ebegin "Stopping samba"
       start-stop-daemon --stop --pidfile /usr/local/samba/var/run/samba.pid
       eend $?
}

reload() {
       ebegin "Reloading samba"
       killall -HUP samba
       eend $?
}
</pre>
<h2> <span class="mw-headline" id="HOWTO:_Restrict_File_Sharing_To_Particular_Users_or_Network_Addresses"> HOWTO: Restrict File Sharing To Particular Users or Network Addresses </span></h2>
<p><a rel="nofollow" class="external free" href="http://www.cyberciti.biz/faq/samba-user-network-file-sharing-restictions/">http://www.cyberciti.biz/faq/samba-user-network-file-sharing-restictions/</a>
</p>
<h2> <span class="mw-headline" id="Shut_Down_A_Windows_PC_Remotely"> Shut Down A Windows PC Remotely </span></h2>
<pre>net rpc SHUTDOWN -C "Test of remote shutdown with Samba" -f -I "192.168.0.61" -W DOMAIN -U username%password

Shutdown of remote machine succeeded
</pre>
<h2> <span class="mw-headline" id="ERROR:_read_data:_Accessing_Share_From_Windows_7"> ERROR: read_data: Accessing Share From Windows 7 </span></h2>
<p>Windows PC cannot access Samba Share. This is from Samba log file (/var/log/samba/log.mypc)...
</p>
<pre> [2012/06/08 12:03:21, 0] lib/util_sock.c:read_data(534)
 read_data: read failure for 4 bytes to client 192.168.0.55. Error = Connection reset by peer
</pre>
<p>Fix #1:
</p>
<pre>Control Panel &gt; System and Security &gt; Administrative Tools &gt; Local Security Policy
Local Policies &gt; Security Options &gt; Network Security
LAN Manager Authentication Level &gt; Send LM &amp; NTML Responses
<b>Uncheck</b> Require 128-bit Encryption on Clients
<b>Uncheck</b> Require 128-bit Encryption on Servers
Save and Reboot
</pre>
<p>Fix #2:
</p>
<pre>Control Panel &gt; Credentials Manager &gt; Browse to Samba Server and check or delete stored usernames and passwords
Save and Reboot
</pre>
<h2> <span class="mw-headline" id="Adding_And_Testing_Users"> Adding And Testing Users </span></h2>
<p>Adding...
</p>
<pre>smbpasswd -a testuser
</pre>
<p>or...
</p>
<pre>pdbedit -a -u testuser
</pre>
<p>Testing...
</p>
<pre>grep 'testuser' /etc/passwd
testuser:*:1001:1001::0:0:Test User:/home/testuser:/usr/sbin/nologin
</pre>
<pre>pdbedit -u testuser
testuser:1001:Test User
</pre>
<pre>pdbedit -v -u testuser
</pre>
<h2> <span class="mw-headline" id="Add_Roaming_Profile_Machine_Trust_Account"> Add Roaming Profile Machine Trust Account </span></h2>
<pre>useradd -c "Company 003 Machine Account" -d /dev/null -g machines -s /bin/false company-003$
smbpasswd -a -n -m company-003
</pre>
<p>You should have entries like the following:
</p>
<pre><b>/etc/passwd:</b> company-010$:x:1016:101:Company-010 Machine Account:/dev/null:/bin/false
<b>/etc/shadow:</b> company-003$:!:15393:0:99999:7:::
<b>/var/lib/samba/private/smbpasswd:</b> company-003$:1035:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:2D6AF5372CEEE519054B3EAA0FC1B9D6:[W          ]:LCT-4F4664C3:
</pre>
<h2> <span class="mw-headline" id="Test_Samba_Share_Via_Command_Line"> Test Samba Share Via Command Line </span></h2>
<pre>server.domain.co.uk ~ $ <b>smbclient -U username //server.domain.co.uk/sharename</b>
Password: 
Domain=[DOAMIN] OS=[Unix] Server=[Samba 3.0.28]
smb: \&gt; ls
smb: \&gt; quit
</pre>
<h2> <span class="mw-headline" id="Tweaks_For_Network_Browsing"> Tweaks For Network Browsing </span></h2>
<pre>smb port = 139
local master = yes
domain master = yes
preferred master = yes
os level = 35
interfaces = 192.168.0.0/24 127.0.0.1
bind interfaces only = yes
</pre>
<h2> <span class="mw-headline" id="Fix_Subnet_Interface_Errors"> Fix Subnet Interface Errors </span></h2>
<p>If you cannot access your samba server, and in the /var/log/samba/log.nmbd you see this error...
</p>
<pre>create_subnets: No local IPv4 non-loopback interfaces
create_subnets: Waiting for an interface to appear
</pre>
<p>...then change your interfaces parameter in /etc/samba/smb.conf to match your actual network interface card. For example...
</p><p>From
</p>
<pre>interfaces = 192.168.0.0/24 127.0.0.1
</pre>
<p>To
</p>
<pre>interfaces = 192.168.0.200/24 127.0.0.1
</pre>
<p>Weird, but it works.&#160;:-/
</p>
<h2> <span class="mw-headline" id="Windows_7:_Domain_Log_On"> Windows 7: Domain Log On </span></h2>
<p>There are currently two registry settings required to be added on the Windows 7 client prior to joining a Samba Domain. These are:
</p>
<pre>        HKLM\System\CCS\Services\LanmanWorkstation\Parameters
            DWORD  DomainCompatibilityMode = 1
            DWORD  DNSNameResolutionRequired = 0
</pre>
<p>Do not edit any other registry parameters (NETLOGON) that have been seen in the wild. If you have already modified your Windows 7 registry, please make sure to reset the keys to their default values.
</p><p>If you have changed the NETLOGON Parameters, make sure and turn them back to '1' as shown below:
</p>
<pre>       HKLM\System\CCS\Services\Netlogon\Parameters
           DWORD  RequireSignOrSeal = 1
           DWORD  RequireStrongKey = 1
</pre>
<h2> <span class="mw-headline" id="Primary_Domain_Controller"> Primary Domain Controller </span></h2>
<p><a rel="nofollow" class="external free" href="http://en.gentoo-wiki.com/wiki/Samba/Primary_Domain_Controller">http://en.gentoo-wiki.com/wiki/Samba/Primary_Domain_Controller</a>
</p>
<!-- 
NewPP limit report
Preprocessor visited node count: 76/1000000
Preprocessor generated node count: 104/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key db371761041-mw_:pcache:idhash:198-0!*!*!!en!*!* and timestamp 20130729183645 -->
</div><div class="printfooter">
Retrieved from "<a href="http://wiki.indie-it.com/index.php?title=Samba&amp;oldid=6449">http://wiki.indie-it.com/index.php?title=Samba&amp;oldid=6449</a>"</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php?title=Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="/index.php?title=Category:Linux" title="Category:Linux">Linux</a></li><li><a href="/index.php?title=Category:Software" title="Category:Software">Software</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/index.php?title=Samba" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/index.php?title=Talk:Samba&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=Samba&amp;action=edit" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="/index.php?title=Samba&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Samba" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="/index.php?title=Main_Page" style="background-image: url(http://wiki.indie-it.com/images/logo.gif);" title="Visit the main page"></a>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search Indie IT - Wiki [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/index.php?title=Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-portal"><a href="/index.php?title=Indie_IT_-_Wiki:Community_portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="/index.php?title=Indie_IT_-_Wiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="/index.php?title=Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/index.php?title=Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/index.php?title=Special:WhatLinksHere/Samba" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/index.php?title=Special:RecentChangesLinked/Samba" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="/index.php?title=Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/index.php?title=Samba&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
				<li id="t-permalink"><a href="/index.php?title=Samba&amp;oldid=6449" title="Permanent link to this revision of the page">Permanent link</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-copyrightico">
		<a href="http://creativecommons.org/licenses/by/3.0/"><img src="http://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a>
	</div>
	<div id="f-poweredbyico">
		<a href="//www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 24 July 2013, at 08:54.</li>
		<li id="viewcount">This page has been accessed 1,094 times.</li>
		<li id="copyright">Content is available under <a class="external" href="http://creativecommons.org/licenses/by/3.0/">Attribution 3.0 Unported</a>.</li>
		<li id="privacy"><a href="/index.php?title=Indie_IT_-_Wiki:Privacy_policy" title="Indie IT - Wiki:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="/index.php?title=Indie_IT_-_Wiki:About" title="Indie IT - Wiki:About">About Indie IT - Wiki</a></li>
		<li id="disclaimer"><a href="/index.php?title=Indie_IT_-_Wiki:General_disclaimer" title="Indie IT - Wiki:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script src="http://wiki.indie-it.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2176260-19");
pageTracker._trackPageview();
</script><!-- Served in 0.276 secs. --></body></html>