<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="ltr" lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" type="text/css" href="http://somewoman.com/wp-content/themes/scrapbook/style.css" media="screen" />
<link rel="stylesheet" type="text/css" href="http://somewoman.com/wp-content/themes/scrapbook/print.css" media="print" />

<!--[if IE]>
<link rel="stylesheet" href="http://somewoman.com/wp-content/themes/scrapbook/ie.css" media="screen" type="text/css" />
<script src="http://somewoman.com/wp-content/themes/scrapbook/library/focus.js" type="text/javascript"></script>
<![endif]-->
<!--[if lte IE 7]>
<link rel="stylesheet" href="http://somewoman.com/wp-content/themes/scrapbook/ie7.css" media="screen" type="text/css" />
<![endif]-->


<link rel="pingback" href="http://somewoman.com/xmlrpc.php" />

	<link rel='archives' title='January 2013' href='http://somewoman.com/?m=201301' />
	<link rel='archives' title='December 2012' href='http://somewoman.com/?m=201212' />
	<link rel='archives' title='November 2012' href='http://somewoman.com/?m=201211' />
	<link rel='archives' title='December 2011' href='http://somewoman.com/?m=201112' />
	<link rel='archives' title='November 2011' href='http://somewoman.com/?m=201111' />
	<link rel='archives' title='October 2011' href='http://somewoman.com/?m=201110' />
	<link rel='archives' title='September 2011' href='http://somewoman.com/?m=201109' />

<title>LDB part 4 : Kelly Yeoh</title>

<link rel="alternate" type="application/rss+xml" title="Kelly Yeoh &raquo; Feed" href="http://somewoman.com/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Kelly Yeoh &raquo; Comments Feed" href="http://somewoman.com/?feed=comments-rss2" />
<link rel='stylesheet' id='custom-thickbox-css'  href='http://somewoman.com/wp-content/themes/scrapbook/custom-thickbox.css?ver=3.2.1' type='text/css' media='screen' />
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/l10n.js?ver=20101110'></script>
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/jquery/jquery.js?ver=1.6.1'></script>
<script type='text/javascript' src='http://somewoman.com/wp-content/themes/scrapbook/library/accordian-menu.js?ver=3.0.2'></script>
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/comment-reply.js?ver=20090102'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://somewoman.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://somewoman.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Kelly Yeoh' href='http://somewoman.com' />
<link rel='start' title='Repurposed' href='http://somewoman.com/?p=3' />
<link rel='prev' title='LDB part 3 (don&#8217;t stop now!!!)' href='http://somewoman.com/?p=261' />
<link rel='next' title='Off topic' href='http://somewoman.com/?p=446' />
<meta name="generator" content="WordPress 3.2.1" />
<link rel='canonical' href='http://somewoman.com/?p=383' />
<style type="text/css" media="screen,print">
#blogtitle {background-image:url(http://somewoman.com/wp-content/uploads/2011/09/logo1.png);}#blogtitle h1,#blogtitle h1 a {color:#776963;}
</style>

<style type="text/css">
body { background-color: #fff; }
</style>

</head>

<body id="top" class="single single-post postid-383 single-format-standard">
<div id="container">

<ul class="jumplinks">
<li><a href="#sidebar">Jump to sidebar</a></li>
<li><a href="#content">Jump to page content</a></li>
<li><a href="#footer">Jump to footer</a></li>
</ul>

<div id="blogtitle">
<h1><a href="http://somewoman.com/"><span>Kelly Yeoh</span></a></h1>
</div>

<!-- start wrapper-top -->
<div id="wrapper-top">
<div id="wrapper-top-left"></div>
<div id="wrapper-top-right"></div>
</div>
<!-- end wrapper-top -->

<div id="wrapper">

<div id="innerwrap">

<div id="content">

<div class="tagline">bit of this, bit of that, voila!!</div>


<div class="post-383 post type-post status-publish format-standard hentry category-uncategorized">

<h2 class="post-title" id="post-383"><a href="http://somewoman.com/?p=383" rel="bookmark" title="Permanent Link: LDB part 4">LDB part 4</a></h2>
<ul class="meta">
<li>November 22, 2012 3:16 pm</li>
<li></li>
</ul>

<h2><strong>LDB Posts</strong></h2>
<ul>
<li><a title="LDB part 1 (of god only knows how many!!!) – Introduction" href="http://somewoman.com/?p=212">LDB part 1 (of god only knows how many!!!) – Introduction</a></li>
<li><a title="LDB part 2 (it just keeps goin') - Tools and things" href="http://somewoman.com/?p=276">LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things</a></li>
<li><a title="LDB part 3" href="http://somewoman.com/?p=261">LDB part 3 (don&#8217;t stop now!!!)</a></li>
<li>LDB part 4</li>
</ul>
<p>Much like part 3, this has also been sitting around for quite some time. I can&#8217;t even remember what it contains, and really don&#8217;t have the energy to review it anymore. If it comes in useful for somebody, my work here is done.</p>
<p>I have many other draft posts in here, although none completed to this level. This may be my last samba related post. I hope it has been if help to someone.</p>
<h2><strong>Partitions</strong></h2>
<p>Partitions within LDB are the equivalent of Naming Contexts within LDAP/Active Directory. These are used to create a separation of data used for different purposes.</p>
<p>When the &#8211;cross-ncs control is used on a query, it allows the query to search data across multiple partitions (where the search would generally default to the SAMBA partition).</p>
<p>Returning back to our earlier example of the rootDSE, we can see various pieces of information in there on Naming Contexts (or partitions):</p>
<blockquote><p><code>kelly@shiny:~/work/samba/prefix.s4$ bin/ldbsearch -H ldap://localhost -s base -b ''<br />
# record 1<br />
dn:<br />
configurationNamingContext: CN=Configuration,DC=samba,DC=somewoman,DC=com<br />
defaultNamingContext: DC=samba,DC=somewoman,DC=com<br />
rootDomainNamingContext: DC=samba,DC=somewoman,DC=com<br />
schemaNamingContext: CN=Schema,CN=Configuration,DC=samba,DC=somewoman,DC=com</p>
<p>namingContexts: DC=samba,DC=somewoman,DC=com<br />
namingContexts: CN=Configuration,DC=samba,DC=somewoman,DC=com<br />
namingContexts: CN=Schema,CN=Configuration,DC=samba,DC=somewoman,DC=com<br />
namingContexts: DC=DomainDnsZones,DC=samba,DC=somewoman,DC=com<br />
namingContexts: DC=ForestDnsZones,DC=samba,DC=somewoman,DC=com</p>
<p></code></p></blockquote>
<p>This displays the partitions for the configuration and schema data, and the default data (the main database containing users, etc), and also the root domain (which, in this case, is the same as the default). Later in the file, all NamingContexts are listed including the ones mentioned above.</p>
<p>An alternative means of displaying partition information is by using the magic @PARTITION records, we can do an ldbsearch seeking partitions on the current database:</p>
<blockquote><p><code>root@shiny:/home/kelly/work/samba/prefix.s4# bin/ldbsearch -H private/sam.ldb -s base -b @PARTITION<br />
# record 1<br />
dn: @PARTITION<br />
replicateEntries: @ATTRIBUTES<br />
replicateEntries: @INDEXLIST<br />
replicateEntries: @OPTIONS<br />
partition: DC=SAMBA,DC=SOMEWOMAN,DC=COM:sam.ldb.d/DC=SAMBA,DC=SOMEWOMAN,DC=COM<br />
.ldb<br />
partition: CN=CONFIGURATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM:sam.ldb.d/CN=CONFIGUR<br />
ATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
partition: CN=SCHEMA,CN=CONFIGURATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM:sam.ldb.d/C<br />
N=SCHEMA,CN=CONFIGURATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
partition: DC=DOMAINDNSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM:sam.ldb.d/DC=DOMAIND<br />
NSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
partition: DC=FORESTDNSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM:sam.ldb.d/DC=FORESTD<br />
NSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
distinguishedName: @PARTITION</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>We can see five partitions listed (which are the same as the NamingContext entries listed within the rootDSE):</p>
<h3>SAMBA</h3>
<p>This contains the &#8220;actual&#8221; data, eg users, etc.</p>
<h3>CONFIGURATION</h3>
<p>This contains the configuration information for Domain Controllers within the domain. This information is replicated to all Samba Domain Controllers.</p>
<h3>SCHEMA</h3>
<p>This partition contains all of the information that the database uses to enforce rules that the data therein must comply with &#8211; the schema. The schema was originally discussed in part 1 of these LDB posts.</p>
<h3>DOMAINDNSZONES</h3>
<p>The information in here would be the same as a zone file that would normally be used within bind (DNS services), encoded within the directory and replicated across all servers.</p>
<h3>FORESTDNSZONES</h3>
<p>Much like the DomainDNSZones, but across the forest.<br />
Each of the partitions actually have their own database located within <code>/private/sam.ldb.d/</code>, as displayed below:</p>
<blockquote><p><code>@:$ ls private/sam.ldb.d/<br />
CN=CONFIGURATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
CN=SCHEMA,CN=CONFIGURATION,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
DC=DOMAINDNSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
DC=FORESTDNSZONES,DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
DC=SAMBA,DC=SOMEWOMAN,DC=COM.ldb<br />
metadata.tdb</code></p></blockquote>
<p>metadata.tdb is used solely to contain the local uSN. This is stored outside of any of the partitions as the number is increased for ALL database updates across any partition. The sequence number used to be held within each partition, then added up to gain the universal sequence number, but this caused too much complexity, so it was moved into a simple tdb file on its own outside of the partitions.</p>
<blockquote><p><code>@:$ tdbdump private/sam.ldb.d/metadata.tdb<br />
{<br />
key(7) = "SEQ_NUM"<br />
data(4) = "3730"<br />
}</code></p></blockquote>
<p>The databases within this directory can be edited freely, without schema information controlling behaviors.</p>
<h2><strong>ACLs</strong></h2>
<p>In Part 3 we took a quick look at security within Active Directory, and the concept of tokens and how these use Access Control Lists, or ACLs, to determine who or what has access to perform certain functions on certain objects or directories.</p>
<p>At present, Samba doesn&#8217;t use ACLs to control reads because they have been found to be too resource intensive, so different controls are used where you need to be authenticated to the directory to be able to read anything. ACLs are used for writing.</p>
<p>There are multiple ways of being able to view ACL information for an object within samba. We can use the smb acl tool ******** MORE INFORMATION NEEDED HERE</p>
<p>We can also view the same information within the ntSecurityDescriptor field, which was displayed in Part 1 of this series. We can do this by performing an ldbsearch on the object we wish to see ACLs for</p>
<blockquote><p><code>@:$ bin/ldbsearch -H private/sam.ldb "name=kelly" ntSecurityDescriptor<br />
# record 1<br />
dn: CN=kelly,DC=samba,DC=somewoman,DC=com<br />
nTSecurityDescriptor: O:SYG:SYD:AI(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;DA)(A;;RPWP<br />
CRCCDCLCLORCWOWDSDDTSW;;;SY)(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;AO)(A;;RPLCLORC;<br />
;;PS)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a54-1e2f-1<br />
1d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a56-1e2f-11d0-9819-00aa0040529b;;PS)(O<br />
A;;RPWP;77b5b886-944a-11d1-aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b2-9455-11d1<br />
-aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b3-9455-11d1-aebd-0000f80367c1;;PS)(OA<br />
;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;;RS)(OA;;RP;4c164200-20c0-11d0-a768<br />
-00aa006e0529;;RS)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;;RS)(A;;RC;;;A<br />
U)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;;AU)(OA;;RP;77b5b886-944a-11d1<br />
-aebd-0000f80367c1;;AU)(OA;;RP;e45795b3-9455-11d1-aebd-0000f80367c1;;AU)(OA;;<br />
RP;e48d0154-bcf8-11d1-8702-00c04fb96050;;AU)(OA;;CR;ab721a53-1e2f-11d0-9819-0<br />
0aa0040529b;;WD)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;;RS)(OA;;RPWP;bf<br />
967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58<br />
d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32<br />
-561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;CIID;RP<br />
;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU<br />
)(OA;CIID;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00a<br />
a003049e2;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-4<br />
5bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;bf9<br />
67aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;bc0ac240-79a9-11d0-9020-00c0<br />
4fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;bc0ac240-79a9-11<br />
d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;59ba<br />
2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;<br />
CIID;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa0030<br />
49e2;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9<br />
b07-ad6f015e5f28;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba<br />
-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f<br />
608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-2cc7-11d2-85<br />
4e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-<br />
2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;<br />
RPLCLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RPLCLORC;;bf967a9c<br />
-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RPLCLORC;;bf967aba-0de6-11d0-a285-00<br />
aa003049e2;RU)(OA;CIID;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;CII<br />
D;RPWPCRCCDCLCLORCWOWDSDDTSW;;;EA)(A;CIID;LC;;;RU)(A;CIID;RPWPCRCCLCLORCWOWDS<br />
DSW;;;BA)S:AI(OU;CIIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6<br />
-11d0-a285-00aa003049e2;WD)(OU;CIIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1<br />
;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)</code></p></blockquote>
<p>We can use the &#8211;show-binary control to present the ntSecurityDescriptor field in a readable format:<br />
<code>@:$ bin/ldbsearch -H private/sam.ldb "name=kelly" ntSecurityDescriptor --show-binary</code></p>
<p><a href="http://somewoman.com/wp-content/uploads/2012/02/acl_ntsecuritydescriptor.jpg"><img class="aligncenter size-full wp-image-403" title="ntSecurityDescriptor" src="http://somewoman.com/wp-content/uploads/2012/02/acl_ntsecuritydescriptor.jpg" alt="" width="480" height="1007" /></a>Displayed is just a small fraction of what the ntSecurityDescriptor contains.</p>
<p>Within Windows, ACLs are edited within the Security tab of the Properties dialog for any object, and alternatively via an ACL editor.</p>
<p><a href="http://somewoman.com/wp-content/uploads/2012/02/acl_windows.jpg"><img class="aligncenter size-full wp-image-406" title="ACLs in windows" src="http://somewoman.com/wp-content/uploads/2012/02/acl_windows.jpg" alt="" width="367" height="957" /></a></p>
<h2><strong>Using dbcheck</strong></h2>
<p>dbcheck is used to test for consistency and errors within the samba database, and it is a part of samba-tool</p>
<p>***insert link to samba-tool info on wiki or some such!!!</p>
<p>As with any components of samba-tool, we call dbcheck by adding the parameter to the command:<br />
<code>@:$ bin/samba-tool dbcheck</code></p>
<p>Also, as with any component of samba-tool, we can see usage and general help information by adding &#8211;help to the end of this line:</p>
<blockquote><p><code>@:$ bin/samba-tool dbcheck --help<br />
Usage: samba-tool dbcheck [] [options]</code></p>
<p><code>check local AD database for errors</code></p>
<p><code>Options:<br />
-h, --help show this help message and exit<br />
--scope=SCOPE Pass search scope that builds DN list. Options: SUB,<br />
ONE, BASE<br />
--fix Fix any errors found<br />
--yes don't confirm changes, just do them all as a single<br />
transaction<br />
--cross-ncs cross naming context boundaries<br />
-v, --verbose Print more details of checking<br />
--quiet don't print details of checking<br />
--attrs=ATTRS list of attributes to check (space separated)<br />
--reindex force database re-index<br />
-H URL, --URL=URL LDB URL for database or target server (defaults to<br />
local SAM database)</code></p>
<p><code>Samba Common Options:<br />
-s FILE, --configfile=FILE<br />
Configuration file<br />
-d DEBUGLEVEL, --debuglevel=DEBUGLEVEL<br />
debug level<br />
--option=OPTION set smb.conf option from command line<br />
--realm=REALM set the realm name</code></p>
<p><code>Credentials Options:<br />
--simple-bind-dn=DN<br />
DN to use for a simple bind<br />
--password=PASSWORD<br />
Password<br />
-U USERNAME, --username=USERNAME<br />
Username<br />
-W WORKGROUP, --workgroup=WORKGROUP<br />
Workgroup<br />
-N, --no-pass Don't ask for a password<br />
-k KERBEROS, --kerberos=KERBEROS<br />
Use Kerberos<br />
--ipaddress=IPADDRESS<br />
IP address of server</code></p>
<p><code>Version Options:<br />
--version Display version number</code></p></blockquote>
<p>In order to demonstrate how dbcheck can be used to fix a database, we must first break it. In the earlier section on partitions, it was mentioned that a database partition can be edited directly from the <code>/private/sam.ldb.d/</code> directory without worry for schema constraints. We also know from earlier posts that two-way links cannot have the back link edited or removed, and that making changes to a forward link will automatically effect the corresponding change within the back link. Using a user as an example, the memberof attribute (linking that user to a group) is the back link component of the group&#8217;s member attribute. So, to break the database, I will remove the back link directly within the partition database:</p>
<p>Before the edit:</p>
<blockquote><p><code>@:$ bin/ldbsearch -H private/sam.ldb.d/DC\=SAMBA\,DC\=SOMEWOMAN\,DC\=COM.ldb 'name=newuser' name memberof<br />
# record 1<br />
dn: CN=newuser,DC=samba,DC=somewoman,DC=com<br />
name: newuser<br />
memberOf: ;;CN=Administrators,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
memberOf: ;;CN=Users,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
memberOf: ;;CN=Guests,CN=Builtin,DC=samba,DC=somewoman,DC=com</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>Performing the edit:</p>
<blockquote><p><code>@:$ bin/ldbmodify -H private/sam.ldb.d/DC\=SAMBA\,DC\=SOMEWOMAN\,DC\=COM.ldb modifynewuser.ldif<br />
# 0 adds 1 modifies 0 deletes</code></p></blockquote>
<p>where modifynewuser.ldif contains:</p>
<blockquote><p><code>dn: CN=newuser,DC=samba,DC=somewoman,DC=com<br />
changetype: modify<br />
delete: memberof<br />
memberOf: ;;CN=Gu<br />
ests,CN=Builtin,DC=samba,DC=somewoman,DC=com</code></p></blockquote>
<p>After the edit:</p>
<blockquote><p><code>@:$ bin/ldbsearch -H private/sam.ldb.d/DC\=SAMBA\,DC\=SOMEWOMAN\,DC\=COM.ldb 'name=newuser' name memberof<br />
# record 1<br />
dn: CN=newuser,DC=samba,DC=somewoman,DC=com<br />
name: newuser<br />
memberOf: ;;CN=Administrators,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
memberOf: ;;CN=Users,CN=Builtin,DC=samba,DC=somewoman,DC=com</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>Using dbcheck:</p>
<blockquote><p><code>@:$ bin/samba-tool dbcheck<br />
Checking 210 objects<br />
ERROR: missing backlink attribute 'memberOf' in CN=newuser,DC=samba,DC=somewoman,DC=com for link member in CN=Guests,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
Not fixing missing backlink memberOf<br />
Please use --fix to fix these errors<br />
Checked 210 objects (1 errors)</code></p></blockquote>
<p>We can see that it has picked up the existence of an error, and it displays where this error is and what the problem is. We can then use the &#8211;fix control to allow dbcheck to correct it</p>
<blockquote><p><code>@:$ bin/samba-tool dbcheck --fix<br />
Checking 210 objects<br />
ERROR: missing backlink attribute 'memberOf' in CN=newuser,DC=samba,DC=somewoman,DC=com for link member in CN=Guests,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
Fix missing backlink memberOf [y/N/all/none] y<br />
Fixed missing backlink memberOf<br />
Checked 210 objects (1 errors)</code></p></blockquote>
<p>And taking a look at the original query again, we can see that the backlink has been returned, and all is right with the world:</p>
<blockquote><p><code>@:$ bin/ldbsearch -H private/sam.ldb.d/DC\=SAMBA\,DC\=SOMEWOMAN\,DC\=COM.ldb 'name=newuser' name memberof<br />
# record 1<br />
dn: CN=newuser,DC=samba,DC=somewoman,DC=com<br />
name: newuser<br />
memberOf: ;;CN=Administrators,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
memberOf: ;;CN=Users,CN=Builtin,DC=samba,DC=somewoman,DC=com<br />
memberOf: ;;CN=Guests,CN=Builtin,DC=samba,DC=somewoman,DC=com</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<h2><strong>Linked Attributes (continued &#8211; one-way links)</strong></h2>
<p>Microsoft have provided the Samba project with full schema documentation for Active Directory, and we can use this to view attribute information, including whether an attribute is linked or not. These schema files exist within/source4/setup/ad-schema</p>
<p>Using/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Attributes.txt as an example, we can find linked attributes quite easily by searching for attributes that contain the property attributeSyntax: 2.5.5.1 (this is a linked attribute). Two-way linked attributes also contain a property called linkID which has an even value for a forward link and an odd value for a back link. One-way links do not have the linkID, but DO contain attributeSyntax: 2.5.5.1</p>
<p>Some examples of one-way linked objects are:</p>
<ul>
<li>Certificate-Authority-Object</li>
<li>Current-Parent-CA</li>
<li>Default-Class-Store</li>
<li>Default-Group</li>
<li>Default-Local-Policy-Object</li>
<li>Default-Object-Category</li>
<li>DN-Reference-Update</li>
<li>documentAuthor</li>
<li>Domain-Certificate-Authorities</li>
<li>FSMO-Role-Owner</li>
</ul>
<p>There are a few more.</p>
<p>As mentioned within Part 3, Samba builds a list of linked attributes at startup, and it is very fast to discover whether any given link is one or two-way. When performing a function on a one-way link, we need to first check it to ensure that the link hasn&#8217;t been broken due to renaming or deletion of the linked object. Within the modules directory is the file /source4/dsdb/samdb/ldb_modules/extended_dn_out.c, which contains a function fix_one_way_link(). This checks one-way links to see if the link has become broken (ie, the linked object may have been renamed or deleted or such), and locates where the link is meant to be pointing to based on GUID information, then repairs the database.</p>


<ul class="meta postfoot">
<li>Filed under <ul><li><a href="http://somewoman.com/?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a></li></ul></li>




<li class="comments-feed icon inline"><a href="http://somewoman.com/?feed=rss2&amp;p=383">Comments feed</a></li>

</ul>

</div>



								

</div>
<!-- end content -->

<div class="sidebar accordian" id="scrapbook-main">

<h2 id="navbar">Navigation Menu</h2>

<div id="archives-3" class="widget-container widget_archive"><h3 class="widgettitle">Archives</h3>		<ul>
			<li><a href='http://somewoman.com/?m=201301' title='January 2013'>January 2013</a></li>
	<li><a href='http://somewoman.com/?m=201212' title='December 2012'>December 2012</a></li>
	<li><a href='http://somewoman.com/?m=201211' title='November 2012'>November 2012</a></li>
	<li><a href='http://somewoman.com/?m=201112' title='December 2011'>December 2011</a></li>
	<li><a href='http://somewoman.com/?m=201111' title='November 2011'>November 2011</a></li>
	<li><a href='http://somewoman.com/?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='http://somewoman.com/?m=201109' title='September 2011'>September 2011</a></li>
		</ul>
</div><div id="categories-3" class="widget-container widget_categories"><h3 class="widgettitle">Categories</h3><select name='cat' id='cat' class='postform' >
	<option value='-1'>Select Category</option>
	<option class="level-0" value="8">#killme&nbsp;&nbsp;(8)</option>
	<option class="level-0" value="11">Adelaide&nbsp;&nbsp;(7)</option>
	<option class="level-0" value="6">Alyssa&nbsp;&nbsp;(9)</option>
	<option class="level-0" value="9">cookin&#8217; baby!!&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="15">Debian&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="16">LDB&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="19">lenovo&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="7">Life in general&nbsp;&nbsp;(12)</option>
	<option class="level-0" value="13">Linux&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="4">Miscellaneous&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="20">personal&nbsp;&nbsp;(7)</option>
	<option class="level-0" value="5">Samba&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="14">Ubuntu&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="1">Uncategorized&nbsp;&nbsp;(10)</option>
	<option class="level-0" value="17">Virtual Machines&nbsp;&nbsp;(1)</option>
</select>

<script type='text/javascript'>
/* <![CDATA[ */
	var dropdown = document.getElementById("cat");
	function onCatChange() {
		if ( dropdown.options[dropdown.selectedIndex].value > 0 ) {
			location.href = "http://somewoman.com/?cat="+dropdown.options[dropdown.selectedIndex].value;
		}
	}
	dropdown.onchange = onCatChange;
/* ]]> */
</script>

</div><div id="search-3" class="widget-container widget_search"><form method="get" id="searchform" action="http://somewoman.com/">
<div>
<label for="s">Keyword(s): </label><input class="text" type="text" value=" " name="s" id="s" />
<input type="submit" class="submit" name="submit" value="Search" />
</div>
</form>
</div>
<h3 class="home"><a href="http://somewoman.com/">Home</a></h3>
<div id="linkcat-2" class="widget-container widget_links"><h3 class="widgettitle">Blogroll</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://alyssa.yeoh.info" rel="me" title="My beautiful little person" target="_blank">Alyssa Pei Ping Yeoh</a></li>
<li><a href="http://kattekrab.net/" title="Someone who I admire above and beyond almost all others &#8211; one of the most awesome gals on the planet!" target="_blank">Donna Benjamin</a></li>
<li><a href="http://house.yeoh.info" rel="me" title="The house that I no longer live in" target="_blank">House</a></li>
<li><a href="http://samba.org" rel="co-worker" title="The official web page for Samba software" target="_blank">Samba</a></li>

	</ul>
</div>

<div id="meta-3" class="widget-container widget_meta"><h3 class="widgettitle">Meta</h3>			<ul>
						<li><a href="http://somewoman.com/wp-login.php">Log in</a></li>
			<li><a href="http://somewoman.com/?feed=rss2" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://somewoman.com/?feed=comments-rss2" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>
						</ul>
</div>
<a class="rss" href="http://somewoman.com/?feed=rss2" title="Subscribe to my RSS news feed"><img src="http://somewoman.com/wp-content/themes/scrapbook/images/rss.gif" width="24" height="24" alt="RSS" /></a>

</div>

</div>
<span class="clear"></span>
<!-- end innerwrap -->

</div>
<!-- end wrapper -->

<!-- start footer -->
<div id="footer">
<div id="footer-left"></div>
<div id="footer-right"></div>

<a class="top" href="#top" title="Go to top of page"><img src="http://somewoman.com/wp-content/themes/scrapbook/images/up.gif" width="16" height="16" alt="Go to top of page" /></a><br />

&copy; 2013 Kelly Yeoh<br />


Powered by the <a href="http://quirm.net/scrapbook">Scrapbook Theme </a>


<script type="text/javascript">tb_pathToImage = "http://somewoman.com/wp-includes/js/thickbox/loadingAnimation.gif";tb_closeImage = "http://somewoman.com/wp-includes/js/thickbox/tb-close.png";</script>
</div>
<!-- end footer -->


</div>
<!-- end container -->

</body>
</html>