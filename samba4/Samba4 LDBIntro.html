<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.5-2squeeze5" />
		<meta name="keywords" content="Samba4/LDBIntro" />
		<link rel="shortcut icon" href="https://www.samba.org/samba/style/2010/grey/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="SambaWiki (en)" />
		<link title="Creative Commons" type="application/rdf+xml" href="/index.php?title=Samba4/LDBIntro&amp;action=creativecommons" rel="meta" />
		<link rel="copyright" href="/index.php/License" />
		<link rel="alternate" type="application/rss+xml" title="SambaWiki RSS feed" href="/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="SambaWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Samba4/LDBIntro - SambaWiki</title>
		<link rel="stylesheet" href="https://wikistatic.samba.org/skins/common/shared.css?207" type="text/css" media="screen" />
		<link rel="stylesheet" href="https://wikistatic.samba.org/skins/common/commonPrint.css?207" type="text/css" media="print" />
		<link rel="stylesheet" href="https://wikistatic.samba.org/skins/monobook/main.css?207" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="https://wikistatic.samba.org/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="https://wikistatic.samba.org/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="https://wikistatic.samba.org/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="https://wikistatic.samba.org/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="https://wikistatic.samba.org/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "https://wikistatic.samba.org/skins";
		var wgArticlePath = "/index.php/$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "https://wiki.samba.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Samba4/LDBIntro";
		var wgTitle = "Samba4/LDBIntro";
		var wgAction = "view";
		var wgArticleId = "1812";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 6314;
		var wgVersion = "1.15.5-2squeeze5";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="https://wikistatic.samba.org/skins/common/wikibits.js?207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="https://wikistatic.samba.org/skins/common/ajax.js?207"></script>
		<script type="text/javascript" src="/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Samba4_LDBIntro skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Samba4/LDBIntro</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From SambaWiki</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#LDB"><span class="tocnumber">1</span> <span class="toctext">LDB</span></a>
<ul>
<li class="toclevel-2"><a href="#Introduction"><span class="tocnumber">1.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2"><a href="#What_is_LDAP.3F"><span class="tocnumber">1.2</span> <span class="toctext">What is LDAP?</span></a></li>
<li class="toclevel-2"><a href="#Active_Directory"><span class="tocnumber">1.3</span> <span class="toctext">Active Directory</span></a></li>
<li class="toclevel-2"><a href="#TDB"><span class="tocnumber">1.4</span> <span class="toctext">TDB</span></a></li>
<li class="toclevel-2"><a href="#How_LDB_uses_TDB"><span class="tocnumber">1.5</span> <span class="toctext">How LDB uses TDB</span></a></li>
<li class="toclevel-2"><a href="#LDB_Modules"><span class="tocnumber">1.6</span> <span class="toctext">LDB Modules</span></a></li>
<li class="toclevel-2"><a href="#More_on_Schemas"><span class="tocnumber">1.7</span> <span class="toctext">More on Schemas</span></a>
<ul>
<li class="toclevel-3"><a href="#Schema-less"><span class="tocnumber">1.7.1</span> <span class="toctext">Schema-less</span></a></li>
<li class="toclevel-3"><a href="#Schema_controlled"><span class="tocnumber">1.7.2</span> <span class="toctext">Schema controlled</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#LDB_Tools"><span class="tocnumber">1.8</span> <span class="toctext">LDB Tools</span></a>
<ul>
<li class="toclevel-3"><a href="#Common_input_.28utilised_by_some_or_all_of_the_tools.29:"><span class="tocnumber">1.8.1</span> <span class="toctext">Common input (utilised by some or all of the tools):</span></a></li>
<li class="toclevel-3"><a href="#ldbsearch"><span class="tocnumber">1.8.2</span> <span class="toctext">ldbsearch</span></a></li>
<li class="toclevel-3"><a href="#ldbmodify"><span class="tocnumber">1.8.3</span> <span class="toctext">ldbmodify</span></a></li>
<li class="toclevel-3"><a href="#ldbedit"><span class="tocnumber">1.8.4</span> <span class="toctext">ldbedit</span></a></li>
<li class="toclevel-3"><a href="#ldbadd"><span class="tocnumber">1.8.5</span> <span class="toctext">ldbadd</span></a></li>
<li class="toclevel-3"><a href="#ldbdel"><span class="tocnumber">1.8.6</span> <span class="toctext">ldbdel</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Hidden_Attributes"><span class="tocnumber">1.9</span> <span class="toctext">Hidden Attributes</span></a></li>
<li class="toclevel-2"><a href="#How_LDB_Indexing_works"><span class="tocnumber">1.10</span> <span class="toctext">How LDB Indexing works</span></a></li>
<li class="toclevel-2"><a href="#rootDSE"><span class="tocnumber">1.11</span> <span class="toctext">rootDSE</span></a></li>
<li class="toclevel-2"><a href="#Other"><span class="tocnumber">1.12</span> <span class="toctext">Other</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="LDB" id="LDB"></a><h1> <span class="mw-headline"> LDB </span></h1>
<a name="Introduction" id="Introduction"></a><h2> <span class="mw-headline"> Introduction </span></h2>
<p>LDB is the database engine used within Samba. It is a light-weight, LDAP-*like* database, but not completely LDAP compliant.
</p><p><br />
Raw LDB is not even close to LDAP compliant, we use modules to ensure compliance. We aim for LDAP compliance where possible, although Samba’s higher priority is Active Directory compliance. We do aim for LDAP compliance where it doesn’t conflict.
</p><p><br />
LDB is transactional (allowing multiple changes to be made to ensure that changes all are applied as expected prior to committing them to the database, if an error occurs all changes are backed out and the database is left “untouched”) and modular (allowing different information or functionality to be added or removed according to how a database is needed to perform).
</p><p><br />
The main LDB website is located at <a href="http://ldb.samba.org" class="external free" title="http://ldb.samba.org" rel="nofollow">http://ldb.samba.org</a>
</p><p><br />
All of the examples listed below will be using the ldb databases created by the self test suite included with Samba. These databases are located at {samba_build_directory}/st/dc/private/
</p><p><br />
</p>
<a name="What_is_LDAP.3F" id="What_is_LDAP.3F"></a><h2> <span class="mw-headline"> What is LDAP? </span></h2>
<p>Lightweight Directory Access Protocol is the dominant database used by organisations around the world to manage their, well, organisation – eg all of their directory services (things such as person information, IT information (machine details, print services, etc), all information pertaining to the business that would need to be “directoried”). Many large companies use LDAP within their server and business tools, eg IBM, Oracle, HP, Novell to name but a few.
</p><p><br />
LDAP is an incredibly complex protocol, and there are many books and RFCs available to read about it. The RFC probably most of note is this one: RFC4511 – Lightweight Directory Access Protocol (LDAP): The Protocol
</p><p><br />
Since this post aims to address LDB, I’ll go further into LDAP and how we use it at a later date. For now, some basic LDAP information (and some nice links) are available here: <a href="http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" class="external free" title="http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" rel="nofollow">http://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol</a>
</p><p><br />
</p>
<a name="Active_Directory" id="Active_Directory"></a><h2> <span class="mw-headline"> Active Directory </span></h2>
<p>Active Directory is a Microsoft product, based around LDAP, but uses other pieces to make up the whole such as Kerberosv5, DNS, MS-RPC, SMB (CIFS). Other protocols are used within Active Directory, but these form the major components.
</p><p><br />
These components are used as follows:
</p><p><b>LDAP</b> database
</p><p><b>kerberos</b> authentication system
</p><p><b>dns</b> machine names – not as trivial as may be expected, this forms a fairly large part of AD and will probably warrant its own post in the near future. If you want this, and I forget, ping me!! Really&nbsp;:)
</p><p><b>MS-RPC</b> remote procedure calls, if you can’t do **something** over LDAP you can generally use MS-RPC. With MS-RPC, you create a protocol specification using IDL files, compiled using IDL compilers, which creates a remote protocol procedure for RPC calls. This also warrants its own post to demonstrate why, how, where, etc. Soon!
</p><p><b>SMB/CIFS</b> for file sharing
</p><p><br />
</p><p>There are several sources of information available on Active Directory. Microsoft has many useful documents available here:
<a href="http://msdn.microsoft.com/en-us/library/gg258393%28v=PROT.13%29.aspx" class="external free" title="http://msdn.microsoft.com/en-us/library/gg258393%28v=PROT.13%29.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/gg258393%28v=PROT.13%29.aspx</a>
</p><p><br />
And probably the one of most use, particularly within the Samba team, is the Active Directory Technical Specification. For example, this document gives valuable information about the database schema which is useful for ensuring compatibility with data sources within Samba (see section 3.1.1.3.1.1 Schema, page 123 of 521, using version 30.0 of the document, released 23rd September 2011)
<a href="http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx" class="external free" title="http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx</a>
</p><p><br /> 
</p>
<a name="TDB" id="TDB"></a><h2> <span class="mw-headline"> TDB </span></h2>
<p>TDB is the Trivial DataBase. This is a very simple key/value pair database (where each record has a key and some data associated with that key). TDB stores data in binary format, and supports transactions.
</p><p><br />
The main TDB website is located at <a href="http://tdb.samba.org" class="external free" title="http://tdb.samba.org" rel="nofollow">http://tdb.samba.org</a>
</p><p>Some basic operations
</p><p><i><b>tdb_open</b></i> Opens a database
</p><p><i><b>tdb_close</b></i> Closes a database
</p><p><i><b>tdb_delete</b></i> Deletes a record with a given key
</p><p><i><b>tdb_exists</b></i> Checks for existence of a record with a given key
</p><p><i><b>tdb_fetch</b></i> Retrieves a record with a given key
</p><p><i><b>tdb_store</b></i> Allows insertion, modification or replacement of a record
</p><p><br />
TDB also has other functionality such as enumerating all records by asking for a list of all keys, start a transaction, do any number of operations and then cancel or commit transaction, etc.
</p><p><br />
Some typical tdb data might look as follows (taken from the samba secrets.ldb database used with the self test suite). This clearly displays the key and value pair of each record, with each record delimited by curly braces (in a dump format):
</p><p><br />
</p>
<pre>   username@computername:~/Samba/samba-master$ tdbdump st/dc/private/secrets.ldb
   {
   key(12) = "DN=@MODULES\00"
   data(45) = "g\19\01&amp;\01\00\00\00@MODULES\00@LIST\00\01\00\00\00\0D\00\00\00samba_secrets\00"
   }
   {
   key(43) = "DN=FLATNAME=SAMBADOMAIN,CN=PRIMARY DOMAINS\00"
   data(702) = "g\19\01&amp;\11\00\00\00flatname=SAMBADOMAIN,cn=Primary Domains\00msDS-KeyVersionNumber\00\01\00\00\00\01\00\00\001\00objectClass\00\03\00\00\00\03\00\00\00top\00\0D\00\00\00primaryDomain\00\0E\00\00\00kerberosSecret\00objectSid\00\01\00\00\00\18\00\00\00\01\04\00\00\00\00\00\05\15\00\00\00\013\BE\F5\DB\E8\C33\B4\9C\1E\ED\00privateKeytab\00\01\00\00\00\0E\00\00\00secrets.keytab\00realm\00\01\00\00\00\11\00\00\00SAMBA.EXAMPLE.COM\00saltPrincipal\00\01\00\00\000\00\00\00host/localdc.samba.example.com@SAMBA.EXAMPLE.COM\00samAccountName\00\01\00\00\00\08\00\00\00LOCALDC$\00secret\00\01\00\00\00\11\00\00\00machinelocDCpass1\00secureChannelType\00\01\00\00\00\01\00\00\006\00servicePrincipalName\00\02\00\00\00\0C\00\00\00HOST/localdc\00\1E\00\00\00HOST/localdc.samba.example.com\00objectGUID\00\01\00\00\00\10\00\00\00H\D9_\D5+\E3\C0G\B7\CF\F6\FB\B1m\EB\1E\00whenCreated\00\01\00\00\00\11\00\00\0020111005000140.0Z\00whenChanged\00\01\00\00\00\11\00\00\0020111005000140.0Z\00uSNCreated\00\01\00\00\00\01\00\00\007\00uSNChanged\00\01\00\00\00\01\00\00\007\00name\00\01\00\00\00\0B\00\00\00SAMBADOMAIN\00flatname\00\01\00\00\00\0B\00\00\00SAMBADOMAIN\00"
   }
   {
   key(31) = "DN=@INDEX:FLATNAME:SAMBADOMAIN\00"
   data(111) = "g\19\01&amp;\02\00\00\00@INDEX:FLATNAME:SAMBADOMAIN\00@IDXVERSION\00\01\00\00\00\01\00\00\002\00@IDX\00\01\00\00\00'\00\00\00flatname=SAMBADOMAIN,cn=Primary Domains\00"
   }
   {
   key(15) = "DN=@ATTRIBUTES\00"
   data(153) = "g\19\01&amp;\04\00\00\00@ATTRIBUTES\00cn\00\01\00\00\00\10\00\00\00CASE_INSENSITIVE\00flatname\00\01\00\00\00\10\00\00\00CASE_INSENSITIVE\00realm\00\01\00\00\00\10\00\00\00CASE_INSENSITIVE\00sAMAccountName\00\01\00\00\00\10\00\00\00CASE_INSENSITIVE\00"
   }
</pre>
<p><br />
Note: this contains only a small section of the data returned from the secrets.ldb database.
</p><p><br />
Within Samba, the key is always the distinguished name (DN) for an object, and the data contains all of the attributes for that object. Every object in LDAP has a distinguished name that distinguishes it from any other (unique, as the name would suggest&nbsp;;) ).
</p><p><br />
</p>
<a name="How_LDB_uses_TDB" id="How_LDB_uses_TDB"></a><h2> <span class="mw-headline"> How LDB uses TDB </span></h2>
<p>LDB basically sits on top of TDB and manipulates the data into an LDAP-like structure. As a very basic example, we can imagine a stack like structure with TDB residing at the base, then LDB modules are stacked on top that describe the functionality or rules required for this database (for example, schema information), and the LDB API sits on top taking and servicing requests.
</p><p><br />
So where TDB uses a key/value pair that is quite confusing to look at:
</p><p><br />
</p>
<pre>   {
   key(43) = "DN=FLATNAME=SAMBADOMAIN,CN=PRIMARY DOMAINS\00"
   data(702) = "g\19\01&amp;\11\00\00\00flatname=SAMBADOMAIN,cn=Primary Domains\00msDS-KeyVersionNumber\00\01\00\00\00\01\00\00\001\00objectClass\00\03\00\00\00\03\00\00\00top\00\0D\00\00\00primaryDomain\00\0E\00\00\00kerberosSecret\00objectSid\00\01\00\00\00\18\00\00\00\01\04\00\00\00\00\00\05\15\00\00\00\013\BE\F5\DB\E8\C33\B4\9C\1E\ED\00privateKeytab\00\01\00\00\00\0E\00\00\00secrets.keytab\00realm\00\01\00\00\00\11\00\00\00SAMBA.EXAMPLE.COM\00saltPrincipal\00\01\00\00\000\00\00\00host/localdc.samba.example.com@SAMBA.EXAMPLE.COM\00samAccountName\00\01\00\00\00\08\00\00\00LOCALDC$\00secret\00\01\00\00\00\11\00\00\00machinelocDCpass1\00secureChannelType\00\01\00\00\00\01\00\00\006\00servicePrincipalName\00\02\00\00\00\0C\00\00\00HOST/localdc\00\1E\00\00\00HOST/localdc.samba.example.com\00objectGUID\00\01\00\00\00\10\00\00\00H\D9_\D5+\E3\C0G\B7\CF\F6\FB\B1m\EB\1E\00whenCreated\00\01\00\00\00\11\00\00\0020111005000140.0Z\00whenChanged\00\01\00\00\00\11\00\00\0020111005000140.0Z\00uSNCreated\00\01\00\00\00\01\00\00\007\00uSNChanged\00\01\00\00\00\01\00\00\007\00name\00\01\00\00\00\0B\00\00\00SAMBADOMAIN\00flatname\00\01\00\00\00\0B\00\00\00SAMBADOMAIN\00"
   }
</pre>
<p><br />
LDB would output the same data as follows, in a much more readable fashion:
</p>
<pre>   dn: flatname=SAMBADOMAIN,cn=Primary Domains
   msDS-KeyVersionNumber: 1
   objectClass: top
   objectClass: primaryDomain
   objectClass: kerberosSecret
   objectSid: S-1-5-21-4122882817-868477147-3978206388
   privateKeytab: secrets.keytab
   realm: SAMBA.EXAMPLE.COM
   saltPrincipal: host/localdc.samba.example.com@SAMBA.EXAMPLE.COM
   samAccountName: LOCALDC$
   secret: machinelocDCpass1
   secureChannelType: 6
   servicePrincipalName: HOST/localdc
   servicePrincipalName: HOST/localdc.samba.example.com
   objectGUID: d55fd948-e32b-47c0-b7cf-f6fbb16deb1e
   whenCreated: 20111005000140.0Z
   whenChanged: 20111005000140.0Z
   uSNCreated: 7
   uSNChanged: 7
   name: SAMBADOMAIN
   flatname: SAMBADOMAIN
   distinguishedName: flatname=SAMBADOMAIN,cn=Primary Domains
</pre>
<p><br />
</p>
<a name="LDB_Modules" id="LDB_Modules"></a><h2> <span class="mw-headline"> LDB Modules </span></h2>
<p>Modules can be stacked on top of each other to add rules or functionality. As an example a schema can be added as a module to a database to ensure that the data therein complies with set rules (so a database can be forced to be entirely LDAP compliant, as an example).
</p><p><br />
Another example of a module used with LDB is the password hash module. This sits between the database and the LDB API and ensures that passwords match password policies, and also performs any required encryption/decryption thereof.
</p><p><br /> 
</p>
<a name="More_on_Schemas" id="More_on_Schemas"></a><h2> <span class="mw-headline"> More on Schemas </span></h2>
<p>Raw LDB is schema-less, but it is designed to allow modules to enforce schema and add functionality. To begin with, there are no rules and regulations, and the LDB API allows for fast and easy setup of a database with minimal overheads. Further overheads can be added as required using modules (as mentioned above), and schema support can be added in this way.
</p><p><br />
It is through these schemas that we ensure that our databases are LDAP compliant. In this way, we can use LDB within Samba to allow us to communicate with other LDAP databases, and (what we are really aiming for) Active Directory.
</p><p><br />
</p>
<a name="Schema-less" id="Schema-less"></a><h3> <span class="mw-headline"> Schema-less </span></h3>
<p>an example of a schema-less database used within Samba is the secrets.ldb database. The reason that secrets.ldb doesn’t need a schema is because it is used only internally within Samba, so there is no need for the overhead of a schema. Because there is no schema attached, arbitrary data can be inserted into the database, for example we can modify a record to include a new attribute called “pet” with a value of our choosing, eg “cat”, and this is a perfectly acceptable thing to do. It is also possible that I have a thing for cats&nbsp;;)
</p>
<pre>   # editing 1 records
   # record 1
   
   dn: samAccountName=dns-localdc,CN=Principals
   msDS-KeyVersionNumber: 1
   objectClass: top
   objectClass: secret
   objectClass: kerberosSecret
   privateKeytab: dns.keytab
   realm: SAMBA.EXAMPLE.COM
   sAMAccountName: dns-localdc
   secret: DZCb)wH]7uoDEd:q+ZmoC#P==0YAP(7.Dbz$6RA0l!KLx3sr#0]oV&gt;eij3,=y@StOKNCn?k28ik%McPo&amp;tPLnoyt0koqxm@NFe(aRn;YyD4fIkK4w&gt;K=zBjUkv_LEGUCcoK_:7Q#0UC2CZx0WOV6pHu$aO
   servicePrincipalName: DNS/samba.example.com
   servicePrincipalName: DNS/localdc.samba.example.com
   objectGUID: 2f1d38f3-49b2-4baa-b77c-14c5daebadc0
   whenCreated: 20111005000141.0Z
   uSNCreated: 8
   name: dns-localdc
   pet: cat
   whenChanged: 20111005004406.0Z
   uSNChanged: 9
   distinguishedName: samAccountName=dns-localdc,CN=Principals
</pre>
<p>(note the sneaky inclusion of the new attribute just after the name attribute. Also note the plain text way in which the data has been written, this is called LDIF – LDAP Data Interchange Format. More on this in a later post)
</p><p><br />
</p>
<a name="Schema_controlled" id="Schema_controlled"></a><h3> <span class="mw-headline"> Schema controlled </span></h3>
<p>We can add a schema module to a database to ensure that it follows set rules. A schema would generally include information about what attributes are allowed, and constraints on data type, size, etc. Within Samba, the sam.ldb database is controlled by a schema. Schemas are only needed where the database communicates externally, so a schema provides valuable protection to ensure data compatibility. If we were to make an attempt to include the same pet: cat attribute and value pair within the sam.ldb database, the following error would be returned:
</p>
<pre>   Controllers,DC=samba,DC=example,DC=com - objectclass_attrs: attribute 'pet' on entry 'CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com' was not found in the schema!
</pre>
<p><br />
The schema for the sam.ldb database is compatible with the schema described within the Microsoft Active Directory Technical Specification <a href="http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx" class="external free" title="http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/cc223122%28v=PROT.13%29.aspx</a>
</p><p><br />
The schemas used are available for viewing online via the http accessible copy of Samba code.
</p><p><br />
<a href="http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Attributes.txt" class="external free" title="http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Attributes.txt" rel="nofollow">http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Attributes.txt</a> defines the attributes regardless of objectClass. The classes file determines which attributes are associated with each class
</p><p><br />
<a href="http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Classes.txt" class="external free" title="http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Classes.txt" rel="nofollow">http://samba.org/ftp/unpacked/samba_4_0_test/source4/setup/ad-schema/MS-AD_Schema_2K8_R2_Classes.txt</a> defines the objectClass and what attributes are allowed for a given class
</p><p><br />
</p>
<a name="LDB_Tools" id="LDB_Tools"></a><h2> <span class="mw-headline"> LDB Tools </span></h2>
<p>Each of the LDB tools is named appropriately to be quite self-explanatory in its functionality.
</p><p><br />
</p>
<a name="Common_input_.28utilised_by_some_or_all_of_the_tools.29:" id="Common_input_.28utilised_by_some_or_all_of_the_tools.29:"></a><h3> <span class="mw-headline"> Common input (utilised by some or all of the tools): </span></h3>
<p><b>-H</b> <i>ldburl</i> (the local database or the url to it)
eg -H st/dc/private/secrets.ldb
</p><p>-H ldap://localhost
</p><p>-H ldaps://hostname (ldap with ssl, runs on a different port number)
</p><p>-H ldapi://path/ (unix domain sockets, i means internal (?), unix domain socket is a file that gives a communication path to a process on a unix box. Only within a machine, not over a network)
</p><p><br />
<b>-s</b> <i>[one|sub|base]</i> search scope, can be one level, subtree or base
</p><p><br />
<b>-b</b> <i>basedn</i> the distinguished name at which a search begins
</p><p><br />
<i><b>LDAP-style search expression</b></i>
</p><p>A search expression can be as simple as (for example) seeking an object with a given distinguished name, or can become quite complex. Standard logic operators (and &amp;, or |, not&nbsp;!) are able to be used within search expressions, with an arbitrary length of searches able to be done using each or any of these operators. Additional search parameters can be added by inserting further search strings within braces.
</p><p><br />
Using the &amp; operator
</p><p>(&amp;(search expression 1)(search expression 2)(search expression 3)…(search expression n))
</p><p><br />
Using the | operator
</p><p>(|(search expression 1)(search expression 2)(search expression 3)…(search expression n))
</p><p><br />
Using the&nbsp;! operator
</p><p>(!search expression 1)
</p><p>The&nbsp;! operator takes a single input
</p><p><br />
Using a mixture
</p><p>(&amp;(search expression 1)(search expression 2)(!search expression 3))
</p><p>(|(search expression 1)(&amp;(search expression 2)(search expression 3)))
</p><p><br />
Wildcard searches can also be performed using an * character, eg "samAccountName=kel*". A simple presence test can be performed by checking that an attribute has a value – any value – using a wildcard search: attribute=*
</p><p><br />
<i><b>attributes</b></i>
</p><p>which attributes from the dataset to display, will display all if none selected. These are written to the end of the ldbsearch line with spaces between each attribute name (eg dn name realm objectGUID).
</p><p><br /> 
</p>
<a name="ldbsearch" id="ldbsearch"></a><h3> <span class="mw-headline"> ldbsearch </span></h3>
<p>This searches an LDB database for records that match the given parameters. LDB has a built in query optimiser that will attempt to use any indexed part of the search expression to reduce the reach of the search.
</p><p><br />
Common input parameters
</p><p><b>-h</b> help (displays a list of available options)
</p><p><b>-H</b> <i>ldburl</i> (database to connect to)
</p><p><b>-s</b> <i>[one|base|sub]</i> search scope (one-level, subtree or base)
</p><p><b>-b</b> <i>basedn</i>
</p><p><b>-i</b> read search expressions from stdin
</p><p><i><b>LDAP-style search expression</b></i>
</p><p>(eg, ‘(&amp;(objectclass=kerberossecret)(samaccountname=dns-localdc))’)
</p><p><i><b>Attributes</b></i>
</p><p>which attributes from the dataset to display, will display not quite all if none selected (some are hidden, more on this later). These are written to the end of the ldbsearch line with spaces between each attribute name (eg name realm objectGUID)
</p><p><br />
as an example, an entire search command may look like this:
</p>
<pre>   bin/ldbsearch -H st/dc/private/secrets.ldb '(&amp;(objectclass=kerberossecret)(samaccountname=dns-localdc))' name realm objectGUID
</pre>
<p>which would, in turn, produce the following information:
</p>
<pre>   # record 1
   
   dn: samAccountName=dns-localdc,CN=Principals
   realm: SAMBA.EXAMPLE.COM
   objectGUID: 2f1d38f3-49b2-4baa-b77c-14c5daebadc0
   name: dns-localdc
   
   # returned 1 records
   # 1 entries
   # 0 referrals
</pre>
<p>LDB pretty prints – eg, objectGUID is saved in binary form, but displayed in useful format
</p><p><br />
The following example returns the same database as our earlier tdbdump example. The data is in a much more readable format, and returned as a tree-like structure using LDAP style objects, attributes and values.
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/secrets.ldb
   
   # record 1
   dn: flatname=SAMBADOMAIN,cn=Primary Domains
   msDS-KeyVersionNumber: 1
   objectClass: top
   objectClass: primaryDomain
   objectClass: kerberosSecret
   objectSid: S-1-5-21-4122882817-868477147-3978206388
   privateKeytab: secrets.keytab
   realm: SAMBA.EXAMPLE.COM
   saltPrincipal: host/localdc.samba.example.com@SAMBA.EXAMPLE.COM
   samAccountName: LOCALDC$
   secret: machinelocDCpass1
   secureChannelType: 6
   servicePrincipalName: HOST/localdc
   servicePrincipalName: HOST/localdc.samba.example.com
   objectGUID: d55fd948-e32b-47c0-b7cf-f6fbb16deb1e
   whenCreated: 20111005000140.0Z
   whenChanged: 20111005000140.0Z
   uSNCreated: 7
   uSNChanged: 7
   name: SAMBADOMAIN
   flatname: SAMBADOMAIN
   distinguishedName: flatname=SAMBADOMAIN,cn=Primary Domains
   
   # record 2
   dn: CN=LSA Secrets
   cn: LSA Secrets
   objectClass: top
   objectClass: container
   objectGUID: 09bef02e-5144-4753-b133-59c2d3a445f1
   whenCreated: 20111005000046.0Z
   whenChanged: 20111005000046.0Z
   uSNCreated: 5
   uSNChanged: 5
   name: LSA Secrets
   distinguishedName: CN=LSA Secrets
</pre>
<p><br />
The following examples return records of a specific objectClass – in this case person.
</p><p><br />
This example displays all information returned by default (albeit with some records removed for the sake of space)
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(objectclass=person)'
   # record 1
   dn: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   objectClass: top
   objectClass: person
   objectClass: organizationalPerson
   objectClass: user
   objectClass: computer
   cn: LOCALDC
   instanceType: 4
   whenCreated: 20111005000123.0Z
   uSNCreated: 3600
   name: LOCALDC
   objectGUID: 01cb8349-ff11-49ea-ab9d-6011afb44c95
   userAccountControl: 532480
   badPwdCount: 0
   codePage: 0
   countryCode: 0
   badPasswordTime: 0
   lastLogoff: 0
   lastLogon: 0
   localPolicyFlags: 0
   pwdLastSet: 129622464830000000
   primaryGroupID: 516
   objectSid: S-1-5-21-4122882817-868477147-3978206388-1000
   accountExpires: 9223372036854775807
   logonCount: 0
   sAMAccountName: LOCALDC$
   sAMAccountType: 805306369
   operatingSystem: Samba
   operatingSystemVersion: 4.0.0alpha18-DEVELOPERBUILD
   dNSHostName: localdc.samba.example.com
   objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=
    com
   isCriticalSystemObject: TRUE
   rIDSetReferences: CN=RID Set,CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=exam
   ple,DC=com
   serverReferenceBL: CN=LOCALDC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,C
   N=Configuration,DC=samba,DC=example,DC=com
   msDS-SupportedEncryptionTypes: 31
   servicePrincipalName: HOST/localdc.samba.example.com
   servicePrincipalName: HOST/localdc.samba.example.com/SAMBADOMAIN
   servicePrincipalName: ldap/localdc.samba.example.com/SAMBADOMAIN
   servicePrincipalName: GC/localdc.samba.example.com/samba.example.com
   servicePrincipalName: ldap/localdc.samba.example.com
   servicePrincipalName: HOST/localdc.samba.example.com/samba.example.com
   servicePrincipalName: ldap/localdc.samba.example.com/samba.example.com
   servicePrincipalName: HOST/LOCALDC
   servicePrincipalName: E3514235-4B06-11D1-AB04-00C04FC2DCD2/9735e6ca-672f-44be-
   95ab-21014e97a26a/samba.example.com
   servicePrincipalName: ldap/9735e6ca-672f-44be-95ab-21014e97a26a._msdcs.samba.e
   xample.com
   servicePrincipalName: ldap/LOCALDC
   servicePrincipalName: RestrictedKrbHost/LOCALDC
   servicePrincipalName: RestrictedKrbHost/localdc.samba.example.com
   servicePrincipalName: ldap/localdc.samba.example.com/DomainDnsZones.samba.exam
   ple.com
   servicePrincipalName: ldap/localdc.samba.example.com/ForestDnsZones.samba.exam
   ple.com
   whenChanged: 20111005000213.0Z
   uSNChanged: 3734
   distinguishedName: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   
   # record 2
   dn: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com
   objectClass: top
   objectClass: person
   objectClass: organizationalPerson
   objectClass: user
   objectClass: computer
   cn: LOCALRPCPROXY
   instanceType: 4
   whenCreated: 20111005002050.0Z
   uSNCreated: 6719
   name: LOCALRPCPROXY
   objectGUID: ea7e2e4f-830e-4cf1-9f84-a3a1c604d8aa
   badPwdCount: 0
   codePage: 0
   countryCode: 0
   badPasswordTime: 0
   lastLogoff: 0
   lastLogon: 0
   objectSid: S-1-5-21-4122882817-868477147-3978206388-1221
   accountExpires: 9223372036854775807
   logonCount: 0
   sAMAccountName: LOCALRPCPROXY$
   objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=
    com
   sAMAccountType: 805306369
   isCriticalSystemObject: FALSE
   primaryGroupID: 515
   pwdLastSet: 129622476500000000
   displayName: LOCALRPCPROXY$
   servicePrincipalName: HOST/localrpcproxy.samba.example.com
   servicePrincipalName: HOST/LOCALRPCPROXY
   dNSHostName: localrpcproxy.samba.example.com
   msDS-SupportedEncryptionTypes: 31
   userAccountControl: 16781312
   msDS-AllowedToDelegateTo: cifs/localdc
   whenChanged: 20111005002054.0Z
   uSNChanged: 6732
   distinguishedName: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com
   
   # record 3
   dn: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   objectClass: top
   objectClass: person
   objectClass: organizationalPerson
   objectClass: user
   objectClass: computer
   cn: RODC
   instanceType: 4
   whenCreated: 20111005002342.0Z
   displayName: RODC$
   uSNCreated: 6747
   name: RODC
   objectGUID: 2f32fc2c-04e6-4693-b8bc-d2721d8b6ec1
   badPwdCount: 0
   codePage: 0
   countryCode: 0
   badPasswordTime: 0
   lastLogoff: 0
   lastLogon: 0
   primaryGroupID: 521
   objectSid: S-1-5-21-4122882817-868477147-3978206388-1223
   accountExpires: 9223372036854775807
   logonCount: 0
   sAMAccountName: RODC$
   sAMAccountType: 805306369
   dNSHostName: RODC.samba.example.com
   managedBy: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com
   objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=
   com
   isCriticalSystemObject: TRUE
   msDS-NeverRevealGroup: CN=Denied RODC Password Replication Group,CN=Users,DC=s
   amba,DC=example,DC=com
   msDS-NeverRevealGroup: CN=Administrators,CN=Builtin,DC=samba,DC=example,DC=com
   msDS-NeverRevealGroup: CN=Server Operators,CN=Builtin,DC=samba,DC=example,DC=c
   om
   msDS-NeverRevealGroup: CN=Backup Operators,CN=Builtin,DC=samba,DC=example,DC=c
   om
   msDS-NeverRevealGroup: CN=Account Operators,CN=Builtin,DC=samba,DC=example,DC=
   com
   msDS-RevealOnDemandGroup: CN=Allowed RODC Password Replication Group,CN=Users,
   DC=samba,DC=example,DC=com
   msDS-SupportedEncryptionTypes: 31
   whenChanged: 20111005002343.0Z
   msDS-KrbTgtLink: CN=krbtgt_2438,CN=Users,DC=samba,DC=example,DC=com
   serverReferenceBL: CN=RODC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=C
   onfiguration,DC=samba,DC=example,DC=com
   msDFSR-ComputerReferenceBL: CN=RODC,CN=Topology,CN=Domain System Volume,CN=DFS
   R-GlobalSettings,CN=System,DC=samba,DC=example,DC=com
   servicePrincipalName: HOST/RODC
   servicePrincipalName: HOST/RODC.samba.example.com
   servicePrincipalName: GC/RODC.samba.example.com/samba.example.com
   servicePrincipalName: RestrictedKrbHost/RODC
   servicePrincipalName: RestrictedKrbHost/RODC.samba.example.com
   pwdLastSet: 129622478230000000
   userAccountControl: 83890176
   uSNChanged: 6781
   distinguishedName: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   
   …
   
   # Referral
   ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com
   
   # returned 10 records
   # 9 entries
   # 1 referrals 
</pre>
<p>This example is using the same search expression as above, although requesting only the name and managedBy attributes. Because managedBy is only used within some records, the others will not attempt to display it.
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(objectclass=person)' name managedby
   # record 1
   dn: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   name: LOCALDC
   
   # record 2
   dn: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com
   name: LOCALRPCPROXY
   
   # record 3
   dn: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com
   name: RODC
   managedBy: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com
   
   # record 4
   dn: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com
   name: Administrator
   
   # record 5
   dn: CN=S4MEMBER,CN=Computers,DC=samba,DC=example,DC=com
   name: S4MEMBER
   
   # record 6
   dn: CN=dns-localdc,CN=Users,DC=samba,DC=example,DC=com
   name: dns-localdc
   
   # record 7
   dn: CN=krbtgt_2438,CN=Users,DC=samba,DC=example,DC=com
   name: krbtgt_2438
   
   # record 8
   dn: CN=krbtgt,CN=Users,DC=samba,DC=example,DC=com
   name: krbtgt
   
   # record 9
   dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com
   name: Guest
   
   # Referral
   ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com
   
   # returned 10 records
   # 9 entries
   # 1 referrals 
</pre>
<p><br /> 
</p>
<a name="ldbmodify" id="ldbmodify"></a><h3> <span class="mw-headline"> ldbmodify </span></h3>
<p>Modifies a database according to the contents of an input file of LDIF composition
</p><p><br />
Common input parameters:
</p><p><b>-h</b> help
</p><p><b>-H</b> <i>ldburl</i>
</p><p><i><b>LDIF file</b></i>
</p><p>Example of usage:
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbmodify -H st/dc/private/secrets.ldb LDIFfilename
</pre>
<p>The LDIF files used with ldbmodify are a special form of LDIF that specify what is to be changed, where, how, etc. An example is displayed below:
</p>
<pre>  dn: cn=Ursula Hampster,ou=Alumni Association,ou=People,o=University of Michiga
   n,c=TEST
  changetype: modify
  add: drink
  drink: mango lassi
  -
  add: drink
  drink: lemonade
  -
  delete: pager
  -
  replace: telephonenumber
  telephonenumber: +61 2 6260 6012
  telephonenumber: +61 412 666 929
  -
  delete: telephonenumber
  telephonenumber: +61 2 6260 6012
  -
  delete: telephonenumber
  telephonenumber: +61 412 666 929
  -
  add: telephonenumber
  telephonenumber: +61 412 666 929
</pre>
<p><br /> 
Note: Any line beginning with a space character is a continuation of the line immediately preceeding it. Comments are denoted by # (eg, # I am a comment). There are more example LDIF files used within the samba test suites available in <i>&lt;samba-source-directory&gt;/lib/ldb/tests</i>. The dn attribute determines which record is to be modified.
</p><p><br /> 
</p>
<a name="ldbedit" id="ldbedit"></a><h3> <span class="mw-headline"> ldbedit </span></h3>
<p>Allows editing of record/s within an ldb database. Instead of feeding it a premade LDIF file as per ldbmodify, ldbedit takes a bunch of parameters (including search strings if desired) and generates an LDIF file on the fly that can then be modified using the editor of your choice (given with the -e input). The edited LDIF file then forms the input for the ldbmodify operation.
</p><p><br />
Common input parameters:
</p><p><b>-h</b> help
</p><p><b>-H</b> <i>ldburl</i>
</p><p><b>-s</b> <i>[one|sub|base]</i> search scope
</p><p><b>-b</b> <i>basedn</i>
</p><p><b>-a</b> all
</p><p><b>-e</b> <i>editor of choice</i> (eg, vim, emacs, etc)
</p><p><b>-verbose</b>
</p><p><i><b>LDAP style search expression</b></i>
</p><p><i><b>attributes</b></i>
</p><p>Example of usage:
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbedit -e vim -H st/dc/private/sam.ldb '(samaccountname=guest)'
</pre>
<p>Would generate the following LDIF file, and display it within vim (ready for editing):
</p>
<pre>  # editing 1 records
  # record 1
  dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com
  objectClass: top
  objectClass: person
  objectClass: organizationalPerson
  objectClass: user
  cn: Guest
  description: Built-in account for guest access to the computer/domain
  instanceType: 4
  whenCreated: 20111005000123.0Z
  whenChanged: 20111005000123.0Z
  uSNCreated: 3563
  uSNChanged: 3563
  name: Guest
  objectGUID: c6be74bb-1b6f-411d-aba9-9efbe465136f
  userAccountControl: 66082
  badPwdCount: 0
  codePage: 0
  countryCode: 0
  badPasswordTime: 0
  lastLogoff: 0
  lastLogon: 0
  pwdLastSet: 0
  primaryGroupID: 514
  objectSid: S-1-5-21-4122882817-868477147-3978206388-501
  accountExpires: 9223372036854775807
  logonCount: 0
  sAMAccountName: Guest
  sAMAccountType: 805306368
  objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=co
   m
  isCriticalSystemObject: TRUE
  memberOf: CN=Guests,CN=Builtin,DC=samba,DC=example,DC=com
  distinguishedName: CN=Guest,CN=Users,DC=samba,DC=example,DC=com
</pre>
<p>Once the contents of this file have been changed and saved, the modify takes place. The generated LDIF file has comments denoting how many records are within it, and the beginning of each new record.
</p><p><br /> 
</p>
<a name="ldbadd" id="ldbadd"></a><h3> <span class="mw-headline"> ldbadd </span></h3>
<p>This function takes an LDIF file and uses the contents to insert a new record into the LDB database. The distinguished name must be unique to all others within the database, and the LDIF file must comply with any applicable schema.
</p><p>Common input parameters:
</p><p><b>-h</b> help
</p><p><b>-H</b> <i>ldburl</i>
</p><p><i><b>LDIF file/s</b></i>
</p><p>Example of usage:
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbadd -H st/dc/private/secrets.ldb LDIFfilename
</pre>
<p><br /> 
</p>
<a name="ldbdel" id="ldbdel"></a><h3> <span class="mw-headline"> ldbdel </span></h3>
<p>The function removes records from the database according to the distinguished name. An arbitrary number of records can be removed by way of additional dns on the command line, or use of wildcards.
Common input parameters:
</p><p><b>-h</b> help
</p><p><b>-H</b> <i>ldburl</i>
<b>-r</b> recursive. Can also use --recursive control
</p><p><i><b>dn of record/s to be deleted</b></i>
</p><p>Example of usage:
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbmodify -H st/dc/private/secrets.ldb [dn1] [dn2*] [dn...]
</pre>
<p><br /> 
</p>
<a name="Hidden_Attributes" id="Hidden_Attributes"></a><h2> <span class="mw-headline"> Hidden Attributes </span></h2>
<p>All operational attributes are hidden, but not all hidden attributes are operational. These attributes are not particularly well hidden, they just don’t show up in * search. You need to specify the name to get them.
</p><p>Operation attributes are generated, not static. The data that they hold is generated from other attributes or from system information. They are read-only.
</p><p>There are some non-operational, but hidden attributes which may be read-only, read-write or there are even some that are write-only (for example, changing password).
</p><p>The database schema information contains an attribute called “SystemFlags”, which allows multiple values. If one of the values within this field is ‘FLAG_ATTR_IS_OPERATIONAL’ then this is a hidden or operational attribute.
</p><p>Some hidden attributes are:
</p>
<pre>   replPropertyMetaData
   nTSecurityDescriptor
   msDS-BridgeHeadServersUsed
   msDS-Entry-Time-To-Die
   msDS-USNLastSyncSuccess
</pre>
<p>For example, we can view the ntSecurityDescriptor data for a record as follows:
</p>
<pre>   kelly@fizzgig:~/work/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(&amp;(objectclass=person)(name=Guest))' name ntsecuritydescriptor
   
   # record 1
   dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com
   nTSecurityDescriptor: O:DAG:DAD:AI(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;DA)(A;;RPWP
   CRCCDCLCLORCWOWDSDDTSW;;;SY)(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;AO)(A;;RPLCLORC;
  &nbsp;;;PS)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a54-1e2f-1
   1d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a56-1e2f-11d0-9819-00aa0040529b;;PS)(O
   A;;RPWP;77b5b886-944a-11d1-aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b2-9455-11d1
   -aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b3-9455-11d1-aebd-0000f80367c1;;PS)(OA
  &nbsp;;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;;RS)(OA;;RP;4c164200-20c0-11d0-a768
   -00aa006e0529;;RS)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;;RS)(A;;RC;;;A
   U)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;;AU)(OA;;RP;77b5b886-944a-11d1
   -aebd-0000f80367c1;;AU)(OA;;RP;e45795b3-9455-11d1-aebd-0000f80367c1;;AU)(OA;;
   RP;e48d0154-bcf8-11d1-8702-00c04fb96050;;AU)(OA;;CR;ab721a53-1e2f-11d0-9819-0
   0aa0040529b;;WD)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;;RS)(OA;;RPWP;bf
   967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58
   d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32
   -561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;CIID;RP
  &nbsp;;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU
   )(OA;CIID;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00a
   a003049e2;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-4
   5bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;bf9
   67aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;bc0ac240-79a9-11d0-9020-00c0
   4fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;bc0ac240-79a9-11
   d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;59ba
   2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;
   CIID;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa0030
   49e2;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9
   b07-ad6f015e5f28;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba
   -0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f
   608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-2cc7-11d2-85
   4e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-
   2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;
   RPLCLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RPLCLORC;;bf967a9c
   -0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RPLCLORC;;bf967aba-0de6-11d0-a285-00
   aa003049e2;RU)(OA;CIID;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;CII
   D;RPWPCRCCDCLCLORCWOWDSDDTSW;;;EA)(A;CIID;LC;;;RU)(A;CIID;RPWPCRCCLCLORCWOWDS
   DSW;;;BA)S:AI(OU;CIIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6
   -11d0-a285-00aa003049e2;WD)(OU;CIIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1
  &nbsp;;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)
   name: Guest
   
   # Referral
   ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com
   
   # returned 2 records
   # 1 entries
   # 1 referrals 
</pre>
<p>The ntSecurityDescriptor field is saved in binary format, and we can view it in readable format by using the –show-binary operator on the command line as follows:
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(&amp;(objectclass=person)(name=Guest))' name ntsecuritydescriptor --show-binary
   
   # record 1
   dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com
   nTSecurityDescriptor: NDR: struct security_descriptor
   revision&nbsp;: SECURITY_DESCRIPTOR_REVISION_1 (1)
   type&nbsp;: 0x8c17 (35863)
   1: SEC_DESC_OWNER_DEFAULTED
   1: SEC_DESC_GROUP_DEFAULTED
   1: SEC_DESC_DACL_PRESENT
   0: SEC_DESC_DACL_DEFAULTED
   1: SEC_DESC_SACL_PRESENT
   0: SEC_DESC_SACL_DEFAULTED
   0: SEC_DESC_DACL_TRUSTED
   0: SEC_DESC_SERVER_SECURITY
   0: SEC_DESC_DACL_AUTO_INHERIT_REQ
   0: SEC_DESC_SACL_AUTO_INHERIT_REQ
   1: SEC_DESC_DACL_AUTO_INHERITED
   1: SEC_DESC_SACL_AUTO_INHERITED
   0: SEC_DESC_DACL_PROTECTED
   0: SEC_DESC_SACL_PROTECTED
   0: SEC_DESC_RM_CONTROL_VALID
   1: SEC_DESC_SELF_RELATIVE
   owner_sid&nbsp;: *
   owner_sid&nbsp;: S-1-5-21-4122882817-868477147-3978206388-512
   group_sid&nbsp;: *
   group_sid&nbsp;: S-1-5-21-4122882817-868477147-3978206388-512
   sacl&nbsp;: *
   sacl: struct security_acl
   revision&nbsp;: SECURITY_ACL_REVISION_ADS (4)
   size&nbsp;: 0x0078 (120)
   num_aces&nbsp;: 0x00000002 (2)
   aces: ARRAY(2)
   aces: struct security_ace
   type&nbsp;: SEC_ACE_TYPE_SYSTEM_AUDIT_OBJECT (7)
   flags&nbsp;: 0x52 (82)
   0: SEC_ACE_FLAG_OBJECT_INHERIT
   1: SEC_ACE_FLAG_CONTAINER_INHERIT
   0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT
   0: SEC_ACE_FLAG_INHERIT_ONLY
   1: SEC_ACE_FLAG_INHERITED_ACE
   0x02: SEC_ACE_FLAG_VALID_INHERIT (2)
   1: SEC_ACE_FLAG_SUCCESSFUL_ACCESS
   0: SEC_ACE_FLAG_FAILED_ACCESS
   size&nbsp;: 0x0038 (56)
   access_mask&nbsp;: 0x00000020 (32)
   object&nbsp;: union security_ace_object_ctr(case 7)
   object: struct security_ace_object
   flags&nbsp;: 0x00000003 (3)
   1: SEC_ACE_OBJECT_TYPE_PRESENT
   1: SEC_ACE_INHERITED_OBJECT_TYPE_PRESENT
   type&nbsp;: union security_ace_object_type(case 1)
   type&nbsp;: f30e3bbe-9ff0-11d1-b603-0000f80367c1
   inherited_type&nbsp;: union security_ace_object_inherited_type(case 2)
   inherited_type&nbsp;: bf967aa5-0de6-11d0-a285-00aa003049e2
   trustee&nbsp;: S-1-1-0
   aces: struct security_ace
   type&nbsp;: SEC_ACE_TYPE_SYSTEM_AUDIT_OBJECT (7)
   flags&nbsp;: 0x52 (82)
   0: SEC_ACE_FLAG_OBJECT_INHERIT
   1: SEC_ACE_FLAG_CONTAINER_INHERIT
   0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT
   0: SEC_ACE_FLAG_INHERIT_ONLY
   1: SEC_ACE_FLAG_INHERITED_ACE
   0x02: SEC_ACE_FLAG_VALID_INHERIT (2)
   1: SEC_ACE_FLAG_SUCCESSFUL_ACCESS
   0: SEC_ACE_FLAG_FAILED_ACCESS
   size&nbsp;: 0x0038 (56)
   access_mask&nbsp;: 0x00000020 (32)
   object&nbsp;: union security_ace_object_ctr(case 7)
   object: struct security_ace_object
   flags&nbsp;: 0x00000003 (3)
   1: SEC_ACE_OBJECT_TYPE_PRESENT
   1: SEC_ACE_INHERITED_OBJECT_TYPE_PRESENT
   type&nbsp;: union security_ace_object_type(case 1)
   type&nbsp;: f30e3bbf-9ff0-11d1-b603-0000f80367c1
   inherited_type&nbsp;: union security_ace_object_inherited_type(case 2)
   inherited_type&nbsp;: bf967aa5-0de6-11d0-a285-00aa003049e2
   trustee&nbsp;: S-1-1-0
   dacl&nbsp;: *
   dacl: struct security_acl
   revision&nbsp;: SECURITY_ACL_REVISION_ADS (4)
   size&nbsp;: 0x07d4 (2004)
   num_aces&nbsp;: 0x0000002c (44)
   aces: ARRAY(44)
   aces: struct security_ace
   type&nbsp;: SEC_ACE_TYPE_ACCESS_ALLOWED (0)
   flags&nbsp;: 0x00 (0)
   0: SEC_ACE_FLAG_OBJECT_INHERIT
   0: SEC_ACE_FLAG_CONTAINER_INHERIT
   0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT
   0: SEC_ACE_FLAG_INHERIT_ONLY
   0: SEC_ACE_FLAG_INHERITED_ACE
   0x00: SEC_ACE_FLAG_VALID_INHERIT (0)
   0: SEC_ACE_FLAG_SUCCESSFUL_ACCESS
   0: SEC_ACE_FLAG_FAILED_ACCESS
   size&nbsp;: 0x0024 (36)
   access_mask&nbsp;: 0x000f01ff (983551)
   object&nbsp;: union security_ace_object_ctr(case 0)
   trustee&nbsp;: S-1-5-21-4122882817-868477147-3978206388-512
   aces: struct security_ace
   type&nbsp;: SEC_ACE_TYPE_ACCESS_ALLOWED (0)
   flags&nbsp;: 0x00 (0)
   0: SEC_ACE_FLAG_OBJECT_INHERIT
   0: SEC_ACE_FLAG_CONTAINER_INHERIT
   0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT
   0: SEC_ACE_FLAG_INHERIT_ONLY
   0: SEC_ACE_FLAG_INHERITED_ACE
   0x00: SEC_ACE_FLAG_VALID_INHERIT (0)
   0: SEC_ACE_FLAG_SUCCESSFUL_ACCESS
   0: SEC_ACE_FLAG_FAILED_ACCESS
   size&nbsp;: 0x0014 (20)
   access_mask&nbsp;: 0x000f01ff (983551)
   object&nbsp;: union security_ace_object_ctr(case 0)
   trustee&nbsp;: S-1-5-18
   ##MASSIVE SNIP!!!
   name: Guest
   
   # Referral
   ref: ldap://samba.example.com/CN=Configuration,DC=samba, DC=example,DC=com
   
   # returned 2 records
   # 1 entries
   # 1 referrals 
</pre>
<p>Note the MASSIVE SNIP – this contains a LOT of information, only a very small section is displayed above. We will go into detail on what this data means and how it is used within Samba in a later post.
</p><p><br /> 
</p>
<a name="How_LDB_Indexing_works" id="How_LDB_Indexing_works"></a><h2> <span class="mw-headline"> How LDB Indexing works </span></h2>
<p>Indexing allows for faster searching of the database, and a database can generally be modified to include any relevant field or attribute of importance that may be frequently searched upon. LDB is no different. LDB keeps its indexing information is the @INDEXLIST record. The @INDEXLIST record can have multiple values that can be indexed, and each of these is listed as an @IDXATTR attribute.
</p><p>Indexes can be viewed, modified, inserted or deleted as per other database components. A schema defines which attributes should be indexed. Edit the schema if you wish to edit the index list, or edit the @INDEXLIST if using a schema-less database. A database containing a full schema completely overrides the @INDEXLIST, which then becomes only an approximation of the index listing. The schema provides more detailed indexing instructions, such as how to sort/compare each attribute type.
</p><p>LDB offers two types of indexing: Attribute indexing or one level indexing. Attribute indexing increases speed for a search on a specific value for an attribute. One level indexing improves speed of searching all child objects of a given object. To perform this, we keep an index of every DN within the database and any child DNs thereof.
</p><p>A planned addition to indexing is range indexing, where records within a range of integer values can be requested. This will be added to increase speed of a search used within replication, and will be discussed further when we get into replication.
</p><p>LDB does not currently support prefix indexing, eg searching for “name=kell*”. This was decided as the loss in write performance was not worth the gain in read performance. It may be added in future versions if prefix searches are frequently required.
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/secrets.ldb -s base -b @INDEXLIST
   
   # record 1
   dn: @INDEXLIST
   @IDXATTR: cn
   @IDXATTR: flatname
   @IDXATTR: realm
   distinguishedName: @INDEXLIST
   
   # returned 1 records
   # 1 entries
   # 0 referrals
</pre>
<p><br /> 
</p>
<a name="rootDSE" id="rootDSE"></a><h2> <span class="mw-headline"> rootDSE </span></h2>
<p>The rootDSE provides user accessible metadata about the database. Some parts are pointers into the database, some parts are external references, some parts are information required to gather further information or to gain access to further information.
</p><p><br />
The rootDSE is the only record that can be accessed without authentication.
</p><p><br />
Within the rootDSE there are many numbers that look reasonably like this: 1.2.840.113556.1.4.800 – this is called an OID (or Object IDentifier). OIDs are widely used within many different protocols (not just LDAP), and there is a central authority for assigning OID-space. These OIDs are able to be searched on the internet to locate what they reference, for example a google search on 1.2.840.113556.1.4.800 returns <a href="http://www.oid-info.com/get/1.2.840.113556.1.4.800" class="external free" title="http://www.oid-info.com/get/1.2.840.113556.1.4.800" rel="nofollow">http://www.oid-info.com/get/1.2.840.113556.1.4.800</a>, which states: “If the RootDSE supportedCapabilities attribute contains this OID, it means the LDAP server is an Active Directory server (Win2k and later).”. Many OIDs are visible within the example rootDSE below, and each can be looked up to check for their meaning.
</p>
<pre>   username@computername:~/Samba/samba-master$ bin/ldbsearch -H ldap://localhost -s base -b
   
   # record 1
   
   dn:
   configurationNamingContext: CN=Configuration,DC=samba,DC=example,DC=com
   defaultNamingContext: DC=samba,DC=example,DC=com
   rootDomainNamingContext: DC=samba,DC=example,DC=com
   schemaNamingContext: CN=Schema,CN=Configuration,DC=samba,DC=example,DC=com
   subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=samba,DC=example ,DC=com
   supportedCapabilities: 1.2.840.113556.1.4.800
   supportedCapabilities: 1.2.840.113556.1.4.1670
   supportedCapabilities: 1.2.840.113556.1.4.1791
   supportedCapabilities: 1.2.840.113556.1.4.1935
   supportedCapabilities: 1.2.840.113556.1.4.2080
   supportedLDAPVersion: 2
   supportedLDAPVersion: 3
   vendorName: Samba Team (<a href="http://samba.org" class="external free" title="http://samba.org" rel="nofollow">http://samba.org</a>)
   isSynchronized: TRUE
   dsServiceName: CN=NTDS Settings,CN=COMPUTERNAME,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=samba,DC=example,DC=com
   serverName: CN=COMPUTERNAME,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=samba,DC=example,DC=com
   dNSHostName: computername.samba.example.com
   ldapServiceName: samba.example.com:computername$@SAMBA.EXAMPLE.COM
   currentTime: 20111005012227.0Z
   supportedControl: 1.2.840.113556.1.4.841
   supportedControl: 1.2.840.113556.1.4.319
   supportedControl: 1.2.840.113556.1.4.473
   supportedControl: 1.2.840.113556.1.4.1504
   supportedControl: 1.2.840.113556.1.4.801
   supportedControl: 1.2.840.113556.1.4.801
   supportedControl: 1.2.840.113556.1.4.805
   supportedControl: 1.2.840.113556.1.4.529
   supportedControl: 1.2.840.113556.1.4.417
   supportedControl: 1.2.840.113556.1.4.2064
   supportedControl: 1.2.840.113556.1.4.1413
   supportedControl: 1.2.840.113556.1.4.1413
   supportedControl: 1.2.840.113556.1.4.1413
   supportedControl: 1.2.840.113556.1.4.1339
   supportedControl: 1.2.840.113556.1.4.1340
   supportedControl: 1.2.840.113556.1.4.1413
   supportedControl: 1.2.840.113556.1.4.1341
   namingContexts: DC=samba,DC=example,DC=com
   namingContexts: CN=Configuration,DC=samba,DC=example,DC=com
   namingContexts: CN=Schema,CN=Configuration,DC=samba,DC=example,DC=com
   supportedSASLMechanisms: GSS-SPNEGO
   supportedSASLMechanisms: GSSAPI
   supportedSASLMechanisms: NTLM
   highestCommittedUSN: 3731
   domainFunctionality: 2
   forestFunctionality: 2
   domainControllerFunctionality: 4
   isGlobalCatalogReady: TRUE
   
   # returned 1 records
   # 1 entries
   # 0 referrals
</pre>
<p>An excellent source of what the rootDSE contains is available at <a href="http://www.techgalaxy.net/Docs/Dev/LDAPv3%20RootDSE%20Overview.htm" class="external free" title="http://www.techgalaxy.net/Docs/Dev/LDAPv3%20RootDSE%20Overview.htm" rel="nofollow">http://www.techgalaxy.net/Docs/Dev/LDAPv3%20RootDSE%20Overview.htm</a>
</p><p><br />
Some parts of the rootDSE important to Samba are:
</p><p>The naming contexts are extremely important within ActiveDirectory, these form sub-sections of the database that one would expect to reasonably contain a relevant subset of data. For example, configurationNamingContext points to where all configuration data may be found, defaultNamingContext would locate other subsections such as users, schemaNamingContext would point to the location of the schema information. On that last example, all of the contents of the schema lie within the subtree given by the schemaNamingContext, therefore the database is “introspective” – you need to look within the database for a description of itself. Users can query this subtree of the database to gain information on how the database as a whole should look and behave.
</p><p><br />
<i><b>supportedCapabilities</b></i> uses OIDs to describe what capabilities the server has.
</p><p><br />
<i><b>supportedLDAPVersion</b></i> displays which varieties of LDAP this server supports.
</p><p><br />
<i><b>isSynchronized</b></i> contains TRUE if replicated
</p><p><br />
<i><b>dsServiceName</b></i> is critical in ActiveDirectory. Each server in AD contains an NTDS (New Technology Directory Services) record containing all NTDS settings – information specific to that particular server, and the dsServiceName contains the DN to the object containing these settings. These settings are not contained within the rootDSE due to replication. The rootDSE is not replicated, but the configuration partition is replicated all over the forest, and by keeping these settings within a replicates partition we allow all domain controllers fast access to everyone else’s settings – ie to see capabilities, etc.
</p><p><br />
<i><b>serverName</b></i> points to an object that contains information such as server, DNS settings, netbios settings, etc.
</p><p><br />
<i><b>dNSHostName</b></i> is included within the rootDSE because Kerberos relies upon knowing the hostname to correctly authenticate, so we need access to this information BEFORE we can authenticate, therefore it needs to be located within a record that needs no authentication, thus the rootDSE.
</p><p><br />
<i><b>supportedControl</b></i> uses OIDs to describe what controls are supported by the server. Controls are a way that an LDAP client can ask for different behaviour for a particular operation from a server. There are only a few controls that an AD administrator might want to use, but controls can be very useful for developers. More information on these controls will be included in a later post.
</p><p><br />
<i><b>namingContexts</b></i> is a sub-section or partition of the database. The significance is that a search will, by default, not cross a naming context boundary. A naming context can be a child of another, in a hierarchy. If we do a search that starts at a lower level it will not, by default, cross boundaries to other naming contexts. –cross-ncs option (phantom root option, thus called because it effectively declares the root of the subtree to be at a higher level even though we are searching from lower) allows you to cross these boundaries.
</p><p><br />
<i><b>highestCommittedUSN</b></i> declares how many changes have been made to this database.
</p><p><br />
<i><b>domainFunctionality</b></i> and <i><b>forestFunctionality</b></i> when MS changes the way AD works they add a new functionality level. This tells what functionality level the machine has been upgraded to
</p>
<a name="Other" id="Other"></a><h2> <span class="mw-headline"> Other </span></h2>
<p>During the making of this post, a bug was discovered within ldbedit that would leave a transaction open upon a failed transaction. The following patch was created to address this problem:
</p>
<pre>   commit fc7d7ea4b56db01766491f6ec1a4b6b0c35cd188
   Author: Kelly Yeoh
   Date: Wed Oct 5 11:26:20 2011 +1030
   
   ldb: Fix transaction cancel on failed ldbedit
   When ldbedit fails to modify a record, it needs to cancel the transaction
   to ensure that no transactions are left open on exit.
   
   diff --git a/lib/ldb/tools/ldbedit.c b/lib/ldb/tools/ldbedit.c
   index aaf6d80..cf4ab3f 100644
   --- a/lib/ldb/tools/ldbedit.c
   +++ b/lib/ldb/tools/ldbedit.c
   
   @@ -152,6 +152,7 @@ static int merge_edits(struct ldb_context *ldb,
   if (ret&nbsp;!= -1) {
   modifies += (unsigned int) ret;
   } else {
   + ldb_transaction_cancel(ldb);
   return -1;
   }
   }
</pre>
<!-- 
NewPP limit report
Preprocessor node count: 22/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key samba_wiki:pcache:idhash:1812-0!1!0!!en!2!edit=0 and timestamp 20130729121312 -->
<div class="printfooter">
Retrieved from "<a href="https://wiki.samba.org/index.php/Samba4/LDBIntro">https://wiki.samba.org/index.php/Samba4/LDBIntro</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="/index.php/Samba4/LDBIntro" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="/index.php?title=Talk:Samba4/LDBIntro&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="/index.php?title=Samba4/LDBIntro&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="/index.php?title=Samba4/LDBIntro&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Samba4/LDBIntro" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(https://www.samba.org/samba/style/2010/samba_2010_logo_transparent_151x27.png);" href="/index.php/Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/index.php/Main_Page">Main page</a></li>
				<li id="n-User-documentation"><a href="/index.php/Samba">User documentation</a></li>
				<li id="n-Developer-documentation"><a href="/index.php/Developer_documentation">Developer documentation</a></li>
				<li id="n-portal"><a href="/index.php/SambaWiki:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="/index.php/SambaWiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="/index.php/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/index.php/Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search SambaWiki [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/index.php/Special:WhatLinksHere/Samba4/LDBIntro" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/index.php/Special:RecentChangesLinked/Samba4/LDBIntro" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="/index.php/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/index.php?title=Samba4/LDBIntro&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/index.php?title=Samba4/LDBIntro&amp;oldid=6314" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="https://wikistatic.samba.org/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
				<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/GPL/2.0/"><img src="https://wikistatic.samba.org/cc-GPL-a.png" alt='the CC-GNU GPL v2 or later' /></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 21 November 2011, at 01:48.</li>
					<li id="viewcount">This page has been accessed 3,935 times.</li>
					<li id="copyright">Content is available under <a href="/index.php/License" title="License">the CC-GNU GPL v2 or later</a>.</li>
					<li id="privacy"><a href="/index.php/SambaWiki:Privacy_policy" title="SambaWiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="/index.php/SambaWiki:About" title="SambaWiki:About">About SambaWiki</a></li>
					<li id="disclaimer"><a href="/index.php/SambaWiki:General_disclaimer" title="SambaWiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.045 secs. --></body></html>
