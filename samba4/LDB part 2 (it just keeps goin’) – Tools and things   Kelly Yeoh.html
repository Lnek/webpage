<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="ltr" lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" type="text/css" href="http://somewoman.com/wp-content/themes/scrapbook/style.css" media="screen" />
<link rel="stylesheet" type="text/css" href="http://somewoman.com/wp-content/themes/scrapbook/print.css" media="print" />

<!--[if IE]>
<link rel="stylesheet" href="http://somewoman.com/wp-content/themes/scrapbook/ie.css" media="screen" type="text/css" />
<script src="http://somewoman.com/wp-content/themes/scrapbook/library/focus.js" type="text/javascript"></script>
<![endif]-->
<!--[if lte IE 7]>
<link rel="stylesheet" href="http://somewoman.com/wp-content/themes/scrapbook/ie7.css" media="screen" type="text/css" />
<![endif]-->


<link rel="pingback" href="http://somewoman.com/xmlrpc.php" />

	<link rel='archives' title='January 2013' href='http://somewoman.com/?m=201301' />
	<link rel='archives' title='December 2012' href='http://somewoman.com/?m=201212' />
	<link rel='archives' title='November 2012' href='http://somewoman.com/?m=201211' />
	<link rel='archives' title='December 2011' href='http://somewoman.com/?m=201112' />
	<link rel='archives' title='November 2011' href='http://somewoman.com/?m=201111' />
	<link rel='archives' title='October 2011' href='http://somewoman.com/?m=201110' />
	<link rel='archives' title='September 2011' href='http://somewoman.com/?m=201109' />

<title>LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things : Kelly Yeoh</title>

<link rel="alternate" type="application/rss+xml" title="Kelly Yeoh &raquo; Feed" href="http://somewoman.com/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Kelly Yeoh &raquo; Comments Feed" href="http://somewoman.com/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="Kelly Yeoh &raquo; LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things Comments Feed" href="http://somewoman.com/?feed=rss2&amp;p=276" />
<link rel='stylesheet' id='custom-thickbox-css'  href='http://somewoman.com/wp-content/themes/scrapbook/custom-thickbox.css?ver=3.2.1' type='text/css' media='screen' />
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/l10n.js?ver=20101110'></script>
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/jquery/jquery.js?ver=1.6.1'></script>
<script type='text/javascript' src='http://somewoman.com/wp-content/themes/scrapbook/library/accordian-menu.js?ver=3.0.2'></script>
<script type='text/javascript' src='http://somewoman.com/wp-includes/js/comment-reply.js?ver=20090102'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://somewoman.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://somewoman.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Kelly Yeoh' href='http://somewoman.com' />
<link rel='start' title='Repurposed' href='http://somewoman.com/?p=3' />
<link rel='prev' title='Samba and virtual machines &#8211; part 1. VirtualBox' href='http://somewoman.com/?p=245' />
<link rel='next' title='Oh, doom and disaster!! Almost' href='http://somewoman.com/?p=286' />
<meta name="generator" content="WordPress 3.2.1" />
<link rel='canonical' href='http://somewoman.com/?p=276' />
<style type="text/css" media="screen,print">
#blogtitle {background-image:url(http://somewoman.com/wp-content/uploads/2011/09/logo1.png);}#blogtitle h1,#blogtitle h1 a {color:#776963;}
</style>

<style type="text/css">
body { background-color: #fff; }
</style>

</head>

<body id="top" class="single single-post postid-276 single-format-standard">
<div id="container">

<ul class="jumplinks">
<li><a href="#sidebar">Jump to sidebar</a></li>
<li><a href="#content">Jump to page content</a></li>
<li><a href="#footer">Jump to footer</a></li>
</ul>

<div id="blogtitle">
<h1><a href="http://somewoman.com/"><span>Kelly Yeoh</span></a></h1>
</div>

<!-- start wrapper-top -->
<div id="wrapper-top">
<div id="wrapper-top-left"></div>
<div id="wrapper-top-right"></div>
</div>
<!-- end wrapper-top -->

<div id="wrapper">

<div id="innerwrap">

<div id="content">

<div class="tagline">bit of this, bit of that, voila!!</div>


<div class="post-276 post type-post status-publish format-standard hentry category-ldb category-linux category-samba">

<h2 class="post-title" id="post-276"><a href="http://somewoman.com/?p=276" rel="bookmark" title="Permanent Link: LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things">LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things</a></h2>
<ul class="meta">
<li>November 14, 2011 3:42 pm</li>
<li></li>
</ul>

<h2><strong>LDB Posts</strong></h2>
<ul>
<li><a href="http://somewoman.com/?p=212" title="LDB part 1 (of god only knows how many!!!) – Introduction">LDB part 1 (of god only knows how many!!!) – Introduction</a></li>
<li>*** LDB part 2 (it just keeps goin&#8217;) &#8211; Tools and things</li>
</ul>
<p>&nbsp;</p>
<h2><strong>LDB Tools</strong></h2>
<p>Each of the LDB tools is named appropriately to be quite self-explanatory in its functionality.</p>
<h3>Common input (utilised by some or all of the tools):</h3>
<p><strong>-H</strong> <em>ldburl</em> (the local database or the url to it)<br />
eg -H st/dc/private/secrets.ldb<br />
-H ldap://localhost<br />
-H ldaps://hostname (ldap with ssl, runs on a different port number)<br />
-H ldapi://path/ (unix domain sockets, i means internal (?), unix domain socket is a file that gives a communication path to a process on a unix box. Only within a machine, not over a network)</p>
<p><strong>-s</strong> <em>[one|sub|base]</em> search scope, can be one level, subtree or base</p>
<p><strong>-b</strong> <em>basedn</em> the distinguished name at which a search begins</p>
<p><strong><em>LDAP-style search expression</em></strong><br />
A search expression can be as simple as (for example) seeking an object with a given distinguished name, or can become quite complex. Standard logic operators (and &amp;, or |, not !) are able to be used within search expressions, with an arbitrary length of searches able to be done using each or any of these operators. Additional search parameters can be added by inserting further search strings within braces.</p>
<p>Using the &amp; operator<br />
(&amp;(search expression 1)(search expression 2)(search expression 3)&#8230;(search expression n))</p>
<p>Using the | operator<br />
(|(search expression 1)(search expression 2)(search expression 3)&#8230;(search expression n))</p>
<p>Using the ! operator<br />
(!search expression)<br />
The ! operator take a single input</p>
<p>Using a mixture<br />
(&#038;(search expression 1)(search expression 2)(!search expression 3))<br />
(|(search expression 1)(&#038;(search expression 2)(search expression 3)))</p>
<p>Wildcard searches can also be performed using an * character, eg &#8220;samAccountName=kel*&#8221;. A simple presence test can be performed by checking that an attribute has a value &#8211; any value &#8211; using a wildcard search: attribute=*</p>
<p><strong><em>attributes</em></strong><br />
which attributes from the dataset to display, will display all if none selected. These are written to the end of the ldbsearch line with spaces between each attribute name (eg dn name realm objectGUID). </p>
<p>&nbsp;</p>
<h3>ldbsearch</h3>
<p>This searches an LDB database for records that match the given parameters. LDB has a built in query optimiser that will attempt to use any indexed part of the search expression to reduce the reach of the search.</p>
<p>Common input parameters<br />
<strong>-h</strong> <em>help</em> (displays a list of available options)<br />
<strong>-H</strong> <em>ldburl</em> (database to connect to)<br />
<strong>-s</strong> <em>search scope</em> (one-level, subtree or base) can contain the value one|sub|base<br />
<strong>-b</strong> <em>basedn</em><br />
<strong>-i</strong> read search expressions from stdin<br />
<strong>LDAP-style search expression</strong><br />
(eg, &#8216;(&amp;(objectclass=kerberossecret)(samaccountname=dns-localdc))&#8217;)<br />
<strong>Attributes</strong><br />
which attributes from the dataset to display, will display not quite all if none selected (some are hidden, more on this later). These are written to the end of the ldbsearch line with spaces between each attribute name (eg name realm objectGUID)</p>
<p>as an example, an entire search command may look like this:<br />
<code>bin/ldbsearch -H st/dc/private/secrets.ldb '(&amp;(objectclass=kerberossecret)(samaccountname=dns-localdc))' name realm objectGUID</code></p>
<p>which would, in turn, produce the following information:</p>
<blockquote><p><code># record 1</code></p>
<p><code>dn: samAccountName=dns-localdc,CN=Principals<br />
realm: SAMBA.EXAMPLE.COM<br />
objectGUID: 2f1d38f3-49b2-4baa-b77c-14c5daebadc0<br />
name: dns-localdc</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>LDB pretty prints &#8211; eg, objectGUID is saved in binary form, but displayed in useful format</p>
<p>The following example returns the same database as our earlier tdbdump example. The data is in a much more readable format, and returned as a tree-like structure using LDAP style objects, attributes and values.</p>
<blockquote><p><code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/secrets.ldb<br />
</code></p>
<p><code> # record 1<br />
dn: flatname=SAMBADOMAIN,cn=Primary Domains<br />
msDS-KeyVersionNumber: 1<br />
objectClass: top<br />
objectClass: primaryDomain<br />
objectClass: kerberosSecret<br />
objectSid: S-1-5-21-4122882817-868477147-3978206388<br />
privateKeytab: secrets.keytab<br />
realm: SAMBA.EXAMPLE.COM<br />
saltPrincipal: host/localdc.samba.example.com@SAMBA.EXAMPLE.COM<br />
samAccountName: LOCALDC$<br />
secret: machinelocDCpass1<br />
secureChannelType: 6<br />
servicePrincipalName: HOST/localdc<br />
servicePrincipalName: HOST/localdc.samba.example.com<br />
objectGUID: d55fd948-e32b-47c0-b7cf-f6fbb16deb1e<br />
whenCreated: 20111005000140.0Z<br />
whenChanged: 20111005000140.0Z<br />
uSNCreated: 7<br />
uSNChanged: 7<br />
name: SAMBADOMAIN<br />
flatname: SAMBADOMAIN<br />
distinguishedName: flatname=SAMBADOMAIN,cn=Primary Domains</code></p>
<p><code># record 2<br />
dn: CN=LSA Secrets<br />
cn: LSA Secrets<br />
objectClass: top<br />
objectClass: container<br />
objectGUID: 09bef02e-5144-4753-b133-59c2d3a445f1<br />
whenCreated: 20111005000046.0Z<br />
whenChanged: 20111005000046.0Z<br />
uSNCreated: 5<br />
uSNChanged: 5<br />
name: LSA Secrets<br />
distinguishedName: CN=LSA Secrets</code></p></blockquote>
<p>The following examples return records of a specific objectClass &#8211; in this case person. </p>
<p>This example displays all information returned by default (albeit with some records removed for the sake of space)</p>
<blockquote><p>
<code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(objectclass=person)'<br />
# record 1<br />
dn: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com<br />
objectClass: top<br />
objectClass: person<br />
objectClass: organizationalPerson<br />
objectClass: user<br />
objectClass: computer<br />
cn: LOCALDC<br />
instanceType: 4<br />
whenCreated: 20111005000123.0Z<br />
uSNCreated: 3600<br />
name: LOCALDC<br />
objectGUID: 01cb8349-ff11-49ea-ab9d-6011afb44c95<br />
userAccountControl: 532480<br />
badPwdCount: 0<br />
codePage: 0<br />
countryCode: 0<br />
badPasswordTime: 0<br />
lastLogoff: 0<br />
lastLogon: 0<br />
localPolicyFlags: 0<br />
pwdLastSet: 129622464830000000<br />
primaryGroupID: 516<br />
objectSid: S-1-5-21-4122882817-868477147-3978206388-1000<br />
accountExpires: 9223372036854775807<br />
logonCount: 0<br />
sAMAccountName: LOCALDC$<br />
sAMAccountType: 805306369<br />
operatingSystem: Samba<br />
operatingSystemVersion: 4.0.0alpha18-DEVELOPERBUILD<br />
dNSHostName: localdc.samba.example.com<br />
objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=<br />
 com<br />
isCriticalSystemObject: TRUE<br />
rIDSetReferences: CN=RID Set,CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=exam<br />
 ple,DC=com<br />
serverReferenceBL: CN=LOCALDC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,C<br />
 N=Configuration,DC=samba,DC=example,DC=com<br />
msDS-SupportedEncryptionTypes: 31<br />
servicePrincipalName: HOST/localdc.samba.example.com<br />
servicePrincipalName: HOST/localdc.samba.example.com/SAMBADOMAIN<br />
servicePrincipalName: ldap/localdc.samba.example.com/SAMBADOMAIN<br />
servicePrincipalName: GC/localdc.samba.example.com/samba.example.com<br />
servicePrincipalName: ldap/localdc.samba.example.com<br />
servicePrincipalName: HOST/localdc.samba.example.com/samba.example.com<br />
servicePrincipalName: ldap/localdc.samba.example.com/samba.example.com<br />
servicePrincipalName: HOST/LOCALDC<br />
servicePrincipalName: E3514235-4B06-11D1-AB04-00C04FC2DCD2/9735e6ca-672f-44be-<br />
 95ab-21014e97a26a/samba.example.com<br />
servicePrincipalName: ldap/9735e6ca-672f-44be-95ab-21014e97a26a._msdcs.samba.e<br />
 xample.com<br />
servicePrincipalName: ldap/LOCALDC<br />
servicePrincipalName: RestrictedKrbHost/LOCALDC<br />
servicePrincipalName: RestrictedKrbHost/localdc.samba.example.com<br />
servicePrincipalName: ldap/localdc.samba.example.com/DomainDnsZones.samba.exam<br />
 ple.com<br />
servicePrincipalName: ldap/localdc.samba.example.com/ForestDnsZones.samba.exam<br />
 ple.com<br />
whenChanged: 20111005000213.0Z<br />
uSNChanged: 3734<br />
distinguishedName: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com</code></p>
<p><code># record 2<br />
dn: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com<br />
objectClass: top<br />
objectClass: person<br />
objectClass: organizationalPerson<br />
objectClass: user<br />
objectClass: computer<br />
cn: LOCALRPCPROXY<br />
instanceType: 4<br />
whenCreated: 20111005002050.0Z<br />
uSNCreated: 6719<br />
name: LOCALRPCPROXY<br />
objectGUID: ea7e2e4f-830e-4cf1-9f84-a3a1c604d8aa<br />
badPwdCount: 0<br />
codePage: 0<br />
countryCode: 0<br />
badPasswordTime: 0<br />
lastLogoff: 0<br />
lastLogon: 0<br />
objectSid: S-1-5-21-4122882817-868477147-3978206388-1221<br />
accountExpires: 9223372036854775807<br />
logonCount: 0<br />
sAMAccountName: LOCALRPCPROXY$<br />
objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=<br />
 com<br />
sAMAccountType: 805306369<br />
isCriticalSystemObject: FALSE<br />
primaryGroupID: 515<br />
pwdLastSet: 129622476500000000<br />
displayName: LOCALRPCPROXY$<br />
servicePrincipalName: HOST/localrpcproxy.samba.example.com<br />
servicePrincipalName: HOST/LOCALRPCPROXY<br />
dNSHostName: localrpcproxy.samba.example.com<br />
msDS-SupportedEncryptionTypes: 31<br />
userAccountControl: 16781312<br />
msDS-AllowedToDelegateTo: cifs/localdc<br />
whenChanged: 20111005002054.0Z<br />
uSNChanged: 6732<br />
distinguishedName: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com</code></p>
<p><code># record 3<br />
dn: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com<br />
objectClass: top<br />
objectClass: person<br />
objectClass: organizationalPerson<br />
objectClass: user<br />
objectClass: computer<br />
cn: RODC<br />
instanceType: 4<br />
whenCreated: 20111005002342.0Z<br />
displayName: RODC$<br />
uSNCreated: 6747<br />
name: RODC<br />
objectGUID: 2f32fc2c-04e6-4693-b8bc-d2721d8b6ec1<br />
badPwdCount: 0<br />
codePage: 0<br />
countryCode: 0<br />
badPasswordTime: 0<br />
lastLogoff: 0<br />
lastLogon: 0<br />
primaryGroupID: 521<br />
objectSid: S-1-5-21-4122882817-868477147-3978206388-1223<br />
accountExpires: 9223372036854775807<br />
logonCount: 0<br />
sAMAccountName: RODC$<br />
sAMAccountType: 805306369<br />
dNSHostName: RODC.samba.example.com<br />
managedBy: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com<br />
objectCategory: CN=Computer,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=<br />
 com<br />
isCriticalSystemObject: TRUE<br />
msDS-NeverRevealGroup: CN=Denied RODC Password Replication Group,CN=Users,DC=s<br />
 amba,DC=example,DC=com<br />
msDS-NeverRevealGroup: CN=Administrators,CN=Builtin,DC=samba,DC=example,DC=com<br />
msDS-NeverRevealGroup: CN=Server Operators,CN=Builtin,DC=samba,DC=example,DC=c<br />
 om<br />
msDS-NeverRevealGroup: CN=Backup Operators,CN=Builtin,DC=samba,DC=example,DC=c<br />
 om<br />
msDS-NeverRevealGroup: CN=Account Operators,CN=Builtin,DC=samba,DC=example,DC=<br />
 com<br />
msDS-RevealOnDemandGroup: CN=Allowed RODC Password Replication Group,CN=Users,<br />
 DC=samba,DC=example,DC=com<br />
msDS-SupportedEncryptionTypes: 31<br />
whenChanged: 20111005002343.0Z<br />
msDS-KrbTgtLink: CN=krbtgt_2438,CN=Users,DC=samba,DC=example,DC=com<br />
serverReferenceBL: CN=RODC,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=C<br />
 onfiguration,DC=samba,DC=example,DC=com<br />
msDFSR-ComputerReferenceBL: CN=RODC,CN=Topology,CN=Domain System Volume,CN=DFS<br />
 R-GlobalSettings,CN=System,DC=samba,DC=example,DC=com<br />
servicePrincipalName: HOST/RODC<br />
servicePrincipalName: HOST/RODC.samba.example.com<br />
servicePrincipalName: GC/RODC.samba.example.com/samba.example.com<br />
servicePrincipalName: RestrictedKrbHost/RODC<br />
servicePrincipalName: RestrictedKrbHost/RODC.samba.example.com<br />
pwdLastSet: 129622478230000000<br />
userAccountControl: 83890176<br />
uSNChanged: 6781<br />
distinguishedName: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com</code></p>
<p>&#8230;</p>
<p><code># Referral<br />
ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com</code></p>
<p><code># returned 10 records<br />
# 9 entries<br />
# 1 referrals</code>
</p></blockquote>
<p>This example is using the same search expression as above, although requesting only the name and managedBy attributes. Because managedBy is only used within some records, the others will not attempt to display it.</p>
<blockquote><p>
<code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(objectclass=person)' name managedby<br />
# record 1<br />
dn: CN=LOCALDC,OU=Domain Controllers,DC=samba,DC=example,DC=com<br />
name: LOCALDC</code></p>
<p><code># record 2<br />
dn: CN=LOCALRPCPROXY,CN=Computers,DC=samba,DC=example,DC=com<br />
name: LOCALRPCPROXY</code></p>
<p><code># record 3<br />
dn: CN=RODC,OU=Domain Controllers,DC=samba,DC=example,DC=com<br />
name: RODC<br />
managedBy: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com</code></p>
<p><code># record 4<br />
dn: CN=Administrator,CN=Users,DC=samba,DC=example,DC=com<br />
name: Administrator</code></p>
<p><code># record 5<br />
dn: CN=S4MEMBER,CN=Computers,DC=samba,DC=example,DC=com<br />
name: S4MEMBER</code></p>
<p><code># record 6<br />
dn: CN=dns-localdc,CN=Users,DC=samba,DC=example,DC=com<br />
name: dns-localdc</code></p>
<p><code># record 7<br />
dn: CN=krbtgt_2438,CN=Users,DC=samba,DC=example,DC=com<br />
name: krbtgt_2438</code></p>
<p><code># record 8<br />
dn: CN=krbtgt,CN=Users,DC=samba,DC=example,DC=com<br />
name: krbtgt</code></p>
<p><code># record 9<br />
dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com<br />
name: Guest</code></p>
<p><code># Referral<br />
ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com</code></p>
<p><code># returned 10 records<br />
# 9 entries<br />
# 1 referrals</code>
</p></blockquote>
<p>&nbsp;</p>
<h3>ldbmodify</h3>
<p>Modifies a database according to the contents of an input file of LDIF composition.</p>
<p>Common input parameters:</p>
<p><strong>-h</strong> <em>help</em></p>
<p><strong>-H</strong> <em>ldburl</em></p>
<p><em><strong>LDIF file</strong></em></p>
<p>Example of usage:<br />
<code>username@computername:~/Samba/samba-master$ bin/ldbmodify -H st/dc/private/secrets.ldb <em>LDIFfilename</em></code></p>
<p>The LDIF files used with ldbmodify are a special form of LDIF that specify what is to be changed, where, how, etc. An example is displayed below:</p>
<blockquote><p><code><br />
dn: cn=Ursula Hampster,ou=Alumni Association,ou=People,o=University of Michiga<br />
 n,c=TEST<br />
changetype: modify<br />
add: drink<br />
drink: mango lassi<br />
-<br />
add: drink<br />
drink: lemonade<br />
-<br />
delete: pager<br />
-<br />
replace: telephonenumber<br />
telephonenumber: +61 2 6260 6012<br />
telephonenumber: +61 412 666 929<br />
-<br />
delete: telephonenumber<br />
telephonenumber: +61 2 6260 6012<br />
-<br />
delete: telephonenumber<br />
telephonenumber: +61 412 666 929<br />
-<br />
add: telephonenumber<br />
telephonenumber: +61 412 666 929<br />
</code></p></blockquote>
<p>&nbsp;<br />
Note: Any line beginning with a space character is a continuation of the line immediately preceeding it (which isn&#8217;t obvious in these examples). Comments are denoted by # (eg, # I am a comment). There are more example LDIF files used within the samba test suites available in <em><code>&lt;samba-source-directory&gt;/lib/ldb/tests</code></em>. The dn attribute determines which record is to be modified.</p>
<p>&nbsp;</p>
<h3>ldbedit</h3>
<p>Allows editing of record/s within an ldb database. Instead of feeding it a premade LDIF file as per ldbmodify, ldbedit takes a bunch of parameters (including search strings if desired) and generates an LDIF file on the fly that can then be modified using the editor of your choice (given with the -e input). The edited LDIF file then forms the input for the ldbmodify operation.</p>
<p>Common input parameters:</p>
<p><strong>-h</strong> <em>help</em></p>
<p><strong>-H</strong> <em>ldburl</em></p>
<p><strong>-s</strong> <em>search scope</em></p>
<p><strong>-b</strong> <em>basedn</em></p>
<p><strong>-a</strong> all</p>
<p><strong>-e</strong> editor of choice (eg, vim, emacs, etc)</p>
<p><strong>-verbose</strong></p>
<p><em><strong>LDAP style search expression</strong></em></p>
<p><em><strong>attributes</strong></em></p>
<p>Example of usage:<br />
<code>username@computername:~/Samba/samba-master$ bin/ldbedit -e vim -H st/dc/private/sam.ldb '(samaccountname=guest)'</code></p>
<p>Would generate the following LDIF file, anddisplay it within vim (ready for editing):</p>
<blockquote><p><code><br />
# editing 1 records<br />
# record 1<br />
dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com<br />
objectClass: top<br />
objectClass: person<br />
objectClass: organizationalPerson<br />
objectClass: user<br />
cn: Guest<br />
description: Built-in account for guest access to the computer/domain<br />
instanceType: 4<br />
whenCreated: 20111005000123.0Z<br />
whenChanged: 20111005000123.0Z<br />
uSNCreated: 3563<br />
uSNChanged: 3563<br />
name: Guest<br />
objectGUID: c6be74bb-1b6f-411d-aba9-9efbe465136f<br />
userAccountControl: 66082<br />
badPwdCount: 0<br />
codePage: 0<br />
countryCode: 0<br />
badPasswordTime: 0<br />
lastLogoff: 0<br />
lastLogon: 0<br />
pwdLastSet: 0<br />
primaryGroupID: 514<br />
objectSid: S-1-5-21-4122882817-868477147-3978206388-501<br />
accountExpires: 9223372036854775807<br />
logonCount: 0<br />
sAMAccountName: Guest<br />
sAMAccountType: 805306368<br />
objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=samba,DC=example,DC=co<br />
 m<br />
isCriticalSystemObject: TRUE<br />
memberOf: CN=Guests,CN=Builtin,DC=samba,DC=example,DC=com<br />
distinguishedName: CN=Guest,CN=Users,DC=samba,DC=example,DC=com<br />
</code></p></blockquote>
<p>Once the contents of this file have been changed and saved, the modify takes place. The generated LDIF file has comments denoting how many records are within it, and the beginning of each new record.</p>
<p>&nbsp;</p>
<h3>ldbadd</h3>
<p>This function takes an LDIF file and uses the contents to insert a new record into the LDB database. The distinguished name must be unique to all others within the database, and the LDIF file must comply with any applicable schema.</p>
<p>Common input parameters:</p>
<p><strong>-h</strong> help</p>
<p><strong>-H</strong> <em>ldburl</em></p>
<p><strong><em>LDIF file/s</em></strong></p>
<p>Example of usage:<br />
<code>username@computername:~/Samba/samba-master$ bin/ldbadd -H st/dc/private/secrets.ldb <em>LDIFfilename</em></code></p>
<p>&nbsp;</p>
<h3>ldbdel</h3>
<p>The function removes records from the database according to the distinguished name. An arbitrary number of records can be removed by way of additional dns on the command line, or use of wildcards.<br />
Common input parameters:</p>
<p><strong>-h</strong> help</p>
<p><strong>-H</strong> <em>ldburl</em></p>
<p><strong>-r</strong> recursive. Can also use &#8211;recursive control</p>
<p><strong><em>dn of record/s to be deleted</em></strong></p>
<p>Example of usage:<br />
<code>username@computername:~/Samba/samba-master$ bin/ldbmodify -H st/dc/private/secrets.ldb <em>[dn1] [dn2*] [dn...]</em></code></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2><strong>Hidden and Operational Attributes</strong></h2>
<p>All operational attributes are hidden, but not all hidden attributes are operational. These attributes are not particularly well hidden, they just don&#8217;t show up in * search. You need to specify the name to get them.</p>
<p>Operation attributes are generated, not static. The data that they hold is generated from other attributes or from system information. They are read-only. </p>
<p>There are some non-operational, but hidden attributes which may be read-only, read-write or there are even some that are write-only (for example, changing password).</p>
<p>The database schema information contains an attribute called &#8220;SystemFlags&#8221;, which allows multiple values. If one of the values within this field is &#8216;FLAG_ATTR_IS_OPERATIONAL&#8217; then this is a hidden or operational attribute. </p>
<p>Some operational attributes are:</p>
<ul>
<li>replPropertyMetaData</li>
<li>nTSecurityDescriptor</li>
<li>msDS-BridgeHeadServersUsed</li>
<li>msDS-Entry-Time-To-Die</li>
<li>msDS-USNLastSyncSuccess</li>
</ul>
<p>For example, we can view the ntSecurityDescriptor data for a record as follows:</p>
<blockquote><p><code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(&#038;(objectclass=person)(name=Guest))' name ntsecuritydescriptor</code></p>
<p><code># record 1<br />
dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com<br />
nTSecurityDescriptor: O:DAG:DAD:AI(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;DA)(A;;RPWP<br />
 CRCCDCLCLORCWOWDSDDTSW;;;SY)(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;AO)(A;;RPLCLORC;<br />
 ;;PS)(OA;;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a54-1e2f-1<br />
 1d0-9819-00aa0040529b;;PS)(OA;;CR;ab721a56-1e2f-11d0-9819-00aa0040529b;;PS)(O<br />
 A;;RPWP;77b5b886-944a-11d1-aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b2-9455-11d1<br />
 -aebd-0000f80367c1;;PS)(OA;;RPWP;e45795b3-9455-11d1-aebd-0000f80367c1;;PS)(OA<br />
 ;;RP;037088f8-0ae1-11d2-b422-00a0c968f939;;RS)(OA;;RP;4c164200-20c0-11d0-a768<br />
 -00aa006e0529;;RS)(OA;;RP;bc0ac240-79a9-11d0-9020-00c04fc2d4cf;;RS)(A;;RC;;;A<br />
 U)(OA;;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;;AU)(OA;;RP;77b5b886-944a-11d1<br />
 -aebd-0000f80367c1;;AU)(OA;;RP;e45795b3-9455-11d1-aebd-0000f80367c1;;AU)(OA;;<br />
 RP;e48d0154-bcf8-11d1-8702-00c04fb96050;;AU)(OA;;CR;ab721a53-1e2f-11d0-9819-0<br />
 0aa0040529b;;WD)(OA;;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;;RS)(OA;;RPWP;bf<br />
 967a7f-0de6-11d0-a285-00aa003049e2;;CA)(OA;;RP;46a9b11d-60ae-405a-b7e8-ff8a58<br />
 d456d2;;S-1-5-32-560)(OA;;RPWP;6db69a1c-9422-11d1-aebd-0000f80367c1;;S-1-5-32<br />
 -561)(OA;;RPWP;5805bc62-bdc9-4428-a5e2-856a0f4c185e;;S-1-5-32-561)(OA;CIID;RP<br />
 ;4c164200-20c0-11d0-a768-00aa006e0529;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU<br />
 )(OA;CIID;RP;4c164200-20c0-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00a<br />
 a003049e2;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;4828cc14-1437-4<br />
 5bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;5f202010-79a5-11d0-9020-00c04fc2d4cf;bf9<br />
 67aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;bc0ac240-79a9-11d0-9020-00c0<br />
 4fc2d4cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RP;bc0ac240-79a9-11<br />
 d0-9020-00c04fc2d4cf;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;59ba<br />
 2f42-79a2-11d0-9020-00c04fc2d3cf;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;<br />
 CIID;RP;59ba2f42-79a2-11d0-9020-00c04fc2d3cf;bf967aba-0de6-11d0-a285-00aa0030<br />
 49e2;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;4828cc14-1437-45bc-9<br />
 b07-ad6f015e5f28;RU)(OA;CIID;RP;037088f8-0ae1-11d2-b422-00a0c968f939;bf967aba<br />
 -0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f<br />
 608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-2cc7-11d2-85<br />
 4e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;RP;b7c69e6d-<br />
 2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIID;<br />
 RPLCLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIID;RPLCLORC;;bf967a9c<br />
 -0de6-11d0-a285-00aa003049e2;RU)(OA;CIID;RPLCLORC;;bf967aba-0de6-11d0-a285-00<br />
 aa003049e2;RU)(OA;CIID;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;CII<br />
 D;RPWPCRCCDCLCLORCWOWDSDDTSW;;;EA)(A;CIID;LC;;;RU)(A;CIID;RPWPCRCCLCLORCWOWDS<br />
 DSW;;;BA)S:AI(OU;CIIDSA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6<br />
 -11d0-a285-00aa003049e2;WD)(OU;CIIDSA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1<br />
 ;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)<br />
name: Guest</code></p>
<p><code># Referral<br />
ref: ldap://samba.example.com/CN=Configuration,DC=samba,DC=example,DC=com</code></p>
<p><code># returned 2 records<br />
# 1 entries<br />
# 1 referrals</code>
</p></blockquote>
<p>The ntSecurityDescriptor field is saved in binary format, and we can view it in readable format by using the &#8211;show-binary operator on the command line as follows:</p>
<blockquote><p>
<code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/sam.ldb '(&#038;(objectclass=person)(name=Guest))' name ntsecuritydescriptor --show-binary</code></p>
<p><code># record 1<br />
dn: CN=Guest,CN=Users,DC=samba,DC=example,DC=com<br />
nTSecurityDescriptor:     NDR: struct security_descriptor<br />
        revision                 : SECURITY_DESCRIPTOR_REVISION_1 (1)<br />
        type                     : 0x8c17 (35863)<br />
               1: SEC_DESC_OWNER_DEFAULTED<br />
               1: SEC_DESC_GROUP_DEFAULTED<br />
               1: SEC_DESC_DACL_PRESENT<br />
               0: SEC_DESC_DACL_DEFAULTED<br />
               1: SEC_DESC_SACL_PRESENT<br />
               0: SEC_DESC_SACL_DEFAULTED<br />
               0: SEC_DESC_DACL_TRUSTED<br />
               0: SEC_DESC_SERVER_SECURITY<br />
               0: SEC_DESC_DACL_AUTO_INHERIT_REQ<br />
               0: SEC_DESC_SACL_AUTO_INHERIT_REQ<br />
               1: SEC_DESC_DACL_AUTO_INHERITED<br />
               1: SEC_DESC_SACL_AUTO_INHERITED<br />
               0: SEC_DESC_DACL_PROTECTED<br />
               0: SEC_DESC_SACL_PROTECTED<br />
               0: SEC_DESC_RM_CONTROL_VALID<br />
               1: SEC_DESC_SELF_RELATIVE<br />
        owner_sid                : *<br />
            owner_sid                : S-1-5-21-4122882817-868477147-3978206388-512<br />
        group_sid                : *<br />
            group_sid                : S-1-5-21-4122882817-868477147-3978206388-512<br />
        sacl                     : *<br />
            sacl: struct security_acl<br />
                revision                 : SECURITY_ACL_REVISION_ADS (4)<br />
                size                     : 0x0078 (120)<br />
                num_aces                 : 0x00000002 (2)<br />
                aces: ARRAY(2)<br />
                    aces: struct security_ace<br />
                        type                     : SEC_ACE_TYPE_SYSTEM_AUDIT_OBJECT (7)<br />
                        flags                    : 0x52 (82)<br />
                               0: SEC_ACE_FLAG_OBJECT_INHERIT<br />
                               1: SEC_ACE_FLAG_CONTAINER_INHERIT<br />
                               0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT<br />
                               0: SEC_ACE_FLAG_INHERIT_ONLY<br />
                               1: SEC_ACE_FLAG_INHERITED_ACE<br />
                            0x02: SEC_ACE_FLAG_VALID_INHERIT (2)<br />
                               1: SEC_ACE_FLAG_SUCCESSFUL_ACCESS<br />
                               0: SEC_ACE_FLAG_FAILED_ACCESS<br />
                        size                     : 0x0038 (56)<br />
                        access_mask              : 0x00000020 (32)<br />
                        object                   : union security_ace_object_ctr(case 7)<br />
                        object: struct security_ace_object<br />
                            flags                    : 0x00000003 (3)<br />
                                   1: SEC_ACE_OBJECT_TYPE_PRESENT<br />
                                   1: SEC_ACE_INHERITED_OBJECT_TYPE_PRESENT<br />
                            type                     : union security_ace_object_type(case 1)<br />
                            type                     : f30e3bbe-9ff0-11d1-b603-0000f80367c1<br />
                            inherited_type           : union security_ace_object_inherited_type(case 2)<br />
                            inherited_type           : bf967aa5-0de6-11d0-a285-00aa003049e2<br />
                        trustee                  : S-1-1-0<br />
                    aces: struct security_ace<br />
                        type                     : SEC_ACE_TYPE_SYSTEM_AUDIT_OBJECT (7)<br />
                        flags                    : 0x52 (82)<br />
                               0: SEC_ACE_FLAG_OBJECT_INHERIT<br />
                               1: SEC_ACE_FLAG_CONTAINER_INHERIT<br />
                               0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT<br />
                               0: SEC_ACE_FLAG_INHERIT_ONLY<br />
                               1: SEC_ACE_FLAG_INHERITED_ACE<br />
                            0x02: SEC_ACE_FLAG_VALID_INHERIT (2)<br />
                               1: SEC_ACE_FLAG_SUCCESSFUL_ACCESS<br />
                               0: SEC_ACE_FLAG_FAILED_ACCESS<br />
                        size                     : 0x0038 (56)<br />
                        access_mask              : 0x00000020 (32)<br />
                        object                   : union security_ace_object_ctr(case 7)<br />
                        object: struct security_ace_object<br />
                            flags                    : 0x00000003 (3)<br />
                                   1: SEC_ACE_OBJECT_TYPE_PRESENT<br />
                                   1: SEC_ACE_INHERITED_OBJECT_TYPE_PRESENT<br />
                            type                     : union security_ace_object_type(case 1)<br />
                            type                     : f30e3bbf-9ff0-11d1-b603-0000f80367c1<br />
                            inherited_type           : union security_ace_object_inherited_type(case 2)<br />
                            inherited_type           : bf967aa5-0de6-11d0-a285-00aa003049e2<br />
                        trustee                  : S-1-1-0<br />
        dacl                     : *<br />
            dacl: struct security_acl<br />
                revision                 : SECURITY_ACL_REVISION_ADS (4)<br />
                size                     : 0x07d4 (2004)<br />
                num_aces                 : 0x0000002c (44)<br />
                aces: ARRAY(44)<br />
                    aces: struct security_ace<br />
                        type                     : SEC_ACE_TYPE_ACCESS_ALLOWED (0)<br />
                        flags                    : 0x00 (0)<br />
                               0: SEC_ACE_FLAG_OBJECT_INHERIT<br />
                               0: SEC_ACE_FLAG_CONTAINER_INHERIT<br />
                               0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT<br />
                               0: SEC_ACE_FLAG_INHERIT_ONLY<br />
                               0: SEC_ACE_FLAG_INHERITED_ACE<br />
                            0x00: SEC_ACE_FLAG_VALID_INHERIT (0)<br />
                               0: SEC_ACE_FLAG_SUCCESSFUL_ACCESS<br />
                               0: SEC_ACE_FLAG_FAILED_ACCESS<br />
                        size                     : 0x0024 (36)<br />
                        access_mask              : 0x000f01ff (983551)<br />
                        object                   : union security_ace_object_ctr(case 0)<br />
                        trustee                  : S-1-5-21-4122882817-868477147-3978206388-512<br />
                    aces: struct security_ace<br />
                        type                     : SEC_ACE_TYPE_ACCESS_ALLOWED (0)<br />
                        flags                    : 0x00 (0)<br />
                               0: SEC_ACE_FLAG_OBJECT_INHERIT<br />
                               0: SEC_ACE_FLAG_CONTAINER_INHERIT<br />
                               0: SEC_ACE_FLAG_NO_PROPAGATE_INHERIT<br />
                               0: SEC_ACE_FLAG_INHERIT_ONLY<br />
                               0: SEC_ACE_FLAG_INHERITED_ACE<br />
                            0x00: SEC_ACE_FLAG_VALID_INHERIT (0)<br />
                               0: SEC_ACE_FLAG_SUCCESSFUL_ACCESS<br />
                               0: SEC_ACE_FLAG_FAILED_ACCESS<br />
                        size                     : 0x0014 (20)<br />
                        access_mask              : 0x000f01ff (983551)<br />
                        object                   : union security_ace_object_ctr(case 0)<br />
                        trustee                  : S-1-5-18<br />
   ##MASSIVE SNIP!!!<br />
name: Guest</code></p>
<p><code># Referral<br />
ref: ldap://samba.example.com/CN=Configuration,DC=samba, DC=example,DC=com</code></p>
<p><code># returned 2 records<br />
# 1 entries<br />
# 1 referrals</code>
</p></blockquote>
<p>Note the MASSIVE SNIP &#8211; this contains a LOT of information, only a very small section is displayed above. We will go into detail on what this data means and how it is used within Samba in a later post. </p>
<p>&nbsp;</p>
<h2><strong>How LDB Indexing works</strong></h2>
<p>Indexing allows for faster searching of the database, and a database can generally be modified to include any relevant field or attribute of importance that may be frequently searched upon. LDB is no different. LDB keeps its indexing information is the @INDEXLIST record. The @INDEXLIST record can have multiple values that can be indexed, and each of these is listed as an @IDXATTR attribute.</p>
<p>Indexes can be viewed, modified, inserted or deleted as per other database components. A schema defines which attributes should be indexed. Edit the schema if you wish to edit the index list, or edit the @INDEXLIST if using a schema-less database. A database containing a full schema completely overrides the @INDEXLIST, which then becomes only an approximation of the index listing. The schema provides more detailed indexing instructions, such as how to sort/compare each attribute type.</p>
<p>LDB offers two types of indexing: Attribute indexing or one level indexing. Attribute indexing increases speed for a search on a specific value for an attribute. One level indexing improves speed of searching all child objects of a given object. To perform this, we keep an index of every DN within the database and any child DNs thereof.</p>
<p>A planned addition to indexing is range indexing, where records within a range of integer values can be requested. This will be added to increase speed of a search used within replication, and will be discussed further when we get into replication.</p>
<p>LDB does not currently support prefix indexing, eg searching for &#8220;name=kell*&#8221;. This was decided as the loss in write performance was not worth the gain in read performance. It may be added in future versions if prefix searches are frequently required.</p>
<blockquote><p><code>username@computername:~/Samba/samba-master$ bin/ldbsearch -H st/dc/private/secrets.ldb -s base -b @INDEXLIST</code></p>
<p><code># record 1<br />
dn: @INDEXLIST<br />
@IDXATTR: cn<br />
@IDXATTR: flatname<br />
@IDXATTR: realm<br />
distinguishedName: @INDEXLIST</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>&nbsp;</p>
<h2><strong>rootDSE</strong></h2>
<p>The rootDSE provides user accessible metadata about the database. Some parts are pointers into the database, some parts are external references, some parts are information required to gather further information or to gain access to further information. </p>
<p>The rootDSE is the only record that can be accessed without authentication.</p>
<p>Within the rootDSE there are many numbers that look reasonably like this: 1.2.840.113556.1.4.800 &#8211; this is called an OID (or Object IDentifier). OIDs are widely used within many different protocols (not just LDAP), and there is a central authority for assigning OID-space. These OIDs are able to be searched on the internet to locate what they reference, for example a google search on 1.2.840.113556.1.4.800 returns <a href="http://www.oid-info.com/get/1.2.840.113556.1.4.800" title="LDAP_CAP_ACTIVE_DIRECTORY_OID" target="_blank">http://www.oid-info.com/get/1.2.840.113556.1.4.800</a>, which states: &#8220;If the RootDSE supportedCapabilities attribute contains this OID, it means the LDAP server is an Active Directory server (Win2k and later).&#8221;. Many OIDs are visible within the example rootDSE below, and each can be looked up to check for their meaning.</p>
<blockquote><p><code><em><strong>username@computername:~/Samba/samba-master$</strong></em> bin/ldbsearch -H ldap://localhost -s base -b''</code></p>
<p><code># record 1</code></p>
<p><code>dn:<br />
configurationNamingContext: CN=Configuration,DC=samba,DC=example,DC=com<br />
defaultNamingContext: DC=samba,DC=example,DC=com<br />
rootDomainNamingContext: DC=samba,DC=example,DC=com<br />
schemaNamingContext: CN=Schema,CN=Configuration,DC=samba,DC=example,DC=com<br />
subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=samba,DC=example ,DC=com<br />
supportedCapabilities: 1.2.840.113556.1.4.800<br />
supportedCapabilities: 1.2.840.113556.1.4.1670<br />
supportedCapabilities: 1.2.840.113556.1.4.1791<br />
supportedCapabilities: 1.2.840.113556.1.4.1935<br />
supportedCapabilities: 1.2.840.113556.1.4.2080<br />
supportedLDAPVersion: 2<br />
supportedLDAPVersion: 3<br />
vendorName: Samba Team (http://samba.org)<br />
isSynchronized: TRUE<br />
dsServiceName: CN=NTDS Settings,CN=COMPUTERNAME,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=samba,DC=example,DC=com<br />
serverName: CN=COMPUTERNAME,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=samba,DC=example,DC=com<br />
dNSHostName: computername.samba.example.com<br />
ldapServiceName: samba.example.com:computername$@SAMBA.EXAMPLE.COM<br />
currentTime: 20111005012227.0Z<br />
supportedControl: 1.2.840.113556.1.4.841<br />
supportedControl: 1.2.840.113556.1.4.319<br />
supportedControl: 1.2.840.113556.1.4.473<br />
supportedControl: 1.2.840.113556.1.4.1504<br />
supportedControl: 1.2.840.113556.1.4.801<br />
supportedControl: 1.2.840.113556.1.4.801<br />
supportedControl: 1.2.840.113556.1.4.805<br />
supportedControl: 1.2.840.113556.1.4.529<br />
supportedControl: 1.2.840.113556.1.4.417<br />
supportedControl: 1.2.840.113556.1.4.2064<br />
supportedControl: 1.2.840.113556.1.4.1413<br />
supportedControl: 1.2.840.113556.1.4.1413<br />
supportedControl: 1.2.840.113556.1.4.1413<br />
supportedControl: 1.2.840.113556.1.4.1339<br />
supportedControl: 1.2.840.113556.1.4.1340<br />
supportedControl: 1.2.840.113556.1.4.1413<br />
supportedControl: 1.2.840.113556.1.4.1341<br />
namingContexts: DC=samba,DC=example,DC=com<br />
namingContexts: CN=Configuration,DC=samba,DC=example,DC=com<br />
namingContexts: CN=Schema,CN=Configuration,DC=samba,DC=example,DC=com<br />
supportedSASLMechanisms: GSS-SPNEGO<br />
supportedSASLMechanisms: GSSAPI<br />
supportedSASLMechanisms: NTLM<br />
highestCommittedUSN: 3731<br />
domainFunctionality: 2<br />
forestFunctionality: 2<br />
domainControllerFunctionality: 4<br />
isGlobalCatalogReady: TRUE</code></p>
<p><code># returned 1 records<br />
# 1 entries<br />
# 0 referrals</code></p></blockquote>
<p>An excellent source of what the rootDSE contains is available at <a href="http://www.techgalaxy.net/Docs/Dev/LDAPv3%20RootDSE%20Overview.htm" title="LDAPv3 rootDSE Overview">http://www.techgalaxy.net/Docs/Dev/LDAPv3%20RootDSE%20Overview.htm</a></p>
<p>Some parts of the rootDSE important to Samba are:<br />
The naming contexts are extremely important within ActiveDirectory, these form sub-sections of the database that one would expect to reasonably contain a relevant subset of data. For example, configurationNamingContext points to where all configuration data may be found, defaultNamingContext would locate other subsections such as users, schemaNamingContext would point to the location of the schema information. On that last example, all of the contents of the schema lie within the subtree given by the schemaNamingContext, therefore the database is &#8220;introspective&#8221; &#8211; you need to look within the database for a description of itself. Users can query this subtree of the database to gain information on how the database as a whole should look and behave.</p>
<p>supportedCapabilities uses OIDs to describe what capabilities the server has.</p>
<p>supportedLDAPVersion displays which varieties of LDAP this server supports.</p>
<p>isSynchronized contains TRUE if replicated</p>
<p>dsServiceName is critical in ActiveDirectory. Each server in AD contains an NTDS (New Technology Directory Services) record containing all NTDS settings &#8211; information specific to that particular server, and the dsServiceName contains the DN to the object containing these settings. These settings are not contained within the rootDSE due to replication. The rootDSE is not replicated, but the configuration partition is replicated all over the forest, and by keeping these settings within a replicates partition we allow all domain controllers fast access to everyone else&#8217;s settings &#8211; ie to see capabilities, etc.</p>
<p>serverName points to an object that contains information such as server, DNS settings, netbios settings, etc.</p>
<p>dNSHostName is included within the rootDSE because Kerberos relies upon knowing the hostname to correctly authenticate, so we need access to this information BEFORE we can authenticate, therefore it needs to be located within a record that needs no authentication, thus the rootDSE.</p>
<p>supportedControl uses OIDs to describe what controls are supported by the server. Controls are a way that an LDAP client can ask for different behaviour for a particular operation from a server. There are only a few controls that an AD administrator might want to use, but controls can be very useful for developers. More information on these controls will be included in a later post.</p>
<p>namingContexts is a sub-section or partition of the database. The significance is that a search will, by default, not cross a naming context boundary. A naming context can be a child of another, in a hierarchy. If we do a search that starts at a lower level it will not, by default, cross boundaries to other naming contexts. &#8211;cross-ncs option (phantom root option, thus called because it effectively declares the root of the subtree to be at a higher level even though we are searching from lower) allows you to cross these boundaries.</p>
<p>highestCommittedUSN declares how many changes have been made to this database.</p>
<p>domainFunctionality and forestFunctionality when MS changes the way AD works they add a new functionailty level. This tells what functionality level the machine has been upgraded to</p>
<p>&nbsp;</p>
<h2><strong>Other</strong></h2>
<p>During the making of this post, a bug was discovered within ldbedit that would leave a transaction open upon a failed transaction. The following patch was created to address this problem:</p>
<blockquote><p><code>commit fc7d7ea4b56db01766491f6ec1a4b6b0c35cd188<br />
Author: Kelly Yeoh<br />
Date: Wed Oct 5 11:26:20 2011 +1030</code></p>
<p><code>ldb: Fix transaction cancel on failed ldbedit<br />
When ldbedit fails to modify a record, it needs to cancel the transaction<br />
to ensure that no transactions are left open on exit.</code></p>
<p><code>diff --git a/lib/ldb/tools/ldbedit.c b/lib/ldb/tools/ldbedit.c<br />
index aaf6d80..cf4ab3f 100644<br />
--- a/lib/ldb/tools/ldbedit.c<br />
+++ b/lib/ldb/tools/ldbedit.c</code></p>
<p><code>@@ -152,6 +152,7 @@ static int merge_edits(struct ldb_context *ldb,<br />
if (ret != -1) {<br />
modifies += (unsigned int) ret;<br />
} else {<br />
+ ldb_transaction_cancel(ldb);<br />
return -1;<br />
}<br />
}</code></p></blockquote>
<p>&nbsp;</p>
<h2><strong>Coming up:</strong></h2>
<ul>
<li>Magic @ records</li>
<li>Partitions</li>
<li>LDB controls</li>
<li>Operational attributes</li>
<li>Credentials</li>
<li>ACLs</li>
<li>Module chaining</li>
<li>Linked attributes</li>
</ul>


<ul class="meta postfoot">
<li>Filed under <ul><li><a href="http://somewoman.com/?cat=16" title="View all posts in LDB" rel="category">LDB</a></li><li>, <a href="http://somewoman.com/?cat=13" title="View all posts in Linux" rel="category">Linux</a></li><li>, <a href="http://somewoman.com/?cat=5" title="View all posts in Samba" rel="category">Samba</a></li></ul></li>


<li class="add-comment icon"><a href="#respond">Add your comment</a></li>
<li class="trackback icon inline"><a href="http://somewoman.com/wp-trackback.php?p=276" rel="trackback">TrackBack <abbr title="Uniform Resource Identifier">URI</abbr></a></li>
<li class="comments-feed icon inline"><a href="http://somewoman.com/?feed=rss2&amp;p=276">Comments feed</a></li>

</ul>

</div>



								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/?p=276#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://somewoman.com/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes"><label for="email"> Required fields are marked <span class="required">*</span><br />Your details will be stored in a non-tracking cookie but your email address will <em>never</em> be published or shared.</label></p>							<p class="comment-form-author"><label class="text" for="author">Name<span class="required">*</span></label><input id="author" name="author" type="text" value="" size="30" /></p>
<p class="comment-form-email"><label class="text" for="email">Email<span class="required">*</span></label><input id="email" name="email" type="text" value="" size="30" /></p>
<p class="comment-form-url"><label class="text" for="url">Website</label><input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8"></textarea></p>												<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Submit Reply" />
							<input type='hidden' name='comment_post_ID' value='276' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="dc0f3d8c7a" /></p>					</form>
							</div><!-- #respond -->
						

</div>
<!-- end content -->

<div class="sidebar accordian" id="scrapbook-main">

<h2 id="navbar">Navigation Menu</h2>

<div id="archives-3" class="widget-container widget_archive"><h3 class="widgettitle">Archives</h3>		<ul>
			<li><a href='http://somewoman.com/?m=201301' title='January 2013'>January 2013</a></li>
	<li><a href='http://somewoman.com/?m=201212' title='December 2012'>December 2012</a></li>
	<li><a href='http://somewoman.com/?m=201211' title='November 2012'>November 2012</a></li>
	<li><a href='http://somewoman.com/?m=201112' title='December 2011'>December 2011</a></li>
	<li><a href='http://somewoman.com/?m=201111' title='November 2011'>November 2011</a></li>
	<li><a href='http://somewoman.com/?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='http://somewoman.com/?m=201109' title='September 2011'>September 2011</a></li>
		</ul>
</div><div id="categories-3" class="widget-container widget_categories"><h3 class="widgettitle">Categories</h3><select name='cat' id='cat' class='postform' >
	<option value='-1'>Select Category</option>
	<option class="level-0" value="8">#killme&nbsp;&nbsp;(8)</option>
	<option class="level-0" value="11">Adelaide&nbsp;&nbsp;(7)</option>
	<option class="level-0" value="6">Alyssa&nbsp;&nbsp;(9)</option>
	<option class="level-0" value="9">cookin&#8217; baby!!&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="15">Debian&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="16">LDB&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="19">lenovo&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="7">Life in general&nbsp;&nbsp;(12)</option>
	<option class="level-0" value="13">Linux&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="4">Miscellaneous&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="20">personal&nbsp;&nbsp;(7)</option>
	<option class="level-0" value="5">Samba&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="14">Ubuntu&nbsp;&nbsp;(3)</option>
	<option class="level-0" value="1">Uncategorized&nbsp;&nbsp;(10)</option>
	<option class="level-0" value="17">Virtual Machines&nbsp;&nbsp;(1)</option>
</select>

<script type='text/javascript'>
/* <![CDATA[ */
	var dropdown = document.getElementById("cat");
	function onCatChange() {
		if ( dropdown.options[dropdown.selectedIndex].value > 0 ) {
			location.href = "http://somewoman.com/?cat="+dropdown.options[dropdown.selectedIndex].value;
		}
	}
	dropdown.onchange = onCatChange;
/* ]]> */
</script>

</div><div id="search-3" class="widget-container widget_search"><form method="get" id="searchform" action="http://somewoman.com/">
<div>
<label for="s">Keyword(s): </label><input class="text" type="text" value=" " name="s" id="s" />
<input type="submit" class="submit" name="submit" value="Search" />
</div>
</form>
</div>
<h3 class="home"><a href="http://somewoman.com/">Home</a></h3>
<div id="linkcat-2" class="widget-container widget_links"><h3 class="widgettitle">Blogroll</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://alyssa.yeoh.info" rel="me" title="My beautiful little person" target="_blank">Alyssa Pei Ping Yeoh</a></li>
<li><a href="http://kattekrab.net/" title="Someone who I admire above and beyond almost all others &#8211; one of the most awesome gals on the planet!" target="_blank">Donna Benjamin</a></li>
<li><a href="http://house.yeoh.info" rel="me" title="The house that I no longer live in" target="_blank">House</a></li>
<li><a href="http://samba.org" rel="co-worker" title="The official web page for Samba software" target="_blank">Samba</a></li>

	</ul>
</div>

<div id="meta-3" class="widget-container widget_meta"><h3 class="widgettitle">Meta</h3>			<ul>
						<li><a href="http://somewoman.com/wp-login.php">Log in</a></li>
			<li><a href="http://somewoman.com/?feed=rss2" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://somewoman.com/?feed=comments-rss2" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>
						</ul>
</div>
<a class="rss" href="http://somewoman.com/?feed=rss2" title="Subscribe to my RSS news feed"><img src="http://somewoman.com/wp-content/themes/scrapbook/images/rss.gif" width="24" height="24" alt="RSS" /></a>

</div>

</div>
<span class="clear"></span>
<!-- end innerwrap -->

</div>
<!-- end wrapper -->

<!-- start footer -->
<div id="footer">
<div id="footer-left"></div>
<div id="footer-right"></div>

<a class="top" href="#top" title="Go to top of page"><img src="http://somewoman.com/wp-content/themes/scrapbook/images/up.gif" width="16" height="16" alt="Go to top of page" /></a><br />

&copy; 2013 Kelly Yeoh<br />


Powered by the <a href="http://quirm.net/scrapbook">Scrapbook Theme </a>


<script type="text/javascript">tb_pathToImage = "http://somewoman.com/wp-includes/js/thickbox/loadingAnimation.gif";tb_closeImage = "http://somewoman.com/wp-includes/js/thickbox/tb-close.png";</script>
</div>
<!-- end footer -->


</div>
<!-- end container -->

</body>
</html>