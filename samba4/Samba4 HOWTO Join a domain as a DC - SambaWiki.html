<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.5-2squeeze5" />
		<meta name="keywords" content="Samba4/HOWTO/Join a domain as a DC,Dns-backend bind,Samba4/ldapcmp,Samba AD DC HOWTO,SysVol Replication" />
		<link rel="shortcut icon" href="http://www.samba.org/samba/style/2010/grey/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="SambaWiki (en)" />
		<link title="Creative Commons" type="application/rdf+xml" href="/index.php?title=Samba4/HOWTO/Join_a_domain_as_a_DC&amp;action=creativecommons" rel="meta" />
		<link rel="copyright" href="/index.php/License" />
		<link rel="alternate" type="application/rss+xml" title="SambaWiki RSS feed" href="/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="SambaWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Samba4/HOWTO/Join a domain as a DC - SambaWiki</title>
		<link rel="stylesheet" href="http://wikistatic.samba.org/skins/common/shared.css?207" type="text/css" media="screen" />
		<link rel="stylesheet" href="http://wikistatic.samba.org/skins/common/commonPrint.css?207" type="text/css" media="print" />
		<link rel="stylesheet" href="http://wikistatic.samba.org/skins/monobook/main.css?207" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="http://wikistatic.samba.org/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="http://wikistatic.samba.org/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="http://wikistatic.samba.org/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="http://wikistatic.samba.org/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="http://wikistatic.samba.org/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "http://wikistatic.samba.org/skins";
		var wgArticlePath = "/index.php/$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://wiki.samba.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Samba4/HOWTO/Join_a_domain_as_a_DC";
		var wgTitle = "Samba4/HOWTO/Join a domain as a DC";
		var wgAction = "view";
		var wgArticleId = "1724";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 7886;
		var wgVersion = "1.15.5-2squeeze5";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="http://wikistatic.samba.org/skins/common/wikibits.js?207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="http://wikistatic.samba.org/skins/common/ajax.js?207"></script>
		<script type="text/javascript" src="/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Samba4_HOWTO_Join_a_domain_as_a_DC skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Samba4/HOWTO/Join a domain as a DC</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From SambaWiki</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Samba4_joining_a_domain_as_a_DC"><span class="tocnumber">1</span> <span class="toctext">Samba4 joining a domain as a DC</span></a>
<ul>
<li class="toclevel-2"><a href="#Getting_ready_for_joining_Samba_as_a_DC_to_an_existing_domain"><span class="tocnumber">1.1</span> <span class="toctext">Getting ready for joining Samba as a DC to an existing domain</span></a></li>
<li class="toclevel-2"><a href="#Joining_the_existing_domain_as_a_DC"><span class="tocnumber">1.2</span> <span class="toctext">Joining the existing domain as a DC</span></a></li>
<li class="toclevel-2"><a href="#Check_required_DNS_entries_of_the_new_host"><span class="tocnumber">1.3</span> <span class="toctext">Check required DNS entries of the new host</span></a></li>
<li class="toclevel-2"><a href="#Starting_Samba"><span class="tocnumber">1.4</span> <span class="toctext">Starting Samba</span></a></li>
<li class="toclevel-2"><a href="#Testing_Directory_Replication"><span class="tocnumber">1.5</span> <span class="toctext">Testing Directory Replication</span></a>
<ul>
<li class="toclevel-3"><a href="#ldapcmp"><span class="tocnumber">1.5.1</span> <span class="toctext">ldapcmp</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#A_Note_on_SysVol_replication"><span class="tocnumber">1.6</span> <span class="toctext">A Note on SysVol replication</span></a></li>
<li class="toclevel-2"><a href="#Report_your_success.2Ffailure.21"><span class="tocnumber">1.7</span> <span class="toctext">Report your success/failure!</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#FSMO_role_transfer"><span class="tocnumber">2</span> <span class="toctext">FSMO role transfer</span></a></li>
<li class="toclevel-1"><a href="#A_note_on_DNS_updates"><span class="tocnumber">3</span> <span class="toctext">A note on DNS updates</span></a></li>
<li class="toclevel-1"><a href="#Samba4_joining_a_domain_as_a_RODC_.28Status_for_a_work_in_progress.29"><span class="tocnumber">4</span> <span class="toctext">Samba4 joining a domain as a RODC (Status for a work in progress)</span></a></li>
<li class="toclevel-1"><a href="#FAQ"><span class="tocnumber">5</span> <span class="toctext">FAQ</span></a>
<ul>
<li class="toclevel-2"><a href="#Message_.22Failed_to_find_our_own_NTDS_Settings_invocationId_in_the_ldb.21.22_during_joining"><span class="tocnumber">5.1</span> <span class="toctext">Message "Failed to find our own NTDS Settings invocationId in the ldb!" during joining</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Samba4_joining_a_domain_as_a_DC" id="Samba4_joining_a_domain_as_a_DC"></a><h1> <span class="mw-headline"> Samba4 joining a domain as a DC </span></h1>
<p>As of Samba4 alpha11, Samba4 has the ability to join an existing
Active Directory domain as an additional domain controller. The
process of joining a Samba4 server to an existing domain is a bit
different to provisioning a new domain. This process is the equivalent
of the 'dcpromo' command on Windows servers.
</p><p>This HOWTO will assume you had configured and installed Samba in the
default location of /usr/local/samba. It assumes you are joining Samba
to an existing domain called 'samdom.example.com'.
</p><p>Please note that the following steps are the same regardless of whether
you are joining Samba to an existing Windows based domain or an
existing Samba based domain.
</p><p><br />
</p>
<a name="Getting_ready_for_joining_Samba_as_a_DC_to_an_existing_domain" id="Getting_ready_for_joining_Samba_as_a_DC_to_an_existing_domain"></a><h2> <span class="mw-headline"> Getting ready for joining Samba as a DC to an existing domain </span></h2>
<p>You need to install Samba as a DC, as described in the <a href="/index.php/Samba_AD_DC_HOWTO" title="Samba AD DC HOWTO">Samba AD DC HowTo</a>, but don't do the provision/classicupgrade step. If you choose <a href="/index.php/Dns-backend_bind" title="Dns-backend bind">BIND as DNS backend</a>, instead of the internal DNS, then you, of course, have to finish this before you continue. Depending on your needs, you can have different backends on each of your DC.
</p><p>You should remove any existing smb.conf in /usr/local/samba/etc/.
</p><p>Be sure, that you have your setup your existing domain correctly
as your default realm in /etc/krb5.conf with the following options:
</p>
<pre>[libdefaults]
 dns_lookup_realm = true
 dns_lookup_kdc = true
 default_realm = SAMDOM.EXAMPLE.COM
</pre>
<p>You should then test to make sure that DNS and kerberos are setup
correctly to point at your existing domain controller. Test that it is
all working by trying a kinit as a domain administration:
</p>
<pre># kinit administrator
Password: XXXXXXXX
</pre>
<p>klist should should give you an output like the following:
</p>
<pre># klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: administrator@samdom.example.com

Valid starting     Expires            Service principal
11/11/12 17:29:51  11/12/12 03:29:51  krbtgt/samdom.example.com@samdom.example.com
       renew until 11/12/12 17:29:49
</pre>
<p>Once all that is setup you can move on to the join domain step.
</p><p><br />
</p>
<a name="Joining_the_existing_domain_as_a_DC" id="Joining_the_existing_domain_as_a_DC"></a><h2> <span class="mw-headline"> Joining the existing domain as a DC </span></h2>
<p>Run the following command as root:
</p>
<pre># bin/samba-tool domain join samdom.example.com DC -Uadministrator --realm=samdom.example.com
</pre>
<p>Since samba4 rc2 the internal DNS server is default. If you want to join
this or a higher version with using <a href="/index.php/Dns-backend_bind" title="Dns-backend bind">BIND as DNS backend</a>, use the following
command:
</p>
<pre># bin/samba-tool domain join samdom.example.com DC -Uadministrator --realm=samdom.example.com --dns-backend=BIND9_DLZ
</pre>
<p>During the join, you should see a set of debug messages about replicating
the domains content, like this:
</p>
<pre>Partition[CN=Configuration,DC=samba,DC=example,DC=com] objects[1614/1614] linked_values[28/0]
</pre>
<p>At the end, you will see a message like this:
</p>
<pre>Joined domain SAMBA (SID S-1-5-21-3565189888-2228146013-2029845409) as a DC
</pre>
<p>Now you have joined your Samba4 server to your existing domain.
</p><p><br />
</p>
<a name="Check_required_DNS_entries_of_the_new_host" id="Check_required_DNS_entries_of_the_new_host"></a><h2> <span class="mw-headline"> Check required DNS entries of the new host </span></h2>
<p>Before you start samba, you should check, if the new DCs DNS entries are set
correctly during joining. This doesn't currently work 100% and have to
be done manually in that case.
</p><p>From the new host, try to resolve its hostname:
</p>
<pre># host -t A dc2.samdom.example.com.
</pre>
<p>If this fails, you have to add the A record by hand. Run on your existing DC:
</p>
<pre># samba-tool dns add IP-of-your-DNS-server samdom.example.com DC2 A IP-of-the-DC-you-had-joined -Uadministrator
</pre>
<p>Also you should check, if the objectGUID is resolvable to the new hostname. For that, run
</p>
<pre># ldbsearch -H /usr/local/samba/private/sam.ldb '(invocationid=*)' --cross-ncs objectguid
</pre>
<p>to find out the objectGUID of the new server. The command should give you an output like 
</p>
<pre># record 1
dn: CN=NTDS Settings,CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=samba,DC=example,DC=com
objectGUID: 737506d0-bfe6-40c8-815d-08c3dff7a67f
...
</pre>
<p>In this case, 737506d0-bfe6-40c8-815d-08c3dff7a67f is the objectGUID of the new DC,
we'll query with the following command:
</p>
<pre># host -t CNAME 737506d0-bfe6-40c8-815d-08c3dff7a67f._msdcs.samdom.example.com.
</pre>
<p>This should output you the alias (CNAME) of this entry pointing to your new DC name.
If this record is also missing, you have to add it, too:
</p>
<pre># samba-tool dns add IP-of-your-DNS _msdcs.samdom.example.com 737506d0-bfe6-40c8-815d-08c3dff7a67f CNAME DC2.samdom.example.com -Uadministrator
</pre>
<p>If you are running BIND as DNS backend and still can't resolve the new added DNS entries, see
<a href="/index.php/Dns-backend_bind#New_added_DNS_entries_are_not_resolvable" title="Dns-backend bind">BIND DNS backend: New added DNS entries are not resolvable</a>.
</p><p><br />
</p>
<a name="Starting_Samba" id="Starting_Samba"></a><h2> <span class="mw-headline"> Starting Samba </span></h2>
<p>You start samba as a DC in the same way that you start it as a normal
server, just run the command 'samba' from the sbin directory of your
installation.
</p><p>When you first start Samba as a new DC in an existing Windows domain,
you may find errors messages like these in the samba log file:
</p>
<pre>UpdateRefs failed with WERR_DS_DRA_BAD_NC/NT code 0xc00020f8 for 5344d0a6-78a1-4758be69-66d933f1123._msdcs.samdom.example.com CN=RID Manager$,CN=System,DC=samba,DC=example,DC=com
</pre>
<p>This is caused by the Windows domain controller that haven't yet run its
Knowledge Consistency Checker (KCC), which means it has not yet created
connections to the new Samba DC.
</p><p>To fix this, you can either run "repadmin /kcc" on the Windows DC as
an administrator, or you can use the samba-tool command to do the same
thing, like this:
</p>
<pre># samba-tool drs kcc -Uadministrator windowsdc.samdom.example.com
</pre>
<p>You should then check that replication between the Windows DC and the
Samba DC is working correctly by using:
</p>
<pre># samba-tool drs showrepl

Default-First-Site-Name\DC2
DSA Options: 0x00000001
DSA object GUID: 737506d0-bfe6-40c8-815d-08c3dff7a67f
DSA invocationId: eb242434-ca7e-4da7-9b1d-b289ba1922e9

==== INBOUND NEIGHBORS ====

DC=samba,DC=example,DC=com
       Default-First-Site-Name\DC1 via RPC
               DSA object GUID: 25e33532-42f2-4082-b9f4-072f9108b565
               Last attempt @ Sun Nov 11 18:02:02 2012 CET was successful
               0 consecutive failure(s).
               Last success @ Sun Nov 11 18:02:02 2012 CET

CN=Configuration,DC=samba,DC=example,DC=com
       Default-First-Site-Name\DC1 via RPC
               DSA object GUID: 25e33532-42f2-4082-b9f4-072f9108b565
               Last attempt @ Sun Nov 11 18:02:02 2012 CET was successful
               0 consecutive failure(s).
               Last success @ Sun Nov 11 18:02:02 2012 CET
.....
</pre>
<p><br />
</p>
<a name="Testing_Directory_Replication" id="Testing_Directory_Replication"></a><h2> <span class="mw-headline"> Testing Directory Replication </span></h2>
<p>To check that replication is working correctly between your two domain
controllers, try adding a user on the Samba DC using either the Samba
command line tools, or the Windows GUI admin tools. Then check that
the user shows up within a few seconds on your Windows domain
controller.
</p><p>Similarly, try modifying a user on the Windows domain controller and
check that the modifies show up correctly on the Samba server
</p><p><br />
</p>
<a name="ldapcmp" id="ldapcmp"></a><h3> <span class="mw-headline">ldapcmp</span></h3>
<p>You may wish to use <a href="/index.php/Samba4/ldapcmp" title="Samba4/ldapcmp">ldapcmp</a> to verify that the same data
is being served from all domain controllers.
</p><p><br />
</p>
<a name="A_Note_on_SysVol_replication" id="A_Note_on_SysVol_replication"></a><h2> <span class="mw-headline"> A Note on SysVol replication </span></h2>
<p>Currently the replication of the SysVol share isn't implemented. If you make any changes
on that share, you have to keep the shares on all your DCs in sync manually (e. g. with an rsync cronjob).
An example way how to achieve this, you can find in the <a href="/index.php/SysVol_Replication" title="SysVol Replication">SysVol Replication Howto</a>.
</p><p><br />
</p>
<a name="Report_your_success.2Ffailure.21" id="Report_your_success.2Ffailure.21"></a><h2> <span class="mw-headline"> Report your success/failure! </span></h2>
<p>Samba4 as a replicating domain controller is still developing rapidly,
and we like to hear from users about their successes and
failures. While Samba4 is still in rc state we would encourage
you to report both your successes and failures to the samba-technical
mailing list on <a href="http://lists.samba.org" class="external free" title="http://lists.samba.org" rel="nofollow">http://lists.samba.org</a>
</p><p>Please be aware that Samba4 is not complete, so you should deploy it
carefully until it is ready for production.
</p><p><br />
</p>
<a name="FSMO_role_transfer" id="FSMO_role_transfer"></a><h1> <span class="mw-headline"> FSMO role transfer </span></h1>
<p><b>Warning: Currently seizing roles is not working 100% like expected!</b> See <a href="https://bugzilla.samba.org/show_bug.cgi?id=9461" class="external text" title="https://bugzilla.samba.org/show_bug.cgi?id=9461" rel="nofollow">bug report 9461</a> for further information and if it's fixed in the meantime.
</p><p>You can transfer FSMO roles from an existing DC to a <a href="/index.php/Samba_AD_DC_HOWTO" title="Samba AD DC HOWTO">Samba AD DC</a>, by seizing them from
your Samba AD machine:
</p>
<pre># samba-tool fsmo seize --role=....
</pre>
<p>You can seize all five roles: rid, schema, naming, pdc and infrastructure (you can use "--role=all" to seize all at once).
</p><p><br />
</p>
<a name="A_note_on_DNS_updates" id="A_note_on_DNS_updates"></a><h1> <span class="mw-headline"> A note on DNS updates </span></h1>
<p>As of Samba4 alpha12 Samba4 has the ability to automatically update a
Windows or bind9 DNS server with the correct set of DNS entries when
it becomes a domain controller.
</p><p>For this to work correctly between Samba and Windows you may find that
you need a set of 5 patches to bind9. Those patches are located in the
examples/bind9-patches directory of the Samba4 source tree. The
patches have been submitted to the bind9 developers and will be
incorporated in the future release of bind, but in the meantime you
should be able to build bind9 yourself from sources and apply the
patches.
</p><p>The way the automatic DNS updates works is that Samba regularly (every
10 minutes) calls out to the samba_dnsupdate script that is installed
along with Samba. That script reads a template file of DNS names to
update in the DNS zone from /usr/local/samba/private/dns_update_list.
</p><p>The contents of this file look like this:
</p>
<pre>A                                                        ${DNSDOMAIN} $IP
A                                                        ${HOSTNAME} $IP
CNAME ${NTDSGUID}._msdcs.${DNSDOMAIN}                    ${HOSTNAME}
SRV _kerberos._tcp.${SITE}._sites.dc._msdcs.${DNSDOMAIN} ${HOSTNAME} 88
SRV _ldap._tcp.${SITE}._sites.dc._msdcs.${DNSDOMAIN}     ${HOSTNAME} 389
SRV _kerberos._tcp.dc._msdcs.${DNSDOMAIN}                ${HOSTNAME} 88
SRV _ldap._tcp.dc._msdcs.${DNSDOMAIN}                    ${HOSTNAME} 389
SRV _ldap._tcp.${DOMAINGUID}.domains._msdcs.${DNSDOMAIN} ${HOSTNAME} 389
SRV _ldap._tcp.${SITE}._sites.gc._msdcs.${DNSDOMAIN}     ${HOSTNAME} 3268
SRV _ldap._tcp.gc._msdcs.${DNSDOMAIN}                    ${HOSTNAME} 3268
SRV _ldap._tcp.pdc._msdcs.${DNSDOMAIN}                   ${HOSTNAME} 389
SRV _gc._tcp.${SITE}._sites.${DNSDOMAIN}                 ${HOSTNAME} 3268
SRV _kerberos._tcp.${SITE}._sites.${DNSDOMAIN}           ${HOSTNAME} 88
SRV _ldap._tcp.${SITE}._sites.${DNSDOMAIN}	          ${HOSTNAME} 389
SRV _gc._tcp.${DNSDOMAIN}                                ${HOSTNAME} 3268
SRV _kerberos._tcp.${DNSDOMAIN}                          ${HOSTNAME} 88
SRV _kpasswd._tcp.${DNSDOMAIN}                           ${HOSTNAME} 464
SRV _ldap._tcp.${DNSDOMAIN}                              ${HOSTNAME} 389
SRV _kerberos._udp.${DNSDOMAIN}                          ${HOSTNAME} 88
SRV _kpasswd._udp.${DNSDOMAIN}                           ${HOSTNAME} 464
</pre>
<p>at runtime, Samba will substitute the variables in this file, and call
out to the bind9 nsupdate command using the -g option to enable
TSIG-GSS DNS updates. It will only make updates for DNS names that it
detects are not currently correctly set.
</p><p>You can add your own names to dns_update_list list if you want, and
Samba will add those on the DNS server. You may also choose not to use
TSIG-GSS and instead use a fixed DNS key setup in another bind9
server. To do that you will need to modify the 'nsupdate' command that
Samba runs, which is settable using the "nsupdate command" smb.conf
option. The default is "/usr/bin/nsupdate -g"
</p><p>The $IP entries for A records are replaced with the IP interface addresses that Samba detects at runtime,
based on the "interfaces=" smb.conf option.
</p><p><br />
</p>
<a name="Samba4_joining_a_domain_as_a_RODC_.28Status_for_a_work_in_progress.29" id="Samba4_joining_a_domain_as_a_RODC_.28Status_for_a_work_in_progress.29"></a><h1> <span class="mw-headline"> Samba4 joining a domain as a RODC (Status for a work in progress) </span></h1>
<p>For the TODO list see <a href="http://wiki.samba.org/index.php/Samba4_DRS_TODO_List#Support_RODC" class="external text" title="http://wiki.samba.org/index.php/Samba4_DRS_TODO_List#Support_RODC" rel="nofollow">Support RODC TODO</a>
</p><p><b>Main features implemented</b>
</p>
<ul><li> Joinining as a RODC to Windows DC
</li></ul>
<p>To do that one should do a samba-tool join (or samba-tool domain join), something like this:
</p>
<pre>sudo bin/samba-tool join win.dev RODC -UAdministrator%password --target-dir=/home/ant/prefix.win/
</pre>
<p>or (for newer versions of Samba):
</p>
<pre>sudo bin/samba-tool domain join win.dev RODC -Uadministrator%password --target-dir=/home/ant/prefix.win/
</pre>
<ul><li> Added support for RODC FAS
</li></ul>
<ul><li> Added support for unidirectional replication
</li></ul>
<ul><li> Added support for read-only database
</li></ul>
<p><b>Main features in the TODO list</b>
</p>
<ul><li> Support Administrator role separation
</li></ul>
<ul><li> Support Credential caching
</li></ul>
<ul><li> Join Windows as a RODC in Samba4 domain - blocked by kerberos tgt stuff.
</li></ul>
<p><br />
</p><p><br />
</p><p><br />
</p>
<a name="FAQ" id="FAQ"></a><h1> <span class="mw-headline"> FAQ </span></h1>
<a name="Message_.22Failed_to_find_our_own_NTDS_Settings_invocationId_in_the_ldb.21.22_during_joining" id="Message_.22Failed_to_find_our_own_NTDS_Settings_invocationId_in_the_ldb.21.22_during_joining"></a><h2> <span class="mw-headline"> Message "Failed to find our own NTDS Settings invocationId in the ldb!" during joining </span></h2>
<p>Check if you have an existing <tt>smb.conf</tt> and remove it befor joining.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 15/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key samba_wiki:pcache:idhash:1724-0!1!0!!en!2!edit=0 and timestamp 20130728150958 -->
<div class="printfooter">
Retrieved from "<a href="http://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC">http://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="/index.php?title=Talk:Samba4/HOWTO/Join_a_domain_as_a_DC&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="/index.php?title=Samba4/HOWTO/Join_a_domain_as_a_DC&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="/index.php?title=Samba4/HOWTO/Join_a_domain_as_a_DC&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Samba4/HOWTO/Join_a_domain_as_a_DC" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://www.samba.org/samba/style/2010/samba_2010_logo_transparent_151x27.png);" href="/index.php/Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/index.php/Main_Page">Main page</a></li>
				<li id="n-User-documentation"><a href="/index.php/Samba">User documentation</a></li>
				<li id="n-Developer-documentation"><a href="/index.php/Developer_documentation">Developer documentation</a></li>
				<li id="n-portal"><a href="/index.php/SambaWiki:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="/index.php/SambaWiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="/index.php/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/index.php/Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search SambaWiki [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/index.php/Special:WhatLinksHere/Samba4/HOWTO/Join_a_domain_as_a_DC" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/index.php/Special:RecentChangesLinked/Samba4/HOWTO/Join_a_domain_as_a_DC" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="/index.php/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/index.php?title=Samba4/HOWTO/Join_a_domain_as_a_DC&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/index.php?title=Samba4/HOWTO/Join_a_domain_as_a_DC&amp;oldid=7886" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="http://wikistatic.samba.org/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
				<div id="f-copyrightico"><a href="http://creativecommons.org/licenses/GPL/2.0/"><img src="http://wikistatic.samba.org/cc-GPL-a.png" alt='the CC-GNU GPL v2 or later' /></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 28 July 2013, at 15:09.</li>
					<li id="viewcount">This page has been accessed 85,948 times.</li>
					<li id="copyright">Content is available under <a href="/index.php/License" title="License">the CC-GNU GPL v2 or later</a>.</li>
					<li id="privacy"><a href="/index.php/SambaWiki:Privacy_policy" title="SambaWiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="/index.php/SambaWiki:About" title="SambaWiki:About">About SambaWiki</a></li>
					<li id="disclaimer"><a href="/index.php/SambaWiki:General_disclaimer" title="SambaWiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.059 secs. --></body></html>
