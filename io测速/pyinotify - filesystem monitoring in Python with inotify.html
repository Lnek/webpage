<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">

<link rel="alternate" type="application/rss+xml" title="pyinotify - filesystem monitoring in Python with inotify (RSS 2.0)" href="http://seb.dbzteam.com/swp/bin/page.py?fun=rss&amp;farg=page_49918974774dc106c5fa9d7784af059c.xml"><!-- style sheet -->


<style type="text/css">

html {
  line-height: 1.5;
  color: black;
  background-color: white;
}

body {
  border: 0;
  color: black;
  background-color: white;
  font: 82%/150% sans-serif;
}

#main, #sidebar, #centered-main {
  top: 40px;
  position: relative;
}

#top {
  margin: 30px 0px 30px 0px;
}

#bottom {
  margin: 30px 0px 30px 0px;
}

#main {
  float: right;
  width: 69%;
  padding-right: 3%;
  padding-left: 3%;
  border-left: 1px dashed #7F98A7;
}

#sidebar {
  float: left;
  width: 18%;
  padding: 0px 3% 0px 2%;
}

#sidesection {
  margin: 40px 0px 40px 0px;
}

#centered-main {
  margin: 0px auto 0px auto;
  width: 70%;
}

div.hsep {
  border-top: 1px dashed #7F98A7;
  border-bottom: 1px dashed #7F98A7;
}

ul {
  list-style-type: disc;
  /*list-style-image: none;
  list-style-type: none;
  list-style: none;*/
}

/*
ul li:before {
  content: "\00BB \0020";
}*/

ul#menu-list {
  list-style-type: decimal;
  text-align: left;
}

h1 {
  font-size: 140%;
  margin: 5px 0px 5px 0px;
  letter-spacing: 3px;
  text-align: center;
}

h2 {
  letter-spacing: 2px;
  font-size: 120%;
  font-weight: bold;
  text-align: left;
}

blockquote {
  margin: 0px;
  padding: 0px;
}

div.section {
  -moz-border-radius: 5px 5px 5px 5px;
  padding: 0px;
  margin: 0px 0px 30px 0px;
}

/* menu title */

div.title-menu {
  padding: 4px 5px 0px 10px;
  margin: 0px 0px 10px 0px;
  border-bottom: 1px solid #7F98A7;
  letter-spacing: 2px;
  font-size: 130%;
  font-weight: bold
}

span#menutitle {
  /* empty */
}

/* section title */

div.title-section {
  padding: 0px 20px 0px 5px;
  margin: 0px;
  border-bottom: 1px solid #7F98A7;
}

table.title-section {
  width: 100%;
  padding: 0px;
  margin: 4px 0px 0px 0px;
  border: 0px;
}

tr.title-section {
  border: 0px;
  margin: 0px;
  padding: 0px;
}

td.title-section-left {
  width: 70%;
  letter-spacing: 2px;
  font-size: 130%;
  font-weight: bold;
  text-align: left;
}

td.title-section-right {
  width: 30%;
  font-size: 110%;
  font-weight: bold;
  text-align: right;
  border: 0px;
}

/* section infos */

.infos-section {
  color: #8CA6B6;
  font-size: 0.85em;
  padding: 2px 0px 0px 5px;
}

/* section content */

.content-section {
  margin: 5px 0px 0px 0px;
  padding: 5px;
}

/* footer */

#footer {
  clear: both;
  width: 100%;
  height: 30px;
}

/* separators */

div.bigsep div.medsep span p div {
   font-size: 120%;
}

div.bigsep {
   margin: 20px 0px 20px 0px;
}

div.medsep {
   margin: 15px 0px 0px 0px;
}

/* general */

pre {
    font: 12px Arial, Helvetica, sans-serif;
    font-weight: normal;
    padding: 6px 6px 6px 15px;
}

.verbatim {
  font: 12px Arial, Helvetica, sans-serif;
  font-weight: normal;
  text-align: left;
/*  background-color: #CAFF70;*/
  padding: 0px 3px 0px 3px;
}

a, a:link, a:visited, a:active {
    text-decoration: none;
    border-bottom:  1px dotted #ccc;
    color: #4F7FC9; /* #0101EE; (bleu brillant), #5D9119; (vert)*/
}

a:hover	{
  text-decoration: underline;
  border-bottom: none;
}

dt, dd {
  margin-top: 5px;
  margin-bottom: 10px;
}

table {
  border-collapse: collapse;
}



td.title-section-left {
  border: 0px;
}

div.section {
  color: #315972;
  background-color: white;
  border: 0px;
}

div.title-section {
  border-top: 1px solid #7F98A7;
}

div.title-menu {
  border-top: 1px solid #7F98A7;
}

div.title-menu {
  color: #315972; background-color: white;
}

div#menu {
  border: 0px;
}

pre {
  border:1px dashed #315972;
  background-color: #F5F5F5;
}

h1 a:link, h1 a:hover, h1 a:visited, h2 a, h2 a:hover, h2 a:visited, a:link.fcolor, a:active.fcolor, a:visited.fcolor, a:hover.fcolor {
  color: #315972;
  border-bottom: none;
}

#top, #bottom {
  color: #315972;
}

</style><!--[if IE]> <style type="text/css">
#main {
  width: 60%;
}
</style> <![endif]--><!-- append this section verbatim -->





<style type="text/css">
tr, td {
  text-align: center;
  border: 1px solid black;
}
</style><!-- end verbatim --><title>pyinotify - filesystem monitoring in Python with inotify</title><!-- body --></head><body>

<a name="pagetop" id="pagetop"></a> <!-- top flag -->

<!-- top -->
<div id="top">
<h1>Pyinotify: monitor filesystem events with Python under Linux.</h1>
</div>
<!-- end top -->


<!-- sidebar -->
<div id="sidebar">

<!-- menu -->
<div id="menu">
<!-- menu title -->
<div class="title-menu">
<a name="Menu" id="Menu"></a>
<span id="menutitle">
<a href="http://seb.dbzteam.com/swp/bin/page.py?fun=rss&amp;farg=page_49918974774dc106c5fa9d7784af059c.xml" title="rss feed">  <img src="blue-feed.png" alt="rss feed" style="border: 0px none ; margin: 0px; padding: 0px;"> </a>
Table of Contents
</span>
</div>
<!-- end menu title -->

<!-- menu list -->
<div>
<ul id="menu-list">
<li>
<a href="#Description">
Description
</a>
</li>
<li>
<a href="#Download">
Download pyinotify
</a>
</li>
<li>
<a href="#Quick_start">
Quick start
</a>
</li>
<li>
<a href="#Documentation">
Documentation
</a>
</li>
<li>
<a href="#Namespace">
Namespace details
</a>
</li>
<li>
<a href="#Brief_Tutorial">
Brief Tutorial
</a>
</li>
<li>
<a href="#The_EventsCodes_Class">
The EventsCodes Class
</a>
</li>
<li>
<a href="#The_Event_Class">
The Event Class
</a>
</li>
<li>
<a href="#Subclassing_ProcessEvent">
Subclassing ProcessEvent
</a>
</li>
<li>
<a href="#The_Notifier_Class">
The Notifier Class
</a>
</li>
<li>
<a href="#The_ThreadedNotifier_Class">
The ThreadedNotifier Class
</a>
</li>
<li>
<a href="#The_Watch_Class">
The Watch Class
</a>
</li>
<li>
<a href="#The_WatchManager_Class">
The WatchManager Class
</a>
</li>
<li>
<a href="#Operations_on_WatchManager:_add_watch_update_watch_rm_watch">
WatchManager methods
</a>
</li>
<li>
<a href="#Verbose_Mode">
Verbose Mode
</a>
</li>
<li>
<a href="#Related_Readings">
Related Readings
</a>
</li>
</ul>
</div>
<!-- end menu list -->
</div>
<!-- end menu -->

<!-- side section content -->
<div id="sidesection">
</div>
<!-- end side section -->

</div>
<!-- end sidebar -->

<!-- main -->
<div id="main">

<div style="border: 3px dashed red; padding: 25px; margin: 15px 15px 90px 15px; font-family: sans-serif; font-size: 140%; text-align: center;">
<b>Pyinotify is now hosted at <a href="http://github.com/seb-m/pyinotify" title="New Pyinotify site">http://github.com/seb-m/pyinotify</a></b>.<br /><br /> New versions of Pyinotify are released at this new location.
</div>


<!-- sections -->

<!-- section 1 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Description" id="Description"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Description" class="fcolor">Description</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sun, 30 Dec 2007 21:13</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p><b>Pyinotify is a Python module for monitoring filesystems changes</b>. Pyinotify relies on a Linux Kernel feature (merged in kernel 2.6.13) called <a href="http://en.wikipedia.org/wiki/Inotify" title="inotify">inotify</a>. inotify is an event-driven notifier, its notifications are exported from kernel space to user space through three system calls. pyinotify binds these system calls and provides an implementation on top of them offering a generic and abstract way to manipulate those functionalities.</p>

</div>
<!-- end section content -->
</div>
<!-- end section 1 -->


<!-- section 2 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Download" id="Download"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Download" class="fcolor">Download</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Tue, 29 Jan 2008 02:43</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<div style="border: 2px dashed red; padding: 15px;">
<b><a href="http://github.com/seb-m/pyinotify" title="Pyinotify">Download the Current Version of Pyinotify on its new site (http://github.com/seb-m/pyinotify)</a></b>: this version is recommended for all recent systems i.e. Python 2.5 (or higher) it contains all the new developments.
</div>

<p><a href="http://downloads.sourceforge.net/pyinotify/pyinotify-0.7.1.tar.bz2" title="Pyinotify">Download Old Version 0.7.1 (deprecated)</a>: this version doesn't contains the lastest developments.
Indeed, it is the last version of Pyinotify that supports Python 2.3 and Python 2.4. The documentation below applies to this specific version (and only to this version).</p>
</div>
<!-- end section content -->
</div>
<!-- end section 2 -->


<!-- section 3 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Quick_start" id="Quick_start"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Quick_start" class="fcolor">Quick start</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sat, 06 May 2006 13:07</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>To familiarize yourself with pyinotify, run a first example like this:<br></p>

<pre>$ cd pyinotify-x-x-x &amp;&amp; python setup.py build
$ python src/pyinotify/pyinotify.py -v my-dir-to-watch
</pre>

<p>Where my-dir-to-watch is a path leading to a valid directory. Now
just go in this directory, play with files: read one, create
another,... and compare your actions with the output produced by
pyinotify. Enjoy, you have just been watching your first directory :).</p>

<p>Note: if you want to install pyinotify, just type:</p>
<pre>$ cd pyinotify-x-x-x &amp;&amp; python setup.py install
</pre>
<p>Read the README file to know where the files are installed.</p>
</div>
<!-- end section content -->
</div>
<!-- end section 3 -->


<!-- section 4 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Documentation" id="Documentation"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Documentation" class="fcolor">Documentation</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Tue, 29 Jan 2008 02:37</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Browse the generated documentation online, <a href="http://pyinotify.sourceforge.net/doc-v07/index.html" title="Documentation">versions 0.7.x</a> to view the whole class hierarchy.</p>
</div>
<!-- end section content -->
</div>
<!-- end section 4 -->


<!-- section 5 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Namespace" id="Namespace"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Namespace" class="fcolor">Namespace</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sun, 26 Nov 2006 10:47</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Let's introduce the python namespace through which pyinotify can be
accessed and which should help understanding its logic. pyinotify is
compounded of two modules which are named <span class="verbatim">inotify</span> and <span class="verbatim">pyinotify</span>:</p>

<ul>
<li>The namespace <span class="verbatim">inotify</span> is a simple raw wrap of inotify (wrapping 3 systems calls, and 3 variables available in <span class="verbatim">/proc/sys/</span>). You'd probably never have/want to directly import (use) this namespace unless you know what you're doing.</li>
<li>The namespace <span class="verbatim">pyinotify</span> exposes higher developments made on top of inotify and are the purposes of pyinotify.</li>
</ul>
</div>
<!-- end section content -->
</div>
<!-- end section 5 -->


<!-- section 6 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Brief_Tutorial" id="Brief_Tutorial"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Brief_Tutorial" class="fcolor">Brief Tutorial</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Mon, 28 Jan 2008 23:38</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Let's start a more detailed example. Say, we want to monitor the temp directory <span class="verbatim">'/tmp'</span>
and all its subdirectories for every new file's creation or deletion.
For sake of simplicity, we only print messages for every notification
on standart output.</p>

<p>Now you have the choice to either receive and process the
notifications in the thread who instantiate the monitoring, the main
benefit is that it doesn't need to instantiate a new thread, the
drawback is to block your program in this task. Or, you don't want to
block your main thread, so you can handle the notifications in a new
separate thread. Choose which one is the most adapted to your needs and
is consistent with your constraints and design choices. Next, we will
detail the two approaches:</p>

<center>
<table style="border: 1px solid black;">
<tbody><tr><td></td><td><span class="verbatim">Notifier</span></td><td><span class="verbatim">ThreadedNotifier</span></td></tr>
<tr><td>Current thread</td><td>Yes</td><td>No</td></tr>
<tr><td>Separate thread</td><td>No</td><td>Yes</td></tr>
</tbody></table>
</center>

<p>First the import statements: the <a href="#The_WatchManager_Class">watch manager</a> stores the <a href="#The_Watch_Class">watches</a> and provide operations on watches. <span class="verbatim">EventsCodes</span> bring a set of codes, each code is associated to an event. <span class="verbatim">ProcessEvent</span> is the processing class.</p>

<pre>import os
from pyinotify import WatchManager, Notifier, ThreadedNotifier, EventsCodes, ProcessEvent

wm = WatchManager()
</pre>

<p>The following class inherit from ProcessEvent, handle notifications
and process defined actions with individual processing methods whose the name is written with the specific syntax: <span class="verbatim">process_<i>EVENT_NAME</i></span> where <i>EVENT_NAME</i> is the name of the handled event to process.</p>

<pre>mask = EventsCodes.IN_DELETE | EventsCodes.IN_CREATE  # watched events

class PTmp(ProcessEvent):
    def process_IN_CREATE(self, event):
        print "Create: %s" %  os.path.join(event.path, event.name)

    def process_IN_DELETE(self, event):
        print "Remove: %s" %  os.path.join(event.path, event.name)
</pre>

<p>Next, we describe respectively the classes Notifier and ThreadedNotifier:</p>

<ul>
<li>Class <b>Notifier</b>:<br><br>
This statement instantiate our notifier class and realizes
initializations with in particular the inotify's instantiation. The
second parameter is a callable object the one which will be used to
process notified events this way: <span class="verbatim">PTmp()(<i>event</i>)</span> where <i>event</i> is the notified event.
<pre>notifier = Notifier(wm, PTmp())
</pre>
The next statement add a watch on the first parameter and recursively
on all its subdirectories, note that symlinks are not followed. The
recursion is due to the optional parameter named 'rec' set to True. By
default, the monitoring is limited to the level of the given directory.
It returns a dict where keys are paths and values are corresponding
watch descriptors (wd) and is assigned to wdd. An unique wd is
attributed to every new watch. It is useful (and often necessary) to
keep those wds for further updating or removing one of those watches,
see the <a href="#Operations_on_WatchManager:_add_watch_update_watch_rm_watch">dedicated section</a>. Obviously, if the monitored element had been a file, the rec parameter would have been ignored whatever its value.

<pre>wdd = wm.add_watch('/tmp', mask, rec=True)
</pre>
Let's start reading the events and processing them. Note that during
the loop we can freely add, update or remove any watches, we can also
do anything we want, even stuff unrelated to pyinotify. We call the
stop() method when we want stop monitoring.
<pre>while True:  # loop forever
    try:
        # process the queue of events as explained above
        notifier.process_events()
        if notifier.check_events():
            # read notified events and enqeue them
            notifier.read_events()
        # you can do some tasks here...
    except KeyboardInterrupt:
        # destroy the inotify's instance on this interrupt (stop monitoring)
        notifier.stop()
        break
</pre>
</li>

<li>Class <b>ThreadedNotifier</b>:<br><br>
The second line starts the new thread, doing actually nothing as no directory or file is being monitored.

<pre>notifier = ThreadedNotifier(wm, PTmp())
notifier.start()

wdd = wm.add_watch('/tmp', mask, rec=True)
</pre>

At any moment we can for example remove the watch on <span class="verbatim">'/tmp'</span> like that:
<pre>if wdd['/tmp'] &gt; 0:  # test if the wd is valid, this test is not mandatory
   wm.rm_watch(wdd['/tmp'])
</pre>

Note that its subdirectories (if any) are still being watched. If we wanted to remove <span class="verbatim">'/tmp'</span> and all the watches on its sudirectories, we could have done like that:

<pre>wm.rm_watch(wdd['/tmp'], rec=True)
</pre>

Or we would have even done better like that:

<pre>wm.rm_watch(wdd.values())
</pre>That is, most of the code is written, next, we can add, update or
remove watches on files or directories with the same principles. The
only remaining important task is to stop the thread when we wish stop
monitoring, it will automatically destroy the inotify's instance. Call
the following method:
<pre>notifier.stop()
</pre>
</li>
</ul>
</div>
<!-- end section content -->
</div>
<!-- end section 6 -->


<!-- section 20 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_EventsCodes_Class" id="The_EventsCodes_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_EventsCodes_Class" class="fcolor">The EventsCodes Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sun, 26 Nov 2006 10:53</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<center>
<table>

<tbody><tr><td>Event Name</td><td>Is an Event</td><td>Description</td></tr>
<tr><td>IN_ACCESS</td><td>Yes</td><td>file was accessed.</td></tr>
<tr><td>IN_ATTRIB</td><td>Yes</td><td>metadata changed.</td></tr>
<tr><td>IN_CLOSE_NOWRITE</td><td>Yes</td><td>unwrittable file was closed.</td></tr>
<tr><td>IN_CLOSE_WRITE</td><td>Yes</td><td>writtable file was closed.</td></tr>
<tr><td>IN_CREATE</td><td>Yes</td><td>file/dir was created in watched directory.</td></tr>
<tr><td>IN_DELETE</td><td>Yes</td><td>file/dir was deleted in watched directory.</td></tr>
<tr><td>IN_DELETE_SELF</td><td>Yes</td><td>watched item itself was deleted.</td></tr>
<tr><td>IN_DONT_FOLLOW</td><td>No</td><td>don't follow a symlink (lk 2.6.15).</td></tr>
<tr><td>IN_IGNORED</td><td>Yes</td><td>raised on watched item removing. Probably useless for you, prefer instead IN_DELETE*.</td></tr>
<tr><td>IN_ISDIR</td><td>No</td><td>event occurred against directory.
It is always piggybacked to an event. The Event structure automatically
provide this information (via .is_dir)</td></tr>
<tr><td>IN_MASK_ADD</td><td>No</td><td>to update a mask without overwriting the previous value (lk 2.6.14). Useful when updating a watch.</td></tr>
<tr><td>IN_MODIFY</td><td>Yes</td><td>file was modified.</td></tr>
<tr><td>IN_MOVE_SELF</td><td>Yes</td><td>watched item itself was moved,
currently its full pathname destination can only be traced if its
source directory and destination directory are both watched. Otherwise,
the file is still being watched but you cannot rely anymore on the
given path (.path)</td></tr>
<tr><td>IN_MOVED_FROM</td><td>Yes</td><td>file/dir in a watched dir was
moved from X. Can trace the full move of an item when IN_MOVED_TO is
available too, in this case if the moved item is itself watched, its
path will be updated (see IN_MOVE_SELF). </td></tr>
<tr><td>IN_MOVED_TO</td><td>Yes</td><td>file/dir was moved to Y in a watched dir (see IN_MOVE_FROM).</td></tr>
<tr><td>IN_ONLYDIR</td><td>No</td><td>only watch the path if it is a directory (lk 2.6.15). Usable when calling .add_watch.</td></tr>
<tr><td>IN_OPEN</td><td>Yes</td><td>file was opened.</td></tr>
<tr><td>IN_Q_OVERFLOW</td><td>Yes</td><td>event queued overflowed. This event doesn't belongs to any particular watch.</td></tr>
<tr><td>IN_UNMOUNT</td><td>Yes</td><td>backing fs was unmounted. Notified to all watches located on this fs.</td></tr>

</tbody></table>
</center>
</div>
<!-- end section content -->
</div>
<!-- end section 20 -->


<!-- section 8 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_Event_Class" id="The_Event_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_Event_Class" class="fcolor">The Event Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sun, 26 Nov 2006 10:58</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Each instance contains all the useful informations about <b>the observed event</b>.
However, the presence of each field depends on the type of event. In
effect, some fields are irrelevant for some kind of event (for example <span class="verbatim">cookie</span> is meaningless for <span class="verbatim">IN_CREATE</span> whereas it is useful to <span class="verbatim">IN_MOVE_TO</span>).</p>

<p>Each raised event will be dispatched to one appropriate <a href="#Subclassing_ProcessEvent">processing method</a> (according to its type), in which it can takes actions in response to this event. The possible fields are:</p>

<dl>
<dd><span class="verbatim">wd</span> (int): is the Watch Descriptor, it
is an unique identifier who represents the watched item through which
this event could be observed.</dd>
<dd><span class="verbatim">path</span> (str): is the complete path of the watched item as given in parameter to the method .add_watch.</dd>
<dd><span class="verbatim">name</span> (str): is not None only if the
watched item is a directory, and if the current event has occurred
against an element included in that directory.</dd>
<dd><span class="verbatim">mask</span> (int): is a bitmask of events, it carries all the types of events watched on wd.</dd>
<dd><span class="verbatim">event_name</span> (str): readable event name.</dd>
<dd><span class="verbatim">is_dir</span> (bool): is a boolean flag set to True if the event has occurred against a directory.</dd>
<dd><span class="verbatim">cookie</span> (int): is a unique identifier permitting to tie together two related 'moved to' and 'moved from' events.</dd>
</dl>
</div>
<!-- end section content -->
</div>
<!-- end section 8 -->


<!-- section 14 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Subclassing_ProcessEvent" id="Subclassing_ProcessEvent"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Subclassing_ProcessEvent" class="fcolor">Subclassing ProcessEvent</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sun, 26 Nov 2006 11:05</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>We can obtain our own handling and processing implementation by subclassing <span class="verbatim">ProcessEvent</span>, and defining appropriate methods. See the commented example below:</p>

<pre>class MyProcessing(ProcessEvent):
    def __init__(self):
        """
        Does nothing in this case, but you can as well implement this constructor
        and you don't need to explicitely call its base class constructor.
        """
        pass

    def process_IN_DELETE(event):
        """
        This method process a specific kind of event (IN_DELETE). event
        is an instance of Event.
        """
        print '%s: deleted' % os.path.join(event.path, event.name)

    def process_IN_CLOSE(event):
        """
        This method is called for these events: IN_CLOSE_WRITE,
        IN_CLOSE_NOWRITE.
        """
        print '%s: closed' % os.path.join(event.path, event.name)

    def process_default(event):
        """
        Ultimately, this method is called for all others kind of events.
        This method can be used when similar processing can be applied
        to various events.
        """
        print 'default processing'
</pre>

<p>Explanations and details:</p>

<ul>

<li><span class="verbatim">IN_DELETE</span> have its own method
providing a specific treatment. We associate an individual processing
method by providing a method whose the name is written with the
specific syntax: <span class="verbatim">process_<i>EVENT_NAME</i></span> where <i>EVENT_NAME</i>
is the name of the handled event to process. For the sake of
simplicity, our two methods are very basics they only print messages on
standart output:</li>

<li>There are related events which needs most of the time the same
treatment. It would be annoying to have to implement two times the same
code. In this case we can define a common method. For example we want
to share the same method for these two related events:
<pre>mask = EventsCodes.IN_CLOSE_WRITE | EventsCodes.IN_CLOSE_NOWRITE</pre>

Then it's enough to provide a single processing method named <span class="verbatim">process_IN_CLOSE</span> according to the general syntax <span class="verbatim">process_IN_<i>FAMILYBASENAME</i></span>. The two previous events will be processed by this method. In this case, beware to not implement <span class="verbatim">process_IN_CLOSE_WRITE</span> or <span class="verbatim">process_IN_CLOSE_NOWRITE</span>, because these methods have an higher precedence (see below), thereby are looked first and would have been called instead of <span class="verbatim">process_IN_CLOSE</span> (for a complete example see: <span class="verbatim">src/examples/close.py</span>).</li>

<li>It only makes sense to define <span class="verbatim">process_IN_Q_OVERFLOW</span>
when its class instance is given to Notifier, indeed it could never be
called from a processed object associated to a watch, because this
event isn't associated to any watch.</li>

<li><span class="verbatim">EventsCodes.ALL_EVENTS</span> isn't an event by itself, that means that you don't have to implement the method <span class="verbatim">process_ALL_EVENTS</span>
(even worst it would be wrong to define this method), this is just an
alias to tell the kernel we want to be notified for all kind of events
on a given watch. The kernel raises individual events (with the <span class="verbatim">IN_ISDIR</span> flag if necessary). Instead, if we need to apply the same actions whatever the kind of event, we should implement a <span class="verbatim">process_default</span> method (for a complete example see: <span class="verbatim">src/examples/simple.py</span>).</li>

<li>Processing methods lookup's order (ordered by increasing order of priority): specialized  method (ex: <span class="verbatim">process_IN_CLOSE_WRITE</span>) first, then family method (ex: <span class="verbatim">process_IN_CLOSE</span>), then default method (<span class="verbatim">process_default</span>).</li>

<li>One more thing: say you redifine the method <span class="verbatim">process_default</span>
which contains the instruction os.ismount(my-mount-point), it would be
for example a mistake having this method called for every event <span class="verbatim">IN_OPEN</span> occurred in <span class="verbatim">/etc</span>. Because, one particularity of os.ismount is to check in <span class="verbatim">/etc/mtab</span> if the partition is mounted, so we could easily imagine the kind of endless situation: call process_IN_OPEN, open <span class="verbatim">/etc/mtab</span>, call process_IN_OPEN, open <span class="verbatim">/etc/mtab</span> ... <i>loop forever</i>.
</li></ul>

<p>Whenever possible you should process your notifications this way,
with a single processing object. It is easy to imagine the benefits to
have to deal with only one instance (efficiency, data sharing,...):</p>

<pre>notifier = Notifier(wm, MyProcessing())
</pre>

<p>But, some watches might need a different kind of processing, you can
attach them an instance which will be called only on their associated
watch:</p>

<pre>mask = EventsCodes.ALL_EVENTS
wm.add_watch('/one/path', mask, proc_fun=MyProcessing())
</pre>
</div>
<!-- end section content -->
</div>
<!-- end section 14 -->


<!-- section 17 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_Notifier_Class" id="The_Notifier_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_Notifier_Class" class="fcolor">The Notifier Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sat, 06 May 2006 13:07</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<dl>

<dt><span class="verbatim">Notifier(watch_manager, default_proc_fun=ProcessEvent())</span></dt>
<dd>Read notifications, process events. </dd>
<dd><span class="verbatim">watch_manager</span> is an instance of <span class="verbatim">WatchManager</span>.</dd>
<dd><span class="verbatim">default_proc_fun</span> is an instance of <span class="verbatim">ProcessEvent</span> or one of its subclasses.</dd>

<dt><span class="verbatim">check_events(timeout=4) =&gt; None</span></dt>
<dd>Check for new events available to read.</dd>
<dd><span class="verbatim">timeout</span> (int): timeout passed on to select.select().</dd>

<dt><span class="verbatim">process_events() =&gt; None</span></dt>
<dd>Routine for processing events from queue by calling their associated processing function (instance of <span class="verbatim">ProcessEvent</span> or one of its subclasses).</dd>

<dt><span class="verbatim">read_events() =&gt; None</span></dt>
<dd>Read events from device and enqueue them, waiting to be processed.</dd>

<dt><span class="verbatim">stop() =&gt; None</span></dt>
<dd>Stop the notifications.</dd>

</dl>
</div>
<!-- end section content -->
</div>
<!-- end section 17 -->


<!-- section 19 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_ThreadedNotifier_Class" id="The_ThreadedNotifier_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_ThreadedNotifier_Class" class="fcolor">The ThreadedNotifier Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sat, 06 May 2006 13:07</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<dl>

<dt><span class="verbatim">ThreadedNotifier(watch_manager, default_proc_fun=ProcessEvent())</span></dt>
<dd>This notifier inherits from threading.Thread and from Notifier,
instantiating a separate thread, and providing standart Notifier
functionalities. This is a threaded version of Notifier.</dd>
<dd><span class="verbatim">watch_manager</span> is an instance of <span class="verbatim">WatchManager</span>.</dd>
<dd><span class="verbatim">default_proc_fun</span> is an instance of <span class="verbatim">ProcessEvent</span> or one of its subclasses.</dd>
<dd>inherits all the methods of Notifier but override the <span class="verbatim">stop()</span> method.</dd>

<dt><span class="verbatim">start() =&gt; None</span></dt>
<dd>Start the new thread, start events notifications.</dd>

<dt><span class="verbatim">stop() =&gt; None</span></dt>
<dd>Stop the thread, stop the notifications.</dd>

</dl>
</div>
<!-- end section content -->
</div>
<!-- end section 19 -->


<!-- section 15 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_Watch_Class" id="The_Watch_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_Watch_Class" class="fcolor">The Watch Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Fri, 24 Nov 2006 17:24</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<dl>

<dt><span class="verbatim">Watch(wd, path, mask, proc_fun, auto_add)</span></dt>
<dd>Represent a watch, i.e. a file or directory being watched.</dd>
<dd><span class="verbatim">wd</span> (int): Watch Descriptor.</dd>
<dd><span class="verbatim">path</span> (str): Path of the file or directory being watched.</dd>
<dd><span class="verbatim">mask</span> (int): Mask.</dd>
<dd><span class="verbatim">proc_fun</span> (ProcessEvent): Processing object.</dd>
<dd><span class="verbatim">auto_add</span> (bool): Automatically add watches on creation of directories.</dd>

</dl>
</div>
<!-- end section content -->
</div>
<!-- end section 15 -->


<!-- section 16 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="The_WatchManager_Class" id="The_WatchManager_Class"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#The_WatchManager_Class" class="fcolor">The WatchManager Class</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Fri, 24 Nov 2006 17:26</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<dl>

<dt><span class="verbatim">WatchManager()</span></dt>
<dd>The Watch Manager let the client add a new watch, store the active watches, and provide operations on these watches.</dd>

<dt><span class="verbatim">add_watch(path, mask, proc_fun=None, rec=False, auto_add=False) =&gt; dict</span></dt>
<dd>Add watch(s) on given path(s) with the specified mask.</dd>
<dd><span class="verbatim">path</span> (str or list of str): Path(s) to watch, the path can either be a file or a directory.</dd>
<dd><span class="verbatim">mask</span> (int): Bitmask of events.</dd>
<dd><span class="verbatim">proc_fun</span> (ProcessEvent): Processing
object (must be callable). Will be called if provided, otherwise,
notifier.default_proc_fun will be called.</dd>
<dd><span class="verbatim">rec</span> (bool): Recursively add watches on the given path and on all its subdirectories.</dd>
<dd><span class="verbatim">auto_add</span> (bool): Automatically add watches on newly created directories in the watch's path.</dd>

<dt><span class="verbatim">update_watch(wd, mask=None, proc_fun=None, rec=False, auto_add=False) =&gt; dict</span></dt>
<dd>Update existing watch(s). All these parameters are updatable.</dd>

<dt><span class="verbatim">rm_watch(wd, rec=False) =&gt; dict</span></dt>
<dd>Remove watch(s).</dd>

<dt><span class="verbatim">get_wd(path) =&gt; int</span></dt>
<dd>Return the watch descriptor associated to path.</dd>

<dt><span class="verbatim">get_path(wd) =&gt; str</span></dt>
<dd>Return the path associated to wd, if wd is invalid, None is returned.</dd>

</dl>
</div>
<!-- end section content -->
</div>
<!-- end section 16 -->


<!-- section 9 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Operations_on_WatchManager:_add_watch_update_watch_rm_watch" id="Operations_on_WatchManager:_add_watch_update_watch_rm_watch"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Operations_on_WatchManager:_add_watch_update_watch_rm_watch" class="fcolor">Operations on WatchManager: add_watch, update_watch, rm_watch</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Fri, 24 Nov 2006 17:26</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Question: among these methods, which one must be called with a string path and which ones with a watch descriptor?</p>

<p>This question should be fairly simple to answer, but it's worth
clarifying it once time for all, with a simple table. This table
specifies the kind of parameter accepted by each method:</p>




<table style="border-collapse: collapse; text-align: center; width: 99%;">
<tbody><tr>
 <td style="border-top: 1px solid white; border-left: 1px solid white; background-color: white;" width="10%"></td>
 <td width="15%">Parameter</td>
 <td width="35%">Returned result</td>
 <td width="40%">Example</td>
</tr>
<tr>
 <td width="10%">add_watch</td>
 <td width="15%">path (or list of paths)</td>
 <td width="35%">{path1: wd1, path2: wd2, ...}<br> Where wdx is the watch descriptor associated to pathx, and is positive on success. </td>
 <td width="40%">
 <p class="verbatim">
 ra = notifier.add_watch('/a-dir', mask)<br>
 if ra['/a-dir'] &gt; 0: print "added"
 </p>
 </td>
</tr>
<tr>
 <td width="10%">update_watch</td>
 <td width="15%">wd (or list of wds)</td>
 <td width="35%">{wd1: success, wd2: success, ...} <br>  Where success is True if the op on wdx succeeded, False otherwise.</td>
 <td width="40%">
 <p class="verbatim">
 ru = notifier.update_watch(ra['/a-dir'], new_mask)<br>
 if ru['/a-dir']: print "updated"
 </p>
 </td>
</tr>
<tr>
 <td width="10%">rm_watch</td>
 <td width="15%">wd (or list of wds)</td>
 <td width="35%">{wd1: success, wd2: success, ...}  <br>  Where success is True if the op on wdx succeeded, False otherwise.</td>
 <td width="40%">
 <p class="verbatim">
 rr = notifier.rm_watch(ra['/a-dir']) <br>
 if rr['/a-dir']: print "deleted"
 </p>
 </td>
</tr>
</tbody></table>

<p>The methods updating or removing a watch only take watch descriptors
and return a dictionary notifying the success or failure of operations.</p>

<p>In extreme case if your parameter doesn't fit the expected format,
which can happens if you lost previous returned values, you can use the
methods <span class="verbatim">get_wd(a_path)</span> and its counterpart <span class="verbatim">get_path(a_wd)</span>. The former takes a path and returns its wd, the latter takes a wd and returns its path. Caution: in worst case <span class="verbatim">get_wd(a_path)</span> will have to iterate the whole list of watches, thus the cost can be high. Whenever it is possible avoid this method. </p>
</div>
<!-- end section content -->
</div>
<!-- end section 9 -->


<!-- section 7 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Verbose_Mode" id="Verbose_Mode"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Verbose_Mode" class="fcolor">Verbose Mode</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Sat, 06 May 2006 13:07</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>For more detailed messages from pyinotify, turn-on the <span class="verbatim">VERBOSE</span> variable located in <span class="verbatim">src/pyinotify.py</span>.</p>
</div>
<!-- end section content -->
</div>
<!-- end section 7 -->


<!-- section 10 -->
<div class="section">
<!-- section title -->
<div class="title-section">
<a name="Related_Readings" id="Related_Readings"></a>
<table class="title-section">
<tbody><tr class="title-section">
<td class="title-section-left"><a href="#Related_Readings" class="fcolor">Related Readings</a></td>
<td class="title-section-right"><a href="#pagetop" class="fcolor">top</a></td>
</tr>
</tbody></table>
</div>
<!-- end section title -->

<!-- section infos (last modifications) -->
<div class="infos-section">Edited Thu, 11 May 2006 11:26</div>
<!-- end section infos -->

<!-- section content -->
<div class="content-section">
<p>Either as introduction to inotify or as means to dive into pyinotify, there are some interesting readings worth to be mentioned:</p>

<ul>
<li>Read this <a href="http://www.linuxjournal.com/article/8478">introduction</a> to inotify written by one of its author Robert Love.</li>
<li>Obviously, read the pyinotify's documentation as specified <a href="#Documentation">above</a>.</li>
<li>If you want to write code beyond the basic example, read the python files in the example directory <span class="verbatim">src/examples/*.py</span> and the tests in <span class="verbatim">src/tests/*.py</span> provided with pyinotify.</li>
<li>And finally, you can directly read parts of the <span class="verbatim">src/pyinotify/pyinotify.py</span> source code, its size is relatively short and readable (thanks to Python :) ).</li>
</ul>
</div>
<!-- end section content -->
</div>
<!-- end section 10 -->

<!-- end sections -->


<!-- bottom -->
<div id="bottom">
<b>-- seb |at| dbzteam |dot| org</b>
</div>
<!-- end bottom -->


</div>
<!-- end main -->

<!-- footer -->
<div id="footer"> </div>
<!-- end footer -->

<!-- end body -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-305478-1";
urchinTracker();
</script>
</body>
</html>
