<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<title>python实例32[简单的HttpServer] - iTech - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=RFWbSMVn474Meo5c6rKa1DH_M4ldFPuI9Jah-EA-L5Q1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/darkgreentrip/bundle-darkgreentrip.css?v=xPXJVC4GCITs1yYYgSeLkcicCxapqseaPVQLFGMO1wc1"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/itech/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/itech/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/itech/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'itech', cb_enable_mathjax=false;</script>
<script src="/bundles/blog-common.js?v=NRIlPIHMlVEgoqJZIuk9OQtjtZjNFcz_ov8kYhFFdoM1" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="http://www.cnblogs.com/itech/"><img id="blogLogo" src="/Skins/custom/images/logo.gif" alt="返回主页" /></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/itech/">iTech's Blog</a></h1>
<h2><font size="4" color=red><a href=http://ciandcd.com>www.ciandcd.com</a>：Continuous Integration and Continuous Delievery</font>
<br/>
<font size="4" color=red><a href=http://www.linux6.com>www.linux6.com</a>: linux cookbook</font>
<br/></h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="MyLinks1_HomeLink" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li><a id="MyLinks1_MyHomeLink" class="menu" href="http://www.cnblogs.com/itech/">首页</a></li>
<li><a id="MyLinks1_NewPostLink" class="menu" rel="nofollow" href="http://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li><a id="MyLinks1_ContactLink" class="menu" rel="nofollow" href="http://space.cnblogs.com/msg/send/iTech">联系</a></li>
<li><a id="MyLinks1_Syndication" class="menu" href="http://www.cnblogs.com/itech/rss">订阅</a>
<!--<a id="MyLinks1_XMLLink" class="aHeaderXML" href="http://www.cnblogs.com/itech/rss"><img src="http://www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="MyLinks1_Admin" class="menu" rel="nofollow" href="http://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			
<!--done-->
随笔- 599&nbsp;
文章- 70&nbsp;
评论- 318&nbsp;

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		

<!--done-->
<div id="topics">
	<div class = "post">
		<h1 class = "postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/itech/archive/2011/12/31/2308697.html">python实例32[简单的HttpServer]</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p>&nbsp;</p>
<p>通常地我们要在不同平台间共享文件，samba，ftp，cifs，ntfs的设置都是有点复杂的， 我们可以使用python提供的httpserver来提供基于http方式跨平台的文件共享。</p>
<p>&nbsp;</p>
<p>一 命令行启动简单的httpserver</p>
<p>进入到web或要共享文件的根目录，然后执行(貌似在python32中此module不存在了)：<br />python -m SimpleHTTPServer 8000<br /><br />然后你就可以使用<span style="background-color: #ffffff; color: #181818; font-family: Verdana, Arial, 微软雅黑, 华文黑体; font-size: 13px; line-height: 20px;">http://你的IP地址:8000/来访问web页面或共享文件了。</span></p>
<p><span style="line-height: 1.5;">&nbsp;</span></p>
<p>二 &nbsp;代码启动httpserver</p>
<p>simplehttpservertest.py&nbsp;&nbsp;</p>
<div class="cnblogs_code">
<div><span style="color: #0000ff;">import</span>&nbsp;sys<br /><span style="color: #0000ff;">import</span>&nbsp;locale<br /><span style="color: #0000ff;">import</span>&nbsp;http.server<br /><span style="color: #0000ff;">import</span>&nbsp;socketserver<br /><br />addr&nbsp;=&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;2&nbsp;<span style="color: #0000ff;">and</span>&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">localhost</span><span style="color: #800000;">"</span>&nbsp;<span style="color: #0000ff;">or</span>&nbsp;sys.argv[1]<br />port&nbsp;=&nbsp;len(sys.argv)&nbsp;&lt;&nbsp;3&nbsp;<span style="color: #0000ff;">and</span>&nbsp;80&nbsp;<span style="color: #0000ff;">or</span>&nbsp;locale.atoi(sys.argv[2])<br /><br />handler&nbsp;=&nbsp;http.server.SimpleHTTPRequestHandler<br />httpd&nbsp;=&nbsp;socketserver.TCPServer((addr,&nbsp;port),&nbsp;handler)<br /><span style="color: #0000ff;">print</span>&nbsp;(<span style="color: #800000;">"</span><span style="color: #800000;">HTTP&nbsp;server&nbsp;is&nbsp;at:&nbsp;http://%s:%d/</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;(addr,&nbsp;port))<br />httpd.serve_forever()</div>
</div>
<p>&nbsp;&nbsp;</p>
<p>需要进入web或要共享的目录，执行下列：&nbsp;</p>
<p>simplehttpservertest.py localhost 8008&nbsp;</p>
<p>&nbsp;</p>
<p>三 第三方的python库Droopy</p>
<p>且支持可以上传文件到共享服务器</p>
<div><a href="http://www.home.unix-ag.org/simon/woof">http://www.home.unix-ag.org/simon/woof</a></div>
<p><a href="http://stackp.online.fr/?p=28">http://stackp.online.fr/?p=28</a></p>
<p>&nbsp;</p>
<p>四 支持上传的httpserver</p>
<div class="cnblogs_code"><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env&nbsp;python</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">coding=utf-8</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;modifyDate:&nbsp;20120808&nbsp;~&nbsp;20120810</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;原作者为：bones7456,&nbsp;http://li2z.cn/</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;修改者为：decli@qq.com</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;v1.2，changeLog：</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;+:&nbsp;文件日期/时间/颜色显示、多线程支持、主页跳转</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;-:&nbsp;解决不同浏览器下上传文件名乱码问题：仅IE，其它浏览器暂时没处理。</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;-:&nbsp;一些路径显示的bug，主要是&nbsp;cgi.escape()&nbsp;转义问题</span><span style="color: #008000;"><br />#</span><span style="color: #008000;">&nbsp;?:&nbsp;notepad++&nbsp;下直接编译的server路径问题</span><span style="color: #008000;"><br /></span>&nbsp;<br /><span style="color: #800000;">"""</span><span style="color: #800000;"><br />&nbsp;&nbsp;&nbsp;&nbsp;简介：这是一个&nbsp;python&nbsp;写的轻量级的文件共享服务器（基于内置的SimpleHTTPServer模块），<br />&nbsp;&nbsp;&nbsp;&nbsp;支持文件上传下载，只要你安装了python（建议版本2.6~2.7，不支持3.x），<br />&nbsp;&nbsp;&nbsp;&nbsp;然后去到想要共享的目录下，执行：<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;python&nbsp;SimpleHTTPServerWithUpload.py&nbsp;1234&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;其中1234为你指定的端口号，如不写，默认为&nbsp;8080<br />&nbsp;&nbsp;&nbsp;&nbsp;然后访问&nbsp;http://localhost:1234&nbsp;即可，localhost&nbsp;或者&nbsp;1234&nbsp;请酌情替换。<br /></span><span style="color: #800000;">"""</span><br />&nbsp;<br /><span style="color: #800000;">"""</span><span style="color: #800000;">Simple&nbsp;HTTP&nbsp;Server&nbsp;With&nbsp;Upload.<br />&nbsp;<br />This&nbsp;module&nbsp;builds&nbsp;on&nbsp;BaseHTTPServer&nbsp;by&nbsp;implementing&nbsp;the&nbsp;standard&nbsp;GET<br />and&nbsp;HEAD&nbsp;requests&nbsp;in&nbsp;a&nbsp;fairly&nbsp;straightforward&nbsp;manner.<br />&nbsp;<br /></span><span style="color: #800000;">"""</span><br />&nbsp;<br />&nbsp;<br /><span style="color: #800080;">__version__</span>&nbsp;=&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">0.1</span><span style="color: #800000;">"</span><br /><span style="color: #800080;">__all__</span>&nbsp;=&nbsp;[<span style="color: #800000;">"</span><span style="color: #800000;">SimpleHTTPRequestHandler</span><span style="color: #800000;">"</span>]<br /><span style="color: #800080;">__author__</span>&nbsp;=&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">bones7456</span><span style="color: #800000;">"</span><br /><span style="color: #800080;">__home_page__</span>&nbsp;=&nbsp;<span style="color: #800000;">""</span><br />&nbsp;<br /><span style="color: #0000ff;">import</span>&nbsp;os,&nbsp;sys,&nbsp;platform<br /><span style="color: #0000ff;">import</span>&nbsp;posixpath<br /><span style="color: #0000ff;">import</span>&nbsp;BaseHTTPServer<br /><span style="color: #0000ff;">from</span>&nbsp;SocketServer&nbsp;<span style="color: #0000ff;">import</span>&nbsp;ThreadingMixIn<br /><span style="color: #0000ff;">import</span>&nbsp;threading<br /><span style="color: #0000ff;">import</span>&nbsp;urllib<br /><span style="color: #0000ff;">import</span>&nbsp;cgi<br /><span style="color: #0000ff;">import</span>&nbsp;shutil<br /><span style="color: #0000ff;">import</span>&nbsp;mimetypes<br /><span style="color: #0000ff;">import</span>&nbsp;re<br /><span style="color: #0000ff;">import</span>&nbsp;time<br />&nbsp;<br />&nbsp;<br /><span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">from</span>&nbsp;cStringIO&nbsp;<span style="color: #0000ff;">import</span>&nbsp;StringIO<br /><span style="color: #0000ff;">except</span>&nbsp;ImportError:<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">from</span>&nbsp;StringIO&nbsp;<span style="color: #0000ff;">import</span>&nbsp;StringIO<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;<br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">""</span><br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">-----------------------------------------------------------------------&gt;&gt;&nbsp;</span><span style="color: #800000;">'</span><br /><span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;port&nbsp;=&nbsp;int(sys.argv[1])<br /><span style="color: #0000ff;">except</span>&nbsp;Exception,&nbsp;e:<br />&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">--------&gt;&gt;&nbsp;Warning:&nbsp;Port&nbsp;is&nbsp;not&nbsp;given,&nbsp;will&nbsp;use&nbsp;deafult&nbsp;port:&nbsp;8080&nbsp;</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">--------&gt;&gt;&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;other&nbsp;port,&nbsp;please&nbsp;execute:&nbsp;</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">--------&gt;&gt;&nbsp;python&nbsp;SimpleHTTPServerWithUpload.py&nbsp;port&nbsp;</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">--------&gt;&gt;&nbsp;port&nbsp;is&nbsp;a&nbsp;integer&nbsp;and&nbsp;it's&nbsp;range:&nbsp;1024&nbsp;&lt;&nbsp;port&nbsp;&lt;&nbsp;65535&nbsp;</span><span style="color: #800000;">"</span><br />&nbsp;&nbsp;&nbsp;port&nbsp;=&nbsp;8080<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color: #0000ff;">if</span>&nbsp;<span style="color: #0000ff;">not</span>&nbsp;1024&nbsp;&lt;&nbsp;port&nbsp;&lt;&nbsp;65535:&nbsp;&nbsp;port&nbsp;=&nbsp;8080<br />serveraddr&nbsp;=&nbsp;(<span style="color: #800000;">''</span>,&nbsp;port)<br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">--------&gt;&gt;&nbsp;Now,&nbsp;listening&nbsp;at&nbsp;port&nbsp;</span><span style="color: #800000;">'</span>&nbsp;+&nbsp;str(port)&nbsp;+&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">&nbsp;...</span><span style="color: #800000;">'</span><br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">--------&gt;&gt;&nbsp;You&nbsp;can&nbsp;visit&nbsp;the&nbsp;URL:&nbsp;&nbsp;&nbsp;http://localhost:</span><span style="color: #800000;">'</span>&nbsp;+&nbsp;str(port)<br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">-----------------------------------------------------------------------&gt;&gt;&nbsp;</span><span style="color: #800000;">'</span><br /><span style="color: #0000ff;">print</span>&nbsp;<span style="color: #800000;">""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;<br /><span style="color: #0000ff;">def</span>&nbsp;sizeof_fmt(num):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">for</span>&nbsp;x&nbsp;<span style="color: #0000ff;">in</span>&nbsp;[<span style="color: #800000;">'</span><span style="color: #800000;">bytes</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">KB</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">MB</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">GB</span><span style="color: #800000;">'</span>]:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;num&nbsp;&lt;&nbsp;1024.0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">%3.1f%s</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;(num,&nbsp;x)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num&nbsp;/=&nbsp;1024.0<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">%3.1f%s</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;(num,&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">TB</span><span style="color: #800000;">'</span>)<br />&nbsp;<br /><span style="color: #0000ff;">def</span>&nbsp;modification_date(filename):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;t&nbsp;=&nbsp;os.path.getmtime(filename)</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;return&nbsp;datetime.datetime.fromtimestamp(t)</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;time.strftime(<span style="color: #800000;">"</span><span style="color: #800000;">%Y-%m-%d&nbsp;%H:%M:%S</span><span style="color: #800000;">"</span>,time.localtime(os.path.getmtime(filename)))<br />&nbsp;<br /><span style="color: #0000ff;">class</span>&nbsp;SimpleHTTPRequestHandler(BaseHTTPServer.BaseHTTPRequestHandler):<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Simple&nbsp;HTTP&nbsp;request&nbsp;handler&nbsp;with&nbsp;GET/HEAD/POST&nbsp;commands.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;serves&nbsp;files&nbsp;from&nbsp;the&nbsp;current&nbsp;directory&nbsp;and&nbsp;any&nbsp;of&nbsp;its<br />&nbsp;&nbsp;&nbsp;&nbsp;subdirectories.&nbsp;&nbsp;The&nbsp;MIME&nbsp;type&nbsp;for&nbsp;files&nbsp;is&nbsp;determined&nbsp;by<br />&nbsp;&nbsp;&nbsp;&nbsp;calling&nbsp;the&nbsp;.guess_type()&nbsp;method.&nbsp;And&nbsp;can&nbsp;reveive&nbsp;file&nbsp;uploaded<br />&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;client.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;GET/HEAD/POST&nbsp;requests&nbsp;are&nbsp;identical&nbsp;except&nbsp;that&nbsp;the&nbsp;HEAD<br />&nbsp;&nbsp;&nbsp;&nbsp;request&nbsp;omits&nbsp;the&nbsp;actual&nbsp;contents&nbsp;of&nbsp;the&nbsp;file.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;server_version&nbsp;=&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">SimpleHTTPWithUpload/</span><span style="color: #800000;">"</span>&nbsp;+&nbsp;<span style="color: #800080;">__version__</span><br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;do_GET(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Serve&nbsp;a&nbsp;GET&nbsp;request.</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;print&nbsp;"....................",&nbsp;threading.currentThread().getName()</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;self.send_head()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.copyfile(f,&nbsp;self.wfile)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;do_HEAD(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Serve&nbsp;a&nbsp;HEAD&nbsp;request.</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;self.send_head()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;do_POST(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Serve&nbsp;a&nbsp;POST&nbsp;request.</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r,&nbsp;info&nbsp;=&nbsp;self.deal_post_data()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">print</span>&nbsp;r,&nbsp;info,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">by:&nbsp;</span><span style="color: #800000;">"</span>,&nbsp;self.client_address<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;StringIO()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">'</span><span style="color: #800000;">&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;"-//W3C//DTD&nbsp;HTML&nbsp;3.2&nbsp;Final//EN"&gt;</span><span style="color: #800000;">'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;html&gt;\n&lt;title&gt;Upload&nbsp;Result&nbsp;Page&lt;/title&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;body&gt;\n&lt;h2&gt;Upload&nbsp;Result&nbsp;Page&lt;/h2&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;hr&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;r:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;strong&gt;Success:&lt;/strong&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;strong&gt;Failed:&lt;/strong&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(info)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;br&gt;&lt;a&nbsp;href=\"%s\"&gt;back&lt;/a&gt;</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;self.headers[<span style="color: #800000;">'</span><span style="color: #800000;">referer</span><span style="color: #800000;">'</span>])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;hr&gt;&lt;small&gt;Powered&nbsp;By:&nbsp;bones7456,&nbsp;check&nbsp;new&nbsp;version&nbsp;at&nbsp;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a&nbsp;href=\"http://li2z.cn/?s=SimpleHTTPServerWithUpload\"&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">here&lt;/a&gt;.&lt;/small&gt;&lt;/body&gt;\n&lt;/html&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;f.tell()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.seek(0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_response(200)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-type</span><span style="color: #800000;">"</span>,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">text/html</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-Length</span><span style="color: #800000;">"</span>,&nbsp;str(length))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.end_headers()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;f:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.copyfile(f,&nbsp;self.wfile)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;deal_post_data(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boundary&nbsp;=&nbsp;self.headers.plisttext.split(<span style="color: #800000;">"</span><span style="color: #800000;">=</span><span style="color: #800000;">"</span>)[1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;=&nbsp;int(self.headers[<span style="color: #800000;">'</span><span style="color: #800000;">content-length</span><span style="color: #800000;">'</span>])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;<span style="color: #0000ff;">not</span>&nbsp;boundary&nbsp;<span style="color: #0000ff;">in</span>&nbsp;line:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(False,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">Content&nbsp;NOT&nbsp;begin&nbsp;with&nbsp;boundary</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn&nbsp;=&nbsp;re.findall(r<span style="color: #800000;">'</span><span style="color: #800000;">Content-Disposition.*name="file";&nbsp;filename="(.*)"</span><span style="color: #800000;">'</span>,&nbsp;line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;<span style="color: #0000ff;">not</span>&nbsp;fn:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(False,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">Can't&nbsp;find&nbsp;out&nbsp;file&nbsp;name...</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;self.translate_path(self.path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;osType&nbsp;=&nbsp;platform.system()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;osType&nbsp;==&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">Linux</span><span style="color: #800000;">"</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn&nbsp;=&nbsp;os.path.join(path,&nbsp;fn[0].decode(<span style="color: #800000;">'</span><span style="color: #800000;">gbk</span><span style="color: #800000;">'</span>).encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span>))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn&nbsp;=&nbsp;os.path.join(path,&nbsp;fn[0])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">except</span>&nbsp;Exception,&nbsp;e:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(False,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">文件名请不要用中文，或者使用IE上传中文名的文件。</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">while</span>&nbsp;os.path.exists(fn):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn&nbsp;+=&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">_</span><span style="color: #800000;">"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out&nbsp;=&nbsp;open(fn,&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">wb</span><span style="color: #800000;">'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">except</span>&nbsp;IOError:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(False,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">Can't&nbsp;create&nbsp;file&nbsp;to&nbsp;write,&nbsp;do&nbsp;you&nbsp;have&nbsp;permission&nbsp;to&nbsp;write?</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preline&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(preline)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">while</span>&nbsp;remainbytes&nbsp;&gt;&nbsp;0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;self.rfile.readline()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remainbytes&nbsp;-=&nbsp;len(line)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;boundary&nbsp;<span style="color: #0000ff;">in</span>&nbsp;line:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preline&nbsp;=&nbsp;preline[0:-1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;preline.endswith(<span style="color: #800000;">'</span><span style="color: #800000;">\r</span><span style="color: #800000;">'</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preline&nbsp;=&nbsp;preline[0:-1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(preline)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(True,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">File&nbsp;'%s'&nbsp;upload&nbsp;success!</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;fn)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(preline)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preline&nbsp;=&nbsp;line<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;(False,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">Unexpect&nbsp;Ends&nbsp;of&nbsp;data.</span><span style="color: #800000;">"</span>)<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;send_head(self):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Common&nbsp;code&nbsp;for&nbsp;GET&nbsp;and&nbsp;HEAD&nbsp;commands.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;sends&nbsp;the&nbsp;response&nbsp;code&nbsp;and&nbsp;MIME&nbsp;headers.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;value&nbsp;is&nbsp;either&nbsp;a&nbsp;file&nbsp;object&nbsp;(which&nbsp;has&nbsp;to&nbsp;be&nbsp;copied<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;outputfile&nbsp;by&nbsp;the&nbsp;caller&nbsp;unless&nbsp;the&nbsp;command&nbsp;was&nbsp;HEAD,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;must&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;caller&nbsp;under&nbsp;all&nbsp;circumstances),&nbsp;or<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;None,&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;caller&nbsp;has&nbsp;nothing&nbsp;further&nbsp;to&nbsp;do.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;self.translate_path(self.path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;None<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;os.path.isdir(path):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;<span style="color: #0000ff;">not</span>&nbsp;self.path.endswith(<span style="color: #800000;">'</span><span style="color: #800000;">/</span><span style="color: #800000;">'</span>):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;redirect&nbsp;browser&nbsp;-&nbsp;doing&nbsp;basically&nbsp;what&nbsp;apache&nbsp;does</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_response(301)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Location</span><span style="color: #800000;">"</span>,&nbsp;self.path&nbsp;+&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.end_headers()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;None<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">for</span>&nbsp;index&nbsp;<span style="color: #0000ff;">in</span>&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">index.html</span><span style="color: #800000;">"</span>,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">index.htm</span><span style="color: #800000;">"</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;os.path.join(path,&nbsp;index)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;os.path.exists(index):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;index<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">break</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;self.list_directory(path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctype&nbsp;=&nbsp;self.guess_type(path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;Always&nbsp;read&nbsp;in&nbsp;binary&nbsp;mode.&nbsp;Opening&nbsp;files&nbsp;in&nbsp;text&nbsp;mode&nbsp;may&nbsp;cause</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;newline&nbsp;translations,&nbsp;making&nbsp;the&nbsp;actual&nbsp;size&nbsp;of&nbsp;the&nbsp;content</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;transmitted&nbsp;*less*&nbsp;than&nbsp;the&nbsp;content-length!</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;open(path,&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">rb</span><span style="color: #800000;">'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">except</span>&nbsp;IOError:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_error(404,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">File&nbsp;not&nbsp;found</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;None<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_response(200)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-type</span><span style="color: #800000;">"</span>,&nbsp;ctype)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fs&nbsp;=&nbsp;os.fstat(f.fileno())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-Length</span><span style="color: #800000;">"</span>,&nbsp;str(fs[6]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Last-Modified</span><span style="color: #800000;">"</span>,&nbsp;self.date_time_string(fs.st_mtime))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.end_headers()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;f<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;list_directory(self,&nbsp;path):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Helper&nbsp;to&nbsp;produce&nbsp;a&nbsp;directory&nbsp;listing&nbsp;(absent&nbsp;index.html).<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;value&nbsp;is&nbsp;either&nbsp;a&nbsp;file&nbsp;object,&nbsp;or&nbsp;None&nbsp;(indicating&nbsp;an<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error).&nbsp;&nbsp;In&nbsp;either&nbsp;case,&nbsp;the&nbsp;headers&nbsp;are&nbsp;sent,&nbsp;making&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interface&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;send_head().<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">try</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&nbsp;=&nbsp;os.listdir(path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">except</span>&nbsp;os.error:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_error(404,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">No&nbsp;permission&nbsp;to&nbsp;list&nbsp;directory</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;None<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.sort(key=<span style="color: #0000ff;">lambda</span>&nbsp;a:&nbsp;a.lower())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;=&nbsp;StringIO()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displaypath&nbsp;=&nbsp;cgi.escape(urllib.unquote(self.path))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">'</span><span style="color: #800000;">&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;"-//W3C//DTD&nbsp;HTML&nbsp;3.2&nbsp;Final//EN"&gt;</span><span style="color: #800000;">'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;html&gt;\n&lt;title&gt;Directory&nbsp;listing&nbsp;for&nbsp;%s&lt;/title&gt;\n</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;displaypath)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;body&gt;\n&lt;h2&gt;Directory&nbsp;listing&nbsp;for&nbsp;%s&lt;/h2&gt;\n</span><span style="color: #800000;">"</span>&nbsp;%&nbsp;displaypath)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;hr&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;form&nbsp;ENCTYPE=\"multipart/form-data\"&nbsp;method=\"post\"&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;input&nbsp;name=\"file\"&nbsp;type=\"file\"/&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;input&nbsp;type=\"submit\"&nbsp;value=\"upload\"/&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;input&nbsp;type=\"button\"&nbsp;value=\"HomePage\"&nbsp;onClick=\"location='/'\"&gt;</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;/form&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;hr&gt;\n&lt;ul&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">for</span>&nbsp;name&nbsp;<span style="color: #0000ff;">in</span>&nbsp;list:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullname&nbsp;=&nbsp;os.path.join(path,&nbsp;name)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorName&nbsp;=&nbsp;displayname&nbsp;=&nbsp;linkname&nbsp;=&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;Append&nbsp;/&nbsp;for&nbsp;directories&nbsp;or&nbsp;@&nbsp;for&nbsp;symbolic&nbsp;links</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;os.path.isdir(fullname):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorName&nbsp;=&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">&lt;span&nbsp;style="background-color:&nbsp;#CEFFCE;"&gt;</span><span style="color: #800000;">'</span>&nbsp;+&nbsp;name&nbsp;+&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">/&lt;/span&gt;</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displayname&nbsp;=&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linkname&nbsp;=&nbsp;name&nbsp;+&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;os.path.islink(fullname):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorName&nbsp;=&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">&lt;span&nbsp;style="background-color:&nbsp;#FFBFFF;"&gt;</span><span style="color: #800000;">'</span>&nbsp;+&nbsp;name&nbsp;+&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">@&lt;/span&gt;</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displayname&nbsp;=&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;Note:&nbsp;a&nbsp;link&nbsp;to&nbsp;a&nbsp;directory&nbsp;displays&nbsp;with&nbsp;@&nbsp;and&nbsp;links&nbsp;with&nbsp;/</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;=&nbsp;os.getcwd()&nbsp;+&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">/</span><span style="color: #800000;">'</span>&nbsp;+&nbsp;displaypath&nbsp;+&nbsp;displayname<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">'</span><span style="color: #800000;">&lt;table&gt;&lt;tr&gt;&lt;td&nbsp;width="60%%"&gt;&lt;a&nbsp;href="%s"&gt;%s&lt;/a&gt;&lt;/td&gt;&lt;td&nbsp;width="20%%"&gt;%s&lt;/td&gt;&lt;td&nbsp;width="20%%"&gt;%s&lt;/td&gt;&lt;/tr&gt;\n</span><span style="color: #800000;">'</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;(urllib.quote(linkname),&nbsp;colorName,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof_fmt(os.path.getsize(filename)),&nbsp;modification_date(filename)))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(<span style="color: #800000;">"</span><span style="color: #800000;">&lt;/table&gt;\n&lt;hr&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;f.tell()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.seek(0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_response(200)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-type</span><span style="color: #800000;">"</span>,&nbsp;<span style="color: #800000;">"</span><span style="color: #800000;">text/html</span><span style="color: #800000;">"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.send_header(<span style="color: #800000;">"</span><span style="color: #800000;">Content-Length</span><span style="color: #800000;">"</span>,&nbsp;str(length))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.end_headers()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;f<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;translate_path(self,&nbsp;path):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Translate&nbsp;a&nbsp;/-separated&nbsp;PATH&nbsp;to&nbsp;the&nbsp;local&nbsp;filename&nbsp;syntax.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Components&nbsp;that&nbsp;mean&nbsp;special&nbsp;things&nbsp;to&nbsp;the&nbsp;local&nbsp;file&nbsp;system<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.&nbsp;drive&nbsp;or&nbsp;directory&nbsp;names)&nbsp;are&nbsp;ignored.&nbsp;&nbsp;(XXX&nbsp;They&nbsp;should<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;probably&nbsp;be&nbsp;diagnosed.)<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;abandon&nbsp;query&nbsp;parameters</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;path.split(<span style="color: #800000;">'</span><span style="color: #800000;">?</span><span style="color: #800000;">'</span>,1)[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;path.split(<span style="color: #800000;">'</span><span style="color: #800000;">#</span><span style="color: #800000;">'</span>,1)[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;posixpath.normpath(urllib.unquote(path))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;words&nbsp;=&nbsp;path.split(<span style="color: #800000;">'</span><span style="color: #800000;">/</span><span style="color: #800000;">'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;words&nbsp;=&nbsp;filter(None,&nbsp;words)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;os.getcwd()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">for</span>&nbsp;word&nbsp;<span style="color: #0000ff;">in</span>&nbsp;words:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drive,&nbsp;word&nbsp;=&nbsp;os.path.splitdrive(word)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head,&nbsp;word&nbsp;=&nbsp;os.path.split(word)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;word&nbsp;<span style="color: #0000ff;">in</span>&nbsp;(os.curdir,&nbsp;os.pardir):&nbsp;<span style="color: #0000ff;">continue</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;os.path.join(path,&nbsp;word)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;path<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;copyfile(self,&nbsp;source,&nbsp;outputfile):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Copy&nbsp;all&nbsp;data&nbsp;between&nbsp;two&nbsp;file&nbsp;objects.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;SOURCE&nbsp;argument&nbsp;is&nbsp;a&nbsp;file&nbsp;object&nbsp;open&nbsp;for&nbsp;reading<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(or&nbsp;anything&nbsp;with&nbsp;a&nbsp;read()&nbsp;method)&nbsp;and&nbsp;the&nbsp;DESTINATION<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;argument&nbsp;is&nbsp;a&nbsp;file&nbsp;object&nbsp;open&nbsp;for&nbsp;writing&nbsp;(or<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anything&nbsp;with&nbsp;a&nbsp;write()&nbsp;method).<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;only&nbsp;reason&nbsp;for&nbsp;overriding&nbsp;this&nbsp;would&nbsp;be&nbsp;to&nbsp;change<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;block&nbsp;size&nbsp;or&nbsp;perhaps&nbsp;to&nbsp;replace&nbsp;newlines&nbsp;by&nbsp;CRLF<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;note&nbsp;however&nbsp;that&nbsp;this&nbsp;the&nbsp;default&nbsp;server&nbsp;uses&nbsp;this<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;copy&nbsp;binary&nbsp;data&nbsp;as&nbsp;well.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutil.copyfileobj(source,&nbsp;outputfile)<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">def</span>&nbsp;guess_type(self,&nbsp;path):<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">"""</span><span style="color: #800000;">Guess&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;file.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Argument&nbsp;is&nbsp;a&nbsp;PATH&nbsp;(a&nbsp;filename).<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;value&nbsp;is&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;type/subtype,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usable&nbsp;for&nbsp;a&nbsp;MIME&nbsp;Content-type&nbsp;header.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;default&nbsp;implementation&nbsp;looks&nbsp;the&nbsp;file's&nbsp;extension<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up&nbsp;in&nbsp;the&nbsp;table&nbsp;self.extensions_map,&nbsp;using&nbsp;application/octet-stream<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;a&nbsp;default;&nbsp;however&nbsp;it&nbsp;would&nbsp;be&nbsp;permissible&nbsp;(if<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slow)&nbsp;to&nbsp;look&nbsp;inside&nbsp;the&nbsp;data&nbsp;to&nbsp;make&nbsp;a&nbsp;better&nbsp;guess.<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"""</span><br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base,&nbsp;ext&nbsp;=&nbsp;posixpath.splitext(path)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;ext&nbsp;<span style="color: #0000ff;">in</span>&nbsp;self.extensions_map:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;self.extensions_map[ext]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext&nbsp;=&nbsp;ext.lower()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;ext&nbsp;<span style="color: #0000ff;">in</span>&nbsp;self.extensions_map:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;self.extensions_map[ext]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span>&nbsp;self.extensions_map[<span style="color: #800000;">''</span>]<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span>&nbsp;<span style="color: #0000ff;">not</span>&nbsp;mimetypes.inited:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mimetypes.init()&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;try&nbsp;to&nbsp;read&nbsp;system&nbsp;mime.types</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;extensions_map&nbsp;=&nbsp;mimetypes.types_map.copy()<br />&nbsp;&nbsp;&nbsp;&nbsp;extensions_map.update({<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">''</span>:&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">application/octet-stream</span><span style="color: #800000;">'</span>,&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;Default</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">.py</span><span style="color: #800000;">'</span>:&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">text/plain</span><span style="color: #800000;">'</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">.c</span><span style="color: #800000;">'</span>:&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">text/plain</span><span style="color: #800000;">'</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">.h</span><span style="color: #800000;">'</span>:&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">text/plain</span><span style="color: #800000;">'</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br />&nbsp;<br /><span style="color: #0000ff;">class</span>&nbsp;ThreadingServer(ThreadingMixIn,&nbsp;BaseHTTPServer.HTTPServer):<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">pass</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style="color: #0000ff;">def</span>&nbsp;test(HandlerClass&nbsp;=&nbsp;SimpleHTTPRequestHandler,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerClass&nbsp;=&nbsp;BaseHTTPServer.HTTPServer):<br />&nbsp;&nbsp;&nbsp;&nbsp;BaseHTTPServer.test(HandlerClass,&nbsp;ServerClass)<br />&nbsp;<br /><span style="color: #0000ff;">if</span>&nbsp;<span style="color: #800080;">__name__</span>&nbsp;==&nbsp;<span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span>:<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;test()</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">单线程</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">&nbsp;srvr&nbsp;=&nbsp;BaseHTTPServer.HTTPServer(serveraddr,&nbsp;SimpleHTTPRequestHandler)</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000;">#</span><span style="color: #008000;">多线程</span><span style="color: #008000;"><br /></span>&nbsp;&nbsp;&nbsp;&nbsp;srvr&nbsp;=&nbsp;ThreadingServer(serveraddr,&nbsp;SimpleHTTPRequestHandler)<br /><span style="font-family: verdana, 'courier new'; font-size: 14px; line-height: 21px;">&nbsp; &nbsp; &nbsp; &nbsp;srvr.serve_forever()</span>&nbsp;&nbsp;<br />&nbsp; &nbsp; &nbsp;</div>
<p>&nbsp;</p>
<p>五 本地的httpserver</p>
<p>在本地机器没有联网的时候，需要使用如下：来自<a href="http://coolshell.cn/articles/1480.html">http://coolshell.cn/articles/1480.html</a></p>
<p>&nbsp;如果你只想让这个HTTP服务器服务于本地环境，那么，你需要定制一下你的Python的程序，下面是一个示例：</p>
<div>
<div id="highlighter_69401" class="syntaxhighlighter  python ">
<table style="height: 287px; width: 1306px;" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">sys</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">import</code> <code class="python plain">BaseHTTPServer</code></div>
<div class="line number3 index2 alt2"><code class="python keyword">from</code> <code class="python plain">SimpleHTTPServer </code><code class="python keyword">import</code> <code class="python plain">SimpleHTTPRequestHandler</code></div>
<div class="line number4 index3 alt1"><code class="python plain">HandlerClass </code><code class="python keyword">=</code> <code class="python plain">SimpleHTTPRequestHandler</code></div>
<div class="line number5 index4 alt2"><code class="python plain">ServerClass&nbsp; </code><code class="python keyword">=</code> <code class="python plain">BaseHTTPServer.HTTPServer</code></div>
<div class="line number6 index5 alt1"><code class="python plain">Protocol&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">=</code> <code class="python string">"HTTP/1.0"</code></div>
<div class="line number7 index6 alt2">&nbsp;</div>
<div class="line number8 index7 alt1"><code class="python keyword">if</code> <code class="python plain">sys.argv[</code><code class="python value">1</code><code class="python plain">:]:</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">port </code><code class="python keyword">=</code> <code class="python functions">int</code><code class="python plain">(sys.argv[</code><code class="python value">1</code><code class="python plain">])</code></div>
<div class="line number10 index9 alt1"><code class="python keyword">else</code><code class="python plain">:</code></div>
<div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">port </code><code class="python keyword">=</code> <code class="python value">8000</code></div>
<div class="line number12 index11 alt1"><code class="python plain">server_address </code><code class="python keyword">=</code> <code class="python plain">(</code><code class="python string">'127.0.0.1'</code><code class="python plain">, port)</code></div>
<div class="line number13 index12 alt2">&nbsp;</div>
<div class="line number14 index13 alt1"><code class="python plain">HandlerClass.protocol_version </code><code class="python keyword">=</code> <code class="python plain">Protocol</code></div>
<div class="line number15 index14 alt2"><code class="python plain">httpd </code><code class="python keyword">=</code> <code class="python plain">ServerClass(server_address, HandlerClass)</code></div>
<div class="line number16 index15 alt1">&nbsp;</div>
<div class="line number17 index16 alt2"><code class="python plain">sa </code><code class="python keyword">=</code> <code class="python plain">httpd.socket.getsockname()</code></div>
<div class="line number18 index17 alt1"><code class="python keyword">print</code> <code class="python string">"Serving HTTP on"</code><code class="python plain">, sa[</code><code class="python value">0</code><code class="python plain">], </code><code class="python string">"port"</code><code class="python plain">, sa[</code><code class="python value">1</code><code class="python plain">], </code><code class="python string">"..."</code></div>
<div class="line number19 index18 alt2"><code class="python plain">httpd.serve_forever()</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>&nbsp;</p>
<p>来自：<a href="http://my.oschina.net/leejun2005/blog/71444">http://my.oschina.net/leejun2005/blog/71444</a>&nbsp;<br />&nbsp;</p>
<p>&nbsp;</p>
<p>完！&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class = "postDesc">posted @ <span id="post-date">2011-12-31 14:03</span> <a href='http://www.cnblogs.com/itech/'>iTech</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href ="http://i.cnblogs.com/EditPosts.aspx?postid=2308697" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(2308697);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=50245,cb_entryId=2308697,cb_blogApp=currentBlogApp,cb_blogUserGuid='caee16b0-1cf5-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2011/12/31 14:03:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
<a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="开发者的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="opt_under_post"></div>
<script type="text/javascript">
    var enableGoogleAd = canShowAdsense(); var googletag = googletag || {}; googletag.cmd = googletag.cmd || [];
    fixPostBodyFormat();
</script>
<div id="ad_under_post_holder">
<script type='text/javascript'>
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    (function () {
        if (enableGoogleAd) {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        }
    })();
</script>
<script type='text/javascript'>
    try {
        if (enableGoogleAd) {
            googletag.cmd.push(function () {
                googletag.defineSlot('/1090369/cnblogs_blogpost_C1_sitehome', [300, 250], 'div-gpt-ad-1346480159711-0').addService(googletag.pubads());
                googletag.defineSlot('/1090369/cnblogs_blogpost_C2', [468, 60], 'div-gpt-ad-1410860226396-0').addService(googletag.pubads());
                googletag.pubads().enableSingleRequest();
                googletag.enableServices();
            });
        };
    } catch (e) { }
</script>
<div id="google_ad_c1" class="c_ad_block">
    <div id='div-gpt-ad-1346480159711-0' style='width:300px; height:250px;'>
    <script type='text/javascript'>
        try {
            if (enableGoogleAd) {
                googletag.cmd.push(function () { googletag.display('div-gpt-ad-1346480159711-0'); });            
            } else {
                $('#div-gpt-ad-1346480159711-0').hide();
            }
    } catch (e) { }
    </script>
    </div>
</div>
</div>
<div id="under_post_news"></div>
<div id="google_ad_c2" class="c_ad_block">
<div id='div-gpt-ad-1410860226396-0' style='width:468px; height:60px;'>
<script type='text/javascript'>
try {
    if (enableGoogleAd) {
        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1410860226396-0'); });
    } else {
        $('#div-gpt-ad-1346480159711-0').hide();
    }
} catch (e) { }
</script>
</div>
</div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    setTimeout(function () { incrementViewCount(cb_entryId); }, 200);
});
</script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright &copy;2015 iTech
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->
<!-- JiaThis Button BEGIN -->
<script type="text/javascript" src="http://v2.jiathis.com/code/jiathis_r.js?type=left&amp;btn=l8.gif" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!--PageEndHtml Block End-->
</body>
</html>
