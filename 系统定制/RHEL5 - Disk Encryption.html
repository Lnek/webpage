<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-hant" xml:lang="zh-hant" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>RHEL5 - Disk Encryption | BenJr.tw Quality Assurance LAB</title>
<meta http-equiv="X-UA-Compatible" content="IE=8" />

<link rel="shortcut icon" href="/files/zeropoint_favicon.png" type="image/x-icon" />
<meta name="description" content="&nbsp;" />
<!--[if lte IE 6]>
<script type="text/javascript" src="/themes/zeropoint/js/suckerfish.js"></script>
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/css/ie6.css" />
<![endif]-->
<!--[if IE 7]>
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/css/ie7.css" />
<![endif]-->
<link type="text/css" rel="stylesheet" media="all" href="/modules/book/book.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/ctools/css/ctools.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/fckeditor/fckeditor.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/node/node.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/system/defaults.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/system/system.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/system/system-menus.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/user/user.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/panels/css/panels.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/views/css/views.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/addtoany/addtoany.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/css/style-zero.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/css/sky.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/_custom/custom-style.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/modules/comment/comment.css?C" />
<link type="text/css" rel="stylesheet" media="all" href="/themes/zeropoint/css/round.css?C" />
<link type="text/css" rel="stylesheet" media="print" href="/themes/zeropoint/css/print.css?C" />
<script type="text/javascript" src="/misc/jquery.js?C"></script>
<script type="text/javascript" src="/misc/drupal.js?C"></script>
<script type="text/javascript" src="/files/languages/zh-hant_17adef01cbcab5c0c4c4a777f9504383.js?C"></script>
<script type="text/javascript" src="/modules/panels/js/panels.js?C"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/" });
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var a2a_config=a2a_config||{},da2a={done:false,html_done:false,script_ready:false,script_load:function(){var a=document.createElement('script'),s=document.getElementsByTagName('script')[0];a.type='text/javascript';a.async=true;a.src='http://static.addtoany.com/menu/page.js';s.parentNode.insertBefore(a,s);da2a.script_load=function(){};},script_onready:function(){da2a.script_ready=true;if(da2a.html_done)da2a.init();},init:function(){for(var i=0,el,target,targets=da2a.targets,length=targets.length;i<length;i++){el=document.getElementById('da2a_'+(i+1));target=targets[i];a2a_config.linkname=target.title;a2a_config.linkurl=target.url;if(el)a2a.init('page',{target:el});da2a.done=true;}}};a2a_config.tracking_callback=['ready',da2a.script_onready];&nbsp;
//--><!]]>
</script>
<script type="text/javascript"> </script>
</head>

<body class="layout-main not-admin not-logged-in not-front full-node node-type-blog nid-564 tag-8 tag-43 section-node page-node-564 layout-fluid m-eq sfish bicons48 picons lg-zh-hant">
<div id="skip-nav"><a href="#main">Skip to Content</a></div>

<div id="top_bg" class="page">
<div class="sizer">
<div id="topex" class="expander0">
<div id="top_left">
<div id="top_right">
<div id="headimg">

<div id="above" class="clearfix">
  </div>

<div id="header" class="clearfix">
  <div id="logo">
      </div> <!-- /logo -->
  <div id="top-elements">
		  <div id="toplinks"></div>
	  </div><!-- /top-elements -->
  <div id="name-and-slogan">
      </div> <!-- /name-and-slogan -->

<div class="brclear"></div>

  <!-- block --> 
<div class="block-wrapper odd block_1">
  <div id="block-block-25" class="block block-block ">
        <div class="content"><table>
<tbody>
<tr>
<td rowspan="2"><span style="font-size : 36pt"><span style="font-family: 'victorian LET'; ">
<div class="rteleft"><a href="http://benjr.tw">BenJr.tw Quality Assurance LAB </a></div>
<p>            </p></span></span></td>
<td>
<div class="rteright">
<form action="http://www.google.com.tw/cse" id="cse-search-box" target="_blank">
<div><input type="hidden" name="cx" value="partner-pub-0291628883410848:cs7ti2-wbbd" />     <input type="hidden" name="ie" value="UTF-8" />     <input type="text" name="q" size="28" />     <input type="submit" name="sa" value="搜尋" /></div>
</form>
<script type="text/javascript" src="http://www.google.com.tw/cse/brand?form=cse-search-box&amp;lang=zh-Hant"></script></div>
</td>
</tr>
<tr>
<td>
<div class="rteright">
<form action="http://www.google.com/translate_p" style="margin:0;padding:0;" target="_top">
<script language="javascript" type="text/javascript">
var myLocation = location.href;
var loc = myLocation.split("http://");
var locID = loc.length;
var myurl = "http://"+loc[locID-1];
document.write ('<input value="'+myurl+'" name="u" type="hidden" />');
</script><p><noscript><input value="" name="u" type="hidden" /></noscript>  <input value="zh-TW" name="hl" type="hidden" />    <input value="UTF8" name="ie" type="hidden" /> <input value="" name="langpair" type="hidden" />   <input src="/files/images/googleap/Taiwan.png" value="zh-CN|zh-TW" name="langpair" title="正體中文/Chinese Traditional" onclick="this.form.langpair.value=this.value" align="bottom" type="image" />                    <input src="/files/images/googleap/China.png" value="zh-TW|zh-CN" name="langpair" title="简体中文/Chinese Simplified" onclick="this.form.langpair.value=this.value" align="bottom" type="image" />                    <input src="/files/images/googleap/USA.png" value="zh-TW|en" name="langpair" title="English" onclick="this.form.langpair.value=this.value" align="bottom" type="image" />                    <input src="/files/images/googleap/Japan.png" value="zh-TW|ja" name="langpair" title="日本語/Japan" onclick="this.form.langpair.value=this.value" align="bottom" type="image" />                    <input src="/files/images/googleap/Korea.png" value="zh-TW|ko" name="langpair" title="한국어/Korea" onclick="this.form.langpair.value=this.value" align="bottom" type="image" /><br />
            </p></form>
</div>
</td>
</tr>
</tbody>
</table>
</div>
  </div>
</div>
<!-- /block --> 
<div id="navlinks" class="navleft"><ul class="menu"><li class="leaf first"><a href="/blog/1" title="">Blog</a></li>
<li class="leaf"><a href="/node/503" title="">Drupal</a></li>
<li class="leaf"><a href="/node/507" title="">Linux</a></li>
<li class="leaf"><a href="/node/517" title="">Virtualization</a></li>
<li class="leaf"><a href="/node/37" title="">X Window</a></li>
<li class="leaf"><a href="/node/95" title="">NAS / SAN</a></li>
<li class="leaf"><a href="/node/552" title="">QA</a></li>
<li class="leaf"><a href="/taxonomy/term/64" title="">Android</a></li>
<li class="leaf last"><a href="/taxonomy/term/63" title="">Bible</a></li>
</ul></div>
</div> <!-- /header -->

</div>
</div><!-- /top_right -->
</div><!-- /top_left -->
</div><!-- /expander0 -->
</div><!-- /sizer -->
</div><!-- /top_bg -->

<div id="body_bg" class="page">
<div class="sizer">
<div class="expander0">
<div id="body_left">
<div id="body_right">

  <div class="navleft"></div>

  <div id="breadcrumb">
    <div class="breadcrumb"><a href="/">首頁</a> &raquo; <a href="/blog">部落格</a> &raquo; <a href="/blog/1">sunchiahome&#039;s blog</a> &raquo; RHEL5 - Disk Encryption</div>  </div>

  <div id="section1">
  <table class="sections" cellspacing="0" cellpadding="0">
    <tr>
    <td class="section u1"><!-- block --> 
<div class="block-wrapper odd block_1">
  <div id="block-block-21" class="block block-block ">
        <div class="content"><script type="text/javascript"><!--
google_ad_client = "ca-pub-0291628883410848";
/* 728x90, 已建立 2008/10/6 */
google_ad_slot = "4613703470";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
  </div>
</div>
<!-- /block --> </td>                </tr>
  </table>
  </div>  <!-- /section1 -->

<div id="middlecontainer">
  <div id="wrapper">
    <div class="outer">
      <div class="float-wrap">
        <div class="colmain">
          <div id="main">
                                    <h1 class="title">RHEL5 - Disk Encryption</h1>
            <div class="tabs"><ul class="tabs primary">
<li class="active" ><a href="/node/564" class="active">檢視</a></li>
<li ><a href="/node/564/backlinks">What links here</a></li>
</ul>
</div>
                                    <!-- node --> 
<div id="node-564" class="node odd full-node node-type-blog">
        
  
  <div class="meta">
        <div class="submitted">週五, 03/05/2010 - 20:06 &#151; sunchiahome</div>
      </div>

    <div class="terms">
    <ul class="taxonomy"><li class="vocab-term"><a href="/taxonomy/term/43" rel="tag" title="">rhel5</a> | </li><li class="vocab-term"><a href="/taxonomy/term/8" rel="tag" title="">file</a></li></ul>  </div>
  
  
  <div class="content">
    <p>從 RHEL(Red Hat Enterprise Linux) 5.3 安裝作業系統在做切割 partition 時你會發現多出一個可以勾選 &quot;Encrypt system&quot; &nbsp;的選項.而&nbsp;Encrypt system 主要的功能就是將我們的 root(/) 做加密的動作, 但是 /boot 是無法做加密的.系統必須先載入核心才能使用 Encrypt system 的功能 encrypt system 功能屬於 device mapper 的子模組.LUKS (Linux Unified Key Setup)主要是針對 block device 做加密(LUKS 採用了AES 高级加密标准 Advanced Encryption Standard 的方式來加密,加密請參考&nbsp;<a href="http://zh.wikipedia.org/zh-tw/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">http://zh.wikipedia.org/zh-tw/高级加密标准</a>&nbsp;),所以除了一般的磁區外像是LVM physical volumes, LVM logical volumes, 以及 software RAID arrays&nbsp;都可以使用 LUKS 做加密的動作.</p>
<div class="rtecenter"><img width="750" height="568" alt="" src="/files/images/encrypt/encrypt01.png" /></div>
<ul>
<li>LUKS 主要針對了
<ul>
<li>LUKS 適合用來保護可移動裝置像是 USB 硬碟或是 DiskonKey 之類的裝置.</li>
<li>LUKS 主要針對了 Block device 所以像是 swap , LVM 都適合使用.</li>
<li>LUKS 採用了加強式的密碼,以避免字典式的攻擊.</li>
<li>LUKS 可以同時設定多指令碼.</li>
</ul>
</li>
<li>但是 LUKS 也不是萬能
<ul>
<li>像是 LUKS 無法讓超過 8 隻鑰匙.</li>
<li>LUKS 無法針對檔案作加解密.</li>
</ul>
</li>
</ul>
<p>LUKS 採用 kernel device mapper 下的 dm-crypt 子模組所完成,我們可以透過系統提供的 #cryptsetup 工具來針對 block device 做加解密的動作.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]#</strong><strong>&nbsp;</strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>lsmod |grep -i dm</strong></span><br />
            <span style="color: rgb(0, 0, 0); ">dm_multipath &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 56152 &nbsp;0&nbsp;<br />
            scsi_dh &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;41665 &nbsp;1 dm_multipath<br />
            dm_raid45 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;99401 &nbsp;0&nbsp;<br />
            dm_message &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 36289 &nbsp;1 dm_raid45<br />
            dm_region_hash &nbsp; &nbsp; &nbsp; &nbsp; 46273 &nbsp;1 dm_raid45<br />
            dm_mem_cache &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 39489 &nbsp;1 dm_raid45<br />
            <strong>dm_crypt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 46665 &nbsp;1&nbsp;</strong><br />
            dm_snapshot &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;52105 &nbsp;0&nbsp;<br />
            dm_zero &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;35265 &nbsp;0&nbsp;<br />
            dm_mirror &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;54737 &nbsp;0&nbsp;<br />
            dm_log &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 44993 &nbsp;4 dm_log_clustered,dm_raid45,dm_region_hash,dm_mirror</span><br />
            <span style="color: rgb(153, 51, 0); "><strong>dm_mod &nbsp; &nbsp;</strong></span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: rgb(0, 0, 0); ">&nbsp;101521 &nbsp;15 dm_log_clustered,dm_multipath,dm_raid45,</span><span style="color: rgb(153, 51, 0); "><strong>dm_crypt</strong></span></font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">,dm_snapshot,dm_zero,dm_mirror,dm_log</font></span></td>
</tr>
</tbody>
</table>
<p>LUKS (Linux Unified Key Setup) 是針對整個硬碟磁區做加密.採用的加密方式為 &nbsp;dm-crypt 而工具則是 cryptsetup.如果在安裝時選擇 &quot;Encrypt system&quot; 一開始就需要設定 LUKS 密碼,密碼最短需要 8 碼.</p>
<div class="rtecenter" style="text-align: center; "><img width="750" height="569" alt="" src="/files/images/encrypt/encrypt02.png" /></div>
<p>為什麼要採用 LUKS,其實 Linux 有個很嚴重的安全缺失,就是 rescue 模式,通常我們只要從光碟開機並使用 rescue 模式開進系統,不用密碼就可以直接讀取 Linux 下所有的檔案.所以在這一部份 RHEL 採用的 LUKS (Linux Unified Key Setup) 將 Linux root (/) 磁區 partition 作加密不管使用者是從一般模式開啟系統,</p>
<div class="rtecenter"><img width="713" height="370" alt="" src="/files/images/encrypt/encrypt03.png" /></div>
<p>或是由 rescue 模式進入系統都必須輸入一組帳號密碼才能開啟系統.</p>
<div class="rtecenter"><img width="743" height="423" alt="" src="/files/images/encrypt/encrypt05.png" /></div>
<p>剛剛是在安裝時就選擇 LUKS 的磁區,安裝後需要使用到 LUKS(Linux Unified Key Setup) 時,設定步驟如下:</p>
<ul>
<li>第一步使用 cryptsetup luksFormat 建立加密的磁區</li>
<li>手動設定使用 cryptsetup luksOpen (重新開機就無效)</li>
<li>可將必要的磁區加入 /etc/crypttab (下次重新開機也有效）</li>
<li>LUKS 磁區加入 /etc/fstab</li>
</ul>
<p>
使用 cryptsetup luksFormat 建立加密的磁區</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]#</strong><strong> </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>cryptsetup luksFormat /dev/sdb1</strong></span><br />
            &nbsp;<br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">WARNING!<br />
            ========<br />
            This will overwrite data on /dev/sdb1 irrevocably.<br />
            &nbsp;<br />
            Are you sure? (Type uppercase yes): YES<br />
            Enter LUKS passphrase:<br />
            Verify passphrase:<br />
            Command successful.</font></span></td>
</tr>
</tbody>
</table>
<p>如要使用 LUKS 的磁區其所有的資料都會被清空.在建立好的 LUKS 磁區可以透過 cryptsetup luksDump 查看關於 LUKS 與磁區的資訊.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>cryptsetup luksDump /dev/sdb1</strong></span><br />
            <span style="color: rgb(0, 0, 0); ">LUKS header information for /dev/sdb1<br />
            &nbsp;<br />
            Version: &nbsp; &nbsp; &nbsp; &nbsp;1<br />
            Cipher name: &nbsp; &nbsp;aes<br />
            Cipher mode: &nbsp; &nbsp;cbc-essiv:sha256<br />
            Hash spec: &nbsp; &nbsp; &nbsp;sha1<br />
            Payload offset: 1032<br />
            MK bits: &nbsp; &nbsp; &nbsp; &nbsp;128<br />
            MK digest: &nbsp; &nbsp; &nbsp;cb 4e 23 2c ea 04 f4 34 dd 06 25 29 b0 24 be 65 a7 b2 3c 08<br />
            MK salt: &nbsp; &nbsp; &nbsp; &nbsp;a7 ff f3 ce 5f a5 42 69 06 19 ea 57 36 44 26 0c<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7b 11 3e d8 44 ba 96 c1 9b c6 04 3d 53 4d 2a 13<br />
            MK iterations: &nbsp;10<br />
            UUID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a708db3d-5db8-4db0-8f4a-fde5d0a5a8ea</span><br />
            &nbsp;<br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">Key Slot 0: ENABLED<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Iterations: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 481919<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Salt: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4e 58 ed a5 ac e9 89 a5 44 21 3c 46 e2 aa c0 3d<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ee 49 a0 5f d0 19 0f f7 76 ca c5 fa 23 3d c3 2d<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Key material offset: &nbsp; &nbsp;8<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;AF stripes: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4000<br />
            Key Slot 1: DISABLED<br />
            Key Slot 2: DISABLED<br />
            Key Slot 3: DISABLED<br />
            Key Slot 4: DISABLED<br />
            Key Slot 5: DISABLED<br />
            Key Slot 6: DISABLED<br />
            Key Slot 7: DISABLED</font></span></td>
</tr>
</tbody>
</table>
<p>如果只是要檢查磁區是否為 LUKS,透過 cryptsetup isLuks 就可以檢查,如果沒回傳任何東西就代表他是使用了 LUKS 的磁區.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>cryptsetup isLuks /dev/sdc1</strong></span><br />
            <span style="color: rgb(0, 0, 0); ">/dev/sdc1 is not a LUKS partition</span><br />
            <span style="color: rgb(0, 0, 0); "><strong>[root@benjr ~]# </strong></span><span style="color: rgb(255, 0, 0); "><strong>cryptsetup isLuks /dev/sdb1</strong></span></font></td>
</tr>
</tbody>
</table>
<p>當磁區使用 LUKS 加密之後就無法透過一般的方式去做存取,包括了要掛載之類的動作.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>mount /dev/sdb1 /mnt</strong></span><br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">mount: unknown filesystem type 'crypt_LUKS'</font></span></td>
</tr>
</tbody>
</table>
<p>我們必須先將此磁區做命名,透過指令 &nbsp;cryptsetup luksOpen &nbsp;將你原先的磁區命名為你想要的名稱,這邊開始就需要輸入 LUKS 的密碼.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]#</strong></font></span><font size="4" face="Arial"><strong> </strong><span style="color: rgb(255, 0, 0); "><strong>cryptsetup luksOpen /dev/sdb1 sharedata</strong></span><br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">Enter LUKS passphrase for /dev/sdb1:<br />
            key slot 0 unlocked.<br />
            Command successful.</font></span></td>
</tr>
</tbody>
</table>
<p>命好名稱之後還可以透過 dmsetup info 來觀察.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>dmsetup info sharedata</strong></span><br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">Name: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sharedata<br />
            State: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACTIVE<br />
            Read Ahead: &nbsp; &nbsp; &nbsp; &nbsp;256<br />
            Tables present: &nbsp; &nbsp;LIVE<br />
            Open count: &nbsp; &nbsp; &nbsp; &nbsp;0<br />
            Event number: &nbsp; &nbsp; &nbsp;0<br />
            Major, minor: &nbsp; &nbsp; &nbsp;253, 3<br />
            Number of targets: 1</font></span></td>
</tr>
</tbody>
</table>
<p>因為是使用了 LUKS 的方式加密所以做格式化時也需要透過我們剛剛所命名的名稱來做指定.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>mke2fs /dev/mapper/sharedata</strong></span><br />
            <span style="color: rgb(0, 0, 0); ">mke2fs 1.39 (29-May-2006)<br />
            Filesystem label=<br />
            OS type: Linux<br />
            Block size=4096 (log=2)<br />
            Fragment size=4096 (log=2)<br />
            8962048 inodes, 17920378 blocks<br />
            896018 blocks (5.00%) reserved for the super user<br />
            First data block=0<br />
            Maximum filesystem blocks=4294967296<br />
            547 block groups<br />
            32768 blocks per group, 32768 fragments per group<br />
            16384 inodes per group<br />
            Superblock backups stored on blocks:<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,<br />
            &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;4096000, 7962624, 11239424</span><br />
            &nbsp;<br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">Writing inode tables: done<br />
            Writing superblocks and filesystem accounting information: done<br />
            &nbsp;<br />
            This filesystem will be automatically checked every 28 mounts or<br />
            180 days, whichever comes first. &nbsp;Use tune2fs -c or -i to override.</font></span></td>
</tr>
</tbody>
</table>
<p>剛剛是第一種方式但是重新開機後必須重覆這些動作最好的方式將 LUKS 記錄在 /etc/crypttab 檔案中.不過第一件事我們必須知道這個磁區的 UUID 為何透過 cryptsetup luksUUID 可以知道.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>cryptsetup luksUUID /dev/sdb1</strong></span><br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">a708db3d-5db8-4db0-8f4a-fde5d0a5a8ea</font></span></td>
</tr>
</tbody>
</table>
<p>將這裝置的 UUID 以下面的格式寫在 /etc/crypttab 下次重新開機就可以透過 UUID 裝置直接做存儲.</p>
<table style="border: 2px dotted ;background-color: rgb(192, 192, 192);" cellpadding="10">
<tbody>
<tr>
<td><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial"><strong>[root@benjr ~]# </strong></font></span><font size="4" face="Arial"><span style="color: rgb(255, 0, 0); "><strong>vi &nbsp;/etc/crypttab</strong></span><br />
            </font><span style="color: rgb(0, 0, 0); "><font size="4" face="Arial">luks-a708db3d-5db8-4db0-8f4a-fde5d0a5a8ea UUID=a708db3d-5db8-4db0-8f4a-fde5d0a5a8ea none</font></span></td>
</tr>
</tbody>
</table>
<p>格式必須使用 <strong>&lt;name&gt; UUID=&lt;UUID&gt; none </strong>其中的 name 為自訂.下次在開機時就必須輸入密碼存能存取該磁區.一樣要使用該磁區指定為 /dev/mapper/luks-a708db3d-5db8-4db0-8f4a-fde5d0a5a8ea .&nbsp;如要加入到 /etc/fstab 一樣是指定 /dev/mapper/&lt;name&gt;&nbsp;</p>
<p>關於詳細 LUKS1 的資料請參考<br />
<a href="http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5.4/pdf/Installation_Guide.pdf"> http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5.4/pdf/Installation_Guide.pdf</a>&nbsp;&nbsp; &quot;Chapter 29. Disk Encryption Guide&quot;<br />
LUKS 的官方網站<br />
<a href="http://code.google.com/p/cryptsetup/"> http://code.google.com/p/cryptsetup/</a></p>
  </div>

    <div class="links">
    <ul class="links inline"><li class="addtoany first"><span>
		<a class="da2a_button" href="http://www.addtoany.com/share_save?linkurl=http%3A%2F%2Fbenjr.tw%2Fnode%2F564&amp;linkname=RHEL5%20-%20Disk%20Encryption" id="da2a_1"><img src="/modules/addtoany/images/share_save_256_24.png" width="256" height="24" alt="Share this"/></a>
		<script type="text/javascript">
<!--//--><![CDATA[//><!--
da2a.script_load();
//--><!]]>
</script>
		</span></li>
<li class="blog_usernames_blog"><a href="/blog/1" title="Read sunchiahome&#039;s latest blog entries.">sunchiahome&#039;s blog</a></li>
<li class="comment_add"><a href="/comment/reply/564#comment-form" title="針對本文章分享你的的想法和觀點。">增加新的回應</a></li>
<li class="statistics_counter last"><span>瀏覽次數 1868</span></li>
</ul>  </div>
  
  </div>
<!-- /node-564 -->                                   </div>
        </div> <!-- /colmain -->
                <br class="brclear" />
      </div> <!-- /float-wrap -->
            <br class="brclear" />
    </div><!-- /outer -->
  </div><!-- /wrapper -->
</div>

<div id="bar"></div>

  <div id="section2">
  <table class="sections" cellspacing="0" cellpadding="0">
    <tr>
                <td class="section u8 "><!-- block --> 
<div class="block-wrapper odd block_1">
  <div id="block-views-backlinks-block" class="block block-views ">
              <h2 class="title">What links here</h2>
          <div class="content"><div class="view view-backlinks view-style-overridden view-id-backlinks view-display-id-block">
    
  
  
      <div class="view-empty">
      <p>No backlinks found.</p>
    </div>
  
  
  
  
  
  
</div> </div>
  </div>
</div>
<!-- /block --> </td>    </tr>
  </table>
  </div>  <!-- /section2 -->

<ul class="links" id="navlist2"><li class="menu-70 first"><a href="/blog/1" title="">Blog</a></li>
<li class="menu-72"><a href="/node/503" title="">Drupal</a></li>
<li class="menu-76"><a href="/node/507" title="">Linux</a></li>
<li class="menu-69"><a href="/node/517" title="">Virtualization</a></li>
<li class="menu-860"><a href="/node/37" title="">X Window</a></li>
<li class="menu-60"><a href="/node/95" title="">NAS / SAN</a></li>
<li class="menu-839"><a href="/node/552" title="">QA</a></li>
<li class="menu-841"><a href="/taxonomy/term/64" title="">Android</a></li>
<li class="menu-840 last"><a href="/taxonomy/term/63" title="">Bible</a></li>
</ul>
</div><!-- /body_right -->
</div><!-- /body_left -->
</div><!-- /expander0 -->
</div><!-- /sizer -->
</div><!-- /body_bg -->

<div class="eopage">
<div id="bottom_bg" class="page">
<div class="sizer">
<div class="expander0">
<div id="bottom_left">
<div id="bottom_right">

<div id="footer-wrapper" class="clearfix">
  <div id="footer">
    <div id="below"><!-- block --> 
<div class="block-wrapper odd block_1">
  <div id="block-block-6" class="block block-block ">
        <div class="content"><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5735476-2");
pageTracker._trackPageview();
</script></div>
  </div>
</div>
<!-- /block --> </div>    <div class="legal">
      Copyright &copy; 2012 <a href="/"></a>. &nbsp;      <div id="brand"></div>
    </div>
  </div>
</div> <!-- /footer-wrapper -->

<div id="belowme">
</div>

</div><!-- /bottom_right -->
</div><!-- /bottom_left -->
</div><!-- /expander0 -->
</div><!-- /sizer -->
</div><!-- /page -->
</div>

<script type="text/javascript">
<!--//--><![CDATA[//><!--
da2a.targets=[
{title:'RHEL5 - Disk Encryption',url:'http://benjr.tw/node/564'}];
da2a.html_done=true;if(da2a.script_ready&&!da2a.done)da2a.init();da2a.script_load();
//--><!]]>
</script>
<div class="page"><div class="sizer"><div class="expander0"><div class="by"><a href="http://www.radut.net">Theme by Dr. Radut</a>.</div></div></div></div></body>
</html>
