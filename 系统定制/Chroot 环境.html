<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    cn:handbook:chroot    [SliTaz Doc]
  </title>
  <meta name="generator" content="DokuWiki" />
<meta name="robots" content="index,follow" />
<meta name="date" content="2010-07-08T17:14:40+0200" />
<meta name="keywords" content="cn,handbook,chroot" />
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="SliTaz Doc" />
<link rel="start" href="/" />
<link rel="contents" href="/cn:handbook:chroot?do=index" title="Sitemap" />
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/feed.php" />
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="/feed.php?mode=list&amp;ns=cn:handbook" />
<link rel="alternate" type="text/html" title="Plain HTML" href="/_export/xhtml/cn:handbook:chroot" />
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/_export/raw/cn:handbook:chroot" />
<link rel="canonical" href="http://doc.slitaz.org/cn:handbook:chroot" />
<link rel="stylesheet" media="screen" type="text/css" href="/lib/exe/css.php?t=slitaz-orange&amp;tseed=1333186571" />
<link rel="stylesheet" media="all" type="text/css" href="/lib/exe/css.php?s=all&amp;t=slitaz-orange&amp;tseed=1333186571" />
<link rel="stylesheet" media="print" type="text/css" href="/lib/exe/css.php?s=print&amp;t=slitaz-orange&amp;tseed=1333186571" />
<script type="text/javascript" ><!--//--><![CDATA[//><!--
var NS='cn:handbook';var JSINFO = {"id":"cn:handbook:chroot","namespace":"cn:handbook"};
//--><!]]></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?tseed=1333186571" ></script>
<script type="text/javascript" src="http://connect.facebook.net/en_US/all.js#xfbml=1" ></script>
  <link rel="shortcut icon" href="/lib/tpl/slitaz-orange/images/favicon.ico" />
</head>
<body>

<div class="dokuwiki">

<!-- Header -->
<div id="header">
	<div id="logo"></div>
	<!-- SliTaz Network -->
	<div id="network">
		<a href="http://www.slitaz.org/">
			<img src="/lib/tpl/slitaz-orange/images/home.png" alt="[ Home ]" /></a>
		<a href="http://scn.slitaz.org/">Community</a>
		<a href="http://doc.slitaz.org/">Doc</a>
		<a href="http://forum.slitaz.org/">Forum</a>
		<a href="http://pro.slitaz.org/">Pro</a>
		<a href="http://slitaz.spreadshirt.net/">Shop</a>
		<a href="http://bugs.slitaz.org">Bugs</a>
		<a href="http://hg.slitaz.org/">Hg</a>
	</div>
	<h1><a href="./">SliTaz Doc</a></h1>
	<!-- <a href="/cn:handbook:chroot?do=backlink"  title="Backlinks">cn:handbook:chroot</a> -->
</div>

<!-- SliTaz Block -->
<div id="block">
		<!-- Languages -->
	<div id="lang">
	<div class="notify">This translation is older than the <a href="/en:handbook:chroot" class="wikilink1">original page</a> and might be outdated. See what has <a href="/en:handbook:chroot?do=diff&amp;rev=1278602063" class="wikilink1">changed</a>.</div><div class="plugin_translation"><span>Translations of this page:</span> <ul><li><div class="li"><a href=/cn:handbook:chroot class="wikilink1 cur" title="cn">cn</a></div></li><li><div class="li"><a href=/de:handbook:chroot class="wikilink2" title="Deutsch">de</a></div></li><li><div class="li"><a href=/en:handbook:chroot class="wikilink1" title="English">en</a></div></li><li><div class="li"><a href=/es:handbook:chroot class="wikilink2" title="español">es</a></div></li><li><div class="li"><a href=/fr:handbook:chroot class="wikilink1" title="français">fr</a></div></li><li><div class="li"><a href=/id:handbook:chroot class="wikilink2" title="Bahasa Indonesia">id</a></div></li><li><div class="li"><a href=/it:handbook:chroot class="wikilink2" title="Italiano">it</a></div></li><li><div class="li"><a href=/pt:handbook:chroot class="wikilink1" title="Português">pt</a></div></li><li><div class="li"><a href=/ro:handbook:chroot class="wikilink2" title="română">ro</a></div></li><li><div class="li"><a href=/ru:handbook:chroot class="wikilink1" title="Русский">ru</a></div></li></ul></div>	</div>
	<div style="text-align: justify; width: 60%; padding: 0 10px 0 0;">
		SliTaz GNU/Linux official and community documentation wiki.
	</div>
	<div class="tools">
		<img src="/lib/tpl/slitaz-orange/images/tools.png" alt=".png" />
		
		<div style="float: right; text-align: right;">
			<form class="button btn_source" method="post" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="submit" value="Show pagesource" class="button" accesskey="v" title="Show pagesource [V]" /></div></form>			<form action="/" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>		</div>
		<form class="button btn_recent" method="get" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="recent" /><input type="submit" value="Recent changes" class="button" accesskey="r" title="Recent changes [R]" /></div></form>								<form class="button btn_login" method="get" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="login" /><input type="hidden" name="sectok" value="c8676286fb03d410534dc370bf06c891" /><input type="submit" value="Login" class="button" title="Login" /></div></form>	</div>
</div>

<!-- Content -->
<div id="content">


<!-- wikipage start -->
<!-- TOC START -->
<div class="toc">
<div class="tocheader toctoggle" id="toc__header">Table of Contents</div>
<div id="toc__inside">

<ul class="toc">
<li class="level1"><div class="li"><span class="li"><a href="#chroot-环境" class="toc">Chroot 环境</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="#准备阶段-适用于所有linux发行版" class="toc">准备阶段 (适用于所有Linux发行版)</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#安装-安装包" class="toc">安装 安装包</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="#exit-the-environment" class="toc">Exit the environment</a></span></div></li></ul>
</li></ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1"><a name="chroot-环境" id="chroot-环境">Chroot 环境</a></h1>
<div class="level1">

<p>
本文档叙述如何构建一个 chrooted 环境的必要步骤, 以改变系统根目录的位置. 这样在此chroot环境上编译测试就不会有影响到宿主系统的风险. 宿主系统可以是安装在硬盘上的Slitaz也可以是其他Linux发行版，如 Debian, Fedora, PCLinuxOS 等等. 要构建一个Chroot环境，你所需要的仅仅是一个可用的Slitaz ISO镜像和一点点时间. 注意所有命令都是以管理员(root)身份执行的。
</p>

<p>
注意
以下方法适用于所有Linux发行版，Slitaz的话，有更简便的方法，可以用tazlito extract-iso 解压 slitaz ISO镜像<br/>

参考：<a href="http://community.slitaz.org/node/47" class="urlextern" title="http://community.slitaz.org/node/47"  rel="nofollow">Slitaz光盘重制基本歩骤</a>

</p>

</div>

<h2 class="sectionedit2"><a name="准备阶段-适用于所有linux发行版" id="准备阶段-适用于所有linux发行版">准备阶段 (适用于所有Linux发行版)</a></h2>
<div class="level2">

<p>
开始之前，我们必须把Slitaz ISO里的Live系统解压出来作为chroot环境. 可以解压到任意位置, 比如 <em>/home/slitaz/chroot-env</em>. 这里假设slitaz ISO就在此目录。
</p>

<p>
挂载slitaz iso文件，拷贝里面的rootfs.gz至当前目录。

</p>
<pre class="code"> # mkdir /tmp/loop
 # mount -o loop slitaz-cooking.iso /tmp/loop
 # mkdir -p /home/slitaz/chroot-env
 # cp /tmp/loop/boot/rootfs.gz \
   /home/slitaz/chroot-env
 # umount /tmp/loop</pre>

<p>
解压此rootfs.gz文件至当前文件夹
</p>
<pre class="code"> # cd /home/slitaz/chroot-env
 # (zcat rootfs.gz 2&gt;/dev/null || lzma d rootfs.gz -so) | cpio -id
 # rm rootfs rootfs.gz</pre>

<p>
若解压失败，请尝试一下方法解压。。
</p>
<pre class="code"> # unlzma rootfs.gz -S .gz 
 # cat rootfs | cpio -id</pre>

</div>

<h4><a name="改变根目录位置chroot" id="改变根目录位置chroot">改变根目录位置chroot</a></h4>
<div class="level4">

<p>

要使用此解压出来的系统，必须要挂载一些虚拟硬盘及使用chroot命令。 为了便利，我们写了个自动化脚本以完成这一步。 我们解压的系统在 <em>/home/slitaz/chroot-env</em> 新建一个脚本 chroot_in_env.sh 放在 <em>/home/slitaz</em>. 在非Slitaz系统下可以取消 <em>/dev</em> 及 <em>/tmp</em>的注释 - 注意：可以复制粘贴一下内容..
</p>
<pre class="code"> # cat &gt; /home/slitaz/chroot_in_env.sh &lt;&lt; &quot;EOF&quot; 

#!/bin/sh
# Chroot in SliTaz to hack.
#
ROOTFS=&quot;/home/slitaz/chroot-env&quot;

# Mount virtual Kernel file systems and chroot.
#
#mount --bind /dev $ROOTFS/dev
#mount --bind /tmp $ROOTFS/tmp
mount -t proc proc $ROOTFS/proc
mount -t sysfs sysfs $ROOTFS/sys
mount -t devpts devpts $ROOTFS/dev/pts
mount -t tmpfs shm $ROOTFS/dev/shm

echo &quot;Chrooting into $ROOTFS... &quot;
chroot $ROOTFS /bin/sh --login

# Unmount virtual Kernel file systems on exit.
#
umount $ROOTFS/dev/shm
umount $ROOTFS/dev/pts
umount $ROOTFS/sys
umount $ROOTFS/proc
#umount $ROOTFS/tmp
#umount $ROOTFS/dev

echo &quot;Exiting $ROOTFS chroot environment... &quot;

EOF
</pre>

<p>
修改脚本文件属性为可执行。
</p>
<pre class="code"> # chmod +x /home/slitaz/chroot_in_env.sh
 # sh /home/slitaz/chroot_in_env.sh</pre>

<p>
激活网络。
 
</p>
<pre class="code"> # udhcpc -i eth1 </pre>

</div>

<h2 class="sectionedit3"><a name="安装-安装包" id="安装-安装包">安装 安装包</a></h2>
<div class="level2">

<p>

若可以上网的话，就可以用tazpkg get-install这个命令从仓库安装包了。
</p>
<pre class="code"># tazpkg recharge
 # tazpkg get-install slitaz-toolchain </pre>

<p>
配置好后，你就可以在宿主Linux下测试Slitaz系统了.Cookbook里会有更详细的说明。
</p>

</div>

<h2 class="sectionedit4"><a name="exit-the-environment" id="exit-the-environment">Exit the environment</a></h2>
<div class="level2">

<p>
要退出chroot环境，只要输入exit就OK了。。
</p>
<pre class="code"> # exit
 #</pre>

</div>

<!-- wikipage stop -->

<div class="clearer">&nbsp;</div>

<div class="meta">
  <div class="user">
	  </div>
  <div class="doc">
	cn/handbook/chroot.txt &middot; Last modified: 2010/07/08 17:14 (external edit)  </div>
</div>

<div style="border-top: 1px solid #eaeaea;">
	<div style="float: right; text-align: right;">
		<form class="button btn_source" method="post" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="submit" value="Show pagesource" class="button" accesskey="v" title="Show pagesource [V]" /></div></form>		<form class="button btn_revs" method="get" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="revisions" /><input type="submit" value="Old revisions" class="button" accesskey="o" title="Old revisions [O]" /></div></form>	</div>
	<form class="button btn_recent" method="get" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="recent" /><input type="submit" value="Recent changes" class="button" accesskey="r" title="Recent changes [R]" /></div></form>	<form class="button btn_index" method="get" action="/cn:handbook:chroot"><div class="no"><input type="hidden" name="do" value="index" /><input type="submit" value="Sitemap" class="button" accesskey="x" title="Sitemap [X]" /></div></form></div>

<!-- End of content -->
</div>

<!-- End of: class="dokuwiki" -->
</div>

<!-- Footer -->
<div id="footer">
	Copyright &copy; <span class="year"></span>
	<a href="http://www.slitaz.org/">SliTaz</a> - Network:
	<a href="http://scn.slitaz.org/">Community</a>
	<a href="http://doc.slitaz.org/">Doc</a>
	<a href="http://forum.slitaz.org/">Forum</a>
	<a href="http://pkgs.slitaz.org/">Packages</a>
	<a href="http://bugs.slitaz.org">Bugs</a>
	<a href="http://hg.slitaz.org/">Hg</a>
	<p>
		SliTaz @
		<a href="http://twitter.com/slitaz">Twitter</a>
		<a href="http://www.facebook.com/slitaz">Facebook</a>
		<a href="http://distrowatch.com/slitaz">Distrowatch</a>
		<a href="http://en.wikipedia.org/wiki/SliTaz">Wikipedia</a>
		<a href="http://flattr.com/profile/slitaz">Flattr</a>
	</p>
</div>

<div class="no">
	<img src="/lib/exe/indexer.php?id=cn%3Ahandbook%3Achroot&amp;1335159714" width="1" height="1" alt=""  /></div>

</body>
</html>
